!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/ray-tracer/",n(n.s=26)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2);e.METADATA_KEY=r;var i=n(32);e.Container=i.Container;var o=n(5);e.BindingScopeEnum=o.BindingScopeEnum,e.BindingTypeEnum=o.BindingTypeEnum,e.TargetTypeEnum=o.TargetTypeEnum;var s=n(48);e.AsyncContainerModule=s.AsyncContainerModule,e.ContainerModule=s.ContainerModule;var a=n(49);e.injectable=a.injectable;var u=n(50);e.tagged=u.tagged;var c=n(51);e.named=c.named;var l=n(21);e.inject=l.inject,e.LazyServiceIdentifer=l.LazyServiceIdentifer;var h=n(52);e.optional=h.optional;var f=n(53);e.unmanaged=f.unmanaged;var d=n(54);e.multiInject=d.multiInject;var p=n(55);e.targetName=p.targetName;var m=n(56);e.postConstruct=m.postConstruct;var g=n(19);e.MetadataReader=g.MetadataReader;var v=n(8);e.guid=v.guid;var _=n(6);e.decorate=_.decorate;var y=n(24);e.traverseAncerstors=y.traverseAncerstors,e.taggedConstraint=y.taggedConstraint,e.namedConstraint=y.namedConstraint,e.typeConstraint=y.typeConstraint;var b=n(11);e.getServiceIdentifierAsString=b.getServiceIdentifierAsString;var w=n(57);e.multiBindToService=w.multiBindToService},function(t,e,n){(function(t){e.Vector=n(9),t.$V=e.Vector.create,e.Matrix=n(12),t.$M=e.Matrix.create,e.Line=n(13),t.$L=e.Line.create,e.Plane=n(18),t.$P=e.Plane.create,e.Line.Segment=n(29),e.Sylvester=n(10)}).call(this,n(17))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NAMED_TAG="named",e.NAME_TAG="name",e.UNMANAGED_TAG="unmanaged",e.OPTIONAL_TAG="optional",e.INJECT_TAG="inject",e.MULTI_INJECT_TAG="multi_inject",e.TAGGED="inversify:tagged",e.TAGGED_PROP="inversify:tagged_props",e.PARAM_TYPES="inversify:paramtypes",e.DESIGN_PARAM_TYPES="design:paramtypes",e.POST_CONSTRUCT="post_construct"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",e.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",e.NULL_ARGUMENT="NULL argument",e.KEY_NOT_FOUND="Key Not Found",e.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",e.CANNOT_UNBIND="Could not unbind serviceIdentifier:",e.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",e.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",e.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:",e.UNDEFINED_INJECT_ANNOTATION=function(t){return"@inject called with undefined this could mean that the class "+t+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."},e.CIRCULAR_DEPENDENCY="Circular dependency found:",e.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",e.INVALID_BINDING_TYPE="Invalid binding type:",e.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",e.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",e.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",e.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",e.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.",e.ARGUMENTS_LENGTH_MISMATCH=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"The number of constructor arguments in the derived class "+t[0]+" must be >= than the number of constructor arguments of its base class."},e.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",e.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",e.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",e.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",e.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class",e.POST_CONSTRUCT_ERROR=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"@postConstruct error in class "+t[0]+": "+t[1]},e.CIRCULAR_DEPENDENCY_IN_FACTORY=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"It looks like there is a circular dependency in one of the '"+t[0]+"' bindings. Please investigate bindings withservice identifier '"+t[1]+"'."},e.STACK_OVERFLOW="Maximum call stack size exceeded"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),i=function(){function t(t,e){this.key=t,this.value=e}return t.prototype.toString=function(){return this.key===r.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},t}();e.Metadata=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.BindingScopeEnum={Request:"Request",Singleton:"Singleton",Transient:"Transient"};e.BindingTypeEnum={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};e.TargetTypeEnum={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(2);function o(t,e,n,i,o){var s={},a="number"==typeof o,u=void 0!==o&&a?o.toString():n;if(a&&void 0!==n)throw new Error(r.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(t,e)&&(s=Reflect.getMetadata(t,e));var c=s[u];if(Array.isArray(c))for(var l=0,h=c;l<h.length;l++){var f=h[l];if(f.key===i.key)throw new Error(r.DUPLICATED_METADATA+" "+f.key)}else c=[];c.push(i),s[u]=c,Reflect.defineMetadata(t,s,e)}function s(t,e){Reflect.decorate(t,e)}e.tagParameter=function(t,e,n,r){o(i.TAGGED,t,e,r,n)},e.tagProperty=function(t,e,n){o(i.TAGGED_PROP,t.constructor,e,n)},e.decorate=function(t,e,n){"number"==typeof n?s([function(t,e){return function(n,r){e(n,r,t)}}(n,t)],e):"string"==typeof n?Reflect.decorate([t],e,n):s([t],e)}},function(t,e,n){"use strict";var r=Object.prototype.hasOwnProperty,i="~";function o(){}function s(t,e,n,r,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new function(t,e,n){this.fn=t,this.context=e,this.once=n||!1}(n,r||t,o),a=i?i+e:e;return t._events[a]?t._events[a].fn?t._events[a]=[t._events[a],s]:t._events[a].push(s):(t._events[a]=s,t._eventsCount++),t}function a(t,e){0==--t._eventsCount?t._events=new o:delete t._events[e]}function u(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),u.prototype.eventNames=function(){var t,e,n=[];if(0===this._eventsCount)return n;for(e in t=this._events)r.call(t,e)&&n.push(i?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},u.prototype.listeners=function(t){var e=i?i+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,o=n.length,s=new Array(o);r<o;r++)s[r]=n[r].fn;return s},u.prototype.listenerCount=function(t){var e=i?i+t:t,n=this._events[e];return n?n.fn?1:n.length:0},u.prototype.emit=function(t,e,n,r,o,s){var a=i?i+t:t;if(!this._events[a])return!1;var u,c,l=this._events[a],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,n),!0;case 4:return l.fn.call(l.context,e,n,r),!0;case 5:return l.fn.call(l.context,e,n,r,o),!0;case 6:return l.fn.call(l.context,e,n,r,o,s),!0}for(c=1,u=new Array(h-1);c<h;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var f,d=l.length;for(c=0;c<d;c++)switch(l[c].once&&this.removeListener(t,l[c].fn,void 0,!0),h){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,e);break;case 3:l[c].fn.call(l[c].context,e,n);break;case 4:l[c].fn.call(l[c].context,e,n,r);break;default:if(!u)for(f=1,u=new Array(h-1);f<h;f++)u[f-1]=arguments[f];l[c].fn.apply(l[c].context,u)}}return!0},u.prototype.on=function(t,e,n){return s(this,t,e,n,!1)},u.prototype.once=function(t,e,n){return s(this,t,e,n,!0)},u.prototype.removeListener=function(t,e,n,r){var o=i?i+t:t;if(!this._events[o])return this;if(!e)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==e||r&&!s.once||n&&s.context!==n||a(this,o);else{for(var u=0,c=[],l=s.length;u<l;u++)(s[u].fn!==e||r&&!s[u].once||n&&s[u].context!==n)&&c.push(s[u]);c.length?this._events[o]=1===c.length?c[0]:c:a(this,o)}return this},u.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&a(this,e)):(this._events=new o,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=i,u.EventEmitter=u,t.exports=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.guid=function(){function t(){return Math.floor(65536*(Math.random()+1)).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}},function(t,e,n){var r=n(10),i=n(12);function o(){}o.prototype={norm:function(){for(var t=this.elements.length,e=0;t--;)e+=Math.pow(this.elements[t],2);return Math.sqrt(e)},e:function(t){return t<1||t>this.elements.length?null:this.elements[t-1]},dimensions:function(){return{rows:1,cols:this.elements.length}},rows:function(){return 1},cols:function(){return this.elements.length},modulus:function(){return Math.sqrt(this.dot(this))},eql:function(t){var e=this.elements.length,n=t.elements||t;if(e!=n.length)return!1;for(;e--;)if(Math.abs(this.elements[e]-n[e])>r.precision)return!1;return!0},dup:function(){return o.create(this.elements)},map:function(t){var e=[];return this.each(function(n,r){e.push(t(n,r))}),o.create(e)},each:function(t){for(var e=this.elements.length,n=0;n<e;n++)t(this.elements[n],n+1)},toUnitVector:function(){var t=this.modulus();return 0===t?this.dup():this.map(function(e){return e/t})},angleFrom:function(t){var e=t.elements||t,n=this.elements.length;if(n!=e.length)return null;var r=0,i=0,o=0;if(this.each(function(t,n){r+=t*e[n-1],i+=t*t,o+=e[n-1]*e[n-1]}),i=Math.sqrt(i),o=Math.sqrt(o),i*o==0)return null;var s=r/(i*o);return s<-1&&(s=-1),s>1&&(s=1),Math.acos(s)},isParallelTo:function(t){var e=this.angleFrom(t);return null===e?null:e<=r.precision},isAntiparallelTo:function(t){var e=this.angleFrom(t);return null===e?null:Math.abs(e-Math.PI)<=r.precision},isPerpendicularTo:function(t){var e=this.dot(t);return null===e?null:Math.abs(e)<=r.precision},add:function(t){var e=t.elements||t;return this.elements.length!=e.length?this.map(function(e){return e+t}):this.map(function(t,n){return t+e[n-1]})},subtract:function(t){if("number"==typeof t)return this.map(function(e){return e-t});var e=t.elements||t;return this.elements.length!=e.length?null:this.map(function(t,n){return t-e[n-1]})},multiply:function(t){return this.map(function(e){return e*t})},elementMultiply:function(t){return this.map(function(e,n){return t.e(n)*e})},sum:function(){var t=0;return this.map(function(e){t+=e}),t},chomp:function(t){for(var e=[],n=t;n<this.elements.length;n++)e.push(this.elements[n]);return o.create(e)},top:function(t){for(var e=[],n=0;n<t;n++)e.push(this.elements[n]);return o.create(e)},augment:function(t){for(var e=this.elements,n=0;n<t.length;n++)e.push(t[n]);return o.create(e)},x:function(t){return this.multiply(t)},log:function(){return o.log(this)},elementDivide:function(t){return this.map(function(e,n){return e/t.e(n)})},product:function(){var t=1;return this.map(function(e){t*=e}),t},dot:function(t){var e=t.elements||t,n=0,r=this.elements.length;if(r!=e.length)return null;for(;r--;)n+=this.elements[r]*e[r];return n},cross:function(t){var e=t.elements||t;if(3!=this.elements.length||3!=e.length)return null;var n=this.elements;return o.create([n[1]*e[2]-n[2]*e[1],n[2]*e[0]-n[0]*e[2],n[0]*e[1]-n[1]*e[0]])},max:function(){for(var t=0,e=this.elements.length;e--;)Math.abs(this.elements[e])>Math.abs(t)&&(t=this.elements[e]);return t},maxIndex:function(){for(var t=0,e=this.elements.length,n=-1;e--;)Math.abs(this.elements[e])>Math.abs(t)&&(t=this.elements[e],n=e+1);return n},indexOf:function(t){for(var e=null,n=this.elements.length,r=0;r<n;r++)null===e&&this.elements[r]==t&&(e=r+1);return e},toDiagonalMatrix:function(){return i.Diagonal(this.elements)},round:function(){return this.map(function(t){return Math.round(t)})},transpose:function(){for(var t=this.elements.length,e=[],n=0;n<t;n++)e.push([this.elements[n]]);return i.create(e)},snapTo:function(t){return this.map(function(e){return Math.abs(e-t)<=r.precision?t:e})},distanceFrom:function(t){if(t.anchor||t.start&&t.end)return t.distanceFrom(this);var e=t.elements||t;if(e.length!=this.elements.length)return null;var n,r=0;return this.each(function(t,i){n=t-e[i-1],r+=n*n}),Math.sqrt(r)},liesOn:function(t){return t.contains(this)},liesIn:function(t){return t.contains(this)},rotate:function(t,e){var n,r,s,a,u=null;switch(t.determinant&&(u=t.elements),this.elements.length){case 2:return 2!=(n=e.elements||e).length?null:(u||(u=i.Rotation(t).elements),r=this.elements[0]-n[0],s=this.elements[1]-n[1],o.create([n[0]+u[0][0]*r+u[0][1]*s,n[1]+u[1][0]*r+u[1][1]*s]));case 3:if(!e.direction)return null;var c=e.pointClosestTo(this).elements;return u||(u=i.Rotation(t,e.direction).elements),r=this.elements[0]-c[0],s=this.elements[1]-c[1],a=this.elements[2]-c[2],o.create([c[0]+u[0][0]*r+u[0][1]*s+u[0][2]*a,c[1]+u[1][0]*r+u[1][1]*s+u[1][2]*a,c[2]+u[2][0]*r+u[2][1]*s+u[2][2]*a]);default:return null}},reflectionIn:function(t){if(t.anchor){var e=this.elements.slice(),n=t.pointClosestTo(e).elements;return o.create([n[0]+(n[0]-e[0]),n[1]+(n[1]-e[1]),n[2]+(n[2]-(e[2]||0))])}var r=t.elements||t;return this.elements.length!=r.length?null:this.map(function(t,e){return r[e-1]+(r[e-1]-t)})},to3D:function(){var t=this.dup();switch(t.elements.length){case 3:break;case 2:t.elements.push(0);break;default:return null}return t},inspect:function(){return"["+this.elements.join(", ")+"]"},setElements:function(t){return this.elements=(t.elements||t).slice(),this}},o.create=function(t){return(new o).setElements(t)},o.i=o.create([1,0,0]),o.j=o.create([0,1,0]),o.k=o.create([0,0,1]),o.Random=function(t){for(var e=[];t--;)e.push(Math.random());return o.create(e)},o.Fill=function(t,e){for(var n=[];t--;)n.push(e);return o.create(n)},o.Zero=function(t){return o.Fill(t,0)},o.One=function(t){return o.Fill(t,1)},o.log=function(t){return t.map(function(t){return Math.log(t)})},t.exports=o},function(t,e){Math.sign=function(t){return t<0?-1:1};t.exports={precision:1e-6,approxPrecision:1e-5}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3);function i(t){return"function"==typeof t?t.name:"symbol"==typeof t?t.toString():t}function o(t){if(t.name)return t.name;var e=t.toString(),n=e.match(/^function\s*([^\s(]+)/);return n?n[1]:"Anonymous function: "+e}e.getServiceIdentifierAsString=i,e.listRegisteredBindingsForServiceIdentifier=function(t,e,n){var r="",i=n(t,e);return 0!==i.length&&(r="\nRegistered bindings:",i.forEach(function(t){var e="Object";null!==t.implementationType&&(e=o(t.implementationType)),r=r+"\n "+e,t.constraint.metaData&&(r=r+" - "+t.constraint.metaData)})),r},e.circularDependencyToException=function t(e){e.childRequests.forEach(function(e){if(function t(e,n){return null!==e.parentRequest&&(e.parentRequest.serviceIdentifier===n||t(e.parentRequest,n))}(e,e.serviceIdentifier)){var n=function(t){return function t(e,n){void 0===n&&(n=[]);var r=i(e.serviceIdentifier);return n.push(r),null!==e.parentRequest?t(e.parentRequest,n):n}(t).reverse().join(" --\x3e ")}(e);throw new Error(r.CIRCULAR_DEPENDENCY+" "+n)}t(e)})},e.listMetadataForTarget=function(t,e){if(e.isTagged()||e.isNamed()){var n="",r=e.getNamedTag(),i=e.getCustomTags();return null!==r&&(n+=r.toString()+"\n"),null!==i&&i.forEach(function(t){n+=t.toString()+"\n"})," "+t+"\n "+t+" - "+n}return" "+t},e.getFunctionName=o},function(t,e,n){var r=n(28),o=n(10);n(9);function s(t,e,n,r){for(var i=t.elements,o=r-1;o--;){for(var s=[],a=0;a<n;a++)s.push(a==o?1:0);i.unshift(s)}for(o=r-1;o<e;o++)for(;i[o].length<n;)i[o].unshift(0);return $M(i)}function a(){for(var t=this,e=h.I(t.rows()),n=t.transpose(),r=h.I(t.cols()),i=Number.MAX_VALUE,o=0;i>2.2737e-13&&o<100;){var s=n.transpose().qrJs();n=s.R,e=e.x(s.Q),s=n.transpose().qrJs(),r=r.x(s.Q);var a=(n=s.R).triu(1).unroll().norm(),u=n.diagonal().norm();0==u&&(u=1),i=a/u,o++}var c=n.diagonal(),l=[];for(o=1;o<=c.cols();o++){var f=c.e(o);if(l.push(Math.abs(f)),f<0)for(var d=0;d<r.rows();d++)e.elements[d][o-1]=-e.elements[d][o-1]}return{U:r,S:$V(l).toDiagonalMatrix(),V:e}}function u(){var t=d.sgesvd("A","A",this.elements);return{U:$M(t.U),S:$M(t.S).column(1).toDiagonalMatrix(),V:$M(t.VT).transpose()}}function c(){for(var t=this.rows(),e=this.cols(),n=h.I(t),r=this,i=1;i<Math.min(t,e);i++){for(var o=r.slice(i,0,i,i).col(1),a=[1];a.length<=t-i;)a.push(0);a=$V(a);var u=o.add(a.x(o.norm()*Math.sign(o.e(1)))),c=$M(u),l=s(h.I(t-i+1).subtract(c.x(2).x(c.transpose()).div(c.transpose().x(c).e(1,1))),t,e,i);r=l.x(r),n=n.x(l)}return{Q:n,R:r}}function l(){var t=d.qr(this.elements);return{Q:$M(t.Q),R:$M(t.R)}}function h(){}function f(){var t=d.lu(this.elements);return{L:$M(t.L),U:$M(t.U),P:$M(t.P)}}h.prototype={solve:function(t){var e=this.lu();t=e.P.x(t);var n=e.L.forwardSubstitute(t),r=e.U.backSubstitute(n);return e.P.x(r)},pcaProject:function(t,e){var n=(e=e||function(t){var e=t.transpose().x(t).x(1/t.rows()).svd();return{U:e.U,S:e.S}}(this).U).slice(1,e.rows(),1,t);return{Z:this.x(n),U:e}},pcaRecover:function(t){var e=this.cols(),n=t.slice(1,t.rows(),1,e);return this.x(n.transpose())},triu:function(t){return t||(t=0),this.map(function(e,n,r){return r-n>=t?e:0})},unroll:function(){for(var t=[],e=1;e<=this.cols();e++)for(var n=1;n<=this.rows();n++)t.push(this.e(n,e));return $V(t)},slice:function(t,e,n,r){var o=[];for(0==e&&(e=this.rows()),0==r&&(r=this.cols()),i=t;i<=e;i++){var s=[];for(j=n;j<=r;j++)s.push(this.e(i,j));o.push(s)}return $M(o)},e:function(t,e){return t<1||t>this.elements.length||e<1||e>this.elements[0].length?null:this.elements[t-1][e-1]},row:function(t){return t>this.elements.length?null:$V(this.elements[t-1])},col:function(t){if(t>this.elements[0].length)return null;for(var e=[],n=this.elements.length,r=0;r<n;r++)e.push(this.elements[r][t-1]);return $V(e)},dimensions:function(){return{rows:this.elements.length,cols:this.elements[0].length}},rows:function(){return this.elements.length},cols:function(){return this.elements[0].length},approxEql:function(t){return this.eql(t,o.approxPrecision)},eql:function(t,e){var n=t.elements||t;if(void 0===n[0][0]&&(n=h.create(n).elements),this.elements.length!=n.length||this.elements[0].length!=n[0].length)return!1;for(var r,i=this.elements.length,s=this.elements[0].length;i--;)for(r=s;r--;)if(Math.abs(this.elements[i][r]-n[i][r])>(e||o.precision))return!1;return!0},dup:function(){return h.create(this.elements)},map:function(t){for(var e,n=[],r=this.elements.length,i=this.elements[0].length;r--;)for(e=i,n[r]=[];e--;)n[r][e]=t(this.elements[r][e],r+1,e+1);return h.create(n)},isSameSizeAs:function(t){var e=t.elements||t;return void 0===e[0][0]&&(e=h.create(e).elements),this.elements.length==e.length&&this.elements[0].length==e[0].length},add:function(t){if("number"==typeof t)return this.map(function(e,n,r){return e+t});var e=t.elements||t;return void 0===e[0][0]&&(e=h.create(e).elements),this.isSameSizeAs(e)?this.map(function(t,n,r){return t+e[n-1][r-1]}):null},subtract:function(t){if("number"==typeof t)return this.map(function(e,n,r){return e-t});var e=t.elements||t;return void 0===e[0][0]&&(e=h.create(e).elements),this.isSameSizeAs(e)?this.map(function(t,n,r){return t-e[n-1][r-1]}):null},canMultiplyFromLeft:function(t){var e=t.elements||t;return void 0===e[0][0]&&(e=h.create(e).elements),this.elements[0].length==e.length},mulOp:function(t,e){if(!t.elements)return this.map(function(n){return e(n,t)});var n=!!t.modulus;if(void 0===(m=t.elements||t)[0][0]&&(m=h.create(m).elements),!this.canMultiplyFromLeft(m))return null;for(var r,i,o,s,a,u=this.elements,c=[],l=u.length,f=m[0].length,d=u[0].length,p=l;p--;){for(i=[],r=u[p],s=f;s--;){for(o=0,a=d;a--;)o+=e(r[a],m[a][s]);i[s]=o}c[p]=i}var m=h.create(c);return n?m.col(1):m},div:function(t){return this.mulOp(t,function(t,e){return t/e})},multiply:function(t){return this.mulOp(t,function(t,e){return t*e})},x:function(t){return this.multiply(t)},elementMultiply:function(t){return this.map(function(e,n,r){return t.e(n,r)*e})},sum:function(){var t=0;return this.map(function(e){t+=e}),t},mean:function(){for(var t=this.dimensions(),e=[],n=1;n<=t.cols;n++)e.push(this.col(n).sum()/t.rows);return $V(e)},column:function(t){return this.col(t)},log:function(){return this.map(function(t){return Math.log(t)})},minor:function(t,e,n,r){for(var i,o,s,a=[],u=n,c=this.elements.length,l=this.elements[0].length;u--;)for(a[i=n-u-1]=[],o=r;o--;)s=r-o-1,a[i][s]=this.elements[(t+i-1)%c][(e+s-1)%l];return h.create(a)},transpose:function(){for(var t,e=this.elements.length,n=[],r=this.elements[0].length;r--;)for(t=e,n[r]=[];t--;)n[r][t]=this.elements[t][r];return h.create(n)},isSquare:function(){return this.elements.length==this.elements[0].length},max:function(){for(var t,e=0,n=this.elements.length,r=this.elements[0].length;n--;)for(t=r;t--;)Math.abs(this.elements[n][t])>Math.abs(e)&&(e=this.elements[n][t]);return e},indexOf:function(t){var e,n,r=this.elements.length,i=this.elements[0].length;for(e=0;e<r;e++)for(n=0;n<i;n++)if(this.elements[e][n]==t)return{i:e+1,j:n+1};return null},diagonal:function(){if(!this.isSquare)return null;for(var t=[],e=this.elements.length,n=0;n<e;n++)t.push(this.elements[n][n]);return $V(t)},toRightTriangular:function(){var t,e,n,r,i=this.dup(),o=this.elements.length,s=this.elements[0].length;for(e=0;e<o;e++){if(0==i.elements[e][e])for(n=e+1;n<o;n++)if(0!=i.elements[n][e]){for(t=[],r=0;r<s;r++)t.push(i.elements[e][r]+i.elements[n][r]);i.elements[e]=t;break}if(0!=i.elements[e][e])for(n=e+1;n<o;n++){var a=i.elements[n][e]/i.elements[e][e];for(t=[],r=0;r<s;r++)t.push(r<=e?0:i.elements[n][r]-i.elements[e][r]*a);i.elements[n]=t}}return i},toUpperTriangular:function(){return this.toRightTriangular()},determinant:function(){if(!this.isSquare())return null;if(1==this.cols&&1==this.rows)return this.row(1);if(0==this.cols&&0==this.rows)return 1;for(var t=this.toRightTriangular(),e=t.elements[0][0],n=t.elements.length,r=1;r<n;r++)e*=t.elements[r][r];return e},det:function(){return this.determinant()},isSingular:function(){return this.isSquare()&&0===this.determinant()},trace:function(){if(!this.isSquare())return null;for(var t=this.elements[0][0],e=this.elements.length,n=1;n<e;n++)t+=this.elements[n][n];return t},tr:function(){return this.trace()},rank:function(){for(var t,e=this.toRightTriangular(),n=0,r=this.elements.length,i=this.elements[0].length;r--;)for(t=i;t--;)if(Math.abs(e.elements[r][t])>o.precision){n++;break}return n},rk:function(){return this.rank()},augment:function(t){var e=t.elements||t;void 0===e[0][0]&&(e=h.create(e).elements);var n,r=this.dup(),i=r.elements[0].length,o=r.elements.length,s=e[0].length;if(o!=e.length)return null;for(;o--;)for(n=s;n--;)r.elements[o][i+n]=e[o][n];return r},inverse:function(){if(!this.isSquare()||this.isSingular())return null;for(var t,e,n,r,i,o=this.elements.length,s=o,a=this.augment(h.I(o)).toRightTriangular(),u=a.elements[0].length,c=[];s--;){for(n=[],c[s]=[],r=a.elements[s][s],e=0;e<u;e++)i=a.elements[s][e]/r,n.push(i),e>=o&&c[s].push(i);for(a.elements[s]=n,t=s;t--;){for(n=[],e=0;e<u;e++)n.push(a.elements[t][e]-a.elements[s][e]*a.elements[t][s]);a.elements[t]=n}}return h.create(c)},inv:function(){return this.inverse()},round:function(){return this.map(function(t){return Math.round(t)})},snapTo:function(t){return this.map(function(e){return Math.abs(e-t)<=o.precision?t:e})},inspect:function(){for(var t=[],e=this.elements.length,n=0;n<e;n++)t.push($V(this.elements[n]).inspect());return t.join("\n")},toArray:function(){for(var t=[],e=this.elements.length,n=0;n<e;n++)t.push(this.elements[n]);return t},setElements:function(t){var e,n,r=t.elements||t;if(void 0!==r[0][0]){for(e=r.length,this.elements=[];e--;)for(n=r[e].length,this.elements[e]=[];n--;)this.elements[e][n]=r[e][n];return this}var i=r.length;for(this.elements=[],e=0;e<i;e++)this.elements.push([r[e]]);return this},maxColumnIndexes:function(){for(var t=[],e=1;e<=this.rows();e++){for(var n=null,r=-1,i=1;i<=this.cols();i++)(null===n||this.e(e,i)>n)&&(n=this.e(e,i),r=i);t.push(r)}return $V(t)},maxColumns:function(){for(var t=[],e=1;e<=this.rows();e++){for(var n=null,r=1;r<=this.cols();r++)(null===n||this.e(e,r)>n)&&(n=this.e(e,r));t.push(n)}return $V(t)},minColumnIndexes:function(){for(var t=[],e=1;e<=this.rows();e++){for(var n=null,r=-1,i=1;i<=this.cols();i++)(null===n||this.e(e,i)<n)&&(n=this.e(e,i),r=i);t.push(r)}return $V(t)},minColumns:function(){for(var t=[],e=1;e<=this.rows();e++){for(var n=null,r=1;r<=this.cols();r++)(null===n||this.e(e,r)<n)&&(n=this.e(e,r));t.push(n)}return $V(t)},partialPivot:function(t,e,n,r,i){for(var o=0,s=0,a=t;a<=r.rows();a++)Math.abs(r.e(a,e))>s&&(s=Math.abs(r.e(t,e)),o=a);if(o!=t){var u=r.elements[t-1];r.elements[t-1]=r.elements[o-1],r.elements[o-1]=u,n.elements[t-1][t-1]=0,n.elements[t-1][o-1]=1,n.elements[o-1][o-1]=0,n.elements[o-1][t-1]=1}return n},forwardSubstitute:function(t){for(var e=[],n=1;n<=this.rows();n++){for(var r=0,i=1;i<n;i++)r+=this.e(n,i)*e[i-1];e.push((t.e(n)-r)/this.e(n,n))}return $V(e)},backSubstitute:function(t){for(var e=[],n=this.rows();n>0;n--){for(var r=0,i=this.cols();i>n;i--)r+=this.e(n,i)*e[this.rows()-i];e.push((t.e(n)-r)/this.e(n,n))}return $V(e.reverse())},luPack:f,luJs:p,svdJs:a,svdPack:u,qrJs:c,qrPack:l};var d;function p(){for(var t=this.dup(),e=h.I(t.rows()),n=h.I(t.rows()),r=h.Zeros(t.rows(),t.cols()),i=1,o=1;o<=Math.min(t.cols(),t.rows());o++){n=t.partialPivot(o,i,n,t,e);for(var s=o+1;s<=t.rows();s++){var a=t.e(s,i)/t.e(o,i);e.elements[s-1][o-1]=a;for(var u=o+1;u<=t.cols();u++)t.elements[s-1][u-1]-=t.e(o,u)*a}for(u=o;u<=t.cols();u++)r.elements[o-1][u-1]=t.e(o,u);i<t.cols()&&i++}return{L:e,U:r,P:n}}(d=function(){try{return n(!function(){var t=new Error("Cannot find module 'lapack'");throw t.code="MODULE_NOT_FOUND",t}())}catch(t){}}())?(h.prototype.svd=u,h.prototype.qr=l,h.prototype.lu=f):(h.prototype.svd=a,h.prototype.qr=c,h.prototype.lu=p),h.create=function(t,e){return(new h).setElements(t)},h.I=function(t){for(var e,n=[],r=t;r--;)for(e=t,n[r]=[];e--;)n[r][e]=r==e?1:0;return h.create(n)},h.loadFile=function(t){for(var e=[],n=r.readFileSync(t,"utf-8").split("\n"),i=0;i<n.length;i++){var o=n[i].split(",");o.length>1&&e.push(o)}return(new h).setElements(e)},h.Diagonal=function(t){for(var e=t.length,n=h.I(e);e--;)n.elements[e][e]=t[e];return n},h.Rotation=function(t,e){if(!e)return h.create([[Math.cos(t),-Math.sin(t)],[Math.sin(t),Math.cos(t)]]);var n=e.dup();if(3!=n.elements.length)return null;var r=n.modulus(),i=n.elements[0]/r,o=n.elements[1]/r,s=n.elements[2]/r,a=Math.sin(t),u=Math.cos(t),c=1-u;return h.create([[c*i*i+u,c*i*o-a*s,c*i*s+a*o],[c*i*o+a*s,c*o*o+u,c*o*s-a*i],[c*i*s-a*o,c*o*s+a*i,c*s*s+u]])},h.RotationX=function(t){var e=Math.cos(t),n=Math.sin(t);return h.create([[1,0,0],[0,e,-n],[0,n,e]])},h.RotationY=function(t){var e=Math.cos(t),n=Math.sin(t);return h.create([[e,0,n],[0,1,0],[-n,0,e]])},h.RotationZ=function(t){var e=Math.cos(t),n=Math.sin(t);return h.create([[e,-n,0],[n,e,0],[0,0,1]])},h.Random=function(t,e){return 1===arguments.length&&(e=t),h.Zero(t,e).map(function(){return Math.random()})},h.Fill=function(t,e,n){2===arguments.length&&(n=e,e=t);for(var r,i=[],o=t;o--;)for(r=e,i[o]=[];r--;)i[o][r]=n;return h.create(i)},h.Zero=function(t,e){return h.Fill(t,e,0)},h.Zeros=function(t,e){return h.Zero(t,e)},h.One=function(t,e){return h.Fill(t,e,1)},h.Ones=function(t,e){return h.One(t,e)},t.exports=h},function(t,e,n){var r=n(9),i=n(12),o=n(18),s=n(10);function a(){}a.prototype={eql:function(t){return this.isParallelTo(t)&&this.contains(t.anchor)},dup:function(){return a.create(this.anchor,this.direction)},translate:function(t){var e=t.elements||t;return a.create([this.anchor.elements[0]+e[0],this.anchor.elements[1]+e[1],this.anchor.elements[2]+(e[2]||0)],this.direction)},isParallelTo:function(t){if(t.normal||t.start&&t.end)return t.isParallelTo(this);var e=this.direction.angleFrom(t.direction);return Math.abs(e)<=s.precision||Math.abs(e-Math.PI)<=s.precision},distanceFrom:function(t){if(t.normal||t.start&&t.end)return t.distanceFrom(this);if(t.direction){if(this.isParallelTo(t))return this.distanceFrom(t.anchor);var e=this.direction.cross(t.direction).toUnitVector().elements,n=this.anchor.elements,r=t.anchor.elements;return Math.abs((n[0]-r[0])*e[0]+(n[1]-r[1])*e[1]+(n[2]-r[2])*e[2])}var i=t.elements||t,o=(n=this.anchor.elements,this.direction.elements),s=i[0]-n[0],a=i[1]-n[1],u=(i[2]||0)-n[2],c=Math.sqrt(s*s+a*a+u*u);if(0===c)return 0;var l=(s*o[0]+a*o[1]+u*o[2])/c,h=1-l*l;return Math.abs(c*Math.sqrt(h<0?0:h))},contains:function(t){if(t.start&&t.end)return this.contains(t.start)&&this.contains(t.end);var e=this.distanceFrom(t);return null!==e&&e<=s.precision},positionOf:function(t){if(!this.contains(t))return null;var e=t.elements||t,n=this.anchor.elements,r=this.direction.elements;return(e[0]-n[0])*r[0]+(e[1]-n[1])*r[1]+((e[2]||0)-n[2])*r[2]},liesIn:function(t){return t.contains(this)},intersects:function(t){return t.normal?t.intersects(this):!this.isParallelTo(t)&&this.distanceFrom(t)<=s.precision},intersectionWith:function(t){if(t.normal||t.start&&t.end)return t.intersectionWith(this);if(!this.intersects(t))return null;var e=this.anchor.elements,n=this.direction.elements,i=t.anchor.elements,o=t.direction.elements,s=n[0],a=n[1],u=n[2],c=o[0],l=o[1],h=o[2],f=e[0]-i[0],d=e[1]-i[1],p=e[2]-i[2],m=c*c+l*l+h*h,g=s*c+a*l+u*h,v=((-s*f-a*d-u*p)*m/(s*s+a*a+u*u)+g*(c*f+l*d+h*p))/(m-g*g);return r.create([e[0]+v*s,e[1]+v*a,e[2]+v*u])},pointClosestTo:function(t){if(t.start&&t.end)return null===(f=t.pointClosestTo(this))?null:this.pointClosestTo(f);if(t.direction){if(this.intersects(t))return this.intersectionWith(t);if(this.isParallelTo(t))return null;var e=this.direction.elements,n=t.direction.elements,i=e[0],s=e[1],a=e[2],u=n[0],c=n[1],l=n[2],h=[(v=a*u-i*l)*l-(_=i*c-s*u)*c,_*u-(y=s*l-a*c)*l,y*c-v*u];return(f=o.create(t.anchor,h)).intersectionWith(this)}var f=t.elements||t;if(this.contains(f))return r.create(f);var d=this.anchor.elements,p=(i=(e=this.direction.elements)[0],s=e[1],a=e[2],d[0]),m=d[1],g=d[2],v=i*(f[1]-m)-s*(f[0]-p),_=s*((f[2]||0)-g)-a*(f[1]-m),y=a*(f[0]-p)-i*((f[2]||0)-g),b=r.create([s*v-a*y,a*_-i*v,i*y-s*_]),w=this.distanceFrom(f)/b.modulus();return r.create([f[0]+b.elements[0]*w,f[1]+b.elements[1]*w,(f[2]||0)+b.elements[2]*w])},rotate:function(t,e){void 0===e.direction&&(e=a.create(e.to3D(),r.k));var n=i.Rotation(t,e.direction).elements,o=e.pointClosestTo(this.anchor).elements,s=this.anchor.elements,u=this.direction.elements,c=o[0],l=o[1],h=o[2],f=s[0]-c,d=s[1]-l,p=s[2]-h;return a.create([c+n[0][0]*f+n[0][1]*d+n[0][2]*p,l+n[1][0]*f+n[1][1]*d+n[1][2]*p,h+n[2][0]*f+n[2][1]*d+n[2][2]*p],[n[0][0]*u[0]+n[0][1]*u[1]+n[0][2]*u[2],n[1][0]*u[0]+n[1][1]*u[1]+n[1][2]*u[2],n[2][0]*u[0]+n[2][1]*u[1]+n[2][2]*u[2]])},reverse:function(){return a.create(this.anchor,this.direction.x(-1))},reflectionIn:function(t){if(t.normal){var e=this.anchor.elements,n=this.direction.elements,r=e[0],i=e[1],o=e[2],s=n[0],u=n[1],c=n[2],l=this.anchor.reflectionIn(t).elements,h=r+s,f=i+u,d=o+c,p=t.pointClosestTo([h,f,d]).elements,m=[p[0]+(p[0]-h)-l[0],p[1]+(p[1]-f)-l[1],p[2]+(p[2]-d)-l[2]];return a.create(l,m)}if(t.direction)return this.rotate(Math.PI,t);var g=t.elements||t;return a.create(this.anchor.reflectionIn([g[0],g[1],g[2]||0]),this.direction)},setVectors:function(t,e){if(t=r.create(t),e=r.create(e),2==t.elements.length&&t.elements.push(0),2==e.elements.length&&e.elements.push(0),t.elements.length>3||e.elements.length>3)return null;var n=e.modulus();return 0===n?null:(this.anchor=t,this.direction=r.create([e.elements[0]/n,e.elements[1]/n,e.elements[2]/n]),this)}},a.create=function(t,e){return(new a).setVectors(t,e)},a.X=a.create(r.Zero(3),r.i),a.Y=a.create(r.Zero(3),r.j),a.Z=a.create(r.Zero(3),r.k),t.exports=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(15),i=function(){function t(t){this._binding=t}return t.prototype.onActivation=function(t){return this._binding.onActivation=t,new r.BindingWhenSyntax(this._binding)},t}();e.BindingOnSyntax=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(14),i=n(24),o=function(){function t(t){this._binding=t}return t.prototype.when=function(t){return this._binding.constraint=t,new r.BindingOnSyntax(this._binding)},t.prototype.whenTargetNamed=function(t){return this._binding.constraint=i.namedConstraint(t),new r.BindingOnSyntax(this._binding)},t.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(t){return null!==t.target&&!t.target.isNamed()&&!t.target.isTagged()},new r.BindingOnSyntax(this._binding)},t.prototype.whenTargetTagged=function(t,e){return this._binding.constraint=i.taggedConstraint(t)(e),new r.BindingOnSyntax(this._binding)},t.prototype.whenInjectedInto=function(t){return this._binding.constraint=function(e){return i.typeConstraint(t)(e.parentRequest)},new r.BindingOnSyntax(this._binding)},t.prototype.whenParentNamed=function(t){return this._binding.constraint=function(e){return i.namedConstraint(t)(e.parentRequest)},new r.BindingOnSyntax(this._binding)},t.prototype.whenParentTagged=function(t,e){return this._binding.constraint=function(n){return i.taggedConstraint(t)(e)(n.parentRequest)},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorIs=function(t){return this._binding.constraint=function(e){return i.traverseAncerstors(e,i.typeConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorIs=function(t){return this._binding.constraint=function(e){return!i.traverseAncerstors(e,i.typeConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorNamed=function(t){return this._binding.constraint=function(e){return i.traverseAncerstors(e,i.namedConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorNamed=function(t){return this._binding.constraint=function(e){return!i.traverseAncerstors(e,i.namedConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._binding.constraint=function(n){return i.traverseAncerstors(n,i.taggedConstraint(t)(e))},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorTagged=function(t,e){return this._binding.constraint=function(n){return!i.traverseAncerstors(n,i.taggedConstraint(t)(e))},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorMatches=function(t){return this._binding.constraint=function(e){return i.traverseAncerstors(e,t)},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorMatches=function(t){return this._binding.constraint=function(e){return!i.traverseAncerstors(e,t)},new r.BindingOnSyntax(this._binding)},t}();e.BindingWhenSyntax=o},function(t,e,n){var r;
/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */
/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */
!function(i,o,s,a){"use strict";var u,c=["","webkit","Moz","MS","ms","o"],l=o.createElement("div"),h="function",f=Math.round,d=Math.abs,p=Date.now;function m(t,e,n){return setTimeout(E(t,n),e)}function g(t,e,n){return!!Array.isArray(t)&&(v(t,n[e],n),!0)}function v(t,e,n){var r;if(t)if(t.forEach)t.forEach(e,n);else if(t.length!==a)for(r=0;r<t.length;)e.call(n,t[r],r,t),r++;else for(r in t)t.hasOwnProperty(r)&&e.call(n,t[r],r,t)}function _(t,e,n){var r="DEPRECATED METHOD: "+e+"\n"+n+" AT \n";return function(){var e=new Error("get-stack-trace"),n=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=i.console&&(i.console.warn||i.console.log);return o&&o.call(i.console,r,n),t.apply(this,arguments)}}u="function"!=typeof Object.assign?function(t){if(t===a||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(r!==a&&null!==r)for(var i in r)r.hasOwnProperty(i)&&(e[i]=r[i])}return e}:Object.assign;var y=_(function(t,e,n){for(var r=Object.keys(e),i=0;i<r.length;)(!n||n&&t[r[i]]===a)&&(t[r[i]]=e[r[i]]),i++;return t},"extend","Use `assign`."),b=_(function(t,e){return y(t,e,!0)},"merge","Use `assign`.");function w(t,e,n){var r,i=e.prototype;(r=t.prototype=Object.create(i)).constructor=t,r._super=i,n&&u(r,n)}function E(t,e){return function(){return t.apply(e,arguments)}}function T(t,e){return typeof t==h?t.apply(e&&e[0]||a,e):t}function x(t,e){return t===a?e:t}function A(t,e,n){v(M(e),function(e){t.addEventListener(e,n,!1)})}function S(t,e,n){v(M(e),function(e){t.removeEventListener(e,n,!1)})}function O(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function C(t,e){return t.indexOf(e)>-1}function M(t){return t.trim().split(/\s+/g)}function I(t,e,n){if(t.indexOf&&!n)return t.indexOf(e);for(var r=0;r<t.length;){if(n&&t[r][n]==e||!n&&t[r]===e)return r;r++}return-1}function P(t){return Array.prototype.slice.call(t,0)}function R(t,e,n){for(var r=[],i=[],o=0;o<t.length;){var s=e?t[o][e]:t[o];I(i,s)<0&&r.push(t[o]),i[o]=s,o++}return n&&(r=e?r.sort(function(t,n){return t[e]>n[e]}):r.sort()),r}function N(t,e){for(var n,r,i=e[0].toUpperCase()+e.slice(1),o=0;o<c.length;){if((r=(n=c[o])?n+i:e)in t)return r;o++}return a}var j=1;function D(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||i}var k="ontouchstart"in i,L=N(i,"PointerEvent")!==a,F=k&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),B=25,U=1,V=2,G=4,z=8,H=1,W=2,q=4,X=8,Y=16,$=W|q,J=X|Y,K=$|J,Z=["x","y"],Q=["clientX","clientY"];function tt(t,e){var n=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){T(t.options.enable,[t])&&n.handler(e)},this.init()}function et(t,e,n){var r=n.pointers.length,i=n.changedPointers.length,o=e&U&&r-i==0,s=e&(G|z)&&r-i==0;n.isFirst=!!o,n.isFinal=!!s,o&&(t.session={}),n.eventType=e,function(t,e){var n=t.session,r=e.pointers,i=r.length;n.firstInput||(n.firstInput=nt(e));i>1&&!n.firstMultiple?n.firstMultiple=nt(e):1===i&&(n.firstMultiple=!1);var o=n.firstInput,s=n.firstMultiple,u=s?s.center:o.center,c=e.center=rt(r);e.timeStamp=p(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=at(u,c),e.distance=st(u,c),function(t,e){var n=e.center,r=t.offsetDelta||{},i=t.prevDelta||{},o=t.prevInput||{};e.eventType!==U&&o.eventType!==G||(i=t.prevDelta={x:o.deltaX||0,y:o.deltaY||0},r=t.offsetDelta={x:n.x,y:n.y});e.deltaX=i.x+(n.x-r.x),e.deltaY=i.y+(n.y-r.y)}(n,e),e.offsetDirection=ot(e.deltaX,e.deltaY);var l=it(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=l.x,e.overallVelocityY=l.y,e.overallVelocity=d(l.x)>d(l.y)?l.x:l.y,e.scale=s?function(t,e){return st(e[0],e[1],Q)/st(t[0],t[1],Q)}(s.pointers,r):1,e.rotation=s?function(t,e){return at(e[1],e[0],Q)+at(t[1],t[0],Q)}(s.pointers,r):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length,function(t,e){var n,r,i,o,s=t.lastInterval||e,u=e.timeStamp-s.timeStamp;if(e.eventType!=z&&(u>B||s.velocity===a)){var c=e.deltaX-s.deltaX,l=e.deltaY-s.deltaY,h=it(u,c,l);r=h.x,i=h.y,n=d(h.x)>d(h.y)?h.x:h.y,o=ot(c,l),t.lastInterval=e}else n=s.velocity,r=s.velocityX,i=s.velocityY,o=s.direction;e.velocity=n,e.velocityX=r,e.velocityY=i,e.direction=o}(n,e);var h=t.element;O(e.srcEvent.target,h)&&(h=e.srcEvent.target);e.target=h}(t,n),t.emit("hammer.input",n),t.recognize(n),t.session.prevInput=n}function nt(t){for(var e=[],n=0;n<t.pointers.length;)e[n]={clientX:f(t.pointers[n].clientX),clientY:f(t.pointers[n].clientY)},n++;return{timeStamp:p(),pointers:e,center:rt(e),deltaX:t.deltaX,deltaY:t.deltaY}}function rt(t){var e=t.length;if(1===e)return{x:f(t[0].clientX),y:f(t[0].clientY)};for(var n=0,r=0,i=0;i<e;)n+=t[i].clientX,r+=t[i].clientY,i++;return{x:f(n/e),y:f(r/e)}}function it(t,e,n){return{x:e/t||0,y:n/t||0}}function ot(t,e){return t===e?H:d(t)>=d(e)?t<0?W:q:e<0?X:Y}function st(t,e,n){n||(n=Z);var r=e[n[0]]-t[n[0]],i=e[n[1]]-t[n[1]];return Math.sqrt(r*r+i*i)}function at(t,e,n){n||(n=Z);var r=e[n[0]]-t[n[0]],i=e[n[1]]-t[n[1]];return 180*Math.atan2(i,r)/Math.PI}tt.prototype={handler:function(){},init:function(){this.evEl&&A(this.element,this.evEl,this.domHandler),this.evTarget&&A(this.target,this.evTarget,this.domHandler),this.evWin&&A(D(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&S(this.element,this.evEl,this.domHandler),this.evTarget&&S(this.target,this.evTarget,this.domHandler),this.evWin&&S(D(this.element),this.evWin,this.domHandler)}};var ut={mousedown:U,mousemove:V,mouseup:G},ct="mousedown",lt="mousemove mouseup";function ht(){this.evEl=ct,this.evWin=lt,this.pressed=!1,tt.apply(this,arguments)}w(ht,tt,{handler:function(t){var e=ut[t.type];e&U&&0===t.button&&(this.pressed=!0),e&V&&1!==t.which&&(e=G),this.pressed&&(e&G&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}});var ft={pointerdown:U,pointermove:V,pointerup:G,pointercancel:z,pointerout:z},dt={2:"touch",3:"pen",4:"mouse",5:"kinect"},pt="pointerdown",mt="pointermove pointerup pointercancel";function gt(){this.evEl=pt,this.evWin=mt,tt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}i.MSPointerEvent&&!i.PointerEvent&&(pt="MSPointerDown",mt="MSPointerMove MSPointerUp MSPointerCancel"),w(gt,tt,{handler:function(t){var e=this.store,n=!1,r=t.type.toLowerCase().replace("ms",""),i=ft[r],o=dt[t.pointerType]||t.pointerType,s="touch"==o,a=I(e,t.pointerId,"pointerId");i&U&&(0===t.button||s)?a<0&&(e.push(t),a=e.length-1):i&(G|z)&&(n=!0),a<0||(e[a]=t,this.callback(this.manager,i,{pointers:e,changedPointers:[t],pointerType:o,srcEvent:t}),n&&e.splice(a,1))}});var vt={touchstart:U,touchmove:V,touchend:G,touchcancel:z},_t="touchstart",yt="touchstart touchmove touchend touchcancel";function bt(){this.evTarget=_t,this.evWin=yt,this.started=!1,tt.apply(this,arguments)}w(bt,tt,{handler:function(t){var e=vt[t.type];if(e===U&&(this.started=!0),this.started){var n=function(t,e){var n=P(t.touches),r=P(t.changedTouches);e&(G|z)&&(n=R(n.concat(r),"identifier",!0));return[n,r]}.call(this,t,e);e&(G|z)&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:t})}}});var wt={touchstart:U,touchmove:V,touchend:G,touchcancel:z},Et="touchstart touchmove touchend touchcancel";function Tt(){this.evTarget=Et,this.targetIds={},tt.apply(this,arguments)}w(Tt,tt,{handler:function(t){var e=wt[t.type],n=function(t,e){var n=P(t.touches),r=this.targetIds;if(e&(U|V)&&1===n.length)return r[n[0].identifier]=!0,[n,n];var i,o,s=P(t.changedTouches),a=[],u=this.target;if(o=n.filter(function(t){return O(t.target,u)}),e===U)for(i=0;i<o.length;)r[o[i].identifier]=!0,i++;i=0;for(;i<s.length;)r[s[i].identifier]&&a.push(s[i]),e&(G|z)&&delete r[s[i].identifier],i++;if(!a.length)return;return[R(o.concat(a),"identifier",!0),a]}.call(this,t,e);n&&this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:t})}});var xt=2500,At=25;function St(){tt.apply(this,arguments);var t=E(this.handler,this);this.touch=new Tt(this.manager,t),this.mouse=new ht(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function Ot(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var n={x:e.clientX,y:e.clientY};this.lastTouches.push(n);var r=this.lastTouches;setTimeout(function(){var t=r.indexOf(n);t>-1&&r.splice(t,1)},xt)}}w(St,tt,{handler:function(t,e,n){var r="touch"==n.pointerType,i="mouse"==n.pointerType;if(!(i&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(r)(function(t,e){t&U?(this.primaryTouch=e.changedPointers[0].identifier,Ot.call(this,e)):t&(G|z)&&Ot.call(this,e)}).call(this,e,n);else if(i&&function(t){for(var e=t.srcEvent.clientX,n=t.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var i=this.lastTouches[r],o=Math.abs(e-i.x),s=Math.abs(n-i.y);if(o<=At&&s<=At)return!0}return!1}.call(this,n))return;this.callback(t,e,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Ct=N(l.style,"touchAction"),Mt=Ct!==a,It="auto",Pt="manipulation",Rt="none",Nt="pan-x",jt="pan-y",Dt=function(){if(!Mt)return!1;var t={},e=i.CSS&&i.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(n){t[n]=!e||i.CSS.supports("touch-action",n)}),t}();function kt(t,e){this.manager=t,this.set(e)}kt.prototype={set:function(t){"compute"==t&&(t=this.compute()),Mt&&this.manager.element.style&&Dt[t]&&(this.manager.element.style[Ct]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return v(this.manager.recognizers,function(e){T(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),function(t){if(C(t,Rt))return Rt;var e=C(t,Nt),n=C(t,jt);if(e&&n)return Rt;if(e||n)return e?Nt:jt;if(C(t,Pt))return Pt;return It}(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,n=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var r=this.actions,i=C(r,Rt)&&!Dt[Rt],o=C(r,jt)&&!Dt[jt],s=C(r,Nt)&&!Dt[Nt];if(i){var a=1===t.pointers.length,u=t.distance<2,c=t.deltaTime<250;if(a&&u&&c)return}if(!s||!o)return i||o&&n&$||s&&n&J?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var Lt=1,Ft=2,Bt=4,Ut=8,Vt=Ut,Gt=16;function zt(t){this.options=u({},this.defaults,t||{}),this.id=j++,this.manager=null,this.options.enable=x(this.options.enable,!0),this.state=Lt,this.simultaneous={},this.requireFail=[]}function Ht(t){return t&Gt?"cancel":t&Ut?"end":t&Bt?"move":t&Ft?"start":""}function Wt(t){return t==Y?"down":t==X?"up":t==W?"left":t==q?"right":""}function qt(t,e){var n=e.manager;return n?n.get(t):t}function Xt(){zt.apply(this,arguments)}function Yt(){Xt.apply(this,arguments),this.pX=null,this.pY=null}function $t(){Xt.apply(this,arguments)}function Jt(){zt.apply(this,arguments),this._timer=null,this._input=null}function Kt(){Xt.apply(this,arguments)}function Zt(){Xt.apply(this,arguments)}function Qt(){zt.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function te(t,e){return(e=e||{}).recognizers=x(e.recognizers,te.defaults.preset),new ee(t,e)}zt.prototype={defaults:{},set:function(t){return u(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(g(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=qt(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return g(t,"dropRecognizeWith",this)?this:(t=qt(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(g(t,"requireFailure",this))return this;var e=this.requireFail;return-1===I(e,t=qt(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(g(t,"dropRequireFailure",this))return this;t=qt(t,this);var e=I(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,n=this.state;function r(n){e.manager.emit(n,t)}n<Ut&&r(e.options.event+Ht(n)),r(e.options.event),t.additionalEvent&&r(t.additionalEvent),n>=Ut&&r(e.options.event+Ht(n))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=32},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(32|Lt)))return!1;t++}return!0},recognize:function(t){var e=u({},t);if(!T(this.options.enable,[this,e]))return this.reset(),void(this.state=32);this.state&(Vt|Gt|32)&&(this.state=Lt),this.state=this.process(e),this.state&(Ft|Bt|Ut|Gt)&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},w(Xt,zt,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,n=t.eventType,r=e&(Ft|Bt),i=this.attrTest(t);return r&&(n&z||!i)?e|Gt:r||i?n&G?e|Ut:e&Ft?e|Bt:Ft:32}}),w(Yt,Xt,{defaults:{event:"pan",threshold:10,pointers:1,direction:K},getTouchAction:function(){var t=this.options.direction,e=[];return t&$&&e.push(jt),t&J&&e.push(Nt),e},directionTest:function(t){var e=this.options,n=!0,r=t.distance,i=t.direction,o=t.deltaX,s=t.deltaY;return i&e.direction||(e.direction&$?(i=0===o?H:o<0?W:q,n=o!=this.pX,r=Math.abs(t.deltaX)):(i=0===s?H:s<0?X:Y,n=s!=this.pY,r=Math.abs(t.deltaY))),t.direction=i,n&&r>e.threshold&&i&e.direction},attrTest:function(t){return Xt.prototype.attrTest.call(this,t)&&(this.state&Ft||!(this.state&Ft)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=Wt(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),w($t,Xt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Rt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&Ft)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),w(Jt,zt,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[It]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,r=t.distance<e.threshold,i=t.deltaTime>e.time;if(this._input=t,!r||!n||t.eventType&(G|z)&&!i)this.reset();else if(t.eventType&U)this.reset(),this._timer=m(function(){this.state=Vt,this.tryEmit()},e.time,this);else if(t.eventType&G)return Vt;return 32},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===Vt&&(t&&t.eventType&G?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=p(),this.manager.emit(this.options.event,this._input)))}}),w(Kt,Xt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Rt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&Ft)}}),w(Zt,Xt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:$|J,pointers:1},getTouchAction:function(){return Yt.prototype.getTouchAction.call(this)},attrTest:function(t){var e,n=this.options.direction;return n&($|J)?e=t.overallVelocity:n&$?e=t.overallVelocityX:n&J&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&n&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&d(e)>this.options.velocity&&t.eventType&G},emit:function(t){var e=Wt(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),w(Qt,zt,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Pt]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,r=t.distance<e.threshold,i=t.deltaTime<e.time;if(this.reset(),t.eventType&U&&0===this.count)return this.failTimeout();if(r&&i&&n){if(t.eventType!=G)return this.failTimeout();var o=!this.pTime||t.timeStamp-this.pTime<e.interval,s=!this.pCenter||st(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,s&&o?this.count+=1:this.count=1,this._input=t,0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=m(function(){this.state=Vt,this.tryEmit()},e.interval,this),Ft):Vt}return 32},failTimeout:function(){return this._timer=m(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Vt&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),te.VERSION="2.0.7",te.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[Kt,{enable:!1}],[$t,{enable:!1},["rotate"]],[Zt,{direction:$}],[Yt,{direction:$},["swipe"]],[Qt],[Qt,{event:"doubletap",taps:2},["tap"]],[Jt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function ee(t,e){this.options=u({},te.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=function(t){var e=t.options.inputClass;return new(e||(L?gt:F?Tt:k?St:ht))(t,et)}(this),this.touchAction=new kt(this,this.options.touchAction),ne(this,!0),v(this.options.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function ne(t,e){var n,r=t.element;r.style&&(v(t.options.cssProps,function(i,o){n=N(r.style,o),e?(t.oldCssProps[n]=r.style[n],r.style[n]=i):r.style[n]=t.oldCssProps[n]||""}),e||(t.oldCssProps={}))}ee.prototype={set:function(t){return u(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){var n;this.touchAction.preventDefaults(t);var r=this.recognizers,i=e.curRecognizer;(!i||i&&i.state&Vt)&&(i=e.curRecognizer=null);for(var o=0;o<r.length;)n=r[o],2===e.stopped||i&&n!=i&&!n.canRecognizeWith(i)?n.reset():n.recognize(t),!i&&n.state&(Ft|Bt|Ut)&&(i=e.curRecognizer=n),o++}},get:function(t){if(t instanceof zt)return t;for(var e=this.recognizers,n=0;n<e.length;n++)if(e[n].options.event==t)return e[n];return null},add:function(t){if(g(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(g(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,n=I(e,t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this},on:function(t,e){if(t!==a&&e!==a){var n=this.handlers;return v(M(t),function(t){n[t]=n[t]||[],n[t].push(e)}),this}},off:function(t,e){if(t!==a){var n=this.handlers;return v(M(t),function(t){e?n[t]&&n[t].splice(I(n[t],e),1):delete n[t]}),this}},emit:function(t,e){this.options.domEvents&&function(t,e){var n=o.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=e,e.target.dispatchEvent(n)}(t,e);var n=this.handlers[t]&&this.handlers[t].slice();if(n&&n.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var r=0;r<n.length;)n[r](e),r++}},destroy:function(){this.element&&ne(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},u(te,{INPUT_START:U,INPUT_MOVE:V,INPUT_END:G,INPUT_CANCEL:z,STATE_POSSIBLE:Lt,STATE_BEGAN:Ft,STATE_CHANGED:Bt,STATE_ENDED:Ut,STATE_RECOGNIZED:Vt,STATE_CANCELLED:Gt,STATE_FAILED:32,DIRECTION_NONE:H,DIRECTION_LEFT:W,DIRECTION_RIGHT:q,DIRECTION_UP:X,DIRECTION_DOWN:Y,DIRECTION_HORIZONTAL:$,DIRECTION_VERTICAL:J,DIRECTION_ALL:K,Manager:ee,Input:tt,TouchAction:kt,TouchInput:Tt,MouseInput:ht,PointerEventInput:gt,TouchMouseInput:St,SingleTouchInput:bt,Recognizer:zt,AttrRecognizer:Xt,Tap:Qt,Pan:Yt,Swipe:Zt,Pinch:$t,Rotate:Kt,Press:Jt,on:A,off:S,each:v,merge:b,extend:y,assign:u,inherit:w,bindFn:E,prefixed:N}),(void 0!==i?i:"undefined"!=typeof self?self:{}).Hammer=te,(r=function(){return te}.call(e,n,e,t))===a||(t.exports=r)}(window,document)},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){var r=n(9),i=n(12),o=n(13),s=n(10);function a(){}a.prototype={eql:function(t){return this.contains(t.anchor)&&this.isParallelTo(t)},dup:function(){return a.create(this.anchor,this.normal)},translate:function(t){var e=t.elements||t;return a.create([this.anchor.elements[0]+e[0],this.anchor.elements[1]+e[1],this.anchor.elements[2]+(e[2]||0)],this.normal)},isParallelTo:function(t){var e;return t.normal?(e=this.normal.angleFrom(t.normal),Math.abs(e)<=s.precision||Math.abs(Math.PI-e)<=s.precision):t.direction?this.normal.isPerpendicularTo(t.direction):null},isPerpendicularTo:function(t){var e=this.normal.angleFrom(t.normal);return Math.abs(Math.PI/2-e)<=s.precision},distanceFrom:function(t){if(this.intersects(t)||this.contains(t))return 0;if(t.anchor){var e=this.anchor.elements,n=t.anchor.elements,r=this.normal.elements;return Math.abs((e[0]-n[0])*r[0]+(e[1]-n[1])*r[1]+(e[2]-n[2])*r[2])}var i=t.elements||t;e=this.anchor.elements,r=this.normal.elements;return Math.abs((e[0]-i[0])*r[0]+(e[1]-i[1])*r[1]+(e[2]-(i[2]||0))*r[2])},contains:function(t){if(t.normal)return null;if(t.direction)return this.contains(t.anchor)&&this.contains(t.anchor.add(t.direction));var e=t.elements||t,n=this.anchor.elements,r=this.normal.elements;return Math.abs(r[0]*(n[0]-e[0])+r[1]*(n[1]-e[1])+r[2]*(n[2]-(e[2]||0)))<=s.precision},intersects:function(t){return void 0===t.direction&&void 0===t.normal?null:!this.isParallelTo(t)},intersectionWith:function(t){if(!this.intersects(t))return null;if(t.direction){var e=t.anchor.elements,n=t.direction.elements,s=this.anchor.elements,a=((c=this.normal.elements)[0]*(s[0]-e[0])+c[1]*(s[1]-e[1])+c[2]*(s[2]-e[2]))/(c[0]*n[0]+c[1]*n[1]+c[2]*n[2]);return r.create([e[0]+n[0]*a,e[1]+n[1]*a,e[2]+n[2]*a])}if(t.normal){for(var u=this.normal.cross(t.normal).toUnitVector(),c=this.normal.elements,l=(e=this.anchor.elements,t.normal.elements),h=t.anchor.elements,f=i.Zero(2,2),d=0;f.isSingular();)d++,f=i.create([[c[d%3],c[(d+1)%3]],[l[d%3],l[(d+1)%3]]]);for(var p=f.inverse().elements,m=c[0]*e[0]+c[1]*e[1]+c[2]*e[2],g=l[0]*h[0]+l[1]*h[1]+l[2]*h[2],v=[p[0][0]*m+p[0][1]*g,p[1][0]*m+p[1][1]*g],_=[],y=1;y<=3;y++)_.push(d==y?0:v[(y+(5-d)%3)%3]);return o.create(_,u)}},pointClosestTo:function(t){var e=t.elements||t,n=this.anchor.elements,i=this.normal.elements,o=(n[0]-e[0])*i[0]+(n[1]-e[1])*i[1]+(n[2]-(e[2]||0))*i[2];return r.create([e[0]+i[0]*o,e[1]+i[1]*o,(e[2]||0)+i[2]*o])},rotate:function(t,e){var n=t.determinant?t.elements:i.Rotation(t,e.direction).elements,r=e.pointClosestTo(this.anchor).elements,o=this.anchor.elements,s=this.normal.elements,u=r[0],c=r[1],l=r[2],h=o[0]-u,f=o[1]-c,d=o[2]-l;return a.create([u+n[0][0]*h+n[0][1]*f+n[0][2]*d,c+n[1][0]*h+n[1][1]*f+n[1][2]*d,l+n[2][0]*h+n[2][1]*f+n[2][2]*d],[n[0][0]*s[0]+n[0][1]*s[1]+n[0][2]*s[2],n[1][0]*s[0]+n[1][1]*s[1]+n[1][2]*s[2],n[2][0]*s[0]+n[2][1]*s[1]+n[2][2]*s[2]])},reflectionIn:function(t){if(t.normal){var e=this.anchor.elements,n=this.normal.elements,r=e[0],i=e[1],o=e[2],s=n[0],u=n[1],c=n[2],l=this.anchor.reflectionIn(t).elements,h=r+s,f=i+u,d=o+c,p=t.pointClosestTo([h,f,d]).elements,m=[p[0]+(p[0]-h)-l[0],p[1]+(p[1]-f)-l[1],p[2]+(p[2]-d)-l[2]];return a.create(l,m)}if(t.direction)return this.rotate(Math.PI,t);var g=t.elements||t;return a.create(this.anchor.reflectionIn([g[0],g[1],g[2]||0]),this.normal)},setVectors:function(t,e,n){if(null===(t=(t=r.create(t)).to3D()))return null;if(null===(e=(e=r.create(e)).to3D()))return null;if(void 0===n)n=null;else if(null===(n=(n=r.create(n)).to3D()))return null;var i,o,s=t.elements[0],a=t.elements[1],u=t.elements[2],c=e.elements[0],l=e.elements[1],h=e.elements[2];if(null!==n){var f=n.elements[0],d=n.elements[1],p=n.elements[2];if(0===(o=(i=r.create([(l-a)*(p-u)-(h-u)*(d-a),(h-u)*(f-s)-(c-s)*(p-u),(c-s)*(d-a)-(l-a)*(f-s)])).modulus()))return null;i=r.create([i.elements[0]/o,i.elements[1]/o,i.elements[2]/o])}else{if(0===(o=Math.sqrt(c*c+l*l+h*h)))return null;i=r.create([e.elements[0]/o,e.elements[1]/o,e.elements[2]/o])}return this.anchor=t,this.normal=i,this}},a.create=function(t,e,n){return(new a).setVectors(t,e,n)},a.XY=a.create(r.Zero(3),r.k),a.YZ=a.create(r.Zero(3),r.i),a.ZX=a.create(r.Zero(3),r.j),a.YX=a.XY,a.ZY=a.YZ,a.XZ=a.ZX,a.fromPoints=function(t){var e,n,i,o,u,c,l,h,f,d,p=t.length,m=[],g=r.Zero(3);for(e=0;e<p;e++){if(null===(n=r.create(t[e]).to3D()))return null;if(m.push(n),(i=m.length)>2){if(u=m[i-1].elements,c=m[i-2].elements,l=m[i-3].elements,o=r.create([(u[1]-c[1])*(l[2]-c[2])-(u[2]-c[2])*(l[1]-c[1]),(u[2]-c[2])*(l[0]-c[0])-(u[0]-c[0])*(l[2]-c[2]),(u[0]-c[0])*(l[1]-c[1])-(u[1]-c[1])*(l[0]-c[0])]).toUnitVector(),i>3&&null!==(f=o.angleFrom(d))&&!(Math.abs(f)<=s.precision||Math.abs(f-Math.PI)<=s.precision))return null;g=g.add(o),d=o}}return u=m[1].elements,c=m[0].elements,l=m[i-1].elements,h=m[i-2].elements,g=g.add(r.create([(u[1]-c[1])*(l[2]-c[2])-(u[2]-c[2])*(l[1]-c[1]),(u[2]-c[2])*(l[0]-c[0])-(u[0]-c[0])*(l[2]-c[2]),(u[0]-c[0])*(l[1]-c[1])-(u[1]-c[1])*(l[0]-c[0])]).toUnitVector()).add(r.create([(c[1]-l[1])*(h[2]-l[2])-(c[2]-l[2])*(h[1]-l[1]),(c[2]-l[2])*(h[0]-l[0])-(c[0]-l[0])*(h[2]-l[2]),(c[0]-l[0])*(h[1]-l[1])-(c[1]-l[1])*(h[0]-l[0])]).toUnitVector()),a.create(m[0],g)},t.exports=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),i=function(){function t(){}return t.prototype.getConstructorMetadata=function(t){return{compilerGeneratedMetadata:Reflect.getMetadata(r.PARAM_TYPES,t),userGeneratedMetadata:Reflect.getMetadata(r.TAGGED,t)||{}}},t.prototype.getPropertiesMetadata=function(t){return Reflect.getMetadata(r.TAGGED_PROP,t)||[]},t}();e.MetadataReader=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3);e.isStackOverflowExeption=function(t){return t instanceof RangeError||t.message===r.STACK_OVERFLOW}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(2),o=n(4),s=n(6),a=function(){function t(t){this._cb=t}return t.prototype.unwrap=function(){return this._cb()},t}();e.LazyServiceIdentifer=a,e.inject=function(t){return function(e,n,a){if(void 0===t)throw new Error(r.UNDEFINED_INJECT_ANNOTATION(e.name));var u=new o.Metadata(i.INJECT_TAG,t);"number"==typeof a?s.tagParameter(e,n,a,u):s.tagProperty(e,n,u)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),i=n(8),o=n(4),s=n(39),a=function(){function t(t,e,n,a){this.guid=i.guid(),this.type=t,this.serviceIdentifier=n,this.name=new s.QueryableString(e||""),this.metadata=new Array;var u=null;"string"==typeof a?u=new o.Metadata(r.NAMED_TAG,a):a instanceof o.Metadata&&(u=a),null!==u&&this.metadata.push(u)}return t.prototype.hasTag=function(t){for(var e=0,n=this.metadata;e<n.length;e++){if(n[e].key===t)return!0}return!1},t.prototype.isArray=function(){return this.hasTag(r.MULTI_INJECT_TAG)},t.prototype.matchesArray=function(t){return this.matchesTag(r.MULTI_INJECT_TAG)(t)},t.prototype.isNamed=function(){return this.hasTag(r.NAMED_TAG)},t.prototype.isTagged=function(){return this.metadata.some(function(t){return t.key!==r.INJECT_TAG&&t.key!==r.MULTI_INJECT_TAG&&t.key!==r.NAME_TAG&&t.key!==r.UNMANAGED_TAG&&t.key!==r.NAMED_TAG})},t.prototype.isOptional=function(){return this.matchesTag(r.OPTIONAL_TAG)(!0)},t.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(t){return t.key===r.NAMED_TAG})[0]:null},t.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(t){return t.key!==r.INJECT_TAG&&t.key!==r.MULTI_INJECT_TAG&&t.key!==r.NAME_TAG&&t.key!==r.UNMANAGED_TAG&&t.key!==r.NAMED_TAG}):null},t.prototype.matchesNamedTag=function(t){return this.matchesTag(r.NAMED_TAG)(t)},t.prototype.matchesTag=function(t){var e=this;return function(n){for(var r=0,i=e.metadata;r<i.length;r++){var o=i[r];if(o.key===t&&o.value===n)return!0}return!1}},t}();e.Target=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(14),i=n(15),o=function(){function t(t){this._binding=t,this._bindingWhenSyntax=new i.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new r.BindingOnSyntax(this._binding)}return t.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},t.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},t.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},t.prototype.whenTargetTagged=function(t,e){return this._bindingWhenSyntax.whenTargetTagged(t,e)},t.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},t.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},t.prototype.whenParentTagged=function(t,e){return this._bindingWhenSyntax.whenParentTagged(t,e)},t.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},t.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},t.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,e)},t.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},t.prototype.whenNoAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenNoAncestorTagged(t,e)},t.prototype.whenAnyAncestorMatches=function(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},t.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},t.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},t}();e.BindingWhenOnSyntax=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),i=n(4),o=function(t,e){var n=t.parentRequest;return null!==n&&(!!e(n)||o(n,e))};e.traverseAncerstors=o;var s=function(t){return function(e){var n=function(n){return null!==n&&null!==n.target&&n.target.matchesTag(t)(e)};return n.metaData=new i.Metadata(t,e),n}};e.taggedConstraint=s;var a=s(r.NAMED_TAG);e.namedConstraint=a;e.typeConstraint=function(t){return function(e){var n=null;if(null!==e){if(n=e.bindings[0],"string"==typeof t)return n.serviceIdentifier===t;var r=e.bindings[0].implementationType;return t===r}return!1}}},function(t,e,n){t.exports=function(){var t=function(){function e(t){return i.appendChild(t.dom),t}function n(t){for(var e=0;e<i.children.length;e++)i.children[e].style.display=e===t?"block":"none";r=t}var r=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",function(t){t.preventDefault(),n(++r%i.children.length)},!1);var o=(performance||Date).now(),s=o,a=0,u=e(new t.Panel("FPS","#0ff","#002")),c=e(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=e(new t.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:i,addPanel:e,showPanel:n,begin:function(){o=(performance||Date).now()},end:function(){a++;var t=(performance||Date).now();if(c.update(t-o,200),t>s+1e3&&(u.update(1e3*a/(t-s),100),s=t,a=0,l)){var e=performance.memory;l.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){o=this.end()},domElement:i,setMode:n}};return t.Panel=function(t,e,n){var r=1/0,i=0,o=Math.round,s=o(window.devicePixelRatio||1),a=80*s,u=48*s,c=3*s,l=2*s,h=3*s,f=15*s,d=74*s,p=30*s,m=document.createElement("canvas");m.width=a,m.height=u,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*s+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=n,g.fillRect(0,0,a,u),g.fillStyle=e,g.fillText(t,c,l),g.fillRect(h,f,d,p),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h,f,d,p),{dom:m,update:function(u,v){r=Math.min(r,u),i=Math.max(i,u),g.fillStyle=n,g.globalAlpha=1,g.fillRect(0,0,a,f),g.fillStyle=e,g.fillText(o(u)+" "+t+" ("+o(r)+"-"+o(i)+")",c,l),g.drawImage(m,h+s,f,d-s,p,h,f,d-s,p),g.fillRect(h+d-s,f,s,p),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h+d-s,f,s,o((1-u/v)*p))}}},t}()},function(t,e,n){t.exports=n(58)},function(t,e){var n=9007199254740991,r="[object Arguments]",i="[object Function]",o="[object GeneratorFunction]",s=/^(?:0|[1-9]\d*)$/;var a=Object.prototype,u=a.hasOwnProperty,c=a.toString,l=a.propertyIsEnumerable,h=function(t,e){return function(n){return t(e(n))}}(Object.keys,Object),f=Math.max,d=!l.call({valueOf:1},"valueOf");function p(t,e){var n=y(t)||function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&b(t)}(t)&&u.call(t,"callee")&&(!l.call(t,"callee")||c.call(t)==r)}(t)?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],i=n.length,o=!!i;for(var s in t)!e&&!u.call(t,s)||o&&("length"==s||g(s,i))||n.push(s);return n}function m(t,e,n){var r=t[e];u.call(t,e)&&_(r,n)&&(void 0!==n||e in t)||(t[e]=n)}function g(t,e){return!!(e=null==e?n:e)&&("number"==typeof t||s.test(t))&&t>-1&&t%1==0&&t<e}function v(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||a)}function _(t,e){return t===e||t!=t&&e!=e}var y=Array.isArray;function b(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=n}(t.length)&&!function(t){var e=w(t)?c.call(t):"";return e==i||e==o}(t)}function w(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}var E=function(t){return function(t,e){return e=f(void 0===e?t.length-1:e,0),function(){for(var n=arguments,r=-1,i=f(n.length-e,0),o=Array(i);++r<i;)o[r]=n[e+r];r=-1;for(var s=Array(e+1);++r<e;)s[r]=n[r];return s[e]=o,function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}(t,this,s)}}(function(e,n){var r=-1,i=n.length,o=i>1?n[i-1]:void 0,s=i>2?n[2]:void 0;for(o=t.length>3&&"function"==typeof o?(i--,o):void 0,s&&function(t,e,n){if(!w(n))return!1;var r=typeof e;return!!("number"==r?b(n)&&g(e,n.length):"string"==r&&e in n)&&_(n[e],t)}(n[0],n[1],s)&&(o=i<3?void 0:o,i=1),e=Object(e);++r<i;){var a=n[r];a&&t(e,a,r,o)}return e})}(function(t,e){if(d||v(e)||b(e))!function(t,e,n,r){n||(n={});for(var i=-1,o=e.length;++i<o;){var s=e[i],a=r?r(n[s],t[s],s,n,t):void 0;m(n,s,void 0===a?t[s]:a)}}(e,function(t){return b(t)?p(t):function(t){if(!v(t))return h(t);var e=[];for(var n in Object(t))u.call(t,n)&&"constructor"!=n&&e.push(n);return e}(t)}(e),t);else for(var n in e)u.call(e,n)&&m(t,n,e[n])});t.exports=E},function(t,e){},function(t,e,n){var r=n(13),i=n(9);r.Segment=function(){},r.Segment.prototype={eql:function(t){return this.start.eql(t.start)&&this.end.eql(t.end)||this.start.eql(t.end)&&this.end.eql(t.start)},dup:function(){return r.Segment.create(this.start,this.end)},length:function(){var t=this.start.elements,e=this.end.elements,n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(n*n+r*r+i*i)},toVector:function(){var t=this.start.elements,e=this.end.elements;return i.create([e[0]-t[0],e[1]-t[1],e[2]-t[2]])},midpoint:function(){var t=this.start.elements,e=this.end.elements;return i.create([(e[0]+t[0])/2,(e[1]+t[1])/2,(e[2]+t[2])/2])},bisectingPlane:function(){return Plane.create(this.midpoint(),this.toVector())},translate:function(t){var e=t.elements||t,n=this.start.elements,i=this.end.elements;return r.Segment.create([n[0]+e[0],n[1]+e[1],n[2]+(e[2]||0)],[i[0]+e[0],i[1]+e[1],i[2]+(e[2]||0)])},isParallelTo:function(t){return this.line.isParallelTo(t)},distanceFrom:function(t){var e=this.pointClosestTo(t);return null===e?null:e.distanceFrom(t)},contains:function(t){if(t.start&&t.end)return this.contains(t.start)&&this.contains(t.end);var e=(t.elements||t).slice();if(2==e.length&&e.push(0),this.start.eql(e))return!0;var n=this.start.elements,r=i.create([n[0]-e[0],n[1]-e[1],n[2]-(e[2]||0)]),o=this.toVector();return r.isAntiparallelTo(o)&&r.modulus()<=o.modulus()},intersects:function(t){return null!==this.intersectionWith(t)},intersectionWith:function(t){if(!this.line.intersects(t))return null;var e=this.line.intersectionWith(t);return this.contains(e)?e:null},pointClosestTo:function(t){if(t.normal){var e=this.line.intersectionWith(t);return null===e?null:this.pointClosestTo(e)}var n=this.line.pointClosestTo(t);return null===n?null:this.contains(n)?n:(this.line.positionOf(n)<0?this.start:this.end).dup()},setPoints:function(t,e){return t=i.create(t).to3D(),e=i.create(e).to3D(),null===t||null===e?null:(this.line=r.create(t,e.subtract(t)),this.start=t,this.end=e,this)}},r.Segment.create=function(t,e){return(new r.Segment).setPoints(t,e)},t.exports=r.Segment},function(t,e,n){(function(t,e){
/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var n;!function(n){!function(r){var i="object"==typeof e?e:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),o=s(n);function s(t,e){return function(n,r){"function"!=typeof t[n]&&Object.defineProperty(t,n,{configurable:!0,writable:!0,value:r}),e&&e(n,r)}}void 0===i.Reflect?i.Reflect=n:o=s(i.Reflect,o),function(e){var n=Object.prototype.hasOwnProperty,r="function"==typeof Symbol,i=r&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",o=r&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",s="function"==typeof Object.create,a={__proto__:[]}instanceof Array,u=!s&&!a,c={create:s?function(){return j(Object.create(null))}:a?function(){return j({__proto__:null})}:function(){return j({})},has:u?function(t,e){return n.call(t,e)}:function(t,e){return e in t},get:u?function(t,e){return n.call(t,e)?t[e]:void 0}:function(t,e){return t[e]}},l=Object.getPrototypeOf(Function),h="object"==typeof t&&t.env&&"true"===t.env.REFLECT_METADATA_USE_MAP_POLYFILL,f=h||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var t={},e=[],n=function(){function t(t,e,n){this._index=0,this._keys=t,this._values=e,this._selector=n}return t.prototype["@@iterator"]=function(){return this},t.prototype[o]=function(){return this},t.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var n=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},t.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),t},t.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:t,done:!0}},t}();return function(){function e(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._find(t,!1)>=0},e.prototype.get=function(t){var e=this._find(t,!1);return e>=0?this._values[e]:void 0},e.prototype.set=function(t,e){var n=this._find(t,!0);return this._values[n]=e,this},e.prototype.delete=function(e){var n=this._find(e,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,e===this._cacheKey&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},e.prototype.keys=function(){return new n(this._keys,this._values,r)},e.prototype.values=function(){return new n(this._keys,this._values,i)},e.prototype.entries=function(){return new n(this._keys,this._values,s)},e.prototype["@@iterator"]=function(){return this.entries()},e.prototype[o]=function(){return this.entries()},e.prototype._find=function(t,e){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},e}();function r(t,e){return t}function i(t,e){return e}function s(t,e){return[t,e]}}():Map,d=h||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function t(){this._map=new f}return Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this._map.has(t)},t.prototype.add=function(t){return this._map.set(t,t),this},t.prototype.delete=function(t){return this._map.delete(t)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.values()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[o]=function(){return this.keys()},t}():Set,p=new(h||"function"!=typeof WeakMap?function(){var t=16,e=c.create(),r=i();return function(){function t(){this._key=i()}return t.prototype.has=function(t){var e=o(t,!1);return void 0!==e&&c.has(e,this._key)},t.prototype.get=function(t){var e=o(t,!1);return void 0!==e?c.get(e,this._key):void 0},t.prototype.set=function(t,e){var n=o(t,!0);return n[this._key]=e,this},t.prototype.delete=function(t){var e=o(t,!1);return void 0!==e&&delete e[this._key]},t.prototype.clear=function(){this._key=i()},t}();function i(){var t;do{t="@@WeakMap@@"+a()}while(c.has(e,t));return e[t]=!0,t}function o(t,e){if(!n.call(t,r)){if(!e)return;Object.defineProperty(t,r,{value:c.create()})}return t[r]}function s(t,e){for(var n=0;n<e;++n)t[n]=255*Math.random()|0;return t}function a(){var e=function(t){if("function"==typeof Uint8Array)return"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):s(new Uint8Array(t),t);return s(new Array(t),t)}(t);e[6]=79&e[6]|64,e[8]=191&e[8]|128;for(var n="",r=0;r<t;++r){var i=e[r];4!==r&&6!==r&&8!==r||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}():WeakMap);function m(t,e,n){var r=p.get(t);if(w(r)){if(!n)return;r=new f,p.set(t,r)}var i=r.get(e);if(w(i)){if(!n)return;i=new f,r.set(e,i)}return i}function g(t,e,n){var r=m(e,n,!1);return!w(r)&&function(t){return!!t}(r.has(t))}function v(t,e,n){var r=m(e,n,!1);if(!w(r))return r.get(t)}function _(t,e,n,r){var i=m(n,r,!0);i.set(t,e)}function y(t,e){var n=[],r=m(t,e,!1);if(w(r))return n;for(var i=r.keys(),s=function(t){var e=M(t,o);if(!O(e))throw new TypeError;var n=e.call(t);if(!T(n))throw new TypeError;return n}(i),a=0;;){var u=P(s);if(!u)return n.length=a,n;var c=I(u);try{n[a]=c}catch(t){try{R(s)}finally{throw t}}a++}}function b(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function w(t){return void 0===t}function E(t){return null===t}function T(t){return"object"==typeof t?null!==t:"function"==typeof t}function x(t,e){switch(b(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var n=3===e?"string":5===e?"number":"default",r=M(t,i);if(void 0!==r){var o=r.call(t,n);if(T(o))throw new TypeError;return o}return function(t,e){if("string"===e){var n=t.toString;if(O(n)){var r=n.call(t);if(!T(r))return r}var i=t.valueOf;if(O(i)){var r=i.call(t);if(!T(r))return r}}else{var i=t.valueOf;if(O(i)){var r=i.call(t);if(!T(r))return r}var o=t.toString;if(O(o)){var r=o.call(t);if(!T(r))return r}}throw new TypeError}(t,"default"===n?"number":n)}function A(t){var e=x(t,3);return function(t){return"symbol"==typeof t}(e)?e:function(t){return""+t}(e)}function S(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function O(t){return"function"==typeof t}function C(t){return"function"==typeof t}function M(t,e){var n=t[e];if(void 0!==n&&null!==n){if(!O(n))throw new TypeError;return n}}function I(t){return t.value}function P(t){var e=t.next();return!e.done&&e}function R(t){var e=t.return;e&&e.call(t)}function N(t){var e=Object.getPrototypeOf(t);if("function"!=typeof t||t===l)return e;if(e!==l)return e;var n=t.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return e;var i=r.constructor;return"function"!=typeof i?e:i===t?e:i}function j(t){return t.__=void 0,delete t.__,t}e("decorate",function(t,e,n,r){if(w(n)){if(!S(t))throw new TypeError;if(!C(e))throw new TypeError;return function(t,e){for(var n=t.length-1;n>=0;--n){var r=t[n],i=r(e);if(!w(i)&&!E(i)){if(!C(i))throw new TypeError;e=i}}return e}(t,e)}if(!S(t))throw new TypeError;if(!T(e))throw new TypeError;if(!T(r)&&!w(r)&&!E(r))throw new TypeError;return E(r)&&(r=void 0),n=A(n),function(t,e,n,r){for(var i=t.length-1;i>=0;--i){var o=t[i],s=o(e,n,r);if(!w(s)&&!E(s)){if(!T(s))throw new TypeError;r=s}}return r}(t,e,n,r)}),e("metadata",function(t,e){return function(n,r){if(!T(n))throw new TypeError;if(!w(r)&&!function(t){switch(b(t)){case 3:case 4:return!0;default:return!1}}(r))throw new TypeError;_(t,e,n,r)}}),e("defineMetadata",function(t,e,n,r){if(!T(n))throw new TypeError;w(r)||(r=A(r));return _(t,e,n,r)}),e("hasMetadata",function(t,e,n){if(!T(e))throw new TypeError;w(n)||(n=A(n));return function t(e,n,r){var i=g(e,n,r);if(i)return!0;var o=N(n);if(!E(o))return t(e,o,r);return!1}(t,e,n)}),e("hasOwnMetadata",function(t,e,n){if(!T(e))throw new TypeError;w(n)||(n=A(n));return g(t,e,n)}),e("getMetadata",function(t,e,n){if(!T(e))throw new TypeError;w(n)||(n=A(n));return function t(e,n,r){var i=g(e,n,r);if(i)return v(e,n,r);var o=N(n);if(!E(o))return t(e,o,r);return}(t,e,n)}),e("getOwnMetadata",function(t,e,n){if(!T(e))throw new TypeError;w(n)||(n=A(n));return v(t,e,n)}),e("getMetadataKeys",function(t,e){if(!T(t))throw new TypeError;w(e)||(e=A(e));return function t(e,n){var r=y(e,n);var i=N(e);if(null===i)return r;var o=t(i,n);if(o.length<=0)return r;if(r.length<=0)return o;var s=new d;var a=[];for(var u=0,c=r;u<c.length;u++){var l=c[u],h=s.has(l);h||(s.add(l),a.push(l))}for(var f=0,p=o;f<p.length;f++){var l=p[f],h=s.has(l);h||(s.add(l),a.push(l))}return a}(t,e)}),e("getOwnMetadataKeys",function(t,e){if(!T(t))throw new TypeError;w(e)||(e=A(e));return y(t,e)}),e("deleteMetadata",function(t,e,n){if(!T(e))throw new TypeError;w(n)||(n=A(n));var r=m(e,n,!1);if(w(r))return!1;if(!r.delete(t))return!1;if(r.size>0)return!0;var i=p.get(e);return i.delete(n),i.size>0||(p.delete(e),!0)})}(o)}()}(n||(n={}))}).call(this,n(31),n(17))},function(t,e){var n,r,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(t){r=s}}();var u,c=[],l=!1,h=-1;function f(){l&&u&&(l=!1,u.length?c=u.concat(c):h=-1,c.length&&d())}function d(){if(!l){var t=a(f);l=!0;for(var e=c.length;e;){for(u=c,c=[];++h<e;)u&&u[h].run();h=-1,e=c.length}u=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function m(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new p(t,e)),1!==c.length||l||a(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,a)}u((r=r.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(e,"__esModule",{value:!0});var o=n(33),s=n(3),a=n(5),u=n(2),c=n(19),l=n(34),h=n(41),f=n(43),d=n(8),p=n(11),m=n(46),g=n(47),v=function(){function t(t){var e=t||{};if("object"!=typeof e)throw new Error(""+s.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(void 0===e.defaultScope)e.defaultScope=a.BindingScopeEnum.Transient;else if(e.defaultScope!==a.BindingScopeEnum.Singleton&&e.defaultScope!==a.BindingScopeEnum.Transient&&e.defaultScope!==a.BindingScopeEnum.Request)throw new Error(""+s.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(void 0===e.autoBindInjectable)e.autoBindInjectable=!1;else if("boolean"!=typeof e.autoBindInjectable)throw new Error(""+s.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(void 0===e.skipBaseClassChecks)e.skipBaseClassChecks=!1;else if("boolean"!=typeof e.skipBaseClassChecks)throw new Error(""+s.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:e.autoBindInjectable,defaultScope:e.defaultScope,skipBaseClassChecks:e.skipBaseClassChecks},this.guid=d.guid(),this._bindingDictionary=new g.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new c.MetadataReader}return t.merge=function(e,n){var r=new t,i=l.getBindingDictionary(r),o=l.getBindingDictionary(e),s=l.getBindingDictionary(n);function a(t,e){t.traverse(function(t,n){n.forEach(function(t){e.add(t.serviceIdentifier,t.clone())})})}return a(o,i),a(s,i),r},t.prototype.load=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=this._getContainerModuleHelpersFactory(),r=0,i=t;r<i.length;r++){var o=i[r],s=n(o.guid);o.registry(s.bindFunction,s.unbindFunction,s.isboundFunction,s.rebindFunction)}},t.prototype.loadAsync=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return r(this,void 0,void 0,function(){var e,n,r,o,s;return i(this,function(i){switch(i.label){case 0:e=this._getContainerModuleHelpersFactory(),n=0,r=t,i.label=1;case 1:return n<r.length?(o=r[n],s=e(o.guid),[4,o.registry(s.bindFunction,s.unbindFunction,s.isboundFunction,s.rebindFunction)]):[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},t.prototype.unload=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];e.forEach(function(e){var n=function(t){return function(e){return e.moduleId===t}}(e.guid);t._bindingDictionary.removeByCondition(n)})},t.prototype.bind=function(t){var e=this.options.defaultScope||a.BindingScopeEnum.Transient,n=new o.Binding(t,e);return this._bindingDictionary.add(t,n),new f.BindingToSyntax(n)},t.prototype.rebind=function(t){return this.unbind(t),this.bind(t)},t.prototype.unbind=function(t){try{this._bindingDictionary.remove(t)}catch(e){throw new Error(s.CANNOT_UNBIND+" "+p.getServiceIdentifierAsString(t))}},t.prototype.unbindAll=function(){this._bindingDictionary=new g.Lookup},t.prototype.isBound=function(t){var e=this._bindingDictionary.hasKey(t);return!e&&this.parent&&(e=this.parent.isBound(t)),e},t.prototype.isBoundNamed=function(t,e){return this.isBoundTagged(t,u.NAMED_TAG,e)},t.prototype.isBoundTagged=function(t,e,n){var r=!1;if(this._bindingDictionary.hasKey(t)){var i=this._bindingDictionary.get(t),o=l.createMockRequest(this,t,e,n);r=i.some(function(t){return t.constraint(o)})}return!r&&this.parent&&(r=this.parent.isBoundTagged(t,e,n)),r},t.prototype.snapshot=function(){this._snapshots.push(m.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},t.prototype.restore=function(){var t=this._snapshots.pop();if(void 0===t)throw new Error(s.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=t.bindings,this._middleware=t.middleware},t.prototype.createChild=function(e){var n=new t(e);return n.parent=this,n},t.prototype.applyMiddleware=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=t.reduce(function(t,e){return e(t)},n)},t.prototype.applyCustomMetadataReader=function(t){this._metadataReader=t},t.prototype.get=function(t){return this._get(!1,!1,a.TargetTypeEnum.Variable,t)},t.prototype.getTagged=function(t,e,n){return this._get(!1,!1,a.TargetTypeEnum.Variable,t,e,n)},t.prototype.getNamed=function(t,e){return this.getTagged(t,u.NAMED_TAG,e)},t.prototype.getAll=function(t){return this._get(!0,!0,a.TargetTypeEnum.Variable,t)},t.prototype.getAllTagged=function(t,e,n){return this._get(!1,!0,a.TargetTypeEnum.Variable,t,e,n)},t.prototype.getAllNamed=function(t,e){return this.getAllTagged(t,u.NAMED_TAG,e)},t.prototype.resolve=function(e){var n=new t;return n.bind(e).toSelf(),n.parent=this,n.get(e)},t.prototype._getContainerModuleHelpersFactory=function(){var t=this,e=function(t,e){t._binding.moduleId=e};return function(n){return{bindFunction:function(n){return function(r){var i=t.bind.bind(t)(r);return e(i,n),i}}(n),isboundFunction:function(e){return t.isBound.bind(t)(e)},rebindFunction:function(n){return function(r){var i=t.rebind.bind(t)(r);return e(i,n),i}}(n),unbindFunction:function(e){t.unbind.bind(t)(e)}}}},t.prototype._get=function(t,e,n,r,i,o){var a=null,u={avoidConstraints:t,contextInterceptor:function(t){return t},isMultiInject:e,key:i,serviceIdentifier:r,targetType:n,value:o};if(this._middleware){if(void 0===(a=this._middleware(u))||null===a)throw new Error(s.INVALID_MIDDLEWARE_RETURN)}else a=this._planAndResolve()(u);return a},t.prototype._planAndResolve=function(){var t=this;return function(e){var n=l.plan(t._metadataReader,t,e.isMultiInject,e.targetType,e.serviceIdentifier,e.key,e.value,e.avoidConstraints);return n=e.contextInterceptor(n),h.resolve(n)}},t}();e.Container=v},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(5),i=n(8),o=function(){function t(t,e){this.guid=i.guid(),this.activated=!1,this.serviceIdentifier=t,this.scope=e,this.type=r.BindingTypeEnum.Invalid,this.constraint=function(t){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return t.prototype.clone=function(){var e=new t(this.serviceIdentifier,this.scope);return e.activated=!1,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.factory=this.factory,e.provider=this.provider,e.constraint=this.constraint,e.onActivation=this.onActivation,e.cache=this.cache,e},t}();e.Binding=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(35),i=n(3),o=n(5),s=n(2),a=n(20),u=n(11),c=n(36),l=n(4),h=n(37),f=n(38),d=n(40),p=n(22);function m(t){return t._bindingDictionary}function g(t,e,n,o,s){var a=v(n.container,s.serviceIdentifier),c=[];return a.length===r.BindingCount.NoBindingsAvailable&&n.container.options.autoBindInjectable&&"function"==typeof s.serviceIdentifier&&t.getConstructorMetadata(s.serviceIdentifier).compilerGeneratedMetadata&&(n.container.bind(s.serviceIdentifier).toSelf(),a=v(n.container,s.serviceIdentifier)),c=e?a:a.filter(function(t){var e=new d.Request(t.serviceIdentifier,n,o,t,s);return t.constraint(e)}),function(t,e,n,o){switch(e.length){case r.BindingCount.NoBindingsAvailable:if(n.isOptional())return e;var s=u.getServiceIdentifierAsString(t),a=i.NOT_REGISTERED;throw a+=u.listMetadataForTarget(s,n),a+=u.listRegisteredBindingsForServiceIdentifier(o,s,v),new Error(a);case r.BindingCount.OnlyOneBindingAvailable:if(!n.isArray())return e;case r.BindingCount.MultipleBindingsAvailable:default:if(n.isArray())return e;var s=u.getServiceIdentifierAsString(t),a=i.AMBIGUOUS_MATCH+" "+s;throw a+=u.listRegisteredBindingsForServiceIdentifier(o,s,v),new Error(a)}}(s.serviceIdentifier,c,s,n.container),c}function v(t,e){var n=[],r=m(t);return r.hasKey(e)?n=r.get(e):null!==t.parent&&(n=v(t.parent,e)),n}e.getBindingDictionary=m,e.plan=function(t,e,n,r,m,v,_,y){void 0===y&&(y=!1);var b=new c.Context(e),w=function(t,e,n,r,i,o){var a=t?s.MULTI_INJECT_TAG:s.INJECT_TAG,u=new l.Metadata(a,n),c=new p.Target(e,r,n,u);if(void 0!==i){var h=new l.Metadata(i,o);c.metadata.push(h)}return c}(n,r,m,"",v,_);try{return function t(e,n,r,s,a,u){var c,l;if(null===a){c=g(e,n,s,null,u),l=new d.Request(r,s,null,c,u);var p=new h.Plan(s,l);s.addPlan(p)}else c=g(e,n,s,a,u),l=a.addChildRequest(u.serviceIdentifier,c,u);c.forEach(function(n){var r=null;if(u.isArray())r=l.addChildRequest(n.serviceIdentifier,n,u);else{if(n.cache)return;r=l}if(n.type===o.BindingTypeEnum.Instance&&null!==n.implementationType){var a=f.getDependencies(e,n.implementationType);if(!s.container.options.skipBaseClassChecks){var c=f.getBaseClassDependencyCount(e,n.implementationType);if(a.length<c){var h=i.ARGUMENTS_LENGTH_MISMATCH(f.getFunctionName(n.implementationType));throw new Error(h)}}a.forEach(function(n){t(e,!1,n.serviceIdentifier,s,r,n)})}})}(t,y,m,b,null,w),b}catch(t){throw a.isStackOverflowExeption(t)&&b.plan&&u.circularDependencyToException(b.plan.rootRequest),t}},e.createMockRequest=function(t,e,n,r){var i=new p.Target(o.TargetTypeEnum.Variable,"",e,new l.Metadata(n,r)),s=new c.Context(t);return new d.Request(e,s,null,[],i)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.BindingCount={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(8),i=function(){function t(t){this.guid=r.guid(),this.container=t}return t.prototype.addPlan=function(t){this.plan=t},t.prototype.setCurrentRequest=function(t){this.currentRequest=t},t}();e.Context=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){return function(t,e){this.parentContext=t,this.rootRequest=e}}();e.Plan=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(21),i=n(3),o=n(5),s=n(2),a=n(11);e.getFunctionName=a.getFunctionName;var u=n(22);function c(t,e,n,r){var s=t.getConstructorMetadata(n),a=s.compilerGeneratedMetadata;if(void 0===a){var c=i.MISSING_INJECTABLE_ANNOTATION+" "+e+".";throw new Error(c)}var f=s.userGeneratedMetadata,d=Object.keys(f),p=function(t,e,n,r,i){for(var o=[],s=0;s<i;s++){var a=s,u=l(a,t,e,n,r);null!==u&&o.push(u)}return o}(r,e,a,f,0===n.length&&d.length>0?d.length:n.length),m=function t(e,n){var r=e.getPropertiesMetadata(n);var i=[];var s=Object.keys(r);for(var a=0,c=s;a<c.length;a++){var l=c[a],f=r[l],d=h(r[l]),p=d.targetName||l,m=d.inject||d.multiInject,g=new u.Target(o.TargetTypeEnum.ClassProperty,p,m);g.metadata=f,i.push(g)}var v=Object.getPrototypeOf(n.prototype).constructor;if(v!==Object){var _=t(e,v);i=i.concat(_)}return i}(t,n);return p.concat(m)}function l(t,e,n,s,a){var c=a[t.toString()]||[],l=h(c),f=!0!==l.unmanaged,d=s[t],p=l.inject||l.multiInject;if((d=p||d)instanceof r.LazyServiceIdentifer&&(d=d.unwrap()),f){var m=d===Object,g=d===Function;if(!e&&(m||g||void 0===d)){var v=i.MISSING_INJECT_ANNOTATION+" argument "+t+" in class "+n+".";throw new Error(v)}var _=new u.Target(o.TargetTypeEnum.ConstructorArgument,l.targetName,d);return _.metadata=c,_}return null}function h(t){var e={};return t.forEach(function(t){e[t.key.toString()]=t.value}),{inject:e[s.INJECT_TAG],multiInject:e[s.MULTI_INJECT_TAG],targetName:e[s.NAME_TAG],unmanaged:e[s.UNMANAGED_TAG]}}e.getDependencies=function(t,e){return c(t,a.getFunctionName(e),e,!1)},e.getBaseClassDependencyCount=function t(e,n){var r=Object.getPrototypeOf(n.prototype).constructor;if(r!==Object){var i=c(e,a.getFunctionName(r),r,!0),o=i.map(function(t){return t.metadata.filter(function(t){return t.key===s.UNMANAGED_TAG})}),u=[].concat.apply([],o).length,l=i.length-u;return l>0?l:t(e,r)}return 0}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t){this.str=t}return t.prototype.startsWith=function(t){return 0===this.str.indexOf(t)},t.prototype.endsWith=function(t){var e,n=t.split("").reverse().join("");return e=this.str.split("").reverse().join(""),this.startsWith.call({str:e},n)},t.prototype.contains=function(t){return-1!==this.str.indexOf(t)},t.prototype.equals=function(t){return this.str===t},t.prototype.value=function(){return this.str},t}();e.QueryableString=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(8),i=function(){function t(t,e,n,i,o){this.guid=r.guid(),this.serviceIdentifier=t,this.parentContext=e,this.parentRequest=n,this.target=o,this.childRequests=[],this.bindings=Array.isArray(i)?i:[i],this.requestScope=null===n?new Map:null}return t.prototype.addChildRequest=function(e,n,r){var i=new t(e,this.parentContext,this,n,r);return this.childRequests.push(i),i},t}();e.Request=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(5),o=n(20),s=n(11),a=n(42),u=function(t,e,n){try{return n()}catch(n){throw o.isStackOverflowExeption(n)?new Error(r.CIRCULAR_DEPENDENCY_IN_FACTORY(t,e.toString())):n}},c=function(t){return function(e){e.parentContext.setCurrentRequest(e);var n=e.bindings,o=e.childRequests,l=e.target&&e.target.isArray(),h=!(e.parentRequest&&e.parentRequest.target&&e.target&&e.parentRequest.target.matchesArray(e.target.serviceIdentifier));if(l&&h)return o.map(function(e){return c(t)(e)});var f=null;if(!e.target.isOptional()||0!==n.length){var d=n[0],p=d.scope===i.BindingScopeEnum.Singleton,m=d.scope===i.BindingScopeEnum.Request;if(p&&d.activated)return d.cache;if(m&&null!==t&&t.has(d.guid))return t.get(d.guid);if(d.type===i.BindingTypeEnum.ConstantValue)f=d.cache;else if(d.type===i.BindingTypeEnum.Function)f=d.cache;else if(d.type===i.BindingTypeEnum.Constructor)f=d.implementationType;else if(d.type===i.BindingTypeEnum.DynamicValue&&null!==d.dynamicValue)f=u("toDynamicValue",d.serviceIdentifier,function(){return d.dynamicValue(e.parentContext)});else if(d.type===i.BindingTypeEnum.Factory&&null!==d.factory)f=u("toFactory",d.serviceIdentifier,function(){return d.factory(e.parentContext)});else if(d.type===i.BindingTypeEnum.Provider&&null!==d.provider)f=u("toProvider",d.serviceIdentifier,function(){return d.provider(e.parentContext)});else{if(d.type!==i.BindingTypeEnum.Instance||null===d.implementationType){var g=s.getServiceIdentifierAsString(e.serviceIdentifier);throw new Error(r.INVALID_BINDING_TYPE+" "+g)}f=a.resolveInstance(d.implementationType,o,c(t))}return"function"==typeof d.onActivation&&(f=d.onActivation(e.parentContext,f)),p&&(d.cache=f,d.activated=!0),m&&null!==t&&!t.has(d.guid)&&t.set(d.guid,f),f}}};e.resolve=function(t){return c(t.plan.rootRequest.requestScope)(t.plan.rootRequest)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(5),o=n(2);e.resolveInstance=function(t,e,n){var s=null;return s=e.length>0?function(t,e,n){var r=e.filter(function(t){return null!==t.target&&t.target.type===i.TargetTypeEnum.ClassProperty}),o=r.map(n);return r.forEach(function(e,n){var r;r=e.target.name.value();var i=o[n];t[r]=i}),t}(s=function(t,e){return new(t.bind.apply(t,[void 0].concat(e)))}(t,e.filter(function(t){return null!==t.target&&t.target.type===i.TargetTypeEnum.ConstructorArgument}).map(n)),e,n):new t,function(t,e){if(Reflect.hasMetadata(o.POST_CONSTRUCT,t)){var n=Reflect.getMetadata(o.POST_CONSTRUCT,t);try{e[n.value]()}catch(e){throw new Error(r.POST_CONSTRUCT_ERROR(t.name,e.message))}}}(t,s),s}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(5),o=n(44),s=n(23),a=function(){function t(t){this._binding=t}return t.prototype.to=function(t){return this._binding.type=i.BindingTypeEnum.Instance,this._binding.implementationType=t,new o.BindingInWhenOnSyntax(this._binding)},t.prototype.toSelf=function(){if("function"!=typeof this._binding.serviceIdentifier)throw new Error(""+r.INVALID_TO_SELF_VALUE);var t=this._binding.serviceIdentifier;return this.to(t)},t.prototype.toConstantValue=function(t){return this._binding.type=i.BindingTypeEnum.ConstantValue,this._binding.cache=t,this._binding.dynamicValue=null,this._binding.implementationType=null,new s.BindingWhenOnSyntax(this._binding)},t.prototype.toDynamicValue=function(t){return this._binding.type=i.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=t,this._binding.implementationType=null,new o.BindingInWhenOnSyntax(this._binding)},t.prototype.toConstructor=function(t){return this._binding.type=i.BindingTypeEnum.Constructor,this._binding.implementationType=t,new s.BindingWhenOnSyntax(this._binding)},t.prototype.toFactory=function(t){return this._binding.type=i.BindingTypeEnum.Factory,this._binding.factory=t,new s.BindingWhenOnSyntax(this._binding)},t.prototype.toFunction=function(t){if("function"!=typeof t)throw new Error(r.INVALID_FUNCTION_BINDING);var e=this.toConstantValue(t);return this._binding.type=i.BindingTypeEnum.Function,e},t.prototype.toAutoFactory=function(t){return this._binding.type=i.BindingTypeEnum.Factory,this._binding.factory=function(e){return function(){return e.container.get(t)}},new s.BindingWhenOnSyntax(this._binding)},t.prototype.toProvider=function(t){return this._binding.type=i.BindingTypeEnum.Provider,this._binding.provider=t,new s.BindingWhenOnSyntax(this._binding)},t.prototype.toService=function(t){this.toDynamicValue(function(e){return e.container.get(t)})},t}();e.BindingToSyntax=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(45),i=n(14),o=n(15),s=function(){function t(t){this._binding=t,this._bindingWhenSyntax=new o.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new i.BindingOnSyntax(this._binding),this._bindingInSyntax=new r.BindingInSyntax(t)}return t.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},t.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},t.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},t.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},t.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},t.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},t.prototype.whenTargetTagged=function(t,e){return this._bindingWhenSyntax.whenTargetTagged(t,e)},t.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},t.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},t.prototype.whenParentTagged=function(t,e){return this._bindingWhenSyntax.whenParentTagged(t,e)},t.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},t.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},t.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,e)},t.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},t.prototype.whenNoAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenNoAncestorTagged(t,e)},t.prototype.whenAnyAncestorMatches=function(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},t.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},t.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},t}();e.BindingInWhenOnSyntax=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(5),i=n(23),o=function(){function t(t){this._binding=t}return t.prototype.inRequestScope=function(){return this._binding.scope=r.BindingScopeEnum.Request,new i.BindingWhenOnSyntax(this._binding)},t.prototype.inSingletonScope=function(){return this._binding.scope=r.BindingScopeEnum.Singleton,new i.BindingWhenOnSyntax(this._binding)},t.prototype.inTransientScope=function(){return this._binding.scope=r.BindingScopeEnum.Transient,new i.BindingWhenOnSyntax(this._binding)},t}();e.BindingInSyntax=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){}return t.of=function(e,n){var r=new t;return r.bindings=e,r.middleware=n,r},t}();e.ContainerSnapshot=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=function(){function t(){this._map=new Map}return t.prototype.getMap=function(){return this._map},t.prototype.add=function(t,e){if(null===t||void 0===t)throw new Error(r.NULL_ARGUMENT);if(null===e||void 0===e)throw new Error(r.NULL_ARGUMENT);var n=this._map.get(t);void 0!==n?(n.push(e),this._map.set(t,n)):this._map.set(t,[e])},t.prototype.get=function(t){if(null===t||void 0===t)throw new Error(r.NULL_ARGUMENT);var e=this._map.get(t);if(void 0!==e)return e;throw new Error(r.KEY_NOT_FOUND)},t.prototype.remove=function(t){if(null===t||void 0===t)throw new Error(r.NULL_ARGUMENT);if(!this._map.delete(t))throw new Error(r.KEY_NOT_FOUND)},t.prototype.removeByCondition=function(t){var e=this;this._map.forEach(function(n,r){var i=n.filter(function(e){return!t(e)});i.length>0?e._map.set(r,i):e._map.delete(r)})},t.prototype.hasKey=function(t){if(null===t||void 0===t)throw new Error(r.NULL_ARGUMENT);return this._map.has(t)},t.prototype.clone=function(){var e=new t;return this._map.forEach(function(t,n){t.forEach(function(t){return e.add(n,t.clone())})}),e},t.prototype.traverse=function(t){this._map.forEach(function(e,n){t(n,e)})},t}();e.Lookup=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(8),i=function(){return function(t){this.guid=r.guid(),this.registry=t}}();e.ContainerModule=i;var o=function(){return function(t){this.guid=r.guid(),this.registry=t}}();e.AsyncContainerModule=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(2);e.injectable=function(){return function(t){if(Reflect.hasOwnMetadata(i.PARAM_TYPES,t))throw new Error(r.DUPLICATED_INJECTABLE_DECORATOR);var e=Reflect.getMetadata(i.DESIGN_PARAM_TYPES,t)||[];return Reflect.defineMetadata(i.PARAM_TYPES,e,t),t}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(4),i=n(6);e.tagged=function(t,e){return function(n,o,s){var a=new r.Metadata(t,e);"number"==typeof s?i.tagParameter(n,o,s,a):i.tagProperty(n,o,a)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),i=n(4),o=n(6);e.named=function(t){return function(e,n,s){var a=new i.Metadata(r.NAMED_TAG,t);"number"==typeof s?o.tagParameter(e,n,s,a):o.tagProperty(e,n,a)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),i=n(4),o=n(6);e.optional=function(){return function(t,e,n){var s=new i.Metadata(r.OPTIONAL_TAG,!0);"number"==typeof n?o.tagParameter(t,e,n,s):o.tagProperty(t,e,s)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),i=n(4),o=n(6);e.unmanaged=function(){return function(t,e,n){var s=new i.Metadata(r.UNMANAGED_TAG,!0);o.tagParameter(t,e,n,s)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),i=n(4),o=n(6);e.multiInject=function(t){return function(e,n,s){var a=new i.Metadata(r.MULTI_INJECT_TAG,t);"number"==typeof s?o.tagParameter(e,n,s,a):o.tagProperty(e,n,a)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),i=n(4),o=n(6);e.targetName=function(t){return function(e,n,s){var a=new i.Metadata(r.NAME_TAG,t);o.tagParameter(e,n,s,a)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(2),o=n(4);e.postConstruct=function(){return function(t,e,n){var s=new o.Metadata(i.POST_CONSTRUCT,e);if(Reflect.hasOwnMetadata(i.POST_CONSTRUCT,t.constructor))throw new Error(r.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(i.POST_CONSTRUCT,s,t.constructor)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.multiBindToService=function(t){return function(e){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return n.forEach(function(n){return t.bind(n).toService(e)})}}}},function(t,e,n){"use strict";n.r(e);n(27);var r=n(1);function i(t){return 0==(t&t-1)}r.Matrix.Translation=function(t){var e;if(2==t.elements.length)return(e=r.Matrix.I(3)).elements[2][0]=t.elements[0],e.elements[2][1]=t.elements[1],e;if(3==t.elements.length)return(e=r.Matrix.I(4)).elements[0][3]=t.elements[0],e.elements[1][3]=t.elements[1],e.elements[2][3]=t.elements[2],e;throw"Invalid length for Translation"},r.Matrix.prototype.flatten=function(){var t=[];if(0==this.elements.length)return[];for(var e=0;e<this.elements[0].length;e++)for(var n=0;n<this.elements.length;n++)t.push(this.elements[n][e]);return t},r.Matrix.prototype.ensure4x4=function(){if(4==this.elements.length&&4==this.elements[0].length)return this;if(this.elements.length>4||this.elements[0].length>4)return null;for(var t=0;t<this.elements.length;t++)for(var e=this.elements[t].length;e<4;e++)t==e?this.elements[t].push(1):this.elements[t].push(0);for(t=this.elements.length;t<4;t++)0==t?this.elements.push([1,0,0,0]):1==t?this.elements.push([0,1,0,0]):2==t?this.elements.push([0,0,1,0]):3==t&&this.elements.push([0,0,0,1]);return this},r.Matrix.prototype.make3x3=function(){return 4!=this.elements.length||4!=this.elements[0].length?null:r.Matrix.create([[this.elements[0][0],this.elements[0][1],this.elements[0][2]],[this.elements[1][0],this.elements[1][1],this.elements[1][2]],[this.elements[2][0],this.elements[2][1],this.elements[2][2]]])},r.Vector.prototype.ensure3=function(){return r.Vector.create([this.elements[0],this.elements[1],this.elements[2]])},r.Vector.prototype.ensure4=function(t){return r.Vector.create([this.elements[0],this.elements[1],this.elements[2],t])},r.Vector.prototype.divideByW=function(){for(var t=this.elements[this.elements.length-1],e=[],n=0;n<this.elements.length;n++)e.push(this.elements[n]/t);return r.Vector.create(e)},r.Vector.prototype.componentDivide=function(t){if(this.elements.length!=t.elements.length)return null;for(var e=[],n=0;n<this.elements.length;n++)e.push(this.elements[n]/t.elements[n]);return r.Vector.create(e)},r.Vector.min=function(t,e){if(t.elements.length!=e.elements.length)return null;for(var n=[],i=0;i<t.elements.length;i++)n.push(Math.min(t.elements[i],e.elements[i]));return r.Vector.create(n)},r.Vector.max=function(t,e){if(t.elements.length!=e.elements.length)return null;for(var n=[],i=0;i<t.elements.length;i++)n.push(Math.max(t.elements[i],e.elements[i]));return r.Vector.create(n)},r.Vector.prototype.minComponent=function(){for(var t=Number.MAX_VALUE,e=0;e<this.elements.length;e++)t=Math.min(t,this.elements[e]);return t},r.Vector.prototype.maxComponent=function(){for(var t=-Number.MAX_VALUE,e=0;e<this.elements.length;e++)t=Math.max(t,this.elements[e]);return t};var o=n(25),s=(n(30),n(0)),a={ISceneService:Symbol("ISceneService"),ICameraService:Symbol("ICameraService"),IMouseService:Symbol("IMouseService"),ICanvasService:Symbol("ICanvasService"),IRendererService:Symbol("IRendererService"),IControlsService:Symbol("IControlsService"),ITextureLoaderService:Symbol("ITextureLoaderService")},u=n(7),c=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},l=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},h=0,f=function(){function t(){this.meshes=[],this.lights=[],this.lightsInfo={},this.inited=!1,this.idx=h++}return t.prototype.addMesh=function(t){this.meshes.push(t)},t.prototype.addLight=function(t){this.lightsInfo[t.type]||(this.lightsInfo[t.type]={varName:t.type.charAt(0).toLowerCase()+t.type.substring(1),declaration:t.declaration,lights:[]}),this.lightsInfo[t.type].lights.push(t)},t.prototype.getLightsInfo=function(){return this.lightsInfo},t.prototype.init=function(){this.meshes.forEach(function(t){return t.init()}),this.inited=!0},t=c([Object(s.injectable)(),l("design:paramtypes",[])],t)}(),d=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},p=function(){function t(){this.transform=r.Matrix.I(4)}return t.prototype.init=function(t,e,n,r,i,o){this.eye=t,this.center=e,this.up=$V([0,1,0]),this.fovy=n,this.aspect=r,this.znear=i,this.zfar=o,this.updateProjection(),this.updateTransform()},t.prototype.perspective=function(t,e,n,r){var i=n*Math.tan(t*Math.PI/360),o=-i,s=o*e,a=i*e;return $M([[2*n/(a-s),0,(a+s)/(a-s),0],[0,2*n/(i-o),(i+o)/(i-o),0],[0,0,-(r+n)/(r-n),-2*r*n/(r-n)],[0,0,-1,0]])},t.prototype.lookAt=function(t,e,n){var i=t.subtract(e).toUnitVector(),o=n.cross(i).toUnitVector(),s=i.cross(o).toUnitVector(),a=$M([[o.e(1),o.e(2),o.e(3),0],[s.e(1),s.e(2),s.e(3),0],[i.e(1),i.e(2),i.e(3),0],[0,0,0,1]]),u=r.Matrix.Translation($V([-t.e(1),-t.e(2),-t.e(3)]));return a.x(u)},t.prototype.ortho=function(t,e,n,r,i,o){return $M([[2/(e-t),0,0,-(e+t)/(e-t)],[0,2/(r-n),0,-(r+n)/(r-n)],[0,0,-2/(o-i),-(o+i)/(o-i)],[0,0,0,1]])},t.prototype.truck=function(t){var e=this.eye.subtract(this.center).toUnitVector(),n=this.up.cross(e).toUnitVector();n=n.x(t),this.eye=this.eye.add(n),this.center=this.center.add(n),this.updateTransform()},t.prototype.pedestal=function(t){var e=this.eye.subtract(this.center).toUnitVector(),n=this.up.cross(e).toUnitVector(),r=e.cross(n).toUnitVector();r=r.x(t),this.eye=this.eye.add(r),this.center=this.center.add(r),this.updateTransform()},t.prototype.dolly=function(t){var e=this.eye.subtract(this.center).toUnitVector();e=e.x(t),this.eye=this.eye.add(e),this.center=this.center.add(e),this.updateTransform()},t.prototype.tilt=function(t){var e=this.eye.subtract(this.center).toUnitVector(),n=this.up.cross(e).toUnitVector(),i=this.center.subtract(this.eye),o=r.Matrix.Rotation(t,n);i=o.x(i),this.center=i.add(this.eye),Math.abs(e.dot(this.up))>=.985&&(this.up=o.x(this.up)),this.updateTransform()},t.prototype.pan=function(t){var e=this.eye.subtract(this.center).toUnitVector(),n=this.up.cross(e).toUnitVector(),i=e.cross(n).toUnitVector(),o=r.Matrix.Rotation(t,i),s=this.center.subtract(this.eye);s=o.x(s),this.center=s.add(this.eye),Math.abs(e.dot(this.up))>=.985&&(this.up=o.x(this.up)),this.updateTransform()},t.prototype.cant=function(t){var e=this.eye.subtract(this.center).toUnitVector(),n=this.center.subtract(this.eye),i=r.Matrix.Rotation(t,e);n=i.x(n),this.center=n.add(this.eye),this.up=i.x(this.up),this.updateTransform()},t.prototype.updateTransform=function(){this.view=this.lookAt(this.eye,this.center,this.up),this.transform=this.projection.x(this.view)},t.prototype.updateProjection=function(){this.projection=this.perspective(this.fovy,this.aspect,this.znear,this.zfar)},t=d([Object(s.injectable)()],t)}(),m=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),g=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},v=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},_=function(t){function e(){var e=t.call(this)||this;return e.el=document.getElementById("webgl"),e.onResize=e.onResize.bind(e),window.addEventListener("resize",e.onResize,!1),e.resize(),e}var n;return m(e,t),n=e,e.prototype.getSize=function(){return{width:this.el.width,height:this.el.height}},e.prototype.resize=function(){var t=window.devicePixelRatio,e=Math.floor(this.el.clientWidth*t),n=Math.floor(this.el.clientHeight*t);this.el.width===e&&this.el.height===n||(this.el.width=e,this.el.height=n)},e.prototype.onResize=function(){this.resize(),this.emit(n.RESIZE_EVENT)},e.RESIZE_EVENT="resize",e=n=g([Object(s.injectable)(),v("design:paramtypes",[])],e)}(u.EventEmitter),y=n(16),b=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),w=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},E=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},T=function(t,e){return function(n,r){e(n,r,t)}},x=function(t){function e(e){var n=t.call(this)||this;n.isMoving=!1,n.lastX=-1,n.lastY=-1,n.deltaX=0,n.deltaY=0,n.deltaZ=0,n.canvas=e,n.onPanstart=n.onPanstart.bind(n),n.onPanmove=n.onPanmove.bind(n),n.onPanend=n.onPanend.bind(n),n.onPinch=n.onPinch.bind(n),n.onMousewheel=n.onMousewheel.bind(n);var r=new y(n.canvas.el);return r.get("pan").set({direction:y.DIRECTION_ALL}),r.get("pinch").set({enable:!0}),r.on("panstart",n.onPanstart),r.on("panmove",n.onPanmove),r.on("panend",n.onPanend),r.on("pinch",n.onPinch),n.canvas.el.addEventListener("wheel",n.onMousewheel),n}var n;return b(e,t),n=e,e.prototype.onPanend=function(t){this.isMoving=!1,this.emit(n.UP_EVENT)},e.prototype.onPanstart=function(t){this.lastX=t.center.x,this.lastY=t.center.y,this.isMoving=!0,this.deltaZ=0,this.emit(n.DOWN_EVENT)},e.prototype.onPanmove=function(t){this.isMoving&&(this.deltaX=t.center.x-this.lastX,this.deltaY=t.center.y-this.lastY,this.lastX=t.center.x,this.lastY=t.center.y,this.emit(n.MOVE_EVENT,{deltaX:this.deltaX,deltaY:this.deltaY,deltaZ:this.deltaZ}))},e.prototype.onMousewheel=function(t){this.deltaZ=t.deltaY,this.emit(n.WHEEL_EVENT,{deltaX:this.deltaX,deltaY:this.deltaY,deltaZ:this.deltaZ})},e.prototype.onPinch=function(t){this.deltaZ=10*(1-t.scale),this.emit(n.WHEEL_EVENT,{deltaX:this.deltaX,deltaY:this.deltaY,deltaZ:this.deltaZ})},e.UP_EVENT="mouseup",e.MOVE_EVENT="mousemove",e.DOWN_EVENT="mousedown",e.OUT_EVENT="mouseout",e.WHEEL_EVENT="mousewheel",e=n=w([Object(s.injectable)(),T(0,Object(s.inject)(a.ICanvasService)),E("design:paramtypes",[Object])],e)}(u.EventEmitter);function A(t,e,n){var r=t.createShader(e);if(null==r)return console.log("Failed to create shader."),null;if(t.shaderSource(r,n),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS)){var i=t.getShaderInfoLog(r);return console.log("Failed to compile shader: "+i),t.deleteShader(r),null}return r}function S(t,e,n){var r=function(t,e,n){var r=A(t,t.VERTEX_SHADER,e),i=A(t,t.FRAGMENT_SHADER,n);if(!r||!i)return null;var o=t.createProgram();if(!o)return null;if(t.attachShader(o,r),t.attachShader(o,i),t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS)){var s=t.getProgramInfoLog(o);return console.log("Failed to link program: "+s),t.deleteProgram(o),t.deleteShader(i),t.deleteShader(r),null}return o}(t,e,n);return r?(t.useProgram(r),r):(console.log("Failed to create program."),!1)}function O(t,e,n,r,i,o){var s=t.createBuffer();if(!s)return console.log("Failed to create the buffer object"),!1;t.bindBuffer(t.ARRAY_BUFFER,s),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW);var a=t.getAttribLocation(e,n);return a<0?(console.log("Failed to get the storage location of "+n),!1):(t.vertexAttribPointer(a,i,o,!1,0,0),t.enableVertexAttribArray(a),!0)}function C(t,e,n,i){for(var o in n){var s=n[o],a=t.getUniformLocation(e,o);null!=a&&(s instanceof r.Vector?t.uniform3fv(a,new Float32Array([s.elements[0],s.elements[1],s.elements[2]])):s instanceof r.Matrix?t.uniformMatrix4fv(a,!1,new Float32Array(s.flatten())):s%1==0&&"int"===i?t.uniform1i(a,s):t.uniform1f(a,s))}}var M=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},I=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},P=function(t,e){return function(n,r){e(n,r,t)}},R=function(){function t(t,e){this.shaders=[],this.clearColor=$V([0,0,0]),this.canvas=t,this.scene=e;var n=function(t){for(var e=["webgl","experimental-webgl"],n=null,r=0;r<e.length;++r){try{n=t.getContext(e[r])}catch(t){}if(n)break}return n}(this.canvas.el);this.gl=n,n?(this.gl.clearColor(this.clearColor.e(1),this.clearColor.e(2),this.clearColor.e(3),1),this.gl.enable(n.DEPTH_TEST),this.gl.enable(n.CULL_FACE)):console.log("Failed to get the rendering context for WebGL.")}return t.prototype.addShader=function(t){this.shaders.push(t)},t.prototype.updateShaders=function(){this.shaders.forEach(function(t){t.inited=!1})},t.prototype.updateScene=function(){this.scene.inited=!1},t.prototype.render=function(){var t=this;this.shaders.forEach(function(e){e.inited||e.init(t.gl)}),this.scene.inited||this.scene.init(),this.shaders.forEach(function(t){t.draw()})},t=M([Object(s.injectable)(),P(0,Object(s.inject)(a.ICanvasService)),P(1,Object(s.inject)(a.ISceneService)),I("design:paramtypes",[Object,Object])],t)}();function N(t,e){var n=t.__state.conversionName.toString(),r=Math.round(t.r),i=Math.round(t.g),o=Math.round(t.b),s=t.a,a=Math.round(t.h),u=t.s.toFixed(1),c=t.v.toFixed(1);if(e||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var l=t.hex.toString(16);l.length<6;)l="0"+l;return"#"+l}return"CSS_RGB"===n?"rgb("+r+","+i+","+o+")":"CSS_RGBA"===n?"rgba("+r+","+i+","+o+","+s+")":"HEX"===n?"0x"+t.hex.toString(16):"RGB_ARRAY"===n?"["+r+","+i+","+o+"]":"RGBA_ARRAY"===n?"["+r+","+i+","+o+","+s+"]":"RGB_OBJ"===n?"{r:"+r+",g:"+i+",b:"+o+"}":"RGBA_OBJ"===n?"{r:"+r+",g:"+i+",b:"+o+",a:"+s+"}":"HSV_OBJ"===n?"{h:"+a+",s:"+u+",v:"+c+"}":"HSVA_OBJ"===n?"{h:"+a+",s:"+u+",v:"+c+",a:"+s+"}":"unknown format"}var j=Array.prototype.forEach,D=Array.prototype.slice,k={BREAK:{},extend:function(t){return this.each(D.call(arguments,1),function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(n){this.isUndefined(e[n])||(t[n]=e[n])}.bind(this))},this),t},defaults:function(t){return this.each(D.call(arguments,1),function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(n){this.isUndefined(t[n])&&(t[n]=e[n])}.bind(this))},this),t},compose:function(){var t=D.call(arguments);return function(){for(var e=D.call(arguments),n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},each:function(t,e,n){if(t)if(j&&t.forEach&&t.forEach===j)t.forEach(e,n);else if(t.length===t.length+0){var r,i=void 0;for(i=0,r=t.length;i<r;i++)if(i in t&&e.call(n,t[i],i)===this.BREAK)return}else for(var o in t)if(e.call(n,t[o],o)===this.BREAK)return},defer:function(t){setTimeout(t,0)},debounce:function(t,e,n){var r=void 0;return function(){var i=this,o=arguments;var s=n||!r;clearTimeout(r),r=setTimeout(function(){r=null,n||t.apply(i,o)},e),s&&t.apply(i,o)}},toArray:function(t){return t.toArray?t.toArray():D.call(t)},isUndefined:function(t){return void 0===t},isNull:function(t){return null===t},isNaN:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){return isNaN(t)}),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return!1===t||!0===t},isFunction:function(t){return"[object Function]"===Object.prototype.toString.call(t)}},L=[{litmus:k.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:N},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:N},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:N},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:N}}},{litmus:k.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:k.isArray,conversions:{RGB_ARRAY:{read:function(t){return 3===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return 4===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:k.isObject,conversions:{RGBA_OBJ:{read:function(t){return!!(k.isNumber(t.r)&&k.isNumber(t.g)&&k.isNumber(t.b)&&k.isNumber(t.a))&&{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return!!(k.isNumber(t.r)&&k.isNumber(t.g)&&k.isNumber(t.b))&&{space:"RGB",r:t.r,g:t.g,b:t.b}},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return!!(k.isNumber(t.h)&&k.isNumber(t.s)&&k.isNumber(t.v)&&k.isNumber(t.a))&&{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return!!(k.isNumber(t.h)&&k.isNumber(t.s)&&k.isNumber(t.v))&&{space:"HSV",h:t.h,s:t.s,v:t.v}},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}],F=void 0,B=void 0,U=function(){B=!1;var t=arguments.length>1?k.toArray(arguments):arguments[0];return k.each(L,function(e){if(e.litmus(t))return k.each(e.conversions,function(e,n){if(F=e.read(t),!1===B&&!1!==F)return B=F,F.conversionName=n,F.conversion=e,k.BREAK}),k.BREAK}),B},V=void 0,G={hsv_to_rgb:function(t,e,n){var r=Math.floor(t/60)%6,i=t/60-Math.floor(t/60),o=n*(1-e),s=n*(1-i*e),a=n*(1-(1-i)*e),u=[[n,a,o],[s,n,o],[o,n,a],[o,s,n],[a,o,n],[n,o,s]][r];return{r:255*u[0],g:255*u[1],b:255*u[2]}},rgb_to_hsv:function(t,e,n){var r=Math.min(t,e,n),i=Math.max(t,e,n),o=i-r,s=void 0;return 0===i?{h:NaN,s:0,v:0}:(s=t===i?(e-n)/o:e===i?2+(n-t)/o:4+(t-e)/o,(s/=6)<0&&(s+=1),{h:360*s,s:o/i,v:i/255})},rgb_to_hex:function(t,e,n){var r=this.hex_with_component(0,2,t);return r=this.hex_with_component(r,1,e),r=this.hex_with_component(r,0,n)},component_from_hex:function(t,e){return t>>8*e&255},hex_with_component:function(t,e,n){return n<<(V=8*e)|t&~(255<<V)}},z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},H=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},W=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),q=function t(e,n,r){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,n);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,r)}if("value"in i)return i.value;var s=i.get;return void 0!==s?s.call(r):void 0},X=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},Y=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},$=function(){function t(){if(H(this,t),this.__state=U.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return W(t,[{key:"toString",value:function(){return N(this)}},{key:"toHexString",value:function(){return N(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t}();function J(t,e,n){Object.defineProperty(t,e,{get:function(){return"RGB"===this.__state.space?this.__state[e]:($.recalculateRGB(this,e,n),this.__state[e])},set:function(t){"RGB"!==this.__state.space&&($.recalculateRGB(this,e,n),this.__state.space="RGB"),this.__state[e]=t}})}function K(t,e){Object.defineProperty(t,e,{get:function(){return"HSV"===this.__state.space?this.__state[e]:($.recalculateHSV(this),this.__state[e])},set:function(t){"HSV"!==this.__state.space&&($.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=t}})}$.recalculateRGB=function(t,e,n){if("HEX"===t.__state.space)t.__state[e]=G.component_from_hex(t.__state.hex,n);else{if("HSV"!==t.__state.space)throw new Error("Corrupted color state");k.extend(t.__state,G.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v))}},$.recalculateHSV=function(t){var e=G.rgb_to_hsv(t.r,t.g,t.b);k.extend(t.__state,{s:e.s,v:e.v}),k.isNaN(e.h)?k.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=e.h},$.COMPONENTS=["r","g","b","h","s","v","hex","a"],J($.prototype,"r",2),J($.prototype,"g",1),J($.prototype,"b",0),K($.prototype,"h"),K($.prototype,"s"),K($.prototype,"v"),Object.defineProperty($.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}}),Object.defineProperty($.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=G.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}});var Z=function(){function t(e,n){H(this,t),this.initialValue=e[n],this.domElement=document.createElement("div"),this.object=e,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return W(t,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),t}(),Q={};k.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(t,e){k.each(t,function(t){Q[t]=e})});var tt=/(\d+(\.\d+)?)px/;function et(t){if("0"===t||k.isUndefined(t))return 0;var e=t.match(tt);return k.isNull(e)?0:parseFloat(e[1])}var nt={makeSelectable:function(t,e){void 0!==t&&void 0!==t.style&&(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function(t,e,n){var r=n,i=e;k.isUndefined(i)&&(i=!0),k.isUndefined(r)&&(r=!0),t.style.position="absolute",i&&(t.style.left=0,t.style.right=0),r&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,e,n,r){var i=n||{},o=Q[e];if(!o)throw new Error("Event type "+e+" not supported.");var s=document.createEvent(o);switch(o){case"MouseEvents":var a=i.x||i.clientX||0,u=i.y||i.clientY||0;s.initMouseEvent(e,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,a,u,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var c=s.initKeyboardEvent||s.initKeyEvent;k.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(e,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:s.initEvent(e,i.bubbles||!1,i.cancelable||!0)}k.defaults(s,r),t.dispatchEvent(s)},bind:function(t,e,n,r){var i=r||!1;return t.addEventListener?t.addEventListener(e,n,i):t.attachEvent&&t.attachEvent("on"+e,n),nt},unbind:function(t,e,n,r){var i=r||!1;return t.removeEventListener?t.removeEventListener(e,n,i):t.detachEvent&&t.detachEvent("on"+e,n),nt},addClass:function(t,e){if(void 0===t.className)t.className=e;else if(t.className!==e){var n=t.className.split(/ +/);-1===n.indexOf(e)&&(n.push(e),t.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return nt},removeClass:function(t,e){if(e)if(t.className===e)t.removeAttribute("class");else{var n=t.className.split(/ +/),r=n.indexOf(e);-1!==r&&(n.splice(r,1),t.className=n.join(" "))}else t.className=void 0;return nt},hasClass:function(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var e=getComputedStyle(t);return et(e["border-left-width"])+et(e["border-right-width"])+et(e["padding-left"])+et(e["padding-right"])+et(e.width)},getHeight:function(t){var e=getComputedStyle(t);return et(e["border-top-width"])+et(e["border-bottom-width"])+et(e["padding-top"])+et(e["padding-bottom"])+et(e.height)},getOffset:function(t){var e=t,n={left:0,top:0};if(e.offsetParent)do{n.left+=e.offsetLeft,n.top+=e.offsetTop,e=e.offsetParent}while(e);return n},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}},rt=function(t){function e(t,n){H(this,e);var r=Y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),i=r;return r.__prev=r.getValue(),r.__checkbox=document.createElement("input"),r.__checkbox.setAttribute("type","checkbox"),nt.bind(r.__checkbox,"change",function(){i.setValue(!i.__prev)},!1),r.domElement.appendChild(r.__checkbox),r.updateDisplay(),r}return X(e,Z),W(e,[{key:"setValue",value:function(t){var n=q(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),q(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(),it=function(t){function e(t,n,r){H(this,e);var i=Y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),o=r,s=i;if(i.__select=document.createElement("select"),k.isArray(o)){var a={};k.each(o,function(t){a[t]=t}),o=a}return k.each(o,function(t,e){var n=document.createElement("option");n.innerHTML=e,n.setAttribute("value",t),s.__select.appendChild(n)}),i.updateDisplay(),nt.bind(i.__select,"change",function(){var t=this.options[this.selectedIndex].value;s.setValue(t)}),i.domElement.appendChild(i.__select),i}return X(e,Z),W(e,[{key:"setValue",value:function(t){var n=q(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return nt.isActive(this.__select)?this:(this.__select.value=this.getValue(),q(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(),ot=function(t){function e(t,n){H(this,e);var r=Y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),i=r;function o(){i.setValue(i.__input.value)}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),nt.bind(r.__input,"keyup",o),nt.bind(r.__input,"change",o),nt.bind(r.__input,"blur",function(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())}),nt.bind(r.__input,"keydown",function(t){13===t.keyCode&&this.blur()}),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return X(e,Z),W(e,[{key:"updateDisplay",value:function(){return nt.isActive(this.__input)||(this.__input.value=this.getValue()),q(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}();function st(t){var e=t.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var at=function(t){function e(t,n,r){H(this,e);var i=Y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),o=r||{};return i.__min=o.min,i.__max=o.max,i.__step=o.step,k.isUndefined(i.__step)?0===i.initialValue?i.__impliedStep=1:i.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(i.initialValue))/Math.LN10))/10:i.__impliedStep=i.__step,i.__precision=st(i.__impliedStep),i}return X(e,Z),W(e,[{key:"setValue",value:function(t){var n=t;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!=0&&(n=Math.round(n/this.__step)*this.__step),q(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(t){return this.__min=t,this}},{key:"max",value:function(t){return this.__max=t,this}},{key:"step",value:function(t){return this.__step=t,this.__impliedStep=t,this.__precision=st(t),this}}]),e}();var ut=function(t){function e(t,n,r){H(this,e);var i=Y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r));i.__truncationSuspended=!1;var o=i,s=void 0;function a(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function u(t){var e=s-t.clientY;o.setValue(o.getValue()+e*o.__impliedStep),s=t.clientY}function c(){nt.unbind(window,"mousemove",u),nt.unbind(window,"mouseup",c),a()}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),nt.bind(i.__input,"change",function(){var t=parseFloat(o.__input.value);k.isNaN(t)||o.setValue(t)}),nt.bind(i.__input,"blur",function(){a()}),nt.bind(i.__input,"mousedown",function(t){nt.bind(window,"mousemove",u),nt.bind(window,"mouseup",c),s=t.clientY}),nt.bind(i.__input,"keydown",function(t){13===t.keyCode&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,a())}),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return X(e,at),W(e,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():function(t,e){var n=Math.pow(10,e);return Math.round(t*n)/n}(this.getValue(),this.__precision),q(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}();function ct(t,e,n,r,i){return r+(t-e)/(n-e)*(i-r)}var lt=function(t){function e(t,n,r,i,o){H(this,e);var s=Y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,{min:r,max:i,step:o})),a=s;function u(t){t.preventDefault();var e=a.__background.getBoundingClientRect();return a.setValue(ct(t.clientX,e.left,e.right,a.__min,a.__max)),!1}function c(){nt.unbind(window,"mousemove",u),nt.unbind(window,"mouseup",c),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function l(t){var e=t.touches[0].clientX,n=a.__background.getBoundingClientRect();a.setValue(ct(e,n.left,n.right,a.__min,a.__max))}function h(){nt.unbind(window,"touchmove",l),nt.unbind(window,"touchend",h),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}return s.__background=document.createElement("div"),s.__foreground=document.createElement("div"),nt.bind(s.__background,"mousedown",function(t){document.activeElement.blur(),nt.bind(window,"mousemove",u),nt.bind(window,"mouseup",c),u(t)}),nt.bind(s.__background,"touchstart",function(t){if(1!==t.touches.length)return;nt.bind(window,"touchmove",l),nt.bind(window,"touchend",h),l(t)}),nt.addClass(s.__background,"slider"),nt.addClass(s.__foreground,"slider-fg"),s.updateDisplay(),s.__background.appendChild(s.__foreground),s.domElement.appendChild(s.__background),s}return X(e,at),W(e,[{key:"updateDisplay",value:function(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*t+"%",q(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(),ht=function(t){function e(t,n,r){H(this,e);var i=Y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),o=i;return i.__button=document.createElement("div"),i.__button.innerHTML=void 0===r?"Fire":r,nt.bind(i.__button,"click",function(t){return t.preventDefault(),o.fire(),!1}),nt.addClass(i.__button,"button"),i.domElement.appendChild(i.__button),i}return X(e,Z),W(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(),ft=function(t){function e(t,n){H(this,e);var r=Y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));r.__color=new $(r.getValue()),r.__temp=new $(0);var i=r;r.domElement=document.createElement("div"),nt.makeSelectable(r.domElement,!1),r.__selector=document.createElement("div"),r.__selector.className="selector",r.__saturation_field=document.createElement("div"),r.__saturation_field.className="saturation-field",r.__field_knob=document.createElement("div"),r.__field_knob.className="field-knob",r.__field_knob_border="2px solid ",r.__hue_knob=document.createElement("div"),r.__hue_knob.className="hue-knob",r.__hue_field=document.createElement("div"),r.__hue_field.className="hue-field",r.__input=document.createElement("input"),r.__input.type="text",r.__input_textShadow="0 1px 1px ",nt.bind(r.__input,"keydown",function(t){13===t.keyCode&&l.call(this)}),nt.bind(r.__input,"blur",l),nt.bind(r.__selector,"mousedown",function(){nt.addClass(this,"drag").bind(window,"mouseup",function(){nt.removeClass(i.__selector,"drag")})}),nt.bind(r.__selector,"touchstart",function(){nt.addClass(this,"drag").bind(window,"touchend",function(){nt.removeClass(i.__selector,"drag")})});var o=document.createElement("div");function s(t){f(t),nt.bind(window,"mousemove",f),nt.bind(window,"touchmove",f),nt.bind(window,"mouseup",u),nt.bind(window,"touchend",u)}function a(t){d(t),nt.bind(window,"mousemove",d),nt.bind(window,"touchmove",d),nt.bind(window,"mouseup",c),nt.bind(window,"touchend",c)}function u(){nt.unbind(window,"mousemove",f),nt.unbind(window,"touchmove",f),nt.unbind(window,"mouseup",u),nt.unbind(window,"touchend",u),h()}function c(){nt.unbind(window,"mousemove",d),nt.unbind(window,"touchmove",d),nt.unbind(window,"mouseup",c),nt.unbind(window,"touchend",c),h()}function l(){var t=U(this.value);!1!==t?(i.__color.__state=t,i.setValue(i.__color.toOriginal())):this.value=i.__color.toString()}function h(){i.__onFinishChange&&i.__onFinishChange.call(i,i.__color.toOriginal())}function f(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=i.__saturation_field.getBoundingClientRect(),n=t.touches&&t.touches[0]||t,r=n.clientX,o=n.clientY,s=(r-e.left)/(e.right-e.left),a=1-(o-e.top)/(e.bottom-e.top);return a>1?a=1:a<0&&(a=0),s>1?s=1:s<0&&(s=0),i.__color.v=a,i.__color.s=s,i.setValue(i.__color.toOriginal()),!1}function d(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=i.__hue_field.getBoundingClientRect(),n=1-((t.touches&&t.touches[0]||t).clientY-e.top)/(e.bottom-e.top);return n>1?n=1:n<0&&(n=0),i.__color.h=360*n,i.setValue(i.__color.toOriginal()),!1}return k.extend(r.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),k.extend(r.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:r.__field_knob_border+(r.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),k.extend(r.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),k.extend(r.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),k.extend(o.style,{width:"100%",height:"100%",background:"none"}),pt(o,"top","rgba(0,0,0,0)","#000"),k.extend(r.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),function(t){t.style.background="",t.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",t.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}(r.__hue_field),k.extend(r.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:r.__input_textShadow+"rgba(0,0,0,0.7)"}),nt.bind(r.__saturation_field,"mousedown",s),nt.bind(r.__saturation_field,"touchstart",s),nt.bind(r.__field_knob,"mousedown",s),nt.bind(r.__field_knob,"touchstart",s),nt.bind(r.__hue_field,"mousedown",a),nt.bind(r.__hue_field,"touchstart",a),r.__saturation_field.appendChild(o),r.__selector.appendChild(r.__field_knob),r.__selector.appendChild(r.__saturation_field),r.__selector.appendChild(r.__hue_field),r.__hue_field.appendChild(r.__hue_knob),r.domElement.appendChild(r.__input),r.domElement.appendChild(r.__selector),r.updateDisplay(),r}return X(e,Z),W(e,[{key:"updateDisplay",value:function(){var t=U(this.getValue());if(!1!==t){var e=!1;k.each($.COMPONENTS,function(n){if(!k.isUndefined(t[n])&&!k.isUndefined(this.__color.__state[n])&&t[n]!==this.__color.__state[n])return e=!0,{}},this),e&&k.extend(this.__color.__state,t)}k.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,r=255-n;k.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,pt(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),k.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+r+","+r+","+r+",.7)"})}}]),e}(),dt=["-moz-","-o-","-webkit-","-ms-",""];function pt(t,e,n,r){t.style.background="",k.each(dt,function(i){t.style.cssText+="background: "+i+"linear-gradient("+e+", "+n+" 0%, "+r+" 100%); "})}var mt=function(t,e){var n=e||document,r=document.createElement("style");r.type="text/css",r.innerHTML=t;var i=n.getElementsByTagName("head")[0];try{i.appendChild(r)}catch(t){}},gt=function(t,e){var n=t[e];return k.isArray(arguments[2])||k.isObject(arguments[2])?new it(t,e,arguments[2]):k.isNumber(n)?k.isNumber(arguments[2])&&k.isNumber(arguments[3])?k.isNumber(arguments[4])?new lt(t,e,arguments[2],arguments[3],arguments[4]):new lt(t,e,arguments[2],arguments[3]):k.isNumber(arguments[4])?new ut(t,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new ut(t,e,{min:arguments[2],max:arguments[3]}):k.isString(n)?new ot(t,e):k.isFunction(n)?new ht(t,e,""):k.isBoolean(n)?new rt(t,e):null};var vt=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,1e3/60)},_t=function(){function t(){H(this,t),this.backgroundElement=document.createElement("div"),k.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),nt.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),k.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;nt.bind(this.backgroundElement,"click",function(){e.hide()})}return W(t,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),k.defer(function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var t=this,e=function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",nt.unbind(t.domElement,"webkitTransitionEnd",e),nt.unbind(t.domElement,"transitionend",e),nt.unbind(t.domElement,"oTransitionEnd",e)};nt.bind(this.domElement,"webkitTransitionEnd",e),nt.bind(this.domElement,"transitionend",e),nt.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-nt.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-nt.getHeight(this.domElement)/2+"px"}}]),t}();mt(function(t){if(t&&"undefined"!=typeof window){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var yt="Default",bt=function(){try{return!!window.localStorage}catch(t){return!1}}(),wt=void 0,Et=!0,Tt=void 0,xt=!1,At=[],St=function t(e){var n=this,r=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),nt.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=k.defaults(r,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),r=k.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),k.isUndefined(r.load)?r.load={preset:yt}:r.preset&&(r.load.preset=r.preset),k.isUndefined(r.parent)&&r.hideable&&At.push(this),r.resizable=k.isUndefined(r.parent)&&r.resizable,r.autoPlace&&k.isUndefined(r.scrollable)&&(r.scrollable=!0);var i=bt&&"true"===localStorage.getItem(Rt(this,"isLocal")),o=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:r.load.preset},set:function(t){n.parent?n.getRoot().preset=t:r.load.preset=t,function(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value===t.preset&&(t.__preset_select.selectedIndex=e)}(this),n.revert()}},width:{get:function(){return r.width},set:function(t){r.width=t,kt(n,t)}},name:{get:function(){return r.name},set:function(t){r.name=t,titleRowName&&(titleRowName.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(e){r.closed=e,r.closed?nt.addClass(n.__ul,t.CLASS_CLOSED):nt.removeClass(n.__ul,t.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return i},set:function(t){bt&&(i=t,t?nt.bind(window,"unload",o):nt.unbind(window,"unload",o),localStorage.setItem(Rt(n,"isLocal"),t))}}}),k.isUndefined(r.parent)){if(r.closed=!1,nt.addClass(this.domElement,t.CLASS_MAIN),nt.makeSelectable(this.domElement,!1),bt&&i){n.useLocalStorage=!0;var s=localStorage.getItem(Rt(this,"gui"));s&&(r.load=JSON.parse(s))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,nt.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),r.closeOnTop?(nt.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(nt.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),nt.bind(this.__closeButton,"click",function(){n.closed=!n.closed})}else{void 0===r.closed&&(r.closed=!0);var a=document.createTextNode(r.name);nt.addClass(a,"controller-name");var u=Ot(n,a);nt.addClass(this.__ul,t.CLASS_CLOSED),nt.addClass(u,"title"),nt.bind(u,"click",function(t){return t.preventDefault(),n.closed=!n.closed,!1}),r.closed||(this.closed=!1)}r.autoPlace&&(k.isUndefined(r.parent)&&(Et&&(Tt=document.createElement("div"),nt.addClass(Tt,"dg"),nt.addClass(Tt,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Tt),Et=!1),Tt.appendChild(this.domElement),nt.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||kt(n,r.width)),this.__resizeHandler=function(){n.onResizeDebounced()},nt.bind(window,"resize",this.__resizeHandler),nt.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),nt.bind(this.__ul,"transitionend",this.__resizeHandler),nt.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&Dt(this),o=function(){bt&&"true"===localStorage.getItem(Rt(n,"isLocal"))&&localStorage.setItem(Rt(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=o,r.parent||function(){var t=n.getRoot();t.width+=1,k.defer(function(){t.width-=1})}()};function Ot(t,e,n){var r=document.createElement("li");return e&&r.appendChild(e),n?t.__ul.insertBefore(r,n):t.__ul.appendChild(r),t.onResize(),r}function Ct(t){nt.unbind(window,"resize",t.__resizeHandler),t.saveToLocalStorageIfPossible&&nt.unbind(window,"unload",t.saveToLocalStorageIfPossible)}function Mt(t,e){var n=t.__preset_select[t.__preset_select.selectedIndex];n.innerHTML=e?n.value+"*":n.value}function It(t,e){var n=t.getRoot(),r=n.__rememberedObjects.indexOf(e.object);if(-1!==r){var i=n.__rememberedObjectIndecesToControllers[r];if(void 0===i&&(i={},n.__rememberedObjectIndecesToControllers[r]=i),i[e.property]=e,n.load&&n.load.remembered){var o=n.load.remembered,s=void 0;if(o[t.preset])s=o[t.preset];else{if(!o[yt])return;s=o[yt]}if(s[r]&&void 0!==s[r][e.property]){var a=s[r][e.property];e.initialValue=a,e.setValue(a)}}}}function Pt(t,e,n,r){if(void 0===e[n])throw new Error('Object "'+e+'" has no property "'+n+'"');var i=void 0;if(r.color)i=new ft(e,n);else{var o=[e,n].concat(r.factoryArgs);i=gt.apply(t,o)}r.before instanceof Z&&(r.before=r.before.__li),It(t,i),nt.addClass(i.domElement,"c");var s=document.createElement("span");nt.addClass(s,"property-name"),s.innerHTML=i.property;var a=document.createElement("div");a.appendChild(s),a.appendChild(i.domElement);var u=Ot(t,a,r.before);return nt.addClass(u,St.CLASS_CONTROLLER_ROW),i instanceof ft?nt.addClass(u,"color"):nt.addClass(u,z(i.getValue())),function(t,e,n){if(n.__li=e,n.__gui=t,k.extend(n,{options:function(e){if(arguments.length>1){var r=n.__li.nextElementSibling;return n.remove(),Pt(t,n.object,n.property,{before:r,factoryArgs:[k.toArray(arguments)]})}if(k.isArray(e)||k.isObject(e)){var i=n.__li.nextElementSibling;return n.remove(),Pt(t,n.object,n.property,{before:i,factoryArgs:[e]})}},name:function(t){return n.__li.firstElementChild.firstElementChild.innerHTML=t,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof lt){var r=new ut(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});k.each(["updateDisplay","onChange","onFinishChange","step"],function(t){var e=n[t],i=r[t];n[t]=r[t]=function(){var t=Array.prototype.slice.call(arguments);return i.apply(r,t),e.apply(n,t)}}),nt.addClass(e,"has-slider"),n.domElement.insertBefore(r.domElement,n.domElement.firstElementChild)}else if(n instanceof ut){var i=function(e){if(k.isNumber(n.__min)&&k.isNumber(n.__max)){var r=n.__li.firstElementChild.firstElementChild.innerHTML,i=n.__gui.__listening.indexOf(n)>-1;n.remove();var o=Pt(t,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return o.name(r),i&&o.listen(),o}return e};n.min=k.compose(i,n.min),n.max=k.compose(i,n.max)}else n instanceof rt?(nt.bind(e,"click",function(){nt.fakeEvent(n.__checkbox,"click")}),nt.bind(n.__checkbox,"click",function(t){t.stopPropagation()})):n instanceof ht?(nt.bind(e,"click",function(){nt.fakeEvent(n.__button,"click")}),nt.bind(e,"mouseover",function(){nt.addClass(n.__button,"hover")}),nt.bind(e,"mouseout",function(){nt.removeClass(n.__button,"hover")})):n instanceof ft&&(nt.addClass(e,"color"),n.updateDisplay=k.compose(function(t){return e.style.borderLeftColor=n.__color.toString(),t},n.updateDisplay),n.updateDisplay());n.setValue=k.compose(function(e){return t.getRoot().__preset_select&&n.isModified()&&Mt(t.getRoot(),!0),e},n.setValue)}(t,u,i),t.__controllers.push(i),i}function Rt(t,e){return document.location.href+"."+e}function Nt(t,e,n){var r=document.createElement("option");r.innerHTML=e,r.value=e,t.__preset_select.appendChild(r),n&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function jt(t,e){e.style.display=t.useLocalStorage?"block":"none"}function Dt(t){var e=void 0;function n(n){return n.preventDefault(),t.width+=e-n.clientX,t.onResize(),e=n.clientX,!1}function r(){nt.removeClass(t.__closeButton,St.CLASS_DRAG),nt.unbind(window,"mousemove",n),nt.unbind(window,"mouseup",r)}function i(i){return i.preventDefault(),e=i.clientX,nt.addClass(t.__closeButton,St.CLASS_DRAG),nt.bind(window,"mousemove",n),nt.bind(window,"mouseup",r),!1}t.__resize_handle=document.createElement("div"),k.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),nt.bind(t.__resize_handle,"mousedown",i),nt.bind(t.__closeButton,"mousedown",i),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}function kt(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function Lt(t,e){var n={};return k.each(t.__rememberedObjects,function(r,i){var o={},s=t.__rememberedObjectIndecesToControllers[i];k.each(s,function(t,n){o[n]=e?t.initialValue:t.getValue()}),n[i]=o}),n}St.toggleHide=function(){xt=!xt,k.each(At,function(t){t.domElement.style.display=xt?"none":""})},St.CLASS_AUTO_PLACE="a",St.CLASS_AUTO_PLACE_CONTAINER="ac",St.CLASS_MAIN="main",St.CLASS_CONTROLLER_ROW="cr",St.CLASS_TOO_TALL="taller-than-window",St.CLASS_CLOSED="closed",St.CLASS_CLOSE_BUTTON="close-button",St.CLASS_CLOSE_TOP="close-top",St.CLASS_CLOSE_BOTTOM="close-bottom",St.CLASS_DRAG="drag",St.DEFAULT_WIDTH=245,St.TEXT_CLOSED="Close Controls",St.TEXT_OPEN="Open Controls",St._keydownHandler=function(t){"text"===document.activeElement.type||72!==t.which&&72!==t.keyCode||St.toggleHide()},nt.bind(window,"keydown",St._keydownHandler,!1),k.extend(St.prototype,{add:function(t,e){return Pt(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,e){return Pt(this,t,e,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var e=this;k.defer(function(){e.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&Tt.removeChild(this.domElement);var t=this;k.each(this.__folders,function(e){t.removeFolder(e)}),nt.unbind(window,"keydown",St._keydownHandler,!1),Ct(this)},addFolder:function(t){if(void 0!==this.__folders[t])throw new Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var n=new St(e);this.__folders[t]=n;var r=Ot(this,n.domElement);return nt.addClass(r,"folder"),n},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],Ct(t);var e=this;k.each(t.__folders,function(e){t.removeFolder(e)}),k.defer(function(){e.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=nt.getOffset(t.__ul).top,n=0;k.each(t.__ul.childNodes,function(e){t.autoPlace&&e===t.__save_row||(n+=nt.getHeight(e))}),window.innerHeight-e-20<n?(nt.addClass(t.domElement,St.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-20+"px"):(nt.removeClass(t.domElement,St.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&k.defer(function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"}),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:k.debounce(function(){this.onResize()},50),remember:function(){if(k.isUndefined(wt)&&((wt=new _t).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;k.each(Array.prototype.slice.call(arguments),function(e){0===t.__rememberedObjects.length&&function(t){var e=t.__save_row=document.createElement("li");nt.addClass(t.domElement,"has-save"),t.__ul.insertBefore(e,t.__ul.firstChild),nt.addClass(e,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",nt.addClass(n,"button gears");var r=document.createElement("span");r.innerHTML="Save",nt.addClass(r,"button"),nt.addClass(r,"save");var i=document.createElement("span");i.innerHTML="New",nt.addClass(i,"button"),nt.addClass(i,"save-as");var o=document.createElement("span");o.innerHTML="Revert",nt.addClass(o,"button"),nt.addClass(o,"revert");var s=t.__preset_select=document.createElement("select");t.load&&t.load.remembered?k.each(t.load.remembered,function(e,n){Nt(t,n,n===t.preset)}):Nt(t,yt,!1);if(nt.bind(s,"change",function(){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].innerHTML=t.__preset_select[e].value;t.preset=this.value}),e.appendChild(s),e.appendChild(n),e.appendChild(r),e.appendChild(i),e.appendChild(o),bt){var a=document.getElementById("dg-local-explain"),u=document.getElementById("dg-local-storage"),c=document.getElementById("dg-save-locally");c.style.display="block","true"===localStorage.getItem(Rt(t,"isLocal"))&&u.setAttribute("checked","checked"),jt(t,a),nt.bind(u,"change",function(){t.useLocalStorage=!t.useLocalStorage,jt(t,a)})}var l=document.getElementById("dg-new-constructor");nt.bind(l,"keydown",function(t){!t.metaKey||67!==t.which&&67!==t.keyCode||wt.hide()}),nt.bind(n,"click",function(){l.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),wt.show(),l.focus(),l.select()}),nt.bind(r,"click",function(){t.save()}),nt.bind(i,"click",function(){var e=prompt("Enter a new preset name.");e&&t.saveAs(e)}),nt.bind(o,"click",function(){t.revert()})}(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)}),this.autoPlace&&kt(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=Lt(this)),t.folders={},k.each(this.__folders,function(e,n){t.folders[n]=e.getSaveObject()}),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=Lt(this),Mt(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered[yt]=Lt(this,!0)),this.load.remembered[t]=Lt(this),this.preset=t,Nt(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function(t){k.each(this.__controllers,function(e){this.getRoot().load.remembered?It(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())},this),k.each(this.__folders,function(t){t.revert(t)}),t||Mt(this.getRoot(),!1)},listen:function(t){var e=0===this.__listening.length;this.__listening.push(t),e&&function t(e){0!==e.length&&vt.call(window,function(){t(e)});k.each(e,function(t){t.updateDisplay()})}(this.__listening)},updateDisplay:function(){k.each(this.__controllers,function(t){t.updateDisplay()}),k.each(this.__folders,function(t){t.updateDisplay()})}});var Ft,Bt=St,Ut={constant:1,linear:0,quadratic:0},Vt=function(){return function(t){this.ambient=$V([.2,.2,.2]),this.diffuse=$V([1,1,1]),this.specular=$V([1,1,1]),Object.assign(this,t),this.attenuation=Object.assign({},Ut,t.attenuation)}}(),Gt=0,zt=function(){function t(t){this.declaration="",this.color=$V([1,1,1]),this.position=$V([0,0,0]),this.model=new Vt({}),this.index=Gt++,Object.assign(this,t)}return t.prototype.setUniforms=function(t,e,n){},t}(),Ht=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Wt=function(t){function e(e){var n=t.call(this,e)||this;return n.uShadowMap="u_ShadowMap"+n.index,Object.assign(n,e),n}return Ht(e,t),e.prototype.calculateShadow=function(){var t=this.index;this.shadowSnippet={vertex:{declaration:"\n          uniform mat4 u_MvpMatrixFromLight"+t+";\n          varying vec4 v_PositionFromLight"+t+";\n        ",calculation:"\n          v_PositionFromLight"+t+" = u_MvpMatrixFromLight"+t+" * a_Position;\n        ",result:""},fragment:{declaration:"\n          uniform sampler2D "+this.uShadowMap+";\n          varying vec4 v_PositionFromLight"+t+";\n        ",calculation:"",result:""}}},e.prototype.setUniforms=function(e,n,r){var i;t.prototype.setUniforms.call(this,e,n,r),C(e,n,((i={})[this.uShadowMap]=this.fboTextureIdx,i),"int")},e}(zt),qt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Xt=function(t){function e(e){var n=t.call(this,e)||this;return n.type="SpotLight",n.declaration="\n    struct SpotLight {\n      vec3 position;\n      vec3 direction;\n      \n      float constant;\n      float linear;\n      float quadratic;  \n\n      vec3 ambient;\n      vec3 diffuse;\n      vec3 specular;\n\n      float angle;\n      float blur;\n      float exponent;\n    };\n\n    vec3 calcSpotLight(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir)\n    {\n      vec3 lightDir = normalize(light.position - fragPos);\n      // diffuse shading\n      float diff = max(dot(normal, lightDir), 0.0);\n      // specular shading\n      vec3 reflectDir = reflect(-lightDir, normal);\n      float spec = pow(max(dot(viewDir, reflectDir), 0.0), u_Shininess);\n      // attenuation\n      float distance = length(light.position - fragPos);\n      float attenuation = 1.0 / (light.constant + light.linear * distance + \n              light.quadratic * (distance * distance));    \n\n      vec3 ambient = light.ambient * u_Diffuse;\n      vec3 diffuse = light.diffuse * diff * u_Diffuse;\n      vec3 specular = light.specular * spec * u_Specular;\n\n      float spotEffect = dot(normalize(light.direction), -lightDir);\n      float spotCosCutoff = cos(light.angle / 180.0 * PI);\n      float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);\n      float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);\n      if (spotEffect > spotCosCutoff) {\n        spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);\n      } else {\n        spotEffect = 0.0;\n      }\n\n      float shadow = calcShadow(u_ShadowMap"+n.index+", v_PositionFromLight"+n.index+", lightDir, normal);\n      return ambient + attenuation * shadow * (spotEffect * diffuse + specular);\n    }\n  ",n.direction=n.position,n.angle=14,n.exponent=40,n.blur=5,Object.assign(n,e),n}return qt(e,t),e.prototype.setUniforms=function(e,n,r){var i;t.prototype.setUniforms.call(this,e,n,r),C(e,n,((i={})[r+".position"]=this.position,i[r+".direction"]=this.direction,i[r+".ambient"]=this.model.ambient,i[r+".diffuse"]=this.model.diffuse,i[r+".specular"]=this.model.specular,i[r+".constant"]=this.model.attenuation.constant,i[r+".linear"]=this.model.attenuation.linear,i[r+".quadratic"]=this.model.attenuation.quadratic,i[r+".angle"]=this.angle,i[r+".blur"]=this.blur,i[r+".exponent"]=this.exponent,i))},e}(Wt),Yt=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},$t=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Jt=function(t,e){return function(n,r){e(n,r,t)}},Kt=function(){function t(t,e,n){this.inited=!1,this.canvas=t,this.scene=e,this.camera=n}return t.prototype.init=function(t){this.gl=t,this.program&&t.deleteProgram(this.program),this.initShaders(),this.inited=!0},t.prototype.initShaders=function(){var t=this.generateShaders(),e=t.vertexShader,n=t.fragmentShader;this.program=S(this.gl,e,n),this.program||console.log("Failed to intialize shaders.")},t.prototype.initFramebufferObject=function(t,e){var n,r,i,o=this.gl,s=function(){return n&&o.deleteFramebuffer(n),r&&o.deleteTexture(r),i&&o.deleteRenderbuffer(i),null};if(!(n=o.createFramebuffer()))return console.log("Failed to create frame buffer object"),s();if(!(r=o.createTexture()))return console.log("Failed to create texture object"),s();if(o.bindTexture(o.TEXTURE_2D,r),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,t,e,0,o.RGBA,o.UNSIGNED_BYTE,null),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.NEAREST),!(i=o.createRenderbuffer()))return console.log("Failed to create renderbuffer object"),s();o.bindRenderbuffer(o.RENDERBUFFER,i),o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_COMPONENT16,t,e),o.bindFramebuffer(o.FRAMEBUFFER,n),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,r,0),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,i);var a=o.checkFramebufferStatus(o.FRAMEBUFFER);return o.FRAMEBUFFER_COMPLETE!==a?(console.log("Frame buffer object is incomplete: "+a.toString()),s()):(o.bindFramebuffer(o.FRAMEBUFFER,null),o.bindTexture(o.TEXTURE_2D,null),o.bindRenderbuffer(o.RENDERBUFFER,null),{framebuffer:n,texture:r})},t=Yt([Object(s.injectable)(),Jt(0,Object(s.inject)(a.ICanvasService)),Jt(1,Object(s.inject)(a.ISceneService)),Jt(2,Object(s.inject)(a.ICameraService)),$t("design:paramtypes",[Object,Object,Object])],t)}(),Zt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Qt=function(t){function e(e){var n=t.call(this,e)||this;return n.type="DirectionalLight",n.declaration="\n    struct DirectionalLight {\n      vec3 direction;\n      vec3 ambient;\n      vec3 diffuse;\n      vec3 specular;\n    };\n\n    vec3 calcDirectionalLight(DirectionalLight light, vec3 normal, vec3 fragPos, vec3 viewDir)\n    {\n      vec3 lightDir = normalize(-light.direction);\n\n      // diffuse shading\n      float diff = max(dot(normal, lightDir), 0.0);\n\n      // specular shading\n      // vec3 reflectDir = reflect(-lightDir, normal);\n      // float spec = pow(max(dot(viewDir, reflectDir), 0.0), u_Shininess);\n\n      // Blinn-Phong specular shading\n      vec3 halfwayDir = normalize(lightDir + viewDir);\n      float spec = pow(max(dot(normal, halfwayDir), 0.0), u_Shininess);\n\n      vec3 ambient = light.ambient * u_Diffuse;\n      vec3 diffuse = light.diffuse * diff * u_Diffuse;\n      vec3 specular = light.specular * spec * u_Specular;\n\n      float shadow = calcShadow(u_ShadowMap"+n.index+", v_PositionFromLight"+n.index+", lightDir, normal);\n      return ambient + shadow * (diffuse + specular);\n    }\n  ",Object.assign(n,e),n}return Zt(e,t),e.prototype.setUniforms=function(e,n,r){var i;t.prototype.setUniforms.call(this,e,n,r),C(e,n,((i={})[r+".direction"]=this.direction,i[r+".ambient"]=this.model.ambient,i[r+".diffuse"]=this.model.diffuse,i[r+".specular"]=this.model.specular,i))},e}(Wt),te=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ee=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},ne=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},re=function(t,e){return function(n,r){e(n,r,t)}};!function(t){t.LowPrecision="low-precision",t.HighPrecision="high-precision",t.Lerp="lerp",t.PCF="pcf",t.PCFLerp="pcf-lerp",t.PoissionDisk="poission-disk",t.StratifiedPoissionDisk="stratified-poission-disk"}(Ft||(Ft={}));var ie=function(t){function e(e,n,r){return t.call(this,e,n,r)||this}var n;return te(e,t),n=e,e.prototype.generateShaders=function(){var t,e,r=this,i=(this.gl,0),o=this.scene.getLightsInfo();Object.keys(o).forEach(function(e){var n=o[e],s=n.lights;n.varName;s.forEach(function(e,n){if(e instanceof Wt){if(!(t=r.initFramebufferObject(2048,2048)).framebuffer)return void console.log("Failed to initialize frame buffer object");if(e.fbo=t,e.fboTextureIdx=i++,i>32)return void console.log("Exceed the maximum number of textures")}})});return n.mode===Ft.LowPrecision?e="\n        precision mediump float;\n        void main() {\n          gl_FragColor = vec4(gl_FragCoord.z, 0.0, 0.0, 0.0);\n        }\n      ":n.mode!==Ft.HighPrecision&&n.mode!==Ft.Lerp&&n.mode!==Ft.PCF&&n.mode!==Ft.PCFLerp&&n.mode!==Ft.PoissionDisk&&n.mode!==Ft.StratifiedPoissionDisk||(e="\n        precision mediump float;\n        void main() {\n          vec4 bitShift = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n          const vec4 bitMask = vec4(1.0/256.0, 1.0/256.0, 1.0/256.0, 0.0);\n          vec4 rgbaDepth = fract(gl_FragCoord.z * bitShift);\n          rgbaDepth -= rgbaDepth.gbaa * bitMask;\n          gl_FragColor = rgbaDepth;\n        }\n      "),{vertexShader:"\n      attribute vec4 a_Position;\n      uniform mat4 u_MvpMatrix;\n      void main() {\n        gl_Position = u_MvpMatrix * a_Position;\n      }\n    ",fragmentShader:e}},e.prototype.draw=function(){var t,e,n,r,i=this,o=this.gl,s=this.program;o.useProgram(this.program);var a=this.scene.getLightsInfo();Object.keys(a).forEach(function(u){var c=a[u],l=c.lights;c.varName;l.forEach(function(a,u){a instanceof Wt&&(n="TEXTURE"+a.fboTextureIdx,o.bindFramebuffer(o.FRAMEBUFFER,a.fbo.framebuffer),o.viewport(0,0,2048,2048),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),o.activeTexture(o[n]),o.bindTexture(o.TEXTURE_2D,a.fbo.texture),a instanceof Qt?(r=a.direction.x(-10).subtract(i.camera.center),t=i.camera.ortho(-10,10,-10,10,i.camera.znear,i.camera.zfar)):(r=a.position,t=i.camera.perspective(i.camera.fovy,1,i.camera.znear,i.camera.zfar)),e=i.camera.lookAt(r,i.camera.center,i.camera.up),i.scene.meshes.forEach(function(n){var r=n.geometry,i=r.vertices,u=r.modelMatrix,c=t.x(e.x(u));if(n.mvpMatrixFromLight[""+a.index]=c,C(o,s,{u_MvpMatrix:c}),!O(o,s,"a_Position",i,3,o.FLOAT))return-1;n.geometry.draw(o)}),o.bindFramebuffer(o.FRAMEBUFFER,null))})})},e.mode=Ft.HighPrecision,e=n=ee([Object(s.injectable)(),re(0,Object(s.inject)(a.ICanvasService)),re(1,Object(s.inject)(a.ISceneService)),re(2,Object(s.inject)(a.ICameraService)),ne("design:paramtypes",[Object,Object,Object])],e)}(Kt),oe=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),se=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},ae=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ue=function(t,e){return function(n,r){e(n,r,t)}},ce=function(t){function e(e,n,r,i,o){var s,a=t.call(this)||this;a.scene=i,a.camera=e,a.canvas=r,a.mouse=n,a.renderer=o,a.cameraController={isTruck:!0,moveSpeed:.6},a.lightController={spotLight:{angle:14,blur:2}},a.shadowController={mode:(s={},s[Ft.LowPrecision]=!1,s[Ft.HighPrecision]=!0,s[Ft.Lerp]=!1,s[Ft.PCF]=!1,s[Ft.PCFLerp]=!1,s[Ft.PoissionDisk]=!1,s[Ft.StratifiedPoissionDisk]=!1,s)};var u=new Bt,c=u.addFolder("camera");c.add(a.cameraController,"isTruck"),c.add(a.cameraController,"moveSpeed",.1,2);var l=u.addFolder("light");l.add(a.lightController.spotLight,"angle",10,30).onChange(a.changeLight.bind(a)),l.add(a.lightController.spotLight,"blur",2,10).onChange(a.changeLight.bind(a));var h=u.addFolder("shadow");return Object.keys(a.shadowController.mode).forEach(function(t){h.add(a.shadowController.mode,t).listen().onChange(a.changeShadowMode.bind(a,t))}),a.onResize=a.onResize.bind(a),a.onMousemove=a.onMousemove.bind(a),a.onMousewheel=a.onMousewheel.bind(a),a.canvas.on(_.RESIZE_EVENT,a.onResize),a.mouse.on(x.MOVE_EVENT,a.onMousemove),a.mouse.on(x.WHEEL_EVENT,a.onMousewheel),a}return oe(e,t),e.prototype.onMousemove=function(t){this.moveCamera(t)},e.prototype.onMousewheel=function(t){this.moveCamera(t)},e.prototype.onResize=function(){var t=this.canvas.getSize(),e=t.width,n=t.height;this.camera.aspect=e/n,this.camera.updateProjection(),this.camera.updateTransform()},e.prototype.moveCamera=function(t){var e=t.deltaX,n=t.deltaY,r=t.deltaZ,i=this.cameraController,o=i.isTruck,s=i.moveSpeed;o?(this.camera.truck(.01*-e*s),this.camera.pedestal(.01*n*s),this.camera.dolly(.05*r*s)):(this.camera.pan(.001*e*s),this.camera.tilt(.001*n*s),this.camera.cant(.05*r*s))},e.prototype.changeLight=function(){var t=this,e=this.scene.getLightsInfo();Object.keys(e).forEach(function(n){var r=e[n],i=r.lights;r.varName;i.forEach(function(e,n){e instanceof Xt&&(e.angle=t.lightController.spotLight.angle,e.blur=t.lightController.spotLight.blur)})}),this.renderer.updateShaders()},e.prototype.changeShadowMode=function(t,e){var n=this;e&&(Object.keys(this.shadowController.mode).forEach(function(t){n.shadowController.mode[t]=!1}),this.shadowController.mode[t]=!0,ie.mode=t,this.renderer.updateShaders())},e=se([Object(s.injectable)(),ue(0,Object(s.inject)(a.ICameraService)),ue(1,Object(s.inject)(a.IMouseService)),ue(2,Object(s.inject)(a.ICanvasService)),ue(3,Object(s.inject)(a.ISceneService)),ue(4,Object(s.inject)(a.IRendererService)),ae("design:paramtypes",[Object,Object,Object,Object,Object])],e)}(u.EventEmitter),le=function(){return function(){}}(),he=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},fe=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},de=function(t,e){return function(n,r){e(n,r,t)}},pe=function(){function t(t){this.renderer=t;var e=this.renderer.gl;e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return t.prototype.load=function(t){var e=new Image,n=this.renderer.gl,r=new le;return r.id=3,r.texture=n.createTexture(),e.onload=function(){r.id++,r.img=e,n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,1),n.activeTexture(n["TEXTURE"+r.id]),n.bindTexture(n.TEXTURE_2D,r.texture),n.texImage2D(n.TEXTURE_2D,0,n.RGB,n.RGB,n.UNSIGNED_BYTE,r.img),i(r.img.width)&&i(r.img.height)?(n.generateMipmap(n.TEXTURE_2D),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR_MIPMAP_NEAREST)):n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)},e.onerror=function(){console.log("Failed to load img: "+t)},e.crossOrigin="anonymous",e.src=t,r},t=he([Object(s.injectable)(),de(0,Object(s.inject)(a.IRendererService)),fe("design:paramtypes",[Object])],t)}(),me=new s.Container;me.bind(a.ISceneService).to(f).inSingletonScope(),me.bind(a.ICameraService).to(p).inSingletonScope(),me.bind(a.ICanvasService).to(_).inSingletonScope(),me.bind(a.IMouseService).to(x).inSingletonScope(),me.bind(a.IRendererService).to(R).inSingletonScope(),me.bind(a.IControlsService).to(ce).inSingletonScope(),me.bind(a.ITextureLoaderService).to(pe).inSingletonScope(),Object(s.decorate)(Object(s.injectable)(),u.EventEmitter);var ge=function(){return function(t){this.shininess=120,this.diffuse=1,this.specular=1,this.color=$V([0,0,0]),Object.assign(this,t)}}(),ve=function(){function t(t){this.material=new ge({}),this.mvpMatrixFromLight={},Object.assign(this,t)}return t.prototype.init=function(){var t=this;this.geometry.init(),this.colorAttributeArray=this.geometry.vertices.map(function(e,n){return t.material.color.e(n%3+1)})},t}(),_e=function(){function t(t){Object.assign(this,t),this.modelMatrix=r.Matrix.I(4)}return t.prototype.init=function(){this.setVertices(),this.setModelMatrix()},t.prototype.translate=function(t){return this.modelMatrix=r.Matrix.Translation(t).x(this.modelMatrix),this},t.prototype.scale=function(t){return this.modelMatrix=r.Matrix.Diagonal(t.elements.concat(1)).x(this.modelMatrix),this},t.prototype.rotate=function(t,e){return this.modelMatrix=r.Matrix.Rotation(t,e).ensure4x4().x(this.modelMatrix),this},t.prototype.draw=function(t){var e=t.createBuffer();if(!e)return console.log("Failed to create the buffer object"),!1;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW);var n=this.indices.length>256?t.UNSIGNED_SHORT:t.UNSIGNED_BYTE;t.drawElements(t.TRIANGLES,this.indices.length,n,0),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)},t}(),ye=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),be={center:$V([0,0,0]),radius:1},we=function(t){function e(e){void 0===e&&(e=be);var n=t.call(this,e)||this;return Object.assign(n,e),n}return ye(e,t),e.prototype.setVertices=function(){var t,e,n,r,i,o,s,a,u,c,l=[],h=[];for(i=0;i<=13;i++)for(o=i*Math.PI/13,s=Math.sin(o),a=Math.cos(o),t=0;t<=13;t++)e=2*t*Math.PI/13,n=Math.sin(e),r=Math.cos(e),l.push(n*s),l.push(a),l.push(r*s);for(i=0;i<13;i++)for(t=0;t<13;t++)c=(u=14*i+t)+14,h.push(u),h.push(c),h.push(u+1),h.push(u+1),h.push(c),h.push(c+1);this.vertices=new Float32Array(l),this.normals=new Float32Array(l),this.indices=new Uint16Array(h),this.textureCoords=this.vertices.filter(function(t,e){return e%3!=1}).map(function(t){return t/2+.5})},e.prototype.setModelMatrix=function(){this.scale($V(new Array(3).fill(this.radius))),this.translate(this.center)},e}(_e),Ee=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Te={width:2,height:2,center:$V([0,0,0])},xe=function(t){function e(e){var n=t.call(this,e)||this;return Object.assign(n,Te,e),n}return Ee(e,t),e.prototype.setVertices=function(){if(this.p1){this.vertices=new Float32Array([this.p1.e(1),this.p1.e(2),this.p1.e(3),this.p2.e(1),this.p2.e(2),this.p2.e(3),this.p3.e(1),this.p3.e(2),this.p3.e(3),this.p4.e(1),this.p4.e(2),this.p4.e(3)]);var t=this.p2.subtract(this.p1),e=this.p3.subtract(this.p1),n=t.cross(e).toUnitVector();this.normals=new Float32Array([n.e(1),n.e(2),n.e(3),n.e(1),n.e(2),n.e(3),n.e(1),n.e(2),n.e(3),n.e(1),n.e(2),n.e(3)])}else this.vertices=new Float32Array([1,0,1,1,0,-1,-1,0,-1,-1,0,1]),this.normals=new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0]);this.indices=new Uint8Array([0,1,2,0,2,3]),this.textureCoords=this.vertices.filter(function(t,e){return e%3!=1}).map(function(t){return t/2+.5})},e.prototype.setModelMatrix=function(){this.p1||(this.scale($V([this.width/2,1,this.height/2])),this.translate(this.center))},e}(_e),Ae={declaration:"",calculation:"",result:""},Se={vertex:Ae,fragment:Ae},Oe=(function(){}(),function(){function t(){this.snippet=Se}return t.prototype.getDeclarationInFragment=function(){return"\n      vec2 texelSize = vec2(1.0) / vec2("+(2048..toFixed(5),2048..toFixed(5))+");\n\n      float unpackDepth(const in vec4 rgbaDepth) {\n        const vec4 bitShift = vec4(1.0, 1.0/256.0, 1.0/(256.0*256.0), 1.0/(256.0*256.0*256.0));\n        float depth = dot(rgbaDepth, bitShift);\n        return depth;\n      }\n\n      float texture2DCompare(sampler2D depths, vec2 uv, float compare, float bias){\n        float depth = unpackDepth(texture2D(depths, uv));\n        return step(compare - bias, depth);\n      }\n\n      float texture2DShadowLerp(sampler2D depths, vec2 uv, float compare, float bias){\n        vec2 f = fract(uv);\n        float lb = texture2DCompare(depths, uv + texelSize * vec2(0.0, 0.0), compare, bias);\n        float lt = texture2DCompare(depths, uv + texelSize * vec2(0.0, 1.0), compare, bias);\n        float rb = texture2DCompare(depths, uv + texelSize * vec2(1.0, 0.0), compare, bias);\n        float rt = texture2DCompare(depths, uv + texelSize * vec2(1.0, 1.0), compare, bias);\n        float a = mix(lb, lt, f.y);\n        float b = mix(rb, rt, f.y);\n        float c = mix(a, b, f.x);\n        return c;\n      }\n\n      "+this.snippet.fragment.declaration+"\n\n      float calcShadow(sampler2D depths, vec4 positionFromLight, vec3 lightDir, vec3 normal) {\n        vec3 shadowCoord = (positionFromLight.xyz / positionFromLight.w) * 0.5 + 0.5;\n        float bias = max(0.05 * (1.0 - dot(normal, lightDir)), 0.005);\n        "+this.snippet.fragment.calculation+"\n      }\n    "},t.prototype.setUniforms=function(t,e){},t}()),Ce=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Me=function(t){function e(){var e=t.call(this)||this;return e.snippet.fragment.calculation="\n      return texture2DCompare(depths, shadowCoord.xy, shadowCoord.z, bias);\n    ",e}return Ce(e,t),e.prototype.setUniforms=function(e,n){t.prototype.setUniforms.call(this,e,n)},e}(Oe),Ie=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Pe=function(t){function e(){var e=t.call(this)||this;return e.snippet.fragment.calculation="\n      vec4 rgbaDepth = texture2D(depths, shadowCoord.xy);\n      return step(shadowCoord.z - bias, rgbaDepth.r);\n    ",e}return Ie(e,t),e.prototype.setUniforms=function(e,n){t.prototype.setUniforms.call(this,e,n)},e}(Oe),Re=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ne=function(t){function e(){var e=t.call(this)||this;return e.snippet.fragment.calculation="\n      return texture2DShadowLerp(depths, shadowCoord.xy, shadowCoord.z, bias);\n    ",e}return Re(e,t),e.prototype.setUniforms=function(e,n){t.prototype.setUniforms.call(this,e,n)},e}(Oe),je=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),De=function(t){function e(){var e=t.call(this)||this;return e.snippet.fragment.declaration="\n      float PCF(sampler2D depths, vec2 uv, float compare, float bias){\n        float result = 0.0;\n        for (int x = -2; x <= 2; x++) {\n          for (int y = -2; y <= 2; y++) {\n            vec2 off = texelSize * vec2(x,y);\n            result += texture2DCompare(depths, uv + off, compare, bias);\n          }\n        }\n        return result / 25.0;\n      }\n    ",e.snippet.fragment.calculation="\n      return PCF(depths, shadowCoord.xy, shadowCoord.z, bias);\n    ",e}return je(e,t),e.prototype.setUniforms=function(e,n){t.prototype.setUniforms.call(this,e,n)},e}(Oe),ke=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Le=function(t){function e(){var e=t.call(this)||this;return e.snippet.fragment.calculation="\n      return PCFLerp(depths, shadowCoord.xy, shadowCoord.z, bias);\n    ",e.snippet.fragment.declaration="\n      float PCFLerp(sampler2D depths, vec2 uv, float compare, float bias){\n        float result = 0.0;\n        for(int x = -1; x <= 1; x++){\n          for(int y = -1; y <= 1; y++){\n            vec2 off = texelSize * vec2(x,y);\n            result += texture2DShadowLerp(depths, uv + off, compare, bias);\n          }\n        }\n        return result / 9.0;\n      }\n    ",e}return ke(e,t),e.prototype.setUniforms=function(e,n){t.prototype.setUniforms.call(this,e,n)},e}(Oe),Fe=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Be=function(t){function e(){var e=t.call(this)||this;return e.snippet.fragment.declaration="\n      uniform float uPoissionDisk[8];\n      float PoissionDisk(sampler2D depths, vec2 uv, float compare, float bias){\n        float result = 0.0;\n        for (int i = 0; i < 4; i++) {\n          result += texture2DCompare(depths, uv + vec2(uPoissionDisk[i * 2], uPoissionDisk[i * 2 + 1])/700.0, compare, bias);\n        }\n        return result / 4.0;\n      }\n    ",e.snippet.fragment.calculation="\n      return PoissionDisk(depths, shadowCoord.xy, shadowCoord.z, bias);\n    ",e}return Fe(e,t),e.prototype.setUniforms=function(t,e){for(var n,r=[-.94201624,-.39906216,.94558609,-.76890725,-.094184101,-.9293887,.34495938,.2938776],i=0;i<8;i++)C(t,e,((n={})["uPoissionDisk["+i+"]"]=r[i],n))},e}(Oe),Ue=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ve=function(t){function e(){var e=t.call(this)||this;return e.snippet.fragment.declaration="\n      uniform float uPoissionDisk[32];\n      float random(vec3 seed, int i) {\n        vec4 seed4 = vec4(seed,i);\n        float dot_product = dot(seed4, vec4(12.9898,78.233,45.164,94.673));\n        return fract(sin(dot_product) * 43758.5453);\n      }\n      float StratifiedPoissionDisk(sampler2D depths, vec2 uv, float compare, float bias){\n        float result = 0.0;\n        for (int i = 0; i < 4; i++) {\n          // int index = int(mod((16.0 * random(gl_FragCoord.xyy, i)), 16.0));\n          int index = int(mod((16.0 * random(floor(v_Position.xyz), i)), 16.0));\n          for (int j = 0; j < 16; j++) {\n            if (j == index) {\n              result += texture2DCompare(depths, uv + vec2(uPoissionDisk[j * 2], uPoissionDisk[j * 2 + 1])/700.0, compare, bias);\n              break;\n            }\n          }\n        }\n        return result / 4.0;\n      }\n    ",e.snippet.fragment.calculation="\n      return StratifiedPoissionDisk(depths, shadowCoord.xy, shadowCoord.z, bias);\n    ",e}return Ue(e,t),e.prototype.setUniforms=function(t,e){for(var n,r=[-.94201624,-.39906216,.94558609,-.76890725,-.094184101,-.9293887,.34495938,.2938776,-.91588581,.45771432,-.81544232,-.87912464,-.38277543,.27676845,.97484398,.75648379,.44323325,-.97511554,.53742981,-.4737342,-.26496911,-.41893023,.79197514,.19090188,-.2418884,.99706507,-.81409955,.9143759,.19984126,.78641367,.14383161,-.1410079],i=0;i<32;i++)C(t,e,((n={})["uPoissionDisk["+i+"]"]=r[i],n))},e}(Oe),Ge=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ze=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},He=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},We=function(t,e){return function(n,r){e(n,r,t)}},qe=!1,Xe=function(t){function e(e,n,r){var i=t.call(this,e,n,r)||this;return i.shadow=new Me,i}return Ge(e,t),e.prototype.initShadow=function(){ie.mode===Ft.LowPrecision?this.shadow=new Pe:ie.mode===Ft.HighPrecision?this.shadow=new Me:ie.mode===Ft.Lerp?this.shadow=new Ne:ie.mode===Ft.PCF?this.shadow=new De:ie.mode===Ft.PCFLerp?this.shadow=new Le:ie.mode===Ft.PoissionDisk?this.shadow=new Be:ie.mode===Ft.StratifiedPoissionDisk&&(this.shadow=new Ve)},e.prototype.generateShaders=function(){this.initShadow();var t="",e="",n="",r="",i="";n+=this.shadow.getDeclarationInFragment();var o=this.scene.getLightsInfo();return Object.keys(o).forEach(function(s){var a=o[s],u=a.lights,c=a.varName,l=a.declaration;u.forEach(function(r){r instanceof Wt&&(r.calculateShadow(),t+=r.shadowSnippet.vertex.declaration,e+=r.shadowSnippet.vertex.calculation,n+=r.shadowSnippet.fragment.declaration,r.shadowSnippet.fragment.calculation)}),r+="\n        "+l+"\n        uniform "+s+" "+c+"s["+u.length+"];\n      ",i+="\n        for(int i = 0; i < "+u.length+"; i++) {\n          result += calc"+s+"("+c+"s[i], normal, v_Position, viewDir);\n        }\n      "}),{vertexShader:"\n      attribute vec4 a_Position;\n      attribute vec4 a_Color;\n      attribute vec4 a_Normal;\n      attribute vec2 a_TextureCoord;\n\n      uniform mat4 u_MvpMatrix;\n      uniform mat4 u_ModelMatrix;\n      uniform mat4 u_NormalMatrix;\n      \n      varying vec4 v_Color;\n      varying vec3 v_Normal;\n      varying vec3 v_Position;\n      varying vec2 v_TextureCoord;\n      \n      "+t+"\n      void main() {\n        "+e+"\n        v_Position = vec3(u_ModelMatrix * a_Position);\n        v_Normal = vec3(u_NormalMatrix * a_Normal);\n        v_Color = a_Color;\n        v_TextureCoord = a_TextureCoord;\n        gl_Position = u_MvpMatrix * a_Position;\n      }\n    ",fragmentShader:"\n      precision mediump float;\n      #define PI 3.141592653589793\n      uniform vec3 u_CameraPosition;\n      uniform float u_Diffuse;\n      uniform float u_Specular;\n      uniform float u_Shininess;\n      uniform sampler2D u_MaterialTexture;\n\n      varying vec3 v_Normal;\n      varying vec3 v_Position;\n      varying vec4 v_Color;\n      varying vec2 v_TextureCoord;\n\n      float attenuation(vec3 dir, float constant, float linear, float quadratic){\n        float distance = length(dir);\n        float radiance = 1.0 / (constant + distance * linear + pow(distance, 2.0) * quadratic);\n        return clamp(radiance, 0.0, 1.0);\n      }\n\n      "+n+"\n      "+r+"\n\n      void main() {\n        vec3 normal = normalize(v_Normal);\n        vec3 viewDir = normalize(u_CameraPosition - v_Position);\n        vec3 result = vec3(0.0);\n\n        // calculate lights\n        "+i+"\n\n        vec4 color = texture2D(u_MaterialTexture, v_TextureCoord) + v_Color;\n        gl_FragColor = vec4(result * color.rgb, color.a);\n      }\n    "}},e.prototype.setupTexture=function(t,e){var n=this.gl,r=this.program;if(!qe){var i=n.createTexture();n.activeTexture(n.TEXTURE3),n.bindTexture(n.TEXTURE_2D,i),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,new Uint8Array([0,0,0,255])),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),qe=!0}var o=this.gl.getUniformLocation(r,"u_MaterialTexture");if(this.gl.uniform1i(o,t&&t.id||3),!O(n,r,"a_TextureCoord",e,2,n.FLOAT))return-1},e.prototype.setupLights=function(t){var e=this.gl,n=this.program,r=this.scene.getLightsInfo();Object.keys(r).forEach(function(i){var o=r[i],s=o.lights,a=o.varName;s.forEach(function(r,i){var o;r.setUniforms(e,n,a+"s["+i+"]"),C(e,n,((o={})["u_MvpMatrixFromLight"+r.index]=t[r.index],o))})}),this.shadow.setUniforms(e,n)},e.prototype.draw=function(){var t=this,e=this.gl,n=this.program,r=this.canvas.getSize(),i=r.width,o=r.height;e.viewport(0,0,i,o),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.useProgram(n),C(e,n,{u_CameraPosition:this.camera.eye}),this.scene.meshes.forEach(function(r){var i=r.geometry,o=r.material,s=r.colorAttributeArray,a=r.mvpMatrixFromLight,u=i.vertices,c=i.normals,l=i.modelMatrix,h=i.textureCoords,f=o.diffuse,d=o.specular,p=o.shininess,m=o.texture,g=(o.color,t.camera.transform.x(l)),v=l.inverse().transpose();return C(e,n,{u_MvpMatrix:g,u_ModelMatrix:l,u_NormalMatrix:v,u_Diffuse:f,u_Specular:d,u_Shininess:p}),t.setupTexture(m,h),t.setupLights(a),O(e,n,"a_Position",u,3,e.FLOAT)&&O(e,n,"a_Color",s,3,e.FLOAT)&&O(e,n,"a_Normal",c,3,e.FLOAT)?void r.geometry.draw(e):-1})},e=ze([Object(s.injectable)(),We(0,Object(s.inject)(a.ICanvasService)),We(1,Object(s.inject)(a.ISceneService)),We(2,Object(s.inject)(a.ICameraService)),He("design:paramtypes",[Object,Object,Object])],e)}(Kt),Ye=new o;Ye.showPanel(0);var $e=Ye.dom;$e.style.position="absolute",$e.style.left="0px",$e.style.top="0px",document.getElementById("stats").appendChild($e);var Je=me.get(a.ISceneService),Ke=me.get(a.IRendererService),Ze=me.get(a.ICanvasService),Qe=me.get(a.ICameraService),tn=(me.get(a.IControlsService),me.get(a.ITextureLoaderService).load("https://raw.githubusercontent.com/josdirksen/learning-threejs/master/assets/textures/general/floor-wood.jpg")),en=Ze.getSize(),nn=en.width,rn=en.height;Qe.init($V([0,10,10]),$V([.001,.001,.001]),60,nn/rn,1,100),Je.addMesh(new ve({geometry:new xe({width:10,height:10}),material:new ge({texture:tn})})),Je.addMesh(new ve({geometry:new we({center:$V([1.5,1.5,1.5]),radius:.5}),material:new ge({color:$V([1,.5,0])})})),Je.addLight(new Xt({position:$V([1,15,0]),direction:$V([0,-1,0]),angle:14,exponent:40,model:new Vt({ambient:$V([.2,.2,.2]),diffuse:$V([1,1,1]),specular:$V([1,1,1]),attenuation:{linear:.1,quadratic:.01}})})),Je.addLight(new Xt({position:$V([-1,15,0]),direction:$V([0,-1,0]),angle:14,exponent:40,model:new Vt({ambient:$V([.2,.2,.2]),diffuse:$V([1,1,1]),specular:$V([1,1,1]),attenuation:{linear:.1,quadratic:.01}})})),Ke.addShader(new ie(Ze,Je,Qe)),Ke.addShader(new Xe(Ze,Je,Qe));var on=function(){Ye.update(),Ke.render(),requestAnimationFrame(on)};on()}]);