!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/ray-tracer/",n(n.s=117)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3);t.METADATA_KEY=r;var i=n(52);t.Container=i.Container;var o=n(7);t.BindingScopeEnum=o.BindingScopeEnum,t.BindingTypeEnum=o.BindingTypeEnum,t.TargetTypeEnum=o.TargetTypeEnum;var a=n(68);t.AsyncContainerModule=a.AsyncContainerModule,t.ContainerModule=a.ContainerModule;var s=n(69);t.injectable=s.injectable;var u=n(70);t.tagged=u.tagged;var c=n(71);t.named=c.named;var l=n(35);t.inject=l.inject,t.LazyServiceIdentifer=l.LazyServiceIdentifer;var f=n(72);t.optional=f.optional;var h=n(73);t.unmanaged=h.unmanaged;var d=n(74);t.multiInject=d.multiInject;var p=n(75);t.targetName=p.targetName;var _=n(76);t.postConstruct=_.postConstruct;var m=n(33);t.MetadataReader=m.MetadataReader;var v=n(11);t.id=v.id;var g=n(8);t.decorate=g.decorate;var y=n(38);t.traverseAncerstors=y.traverseAncerstors,t.taggedConstraint=y.taggedConstraint,t.namedConstraint=y.namedConstraint,t.typeConstraint=y.typeConstraint;var b=n(15);t.getServiceIdentifierAsString=b.getServiceIdentifierAsString;var E=n(77);t.multiBindToService=E.multiBindToService},function(e,t,n){(function(e){t.Vector=n(13),e.$V=t.Vector.create,t.Matrix=n(18),e.$M=t.Matrix.create,t.Line=n(24),e.$L=t.Line.create,t.Plane=n(31),e.$P=t.Plane.create,t.Line.Segment=n(50),t.Sylvester=n(14)}).call(this,n(23))},function(e,t,n){"use strict";var r={ISceneService:Symbol("ISceneService"),ICameraService:Symbol("ICameraService"),IMouseService:Symbol("IMouseService"),ICanvasService:Symbol("ICanvasService"),IRendererService:Symbol("IRendererService"),IControlsService:Symbol("IControlsService"),ITextureLoaderService:Symbol("ITextureLoaderService")};t.a=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NAMED_TAG="named",t.NAME_TAG="name",t.UNMANAGED_TAG="unmanaged",t.OPTIONAL_TAG="optional",t.INJECT_TAG="inject",t.MULTI_INJECT_TAG="multi_inject",t.TAGGED="inversify:tagged",t.TAGGED_PROP="inversify:tagged_props",t.PARAM_TYPES="inversify:paramtypes",t.DESIGN_PARAM_TYPES="design:paramtypes",t.POST_CONSTRUCT="post_construct"},function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"a",function(){return o});var r=n(1);function i(e,t,n,r,i,o){var a=e.createBuffer();if(!a)return console.log("Failed to create the buffer object"),!1;e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,r,e.STATIC_DRAW);var s=e.getAttribLocation(t,n);return s<0?(console.log("Failed to get the storage location of "+n),!1):(e.vertexAttribPointer(s,i,o,!1,0,0),e.enableVertexAttribArray(s),!0)}function o(e,t,n,i){for(var o in n){var a=n[o],s=e.getUniformLocation(t,o);null!=s&&(a instanceof r.Vector?e.uniform3fv(s,new Float32Array([a.elements[0],a.elements[1],a.elements[2]])):a instanceof r.Matrix?e.uniformMatrix4fv(s,!1,new Float32Array(a.flatten())):a%1==0&&"int"===i?e.uniform1i(s,a):e.uniform1f(s,a))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",t.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",t.NULL_ARGUMENT="NULL argument",t.KEY_NOT_FOUND="Key Not Found",t.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",t.CANNOT_UNBIND="Could not unbind serviceIdentifier:",t.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",t.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",t.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:",t.UNDEFINED_INJECT_ANNOTATION=function(e){return"@inject called with undefined this could mean that the class "+e+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."},t.CIRCULAR_DEPENDENCY="Circular dependency found:",t.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",t.INVALID_BINDING_TYPE="Invalid binding type:",t.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",t.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",t.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",t.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",t.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.",t.ARGUMENTS_LENGTH_MISMATCH=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"The number of constructor arguments in the derived class "+e[0]+" must be >= than the number of constructor arguments of its base class."},t.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",t.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",t.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",t.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",t.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class",t.POST_CONSTRUCT_ERROR=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"@postConstruct error in class "+e[0]+": "+e[1]},t.CIRCULAR_DEPENDENCY_IN_FACTORY=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"It looks like there is a circular dependency in one of the '"+e[0]+"' bindings. Please investigate bindings withservice identifier '"+e[1]+"'."},t.STACK_OVERFLOW="Maximum call stack size exceeded"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),i=function(){function e(e,t){this.key=e,this.value=t}return e.prototype.toString=function(){return this.key===r.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},e}();t.Metadata=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BindingScopeEnum={Request:"Request",Singleton:"Singleton",Transient:"Transient"};t.BindingTypeEnum={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};t.TargetTypeEnum={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=n(3);function o(e,t,n,i,o){var a={},s="number"==typeof o,u=void 0!==o&&s?o.toString():n;if(s&&void 0!==n)throw new Error(r.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(e,t)&&(a=Reflect.getMetadata(e,t));var c=a[u];if(Array.isArray(c))for(var l=0,f=c;l<f.length;l++){var h=f[l];if(h.key===i.key)throw new Error(r.DUPLICATED_METADATA+" "+h.key.toString())}else c=[];c.push(i),a[u]=c,Reflect.defineMetadata(e,a,t)}function a(e,t){Reflect.decorate(e,t)}function s(e,t){return function(n,r){t(n,r,e)}}t.tagParameter=function(e,t,n,r){o(i.TAGGED,e,t,r,n)},t.tagProperty=function(e,t,n){o(i.TAGGED_PROP,e.constructor,t,n)},t.decorate=function(e,t,n){"number"==typeof n?a([s(n,e)],t):"string"==typeof n?Reflect.decorate([e],t,n):a([e],t)}},function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty,i="~";function o(){}function a(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(e,t,n,r,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new a(n,r||e,o),u=i?i+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function u(e,t){0==--e._eventsCount?e._events=new o:delete e._events[t]}function c(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),c.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)r.call(e,t)&&n.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},c.prototype.listeners=function(e){var t=i?i+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,o=n.length,a=new Array(o);r<o;r++)a[r]=n[r].fn;return a},c.prototype.listenerCount=function(e){var t=i?i+e:e,n=this._events[t];return n?n.fn?1:n.length:0},c.prototype.emit=function(e,t,n,r,o,a){var s=i?i+e:e;if(!this._events[s])return!1;var u,c,l=this._events[s],f=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),f){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,r),!0;case 5:return l.fn.call(l.context,t,n,r,o),!0;case 6:return l.fn.call(l.context,t,n,r,o,a),!0}for(c=1,u=new Array(f-1);c<f;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var h,d=l.length;for(c=0;c<d;c++)switch(l[c].once&&this.removeListener(e,l[c].fn,void 0,!0),f){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,t);break;case 3:l[c].fn.call(l[c].context,t,n);break;case 4:l[c].fn.call(l[c].context,t,n,r);break;default:if(!u)for(h=1,u=new Array(f-1);h<f;h++)u[h-1]=arguments[h];l[c].fn.apply(l[c].context,u)}}return!0},c.prototype.on=function(e,t,n){return s(this,e,t,n,!1)},c.prototype.once=function(e,t,n){return s(this,e,t,n,!0)},c.prototype.removeListener=function(e,t,n,r){var o=i?i+e:e;if(!this._events[o])return this;if(!t)return u(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||r&&!a.once||n&&a.context!==n||u(this,o);else{for(var s=0,c=[],l=a.length;s<l;s++)(a[s].fn!==t||r&&!a[s].once||n&&a[s].context!==n)&&c.push(a[s]);c.length?this._events[o]=1===c.length?c[0]:c:u(this,o)}return this},c.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&u(this,t)):(this._events=new o,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=i,c.EventEmitter=c,e.exports=c},function(e,t,n){"use strict";var r,i=n(0),o=n(9),a=n(44),s=n(45),u=n.n(s),c=n(2),l=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),f=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},h=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(e,t){return function(n,r){t(n,r,e)}},p=function(e){function t(t){var r=e.call(this)||this;return r.shaders=[],r.scene=t,r.shell=u()({clearColor:[1,1,1,1]}),r.shell.on("gl-init",function(){var e=r.shell,t=e.canvas,i=e.gl;r.gl=i,i.clearDepth(1),i.enable(i.DEPTH_TEST),i.enable(i.CULL_FACE),r.canvas=t,r.initStats(),r.emit(n.READY_EVENT)}),r.shell.on("gl-render",function(){r.stats.update();var e=r.shell;e.canvas,e.gl;r.shaders.forEach(function(e){e.inited||e.init(r.gl)}),r.scene.inited||r.scene.init(),r.shaders.forEach(function(e){e.draw()})}),r.shell.on("gl-resize",function(e,t){r.width=e,r.height=t,r.emit(n.RESIZE_EVENT)}),r.shell.on("gl-error",function(e){console.error(e)}),r}var n;return l(t,e),n=t,t.prototype.addShader=function(e){this.shaders.push(e)},t.prototype.updateShaders=function(){this.shaders.forEach(function(e){e.inited=!1})},t.prototype.updateScene=function(){this.scene.inited=!1},t.prototype.initStats=function(){this.stats=new a,this.stats.showPanel(0);var e=this.stats.dom;e.style.position="absolute",e.style.left="0px",e.style.top="0px",document.getElementById("stats").appendChild(e)},t.prototype.getSize=function(){return{width:this.width,height:this.height}},t.RESIZE_EVENT="resize",t.READY_EVENT="ready",t=n=f([Object(i.injectable)(),d(0,Object(i.inject)(c.a.ISceneService)),h("design:paramtypes",[Object])],t)}(o.EventEmitter);t.a=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=0;t.id=function(){return r++}},function(e,t,n){"use strict";var r,i=n(21),o=0,a=function(){function e(e){this.declaration="",this.color=$V([1,1,1]),this.position=$V([0,0,0]),this.model=new i.a({}),this.index=o++,Object.assign(this,e)}return e.prototype.setUniforms=function(e,t,n){},e}(),s=n(4),u=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),c=function(e){function t(t){var n=e.call(this,t)||this;return n.uShadowMap="u_ShadowMap"+n.index,Object.assign(n,t),n}return u(t,e),t.prototype.calculateShadow=function(){var e=this.index;this.shadowSnippet={vertex:{declaration:"\n          uniform mat4 u_MvpMatrixFromLight"+e+";\n          varying vec4 v_PositionFromLight"+e+";\n        ",calculation:"\n          v_PositionFromLight"+e+" = u_MvpMatrixFromLight"+e+" * a_Position;\n        ",result:""},fragment:{declaration:"\n          uniform sampler2D "+this.uShadowMap+";\n          varying vec4 v_PositionFromLight"+e+";\n        ",calculation:"",result:""}}},t.prototype.setUniforms=function(t,n,r){var i;e.prototype.setUniforms.call(this,t,n,r),Object(s.a)(t,n,((i={})[this.uShadowMap]=this.fboTextureIdx,i),"int")},t}(a);t.a=c},function(e,t,n){var r=n(14),i=n(18);function o(){}o.prototype={norm:function(){for(var e=this.elements.length,t=0;e--;)t+=Math.pow(this.elements[e],2);return Math.sqrt(t)},e:function(e){return e<1||e>this.elements.length?null:this.elements[e-1]},dimensions:function(){return{rows:1,cols:this.elements.length}},rows:function(){return 1},cols:function(){return this.elements.length},modulus:function(){return Math.sqrt(this.dot(this))},eql:function(e){var t=this.elements.length,n=e.elements||e;if(t!=n.length)return!1;for(;t--;)if(Math.abs(this.elements[t]-n[t])>r.precision)return!1;return!0},dup:function(){return o.create(this.elements)},map:function(e){var t=[];return this.each(function(n,r){t.push(e(n,r))}),o.create(t)},each:function(e){for(var t=this.elements.length,n=0;n<t;n++)e(this.elements[n],n+1)},toUnitVector:function(){var e=this.modulus();return 0===e?this.dup():this.map(function(t){return t/e})},angleFrom:function(e){var t=e.elements||e,n=this.elements.length;if(n!=t.length)return null;var r=0,i=0,o=0;if(this.each(function(e,n){r+=e*t[n-1],i+=e*e,o+=t[n-1]*t[n-1]}),i=Math.sqrt(i),o=Math.sqrt(o),i*o==0)return null;var a=r/(i*o);return a<-1&&(a=-1),a>1&&(a=1),Math.acos(a)},isParallelTo:function(e){var t=this.angleFrom(e);return null===t?null:t<=r.precision},isAntiparallelTo:function(e){var t=this.angleFrom(e);return null===t?null:Math.abs(t-Math.PI)<=r.precision},isPerpendicularTo:function(e){var t=this.dot(e);return null===t?null:Math.abs(t)<=r.precision},add:function(e){var t=e.elements||e;return this.elements.length!=t.length?this.map(function(t){return t+e}):this.map(function(e,n){return e+t[n-1]})},subtract:function(e){if("number"==typeof e)return this.map(function(t){return t-e});var t=e.elements||e;return this.elements.length!=t.length?null:this.map(function(e,n){return e-t[n-1]})},multiply:function(e){return this.map(function(t){return t*e})},elementMultiply:function(e){return this.map(function(t,n){return e.e(n)*t})},sum:function(){var e=0;return this.map(function(t){e+=t}),e},chomp:function(e){for(var t=[],n=e;n<this.elements.length;n++)t.push(this.elements[n]);return o.create(t)},top:function(e){for(var t=[],n=0;n<e;n++)t.push(this.elements[n]);return o.create(t)},augment:function(e){for(var t=this.elements,n=0;n<e.length;n++)t.push(e[n]);return o.create(t)},x:function(e){return this.multiply(e)},log:function(){return o.log(this)},elementDivide:function(e){return this.map(function(t,n){return t/e.e(n)})},product:function(){var e=1;return this.map(function(t){e*=t}),e},dot:function(e){var t=e.elements||e,n=0,r=this.elements.length;if(r!=t.length)return null;for(;r--;)n+=this.elements[r]*t[r];return n},cross:function(e){var t=e.elements||e;if(3!=this.elements.length||3!=t.length)return null;var n=this.elements;return o.create([n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]])},max:function(){for(var e=0,t=this.elements.length;t--;)Math.abs(this.elements[t])>Math.abs(e)&&(e=this.elements[t]);return e},maxIndex:function(){for(var e=0,t=this.elements.length,n=-1;t--;)Math.abs(this.elements[t])>Math.abs(e)&&(e=this.elements[t],n=t+1);return n},indexOf:function(e){for(var t=null,n=this.elements.length,r=0;r<n;r++)null===t&&this.elements[r]==e&&(t=r+1);return t},toDiagonalMatrix:function(){return i.Diagonal(this.elements)},round:function(){return this.map(function(e){return Math.round(e)})},transpose:function(){for(var e=this.elements.length,t=[],n=0;n<e;n++)t.push([this.elements[n]]);return i.create(t)},snapTo:function(e){return this.map(function(t){return Math.abs(t-e)<=r.precision?e:t})},distanceFrom:function(e){if(e.anchor||e.start&&e.end)return e.distanceFrom(this);var t=e.elements||e;if(t.length!=this.elements.length)return null;var n,r=0;return this.each(function(e,i){n=e-t[i-1],r+=n*n}),Math.sqrt(r)},liesOn:function(e){return e.contains(this)},liesIn:function(e){return e.contains(this)},rotate:function(e,t){var n,r,a,s,u=null;switch(e.determinant&&(u=e.elements),this.elements.length){case 2:return 2!=(n=t.elements||t).length?null:(u||(u=i.Rotation(e).elements),r=this.elements[0]-n[0],a=this.elements[1]-n[1],o.create([n[0]+u[0][0]*r+u[0][1]*a,n[1]+u[1][0]*r+u[1][1]*a]));case 3:if(!t.direction)return null;var c=t.pointClosestTo(this).elements;return u||(u=i.Rotation(e,t.direction).elements),r=this.elements[0]-c[0],a=this.elements[1]-c[1],s=this.elements[2]-c[2],o.create([c[0]+u[0][0]*r+u[0][1]*a+u[0][2]*s,c[1]+u[1][0]*r+u[1][1]*a+u[1][2]*s,c[2]+u[2][0]*r+u[2][1]*a+u[2][2]*s]);default:return null}},reflectionIn:function(e){if(e.anchor){var t=this.elements.slice(),n=e.pointClosestTo(t).elements;return o.create([n[0]+(n[0]-t[0]),n[1]+(n[1]-t[1]),n[2]+(n[2]-(t[2]||0))])}var r=e.elements||e;return this.elements.length!=r.length?null:this.map(function(e,t){return r[t-1]+(r[t-1]-e)})},to3D:function(){var e=this.dup();switch(e.elements.length){case 3:break;case 2:e.elements.push(0);break;default:return null}return e},inspect:function(){return"["+this.elements.join(", ")+"]"},setElements:function(e){return this.elements=(e.elements||e).slice(),this}},o.create=function(e){return(new o).setElements(e)},o.i=o.create([1,0,0]),o.j=o.create([0,1,0]),o.k=o.create([0,0,1]),o.Random=function(e){for(var t=[];e--;)t.push(Math.random());return o.create(t)},o.Fill=function(e,t){for(var n=[];e--;)n.push(t);return o.create(n)},o.Zero=function(e){return o.Fill(e,0)},o.One=function(e){return o.Fill(e,1)},o.log=function(e){return e.map(function(e){return Math.log(e)})},e.exports=o},function(e,t){Math.sign=function(e){return e<0?-1:1};e.exports={precision:1e-6,approxPrecision:1e-5}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5);function i(e){return"function"==typeof e?e.name:"symbol"==typeof e?e.toString():e}function o(e){if(e.name)return e.name;var t=e.toString(),n=t.match(/^function\s*([^\s(]+)/);return n?n[1]:"Anonymous function: "+t}t.getServiceIdentifierAsString=i,t.listRegisteredBindingsForServiceIdentifier=function(e,t,n){var r="",i=n(e,t);return 0!==i.length&&(r="\nRegistered bindings:",i.forEach(function(e){var t="Object";null!==e.implementationType&&(t=o(e.implementationType)),r=r+"\n "+t,e.constraint.metaData&&(r=r+" - "+e.constraint.metaData)})),r},t.circularDependencyToException=function e(t){t.childRequests.forEach(function(t){if(function e(t,n){return null!==t.parentRequest&&(t.parentRequest.serviceIdentifier===n||e(t.parentRequest,n))}(t,t.serviceIdentifier)){var n=function e(t,n){void 0===n&&(n=[]);var r=i(t.serviceIdentifier);return n.push(r),null!==t.parentRequest?e(t.parentRequest,n):n}(t).reverse().join(" --\x3e ");throw new Error(r.CIRCULAR_DEPENDENCY+" "+n)}e(t)})},t.listMetadataForTarget=function(e,t){if(t.isTagged()||t.isNamed()){var n="",r=t.getNamedTag(),i=t.getCustomTags();return null!==r&&(n+=r.toString()+"\n"),null!==i&&i.forEach(function(e){n+=e.toString()+"\n"})," "+e+"\n "+e+" - "+n}return" "+e},t.getFunctionName=o},function(e,t,n){"use strict";var r,i=n(0),o=n(9),a=n(10),s=n(2),u=n(28),c=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),l=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},f=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(e,t){return function(n,r){t(n,r,e)}},d=function(e){function t(t){var n=e.call(this)||this;return n.isMoving=!1,n.lastX=-1,n.lastY=-1,n.deltaX=0,n.deltaY=0,n.deltaZ=0,n.renderer=t,n.onPanstart=n.onPanstart.bind(n),n.onPanmove=n.onPanmove.bind(n),n.onPanend=n.onPanend.bind(n),n.onPinch=n.onPinch.bind(n),n.onMousewheel=n.onMousewheel.bind(n),n.renderer.on(a.a.READY_EVENT,function(){var e=new u(n.renderer.canvas);e.get("pan").set({direction:u.DIRECTION_ALL}),e.get("pinch").set({enable:!0}),e.on("panstart",n.onPanstart),e.on("panmove",n.onPanmove),e.on("panend",n.onPanend),e.on("pinch",n.onPinch),n.renderer.canvas.addEventListener("wheel",n.onMousewheel)}),n}var n;return c(t,e),n=t,t.prototype.onPanend=function(e){this.isMoving=!1,this.emit(n.UP_EVENT)},t.prototype.onPanstart=function(e){this.lastX=e.center.x,this.lastY=e.center.y,this.isMoving=!0,this.deltaZ=0,this.emit(n.DOWN_EVENT)},t.prototype.onPanmove=function(e){this.isMoving&&(this.deltaX=e.center.x-this.lastX,this.deltaY=e.center.y-this.lastY,this.lastX=e.center.x,this.lastY=e.center.y,this.emit(n.MOVE_EVENT,{deltaX:this.deltaX,deltaY:this.deltaY,deltaZ:this.deltaZ}))},t.prototype.onMousewheel=function(e){this.deltaZ=e.deltaY,this.emit(n.WHEEL_EVENT,{deltaX:this.deltaX,deltaY:this.deltaY,deltaZ:this.deltaZ})},t.prototype.onPinch=function(e){this.deltaZ=10*(1-e.scale),this.emit(n.WHEEL_EVENT,{deltaX:this.deltaX,deltaY:this.deltaY,deltaZ:this.deltaZ})},t.UP_EVENT="mouseup",t.MOVE_EVENT="mousemove",t.DOWN_EVENT="mousedown",t.OUT_EVENT="mouseout",t.WHEEL_EVENT="mousewheel",t=n=l([Object(i.injectable)(),h(0,Object(i.inject)(s.a.IRendererService)),f("design:paramtypes",[Object])],t)}(o.EventEmitter);t.a=d},function(e,t,n){"use strict";var r=function(){return function(e){this.shininess=120,this.diffuse=1,this.specular=1,this.color=$V([0,0,0]),Object.assign(this,e)}}();t.a=r},function(e,t,n){var r=n(49),o=n(14);n(13);function a(e,t,n,r){for(var i=e.elements,o=r-1;o--;){for(var a=[],s=0;s<n;s++)a.push(s==o?1:0);i.unshift(a)}for(o=r-1;o<t;o++)for(;i[o].length<n;)i[o].unshift(0);return $M(i)}function s(){for(var e=this,t=f.I(e.rows()),n=e.transpose(),r=f.I(e.cols()),i=Number.MAX_VALUE,o=0;i>2.2737e-13&&o<100;){var a=n.transpose().qrJs();n=a.R,t=t.x(a.Q),a=n.transpose().qrJs(),r=r.x(a.Q);var s=(n=a.R).triu(1).unroll().norm(),u=n.diagonal().norm();0==u&&(u=1),i=s/u,o++}var c=n.diagonal(),l=[];for(o=1;o<=c.cols();o++){var h=c.e(o);if(l.push(Math.abs(h)),h<0)for(var d=0;d<r.rows();d++)t.elements[d][o-1]=-t.elements[d][o-1]}return{U:r,S:$V(l).toDiagonalMatrix(),V:t}}function u(){var e=d.sgesvd("A","A",this.elements);return{U:$M(e.U),S:$M(e.S).column(1).toDiagonalMatrix(),V:$M(e.VT).transpose()}}function c(){for(var e=this.rows(),t=this.cols(),n=f.I(e),r=this,i=1;i<Math.min(e,t);i++){for(var o=r.slice(i,0,i,i).col(1),s=[1];s.length<=e-i;)s.push(0);s=$V(s);var u=o.add(s.x(o.norm()*Math.sign(o.e(1)))),c=$M(u),l=a(f.I(e-i+1).subtract(c.x(2).x(c.transpose()).div(c.transpose().x(c).e(1,1))),e,t,i);r=l.x(r),n=n.x(l)}return{Q:n,R:r}}function l(){var e=d.qr(this.elements);return{Q:$M(e.Q),R:$M(e.R)}}function f(){}function h(){var e=d.lu(this.elements);return{L:$M(e.L),U:$M(e.U),P:$M(e.P)}}f.prototype={solve:function(e){var t=this.lu();e=t.P.x(e);var n=t.L.forwardSubstitute(e),r=t.U.backSubstitute(n);return t.P.x(r)},pcaProject:function(e,t){var n,r,i=(t=t||(n=this,r=n.transpose().x(n).x(1/n.rows()).svd(),{U:r.U,S:r.S}).U).slice(1,t.rows(),1,e);return{Z:this.x(i),U:t}},pcaRecover:function(e){var t=this.cols(),n=e.slice(1,e.rows(),1,t);return this.x(n.transpose())},triu:function(e){return e||(e=0),this.map(function(t,n,r){return r-n>=e?t:0})},unroll:function(){for(var e=[],t=1;t<=this.cols();t++)for(var n=1;n<=this.rows();n++)e.push(this.e(n,t));return $V(e)},slice:function(e,t,n,r){var o=[];for(0==t&&(t=this.rows()),0==r&&(r=this.cols()),i=e;i<=t;i++){var a=[];for(j=n;j<=r;j++)a.push(this.e(i,j));o.push(a)}return $M(o)},e:function(e,t){return e<1||e>this.elements.length||t<1||t>this.elements[0].length?null:this.elements[e-1][t-1]},row:function(e){return e>this.elements.length?null:$V(this.elements[e-1])},col:function(e){if(e>this.elements[0].length)return null;for(var t=[],n=this.elements.length,r=0;r<n;r++)t.push(this.elements[r][e-1]);return $V(t)},dimensions:function(){return{rows:this.elements.length,cols:this.elements[0].length}},rows:function(){return this.elements.length},cols:function(){return this.elements[0].length},approxEql:function(e){return this.eql(e,o.approxPrecision)},eql:function(e,t){var n=e.elements||e;if(void 0===n[0][0]&&(n=f.create(n).elements),this.elements.length!=n.length||this.elements[0].length!=n[0].length)return!1;for(var r,i=this.elements.length,a=this.elements[0].length;i--;)for(r=a;r--;)if(Math.abs(this.elements[i][r]-n[i][r])>(t||o.precision))return!1;return!0},dup:function(){return f.create(this.elements)},map:function(e){for(var t,n=[],r=this.elements.length,i=this.elements[0].length;r--;)for(t=i,n[r]=[];t--;)n[r][t]=e(this.elements[r][t],r+1,t+1);return f.create(n)},isSameSizeAs:function(e){var t=e.elements||e;return void 0===t[0][0]&&(t=f.create(t).elements),this.elements.length==t.length&&this.elements[0].length==t[0].length},add:function(e){if("number"==typeof e)return this.map(function(t,n,r){return t+e});var t=e.elements||e;return void 0===t[0][0]&&(t=f.create(t).elements),this.isSameSizeAs(t)?this.map(function(e,n,r){return e+t[n-1][r-1]}):null},subtract:function(e){if("number"==typeof e)return this.map(function(t,n,r){return t-e});var t=e.elements||e;return void 0===t[0][0]&&(t=f.create(t).elements),this.isSameSizeAs(t)?this.map(function(e,n,r){return e-t[n-1][r-1]}):null},canMultiplyFromLeft:function(e){var t=e.elements||e;return void 0===t[0][0]&&(t=f.create(t).elements),this.elements[0].length==t.length},mulOp:function(e,t){if(!e.elements)return this.map(function(n){return t(n,e)});var n=!!e.modulus;if(void 0===(_=e.elements||e)[0][0]&&(_=f.create(_).elements),!this.canMultiplyFromLeft(_))return null;for(var r,i,o,a,s,u=this.elements,c=[],l=u.length,h=_[0].length,d=u[0].length,p=l;p--;){for(i=[],r=u[p],a=h;a--;){for(o=0,s=d;s--;)o+=t(r[s],_[s][a]);i[a]=o}c[p]=i}var _=f.create(c);return n?_.col(1):_},div:function(e){return this.mulOp(e,function(e,t){return e/t})},multiply:function(e){return this.mulOp(e,function(e,t){return e*t})},x:function(e){return this.multiply(e)},elementMultiply:function(e){return this.map(function(t,n,r){return e.e(n,r)*t})},sum:function(){var e=0;return this.map(function(t){e+=t}),e},mean:function(){for(var e=this.dimensions(),t=[],n=1;n<=e.cols;n++)t.push(this.col(n).sum()/e.rows);return $V(t)},column:function(e){return this.col(e)},log:function(){return this.map(function(e){return Math.log(e)})},minor:function(e,t,n,r){for(var i,o,a,s=[],u=n,c=this.elements.length,l=this.elements[0].length;u--;)for(s[i=n-u-1]=[],o=r;o--;)a=r-o-1,s[i][a]=this.elements[(e+i-1)%c][(t+a-1)%l];return f.create(s)},transpose:function(){for(var e,t=this.elements.length,n=[],r=this.elements[0].length;r--;)for(e=t,n[r]=[];e--;)n[r][e]=this.elements[e][r];return f.create(n)},isSquare:function(){return this.elements.length==this.elements[0].length},max:function(){for(var e,t=0,n=this.elements.length,r=this.elements[0].length;n--;)for(e=r;e--;)Math.abs(this.elements[n][e])>Math.abs(t)&&(t=this.elements[n][e]);return t},indexOf:function(e){var t,n,r=this.elements.length,i=this.elements[0].length;for(t=0;t<r;t++)for(n=0;n<i;n++)if(this.elements[t][n]==e)return{i:t+1,j:n+1};return null},diagonal:function(){if(!this.isSquare)return null;for(var e=[],t=this.elements.length,n=0;n<t;n++)e.push(this.elements[n][n]);return $V(e)},toRightTriangular:function(){var e,t,n,r,i=this.dup(),o=this.elements.length,a=this.elements[0].length;for(t=0;t<o;t++){if(0==i.elements[t][t])for(n=t+1;n<o;n++)if(0!=i.elements[n][t]){for(e=[],r=0;r<a;r++)e.push(i.elements[t][r]+i.elements[n][r]);i.elements[t]=e;break}if(0!=i.elements[t][t])for(n=t+1;n<o;n++){var s=i.elements[n][t]/i.elements[t][t];for(e=[],r=0;r<a;r++)e.push(r<=t?0:i.elements[n][r]-i.elements[t][r]*s);i.elements[n]=e}}return i},toUpperTriangular:function(){return this.toRightTriangular()},determinant:function(){if(!this.isSquare())return null;if(1==this.cols&&1==this.rows)return this.row(1);if(0==this.cols&&0==this.rows)return 1;for(var e=this.toRightTriangular(),t=e.elements[0][0],n=e.elements.length,r=1;r<n;r++)t*=e.elements[r][r];return t},det:function(){return this.determinant()},isSingular:function(){return this.isSquare()&&0===this.determinant()},trace:function(){if(!this.isSquare())return null;for(var e=this.elements[0][0],t=this.elements.length,n=1;n<t;n++)e+=this.elements[n][n];return e},tr:function(){return this.trace()},rank:function(){for(var e,t=this.toRightTriangular(),n=0,r=this.elements.length,i=this.elements[0].length;r--;)for(e=i;e--;)if(Math.abs(t.elements[r][e])>o.precision){n++;break}return n},rk:function(){return this.rank()},augment:function(e){var t=e.elements||e;void 0===t[0][0]&&(t=f.create(t).elements);var n,r=this.dup(),i=r.elements[0].length,o=r.elements.length,a=t[0].length;if(o!=t.length)return null;for(;o--;)for(n=a;n--;)r.elements[o][i+n]=t[o][n];return r},inverse:function(){if(!this.isSquare()||this.isSingular())return null;for(var e,t,n,r,i,o=this.elements.length,a=o,s=this.augment(f.I(o)).toRightTriangular(),u=s.elements[0].length,c=[];a--;){for(n=[],c[a]=[],r=s.elements[a][a],t=0;t<u;t++)i=s.elements[a][t]/r,n.push(i),t>=o&&c[a].push(i);for(s.elements[a]=n,e=a;e--;){for(n=[],t=0;t<u;t++)n.push(s.elements[e][t]-s.elements[a][t]*s.elements[e][a]);s.elements[e]=n}}return f.create(c)},inv:function(){return this.inverse()},round:function(){return this.map(function(e){return Math.round(e)})},snapTo:function(e){return this.map(function(t){return Math.abs(t-e)<=o.precision?e:t})},inspect:function(){for(var e=[],t=this.elements.length,n=0;n<t;n++)e.push($V(this.elements[n]).inspect());return e.join("\n")},toArray:function(){for(var e=[],t=this.elements.length,n=0;n<t;n++)e.push(this.elements[n]);return e},setElements:function(e){var t,n,r=e.elements||e;if(void 0!==r[0][0]){for(t=r.length,this.elements=[];t--;)for(n=r[t].length,this.elements[t]=[];n--;)this.elements[t][n]=r[t][n];return this}var i=r.length;for(this.elements=[],t=0;t<i;t++)this.elements.push([r[t]]);return this},maxColumnIndexes:function(){for(var e=[],t=1;t<=this.rows();t++){for(var n=null,r=-1,i=1;i<=this.cols();i++)(null===n||this.e(t,i)>n)&&(n=this.e(t,i),r=i);e.push(r)}return $V(e)},maxColumns:function(){for(var e=[],t=1;t<=this.rows();t++){for(var n=null,r=1;r<=this.cols();r++)(null===n||this.e(t,r)>n)&&(n=this.e(t,r));e.push(n)}return $V(e)},minColumnIndexes:function(){for(var e=[],t=1;t<=this.rows();t++){for(var n=null,r=-1,i=1;i<=this.cols();i++)(null===n||this.e(t,i)<n)&&(n=this.e(t,i),r=i);e.push(r)}return $V(e)},minColumns:function(){for(var e=[],t=1;t<=this.rows();t++){for(var n=null,r=1;r<=this.cols();r++)(null===n||this.e(t,r)<n)&&(n=this.e(t,r));e.push(n)}return $V(e)},partialPivot:function(e,t,n,r,i){for(var o=0,a=0,s=e;s<=r.rows();s++)Math.abs(r.e(s,t))>a&&(a=Math.abs(r.e(e,t)),o=s);if(o!=e){var u=r.elements[e-1];r.elements[e-1]=r.elements[o-1],r.elements[o-1]=u,n.elements[e-1][e-1]=0,n.elements[e-1][o-1]=1,n.elements[o-1][o-1]=0,n.elements[o-1][e-1]=1}return n},forwardSubstitute:function(e){for(var t=[],n=1;n<=this.rows();n++){for(var r=0,i=1;i<n;i++)r+=this.e(n,i)*t[i-1];t.push((e.e(n)-r)/this.e(n,n))}return $V(t)},backSubstitute:function(e){for(var t=[],n=this.rows();n>0;n--){for(var r=0,i=this.cols();i>n;i--)r+=this.e(n,i)*t[this.rows()-i];t.push((e.e(n)-r)/this.e(n,n))}return $V(t.reverse())},luPack:h,luJs:p,svdJs:s,svdPack:u,qrJs:c,qrPack:l};var d;function p(){for(var e=this.dup(),t=f.I(e.rows()),n=f.I(e.rows()),r=f.Zeros(e.rows(),e.cols()),i=1,o=1;o<=Math.min(e.cols(),e.rows());o++){n=e.partialPivot(o,i,n,e,t);for(var a=o+1;a<=e.rows();a++){var s=e.e(a,i)/e.e(o,i);t.elements[a-1][o-1]=s;for(var u=o+1;u<=e.cols();u++)e.elements[a-1][u-1]-=e.e(o,u)*s}for(u=o;u<=e.cols();u++)r.elements[o-1][u-1]=e.e(o,u);i<e.cols()&&i++}return{L:t,U:r,P:n}}(d=function(){try{return n(!function(){var e=new Error("Cannot find module 'lapack'");throw e.code="MODULE_NOT_FOUND",e}())}catch(e){}}())?(f.prototype.svd=u,f.prototype.qr=l,f.prototype.lu=h):(f.prototype.svd=s,f.prototype.qr=c,f.prototype.lu=p),f.create=function(e,t){return(new f).setElements(e)},f.I=function(e){for(var t,n=[],r=e;r--;)for(t=e,n[r]=[];t--;)n[r][t]=r==t?1:0;return f.create(n)},f.loadFile=function(e){for(var t=[],n=r.readFileSync(e,"utf-8").split("\n"),i=0;i<n.length;i++){var o=n[i].split(",");o.length>1&&t.push(o)}return(new f).setElements(t)},f.Diagonal=function(e){for(var t=e.length,n=f.I(t);t--;)n.elements[t][t]=e[t];return n},f.Rotation=function(e,t){if(!t)return f.create([[Math.cos(e),-Math.sin(e)],[Math.sin(e),Math.cos(e)]]);var n=t.dup();if(3!=n.elements.length)return null;var r=n.modulus(),i=n.elements[0]/r,o=n.elements[1]/r,a=n.elements[2]/r,s=Math.sin(e),u=Math.cos(e),c=1-u;return f.create([[c*i*i+u,c*i*o-s*a,c*i*a+s*o],[c*i*o+s*a,c*o*o+u,c*o*a-s*i],[c*i*a-s*o,c*o*a+s*i,c*a*a+u]])},f.RotationX=function(e){var t=Math.cos(e),n=Math.sin(e);return f.create([[1,0,0],[0,t,-n],[0,n,t]])},f.RotationY=function(e){var t=Math.cos(e),n=Math.sin(e);return f.create([[t,0,n],[0,1,0],[-n,0,t]])},f.RotationZ=function(e){var t=Math.cos(e),n=Math.sin(e);return f.create([[t,-n,0],[n,t,0],[0,0,1]])},f.Random=function(e,t){return 1===arguments.length&&(t=e),f.Zero(e,t).map(function(){return Math.random()})},f.Fill=function(e,t,n){2===arguments.length&&(n=t,t=e);for(var r,i=[],o=e;o--;)for(r=t,i[o]=[];r--;)i[o][r]=n;return f.create(i)},f.Zero=function(e,t){return f.Fill(e,t,0)},f.Zeros=function(e,t){return f.Zero(e,t)},f.One=function(e,t){return f.Fill(e,t,1)},f.Ones=function(e,t){return f.One(e,t)},e.exports=f},function(e,t){function n(e,t,n){this.shortMessage=t||"",this.longMessage=n||"",this.rawError=e||"",this.message="gl-shader: "+(t||e||"")+(n?"\n"+n:""),this.stack=(new Error).stack}n.prototype=new Error,n.prototype.name="GLError",n.prototype.constructor=n,e.exports=n},function(e,t,n){"use strict";var r,i=n(12),o=n(4),a=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=function(e){function t(t){var n=e.call(this,t)||this;return n.type="SpotLight",n.declaration="\n    struct SpotLight {\n      vec3 position;\n      vec3 direction;\n      \n      float constant;\n      float linear;\n      float quadratic;  \n\n      vec3 ambient;\n      vec3 diffuse;\n      vec3 specular;\n\n      float angle;\n      float blur;\n      float exponent;\n    };\n\n    vec3 calcSpotLight(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir, sampler2D shadowMap, vec4 positionFromLight)\n    {\n      vec3 lightDir = normalize(light.position - fragPos);\n      // diffuse shading\n      float diff = max(dot(normal, lightDir), 0.0);\n      // specular shading\n      vec3 reflectDir = reflect(-lightDir, normal);\n      float spec = pow(max(dot(viewDir, reflectDir), 0.0), u_Shininess);\n      // attenuation\n      float distance = length(light.position - fragPos);\n      float attenuation = 1.0 / (light.constant + light.linear * distance + \n              light.quadratic * (distance * distance));    \n\n      vec3 ambient = light.ambient * u_Diffuse;\n      vec3 diffuse = light.diffuse * diff * u_Diffuse;\n      vec3 specular = light.specular * spec * u_Specular;\n\n      float spotEffect = dot(normalize(light.direction), -lightDir);\n      float spotCosCutoff = cos(light.angle / 180.0 * PI);\n      float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);\n      float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);\n      if (spotEffect > spotCosCutoff) {\n        spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);\n      } else {\n        spotEffect = 0.0;\n      }\n\n      float shadowFactor = calcShadow(shadowMap, positionFromLight, lightDir, normal);\n      return ambient + attenuation * shadowFactor * (spotEffect * diffuse + specular);\n    }\n  ",n.direction=n.position,n.angle=14,n.exponent=40,n.blur=5,Object.assign(n,t),n}return a(t,e),t.prototype.setUniforms=function(t,n,r){var i;e.prototype.setUniforms.call(this,t,n,r),Object(o.a)(t,n,((i={})[r+".position"]=this.position,i[r+".direction"]=this.direction,i[r+".ambient"]=this.model.ambient,i[r+".diffuse"]=this.model.diffuse,i[r+".specular"]=this.model.specular,i[r+".constant"]=this.model.attenuation.constant,i[r+".linear"]=this.model.attenuation.linear,i[r+".quadratic"]=this.model.attenuation.quadratic,i[r+".angle"]=this.angle,i[r+".blur"]=this.blur,i[r+".exponent"]=this.exponent,i))},t}(i.a);t.a=s},function(e,t,n){"use strict";var r={constant:1,linear:0,quadratic:0},i=function(){return function(e){this.ambient=$V([.2,.2,.2]),this.diffuse=$V([1,1,1]),this.specular=$V([1,1,1]),Object.assign(this,e),this.attenuation=Object.assign({},r,e.attenuation)}}();t.a=i},function(e,t,n){"use strict";var r=n(0),i=n(47),o=n.n(i),a=n(2),s=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},u=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(e,t){return function(n,r){t(n,r,e)}},l=0,f=function(){function e(e,t,n){this.inited=!1,this.postProcesses=[],this.renderer=e,this.scene=t,this.camera=n,this.id=l++}return e.prototype.init=function(e){this.gl=e,this.initShaders(),this.inited=!0},e.prototype.initShaders=function(){var e=this,t=this.generateShaders(),n=t.vertexShader,r=t.fragmentShader;this.shader=o()(this.gl,{vertex:n,fragment:r}),this.postProcesses.forEach(function(t){return t.init(e.gl)})},e.prototype.initFramebufferObject=function(e,t){var n,r,i,o=this.gl,a=function(){return n&&o.deleteFramebuffer(n),r&&o.deleteTexture(r),i&&o.deleteRenderbuffer(i),null};if(!(n=o.createFramebuffer()))return console.log("Failed to create frame buffer object"),a();if(!(r=o.createTexture()))return console.log("Failed to create texture object"),a();if(o.bindTexture(o.TEXTURE_2D,r),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,e,t,0,o.RGBA,o.UNSIGNED_BYTE,null),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.NEAREST),!(i=o.createRenderbuffer()))return console.log("Failed to create renderbuffer object"),a();o.bindRenderbuffer(o.RENDERBUFFER,i),o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_COMPONENT16,e,t),o.bindFramebuffer(o.FRAMEBUFFER,n),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,r,0),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,i);var s=o.checkFramebufferStatus(o.FRAMEBUFFER);return o.FRAMEBUFFER_COMPLETE!==s?(console.log("Frame buffer object is incomplete: "+s.toString()),a()):(o.bindFramebuffer(o.FRAMEBUFFER,null),o.bindTexture(o.TEXTURE_2D,null),o.bindRenderbuffer(o.RENDERBUFFER,null),{framebuffer:n,texture:r})},e.prototype.activate=function(){this.shader.bind()},e.prototype.deactivate=function(){this.shader.dispose()},e.prototype.addPostProcess=function(e){this.postProcesses.push(e)},e.prototype.removePostProcess=function(e){for(var t=0;t<this.postProcesses.length;t++)if(this.postProcesses[t].id===e.id)return void this.postProcesses.splice(t,1)},e=s([Object(r.injectable)(),c(0,Object(r.inject)(a.a.IRendererService)),c(1,Object(r.inject)(a.a.ISceneService)),c(2,Object(r.inject)(a.a.ICameraService)),u("design:paramtypes",[Object,Object,Object])],e)}();t.a=f},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var r=n(13),i=n(18),o=n(31),a=n(14);function s(){}s.prototype={eql:function(e){return this.isParallelTo(e)&&this.contains(e.anchor)},dup:function(){return s.create(this.anchor,this.direction)},translate:function(e){var t=e.elements||e;return s.create([this.anchor.elements[0]+t[0],this.anchor.elements[1]+t[1],this.anchor.elements[2]+(t[2]||0)],this.direction)},isParallelTo:function(e){if(e.normal||e.start&&e.end)return e.isParallelTo(this);var t=this.direction.angleFrom(e.direction);return Math.abs(t)<=a.precision||Math.abs(t-Math.PI)<=a.precision},distanceFrom:function(e){if(e.normal||e.start&&e.end)return e.distanceFrom(this);if(e.direction){if(this.isParallelTo(e))return this.distanceFrom(e.anchor);var t=this.direction.cross(e.direction).toUnitVector().elements,n=this.anchor.elements,r=e.anchor.elements;return Math.abs((n[0]-r[0])*t[0]+(n[1]-r[1])*t[1]+(n[2]-r[2])*t[2])}var i=e.elements||e,o=(n=this.anchor.elements,this.direction.elements),a=i[0]-n[0],s=i[1]-n[1],u=(i[2]||0)-n[2],c=Math.sqrt(a*a+s*s+u*u);if(0===c)return 0;var l=(a*o[0]+s*o[1]+u*o[2])/c,f=1-l*l;return Math.abs(c*Math.sqrt(f<0?0:f))},contains:function(e){if(e.start&&e.end)return this.contains(e.start)&&this.contains(e.end);var t=this.distanceFrom(e);return null!==t&&t<=a.precision},positionOf:function(e){if(!this.contains(e))return null;var t=e.elements||e,n=this.anchor.elements,r=this.direction.elements;return(t[0]-n[0])*r[0]+(t[1]-n[1])*r[1]+((t[2]||0)-n[2])*r[2]},liesIn:function(e){return e.contains(this)},intersects:function(e){return e.normal?e.intersects(this):!this.isParallelTo(e)&&this.distanceFrom(e)<=a.precision},intersectionWith:function(e){if(e.normal||e.start&&e.end)return e.intersectionWith(this);if(!this.intersects(e))return null;var t=this.anchor.elements,n=this.direction.elements,i=e.anchor.elements,o=e.direction.elements,a=n[0],s=n[1],u=n[2],c=o[0],l=o[1],f=o[2],h=t[0]-i[0],d=t[1]-i[1],p=t[2]-i[2],_=c*c+l*l+f*f,m=a*c+s*l+u*f,v=((-a*h-s*d-u*p)*_/(a*a+s*s+u*u)+m*(c*h+l*d+f*p))/(_-m*m);return r.create([t[0]+v*a,t[1]+v*s,t[2]+v*u])},pointClosestTo:function(e){if(e.start&&e.end)return null===(h=e.pointClosestTo(this))?null:this.pointClosestTo(h);if(e.direction){if(this.intersects(e))return this.intersectionWith(e);if(this.isParallelTo(e))return null;var t=this.direction.elements,n=e.direction.elements,i=t[0],a=t[1],s=t[2],u=n[0],c=n[1],l=n[2],f=[(v=s*u-i*l)*l-(g=i*c-a*u)*c,g*u-(y=a*l-s*c)*l,y*c-v*u];return(h=o.create(e.anchor,f)).intersectionWith(this)}var h=e.elements||e;if(this.contains(h))return r.create(h);var d=this.anchor.elements,p=(i=(t=this.direction.elements)[0],a=t[1],s=t[2],d[0]),_=d[1],m=d[2],v=i*(h[1]-_)-a*(h[0]-p),g=a*((h[2]||0)-m)-s*(h[1]-_),y=s*(h[0]-p)-i*((h[2]||0)-m),b=r.create([a*v-s*y,s*g-i*v,i*y-a*g]),E=this.distanceFrom(h)/b.modulus();return r.create([h[0]+b.elements[0]*E,h[1]+b.elements[1]*E,(h[2]||0)+b.elements[2]*E])},rotate:function(e,t){void 0===t.direction&&(t=s.create(t.to3D(),r.k));var n=i.Rotation(e,t.direction).elements,o=t.pointClosestTo(this.anchor).elements,a=this.anchor.elements,u=this.direction.elements,c=o[0],l=o[1],f=o[2],h=a[0]-c,d=a[1]-l,p=a[2]-f;return s.create([c+n[0][0]*h+n[0][1]*d+n[0][2]*p,l+n[1][0]*h+n[1][1]*d+n[1][2]*p,f+n[2][0]*h+n[2][1]*d+n[2][2]*p],[n[0][0]*u[0]+n[0][1]*u[1]+n[0][2]*u[2],n[1][0]*u[0]+n[1][1]*u[1]+n[1][2]*u[2],n[2][0]*u[0]+n[2][1]*u[1]+n[2][2]*u[2]])},reverse:function(){return s.create(this.anchor,this.direction.x(-1))},reflectionIn:function(e){if(e.normal){var t=this.anchor.elements,n=this.direction.elements,r=t[0],i=t[1],o=t[2],a=n[0],u=n[1],c=n[2],l=this.anchor.reflectionIn(e).elements,f=r+a,h=i+u,d=o+c,p=e.pointClosestTo([f,h,d]).elements,_=[p[0]+(p[0]-f)-l[0],p[1]+(p[1]-h)-l[1],p[2]+(p[2]-d)-l[2]];return s.create(l,_)}if(e.direction)return this.rotate(Math.PI,e);var m=e.elements||e;return s.create(this.anchor.reflectionIn([m[0],m[1],m[2]||0]),this.direction)},setVectors:function(e,t){if(e=r.create(e),t=r.create(t),2==e.elements.length&&e.elements.push(0),2==t.elements.length&&t.elements.push(0),e.elements.length>3||t.elements.length>3)return null;var n=t.modulus();return 0===n?null:(this.anchor=e,this.direction=r.create([t.elements[0]/n,t.elements[1]/n,t.elements[2]/n]),this)}},s.create=function(e,t){return(new s).setVectors(e,t)},s.X=s.create(r.Zero(3),r.i),s.Y=s.create(r.Zero(3),r.j),s.Z=s.create(r.Zero(3),r.k),e.exports=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(26),i=function(){function e(e){this._binding=e}return e.prototype.onActivation=function(e){return this._binding.onActivation=e,new r.BindingWhenSyntax(this._binding)},e}();t.BindingOnSyntax=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(25),i=n(38),o=function(){function e(e){this._binding=e}return e.prototype.when=function(e){return this._binding.constraint=e,new r.BindingOnSyntax(this._binding)},e.prototype.whenTargetNamed=function(e){return this._binding.constraint=i.namedConstraint(e),new r.BindingOnSyntax(this._binding)},e.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){return null!==e.target&&!e.target.isNamed()&&!e.target.isTagged()},new r.BindingOnSyntax(this._binding)},e.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=i.taggedConstraint(e)(t),new r.BindingOnSyntax(this._binding)},e.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return i.typeConstraint(e)(t.parentRequest)},new r.BindingOnSyntax(this._binding)},e.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return i.namedConstraint(e)(t.parentRequest)},new r.BindingOnSyntax(this._binding)},e.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(n){return i.taggedConstraint(e)(t)(n.parentRequest)},new r.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return i.traverseAncerstors(t,i.typeConstraint(e))},new r.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return!i.traverseAncerstors(t,i.typeConstraint(e))},new r.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return i.traverseAncerstors(t,i.namedConstraint(e))},new r.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return!i.traverseAncerstors(t,i.namedConstraint(e))},new r.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(n){return i.traverseAncerstors(n,i.taggedConstraint(e)(t))},new r.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(n){return!i.traverseAncerstors(n,i.taggedConstraint(e)(t))},new r.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return i.traverseAncerstors(t,e)},new r.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return!i.traverseAncerstors(t,e)},new r.BindingOnSyntax(this._binding)},e}();t.BindingWhenSyntax=o},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(1),i=function(){function e(e){Object.assign(this,e),this.modelMatrix=r.Matrix.I(4)}return e.prototype.init=function(){this.setVertices(),this.setModelMatrix()},e.prototype.translate=function(e){return this.modelMatrix=r.Matrix.Translation(e).x(this.modelMatrix),this},e.prototype.scale=function(e){return this.modelMatrix=r.Matrix.Diagonal(e.elements.concat(1)).x(this.modelMatrix),this},e.prototype.rotate=function(e,t){return this.modelMatrix=r.Matrix.Rotation(e,t).ensure4x4().x(this.modelMatrix),this},e.prototype.draw=function(e){var t,n=e.createBuffer();if(!n)return console.log("Failed to create the buffer object"),!1;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW),4===this.indices.BYTES_PER_ELEMENT?t=e.UNSIGNED_INT:2===this.indices.BYTES_PER_ELEMENT?t=e.UNSIGNED_SHORT:1===this.indices.BYTES_PER_ELEMENT&&(t=e.UNSIGNED_BYTE),e.drawElements(e.TRIANGLES,this.indices.length,t,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)},e}()},function(e,t,n){var r;
/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */
/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */
!function(i,o,a,s){"use strict";var u,c=["","webkit","Moz","MS","ms","o"],l=o.createElement("div"),f="function",h=Math.round,d=Math.abs,p=Date.now;function _(e,t,n){return setTimeout(T(e,n),t)}function m(e,t,n){return!!Array.isArray(e)&&(v(e,n[t],n),!0)}function v(e,t,n){var r;if(e)if(e.forEach)e.forEach(t,n);else if(e.length!==s)for(r=0;r<e.length;)t.call(n,e[r],r,e),r++;else for(r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r,e)}function g(e,t,n){var r="DEPRECATED METHOD: "+t+"\n"+n+" AT \n";return function(){var t=new Error("get-stack-trace"),n=t&&t.stack?t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=i.console&&(i.console.warn||i.console.log);return o&&o.call(i.console,r,n),e.apply(this,arguments)}}u="function"!=typeof Object.assign?function(e){if(e===s||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(r!==s&&null!==r)for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}return t}:Object.assign;var y=g(function(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;)(!n||n&&e[r[i]]===s)&&(e[r[i]]=t[r[i]]),i++;return e},"extend","Use `assign`."),b=g(function(e,t){return y(e,t,!0)},"merge","Use `assign`.");function E(e,t,n){var r,i=t.prototype;(r=e.prototype=Object.create(i)).constructor=e,r._super=i,n&&u(r,n)}function T(e,t){return function(){return e.apply(t,arguments)}}function w(e,t){return typeof e==f?e.apply(t&&t[0]||s,t):e}function A(e,t){return e===s?t:e}function x(e,t,n){v(R(t),function(t){e.addEventListener(t,n,!1)})}function S(e,t,n){v(R(t),function(t){e.removeEventListener(t,n,!1)})}function O(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function C(e,t){return e.indexOf(t)>-1}function R(e){return e.trim().split(/\s+/g)}function M(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var r=0;r<e.length;){if(n&&e[r][n]==t||!n&&e[r]===t)return r;r++}return-1}function P(e){return Array.prototype.slice.call(e,0)}function I(e,t,n){for(var r=[],i=[],o=0;o<e.length;){var a=t?e[o][t]:e[o];M(i,a)<0&&r.push(e[o]),i[o]=a,o++}return n&&(r=t?r.sort(function(e,n){return e[t]>n[t]}):r.sort()),r}function N(e,t){for(var n,r,i=t[0].toUpperCase()+t.slice(1),o=0;o<c.length;){if((r=(n=c[o])?n+i:t)in e)return r;o++}return s}var D=1;function L(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||i}var F="ontouchstart"in i,U=N(i,"PointerEvent")!==s,k=F&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),j=25,B=1,V=2,X=4,G=8,H=1,z=2,W=4,Y=8,q=16,K=z|W,$=Y|q,Z=K|$,J=["x","y"],Q=["clientX","clientY"];function ee(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){w(e.options.enable,[e])&&n.handler(t)},this.init()}function te(e,t,n){var r=n.pointers.length,i=n.changedPointers.length,o=t&B&&r-i==0,a=t&(X|G)&&r-i==0;n.isFirst=!!o,n.isFinal=!!a,o&&(e.session={}),n.eventType=t,function(e,t){var n=e.session,r=t.pointers,i=r.length;n.firstInput||(n.firstInput=ne(t));i>1&&!n.firstMultiple?n.firstMultiple=ne(t):1===i&&(n.firstMultiple=!1);var o=n.firstInput,a=n.firstMultiple,u=a?a.center:o.center,c=t.center=re(r);t.timeStamp=p(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=se(u,c),t.distance=ae(u,c),function(e,t){var n=t.center,r=e.offsetDelta||{},i=e.prevDelta||{},o=e.prevInput||{};t.eventType!==B&&o.eventType!==X||(i=e.prevDelta={x:o.deltaX||0,y:o.deltaY||0},r=e.offsetDelta={x:n.x,y:n.y});t.deltaX=i.x+(n.x-r.x),t.deltaY=i.y+(n.y-r.y)}(n,t),t.offsetDirection=oe(t.deltaX,t.deltaY);var l=ie(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=l.x,t.overallVelocityY=l.y,t.overallVelocity=d(l.x)>d(l.y)?l.x:l.y,t.scale=a?(f=a.pointers,h=r,ae(h[0],h[1],Q)/ae(f[0],f[1],Q)):1,t.rotation=a?function(e,t){return se(t[1],t[0],Q)+se(e[1],e[0],Q)}(a.pointers,r):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,function(e,t){var n,r,i,o,a=e.lastInterval||t,u=t.timeStamp-a.timeStamp;if(t.eventType!=G&&(u>j||a.velocity===s)){var c=t.deltaX-a.deltaX,l=t.deltaY-a.deltaY,f=ie(u,c,l);r=f.x,i=f.y,n=d(f.x)>d(f.y)?f.x:f.y,o=oe(c,l),e.lastInterval=t}else n=a.velocity,r=a.velocityX,i=a.velocityY,o=a.direction;t.velocity=n,t.velocityX=r,t.velocityY=i,t.direction=o}(n,t);var f,h;var _=e.element;O(t.srcEvent.target,_)&&(_=t.srcEvent.target);t.target=_}(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function ne(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:h(e.pointers[n].clientX),clientY:h(e.pointers[n].clientY)},n++;return{timeStamp:p(),pointers:t,center:re(t),deltaX:e.deltaX,deltaY:e.deltaY}}function re(e){var t=e.length;if(1===t)return{x:h(e[0].clientX),y:h(e[0].clientY)};for(var n=0,r=0,i=0;i<t;)n+=e[i].clientX,r+=e[i].clientY,i++;return{x:h(n/t),y:h(r/t)}}function ie(e,t,n){return{x:t/e||0,y:n/e||0}}function oe(e,t){return e===t?H:d(e)>=d(t)?e<0?z:W:t<0?Y:q}function ae(e,t,n){n||(n=J);var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return Math.sqrt(r*r+i*i)}function se(e,t,n){n||(n=J);var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return 180*Math.atan2(i,r)/Math.PI}ee.prototype={handler:function(){},init:function(){this.evEl&&x(this.element,this.evEl,this.domHandler),this.evTarget&&x(this.target,this.evTarget,this.domHandler),this.evWin&&x(L(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&S(this.element,this.evEl,this.domHandler),this.evTarget&&S(this.target,this.evTarget,this.domHandler),this.evWin&&S(L(this.element),this.evWin,this.domHandler)}};var ue={mousedown:B,mousemove:V,mouseup:X},ce="mousedown",le="mousemove mouseup";function fe(){this.evEl=ce,this.evWin=le,this.pressed=!1,ee.apply(this,arguments)}E(fe,ee,{handler:function(e){var t=ue[e.type];t&B&&0===e.button&&(this.pressed=!0),t&V&&1!==e.which&&(t=X),this.pressed&&(t&X&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}});var he={pointerdown:B,pointermove:V,pointerup:X,pointercancel:G,pointerout:G},de={2:"touch",3:"pen",4:"mouse",5:"kinect"},pe="pointerdown",_e="pointermove pointerup pointercancel";function me(){this.evEl=pe,this.evWin=_e,ee.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}i.MSPointerEvent&&!i.PointerEvent&&(pe="MSPointerDown",_e="MSPointerMove MSPointerUp MSPointerCancel"),E(me,ee,{handler:function(e){var t=this.store,n=!1,r=e.type.toLowerCase().replace("ms",""),i=he[r],o=de[e.pointerType]||e.pointerType,a="touch"==o,s=M(t,e.pointerId,"pointerId");i&B&&(0===e.button||a)?s<0&&(t.push(e),s=t.length-1):i&(X|G)&&(n=!0),s<0||(t[s]=e,this.callback(this.manager,i,{pointers:t,changedPointers:[e],pointerType:o,srcEvent:e}),n&&t.splice(s,1))}});var ve={touchstart:B,touchmove:V,touchend:X,touchcancel:G},ge="touchstart",ye="touchstart touchmove touchend touchcancel";function be(){this.evTarget=ge,this.evWin=ye,this.started=!1,ee.apply(this,arguments)}E(be,ee,{handler:function(e){var t=ve[e.type];if(t===B&&(this.started=!0),this.started){var n=function(e,t){var n=P(e.touches),r=P(e.changedTouches);t&(X|G)&&(n=I(n.concat(r),"identifier",!0));return[n,r]}.call(this,e,t);t&(X|G)&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:e})}}});var Ee={touchstart:B,touchmove:V,touchend:X,touchcancel:G},Te="touchstart touchmove touchend touchcancel";function we(){this.evTarget=Te,this.targetIds={},ee.apply(this,arguments)}E(we,ee,{handler:function(e){var t=Ee[e.type],n=function(e,t){var n=P(e.touches),r=this.targetIds;if(t&(B|V)&&1===n.length)return r[n[0].identifier]=!0,[n,n];var i,o,a=P(e.changedTouches),s=[],u=this.target;if(o=n.filter(function(e){return O(e.target,u)}),t===B)for(i=0;i<o.length;)r[o[i].identifier]=!0,i++;i=0;for(;i<a.length;)r[a[i].identifier]&&s.push(a[i]),t&(X|G)&&delete r[a[i].identifier],i++;if(!s.length)return;return[I(o.concat(s),"identifier",!0),s]}.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:e})}});var Ae=2500,xe=25;function Se(){ee.apply(this,arguments);var e=T(this.handler,this);this.touch=new we(this.manager,e),this.mouse=new fe(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function Oe(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var r=this.lastTouches;setTimeout(function(){var e=r.indexOf(n);e>-1&&r.splice(e,1)},Ae)}}E(Se,ee,{handler:function(e,t,n){var r="touch"==n.pointerType,i="mouse"==n.pointerType;if(!(i&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(r)(function(e,t){e&B?(this.primaryTouch=t.changedPointers[0].identifier,Oe.call(this,t)):e&(X|G)&&Oe.call(this,t)}).call(this,t,n);else if(i&&function(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var i=this.lastTouches[r],o=Math.abs(t-i.x),a=Math.abs(n-i.y);if(o<=xe&&a<=xe)return!0}return!1}.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Ce=N(l.style,"touchAction"),Re=Ce!==s,Me="auto",Pe="manipulation",Ie="none",Ne="pan-x",De="pan-y",Le=function(){if(!Re)return!1;var e={},t=i.CSS&&i.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(n){e[n]=!t||i.CSS.supports("touch-action",n)}),e}();function Fe(e,t){this.manager=e,this.set(t)}Fe.prototype={set:function(e){"compute"==e&&(e=this.compute()),Re&&this.manager.element.style&&Le[e]&&(this.manager.element.style[Ce]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return v(this.manager.recognizers,function(t){w(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),function(e){if(C(e,Ie))return Ie;var t=C(e,Ne),n=C(e,De);if(t&&n)return Ie;if(t||n)return t?Ne:De;if(C(e,Pe))return Pe;return Me}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var r=this.actions,i=C(r,Ie)&&!Le[Ie],o=C(r,De)&&!Le[De],a=C(r,Ne)&&!Le[Ne];if(i){var s=1===e.pointers.length,u=e.distance<2,c=e.deltaTime<250;if(s&&u&&c)return}if(!a||!o)return i||o&&n&K||a&&n&$?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var Ue=1,ke=2,je=4,Be=8,Ve=Be,Xe=16;function Ge(e){this.options=u({},this.defaults,e||{}),this.id=D++,this.manager=null,this.options.enable=A(this.options.enable,!0),this.state=Ue,this.simultaneous={},this.requireFail=[]}function He(e){return e&Xe?"cancel":e&Be?"end":e&je?"move":e&ke?"start":""}function ze(e){return e==q?"down":e==Y?"up":e==z?"left":e==W?"right":""}function We(e,t){var n=t.manager;return n?n.get(e):e}function Ye(){Ge.apply(this,arguments)}function qe(){Ye.apply(this,arguments),this.pX=null,this.pY=null}function Ke(){Ye.apply(this,arguments)}function $e(){Ge.apply(this,arguments),this._timer=null,this._input=null}function Ze(){Ye.apply(this,arguments)}function Je(){Ye.apply(this,arguments)}function Qe(){Ge.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function et(e,t){return(t=t||{}).recognizers=A(t.recognizers,et.defaults.preset),new tt(e,t)}Ge.prototype={defaults:{},set:function(e){return u(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(m(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=We(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return m(e,"dropRecognizeWith",this)?this:(e=We(e,this),delete this.simultaneous[e.id],this)},requireFailure:function(e){if(m(e,"requireFailure",this))return this;var t=this.requireFail;return-1===M(t,e=We(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(m(e,"dropRequireFailure",this))return this;e=We(e,this);var t=M(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,n=this.state;function r(n){t.manager.emit(n,e)}n<Be&&r(t.options.event+He(n)),r(t.options.event),e.additionalEvent&&r(e.additionalEvent),n>=Be&&r(t.options.event+He(n))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=32},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(32|Ue)))return!1;e++}return!0},recognize:function(e){var t=u({},e);if(!w(this.options.enable,[this,t]))return this.reset(),void(this.state=32);this.state&(Ve|Xe|32)&&(this.state=Ue),this.state=this.process(t),this.state&(ke|je|Be|Xe)&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},E(Ye,Ge,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,r=t&(ke|je),i=this.attrTest(e);return r&&(n&G||!i)?t|Xe:r||i?n&X?t|Be:t&ke?t|je:ke:32}}),E(qe,Ye,{defaults:{event:"pan",threshold:10,pointers:1,direction:Z},getTouchAction:function(){var e=this.options.direction,t=[];return e&K&&t.push(De),e&$&&t.push(Ne),t},directionTest:function(e){var t=this.options,n=!0,r=e.distance,i=e.direction,o=e.deltaX,a=e.deltaY;return i&t.direction||(t.direction&K?(i=0===o?H:o<0?z:W,n=o!=this.pX,r=Math.abs(e.deltaX)):(i=0===a?H:a<0?Y:q,n=a!=this.pY,r=Math.abs(e.deltaY))),e.direction=i,n&&r>t.threshold&&i&t.direction},attrTest:function(e){return Ye.prototype.attrTest.call(this,e)&&(this.state&ke||!(this.state&ke)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=ze(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),E(Ke,Ye,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ie]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&ke)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),E($e,Ge,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Me]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime>t.time;if(this._input=e,!r||!n||e.eventType&(X|G)&&!i)this.reset();else if(e.eventType&B)this.reset(),this._timer=_(function(){this.state=Ve,this.tryEmit()},t.time,this);else if(e.eventType&X)return Ve;return 32},reset:function(){clearTimeout(this._timer)},emit:function(e){this.state===Ve&&(e&&e.eventType&X?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=p(),this.manager.emit(this.options.event,this._input)))}}),E(Ze,Ye,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ie]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||this.state&ke)}}),E(Je,Ye,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:K|$,pointers:1},getTouchAction:function(){return qe.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return n&(K|$)?t=e.overallVelocity:n&K?t=e.overallVelocityX:n&$&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&d(t)>this.options.velocity&&e.eventType&X},emit:function(e){var t=ze(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),E(Qe,Ge,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Pe]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime<t.time;if(this.reset(),e.eventType&B&&0===this.count)return this.failTimeout();if(r&&i&&n){if(e.eventType!=X)return this.failTimeout();var o=!this.pTime||e.timeStamp-this.pTime<t.interval,a=!this.pCenter||ae(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,a&&o?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=_(function(){this.state=Ve,this.tryEmit()},t.interval,this),ke):Ve}return 32},failTimeout:function(){return this._timer=_(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Ve&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),et.VERSION="2.0.7",et.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[Ze,{enable:!1}],[Ke,{enable:!1},["rotate"]],[Je,{direction:K}],[qe,{direction:K},["swipe"]],[Qe],[Qe,{event:"doubletap",taps:2},["tap"]],[$e]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function tt(e,t){var n;this.options=u({},et.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new((n=this).options.inputClass||(U?me:k?we:F?Se:fe))(n,te),this.touchAction=new Fe(this,this.options.touchAction),nt(this,!0),v(this.options.recognizers,function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])},this)}function nt(e,t){var n,r=e.element;r.style&&(v(e.options.cssProps,function(i,o){n=N(r.style,o),t?(e.oldCssProps[n]=r.style[n],r.style[n]=i):r.style[n]=e.oldCssProps[n]||""}),t||(e.oldCssProps={}))}tt.prototype={set:function(e){return u(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var n;this.touchAction.preventDefaults(e);var r=this.recognizers,i=t.curRecognizer;(!i||i&&i.state&Ve)&&(i=t.curRecognizer=null);for(var o=0;o<r.length;)n=r[o],2===t.stopped||i&&n!=i&&!n.canRecognizeWith(i)?n.reset():n.recognize(e),!i&&n.state&(ke|je|Be)&&(i=t.curRecognizer=n),o++}},get:function(e){if(e instanceof Ge)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(m(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(m(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=M(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(e!==s&&t!==s){var n=this.handlers;return v(R(e),function(e){n[e]=n[e]||[],n[e].push(t)}),this}},off:function(e,t){if(e!==s){var n=this.handlers;return v(R(e),function(e){t?n[e]&&n[e].splice(M(n[e],t),1):delete n[e]}),this}},emit:function(e,t){this.options.domEvents&&function(e,t){var n=o.createEvent("Event");n.initEvent(e,!0,!0),n.gesture=t,t.target.dispatchEvent(n)}(e,t);var n=this.handlers[e]&&this.handlers[e].slice();if(n&&n.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var r=0;r<n.length;)n[r](t),r++}},destroy:function(){this.element&&nt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},u(et,{INPUT_START:B,INPUT_MOVE:V,INPUT_END:X,INPUT_CANCEL:G,STATE_POSSIBLE:Ue,STATE_BEGAN:ke,STATE_CHANGED:je,STATE_ENDED:Be,STATE_RECOGNIZED:Ve,STATE_CANCELLED:Xe,STATE_FAILED:32,DIRECTION_NONE:H,DIRECTION_LEFT:z,DIRECTION_RIGHT:W,DIRECTION_UP:Y,DIRECTION_DOWN:q,DIRECTION_HORIZONTAL:K,DIRECTION_VERTICAL:$,DIRECTION_ALL:Z,Manager:tt,Input:ee,TouchAction:Fe,TouchInput:we,MouseInput:fe,PointerEventInput:me,TouchMouseInput:Se,SingleTouchInput:be,Recognizer:Ge,AttrRecognizer:Ye,Tap:Qe,Pan:qe,Swipe:Je,Pinch:Ke,Rotate:Ze,Press:$e,on:x,off:S,each:v,merge:b,extend:y,assign:u,inherit:E,bindFn:T,prefixed:N}),(void 0!==i?i:"undefined"!=typeof self?self:{}).Hammer=et,(r=function(){return et}.call(t,n,t,e))===s||(e.exports=r)}(window,document)},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(1);function i(e){return 0==(e&e-1)}r.Matrix.Translation=function(e){var t;if(2==e.elements.length)return(t=r.Matrix.I(3)).elements[2][0]=e.elements[0],t.elements[2][1]=e.elements[1],t;if(3==e.elements.length)return(t=r.Matrix.I(4)).elements[0][3]=e.elements[0],t.elements[1][3]=e.elements[1],t.elements[2][3]=e.elements[2],t;throw"Invalid length for Translation"},r.Matrix.prototype.flatten=function(){var e=[];if(0==this.elements.length)return[];for(var t=0;t<this.elements[0].length;t++)for(var n=0;n<this.elements.length;n++)e.push(this.elements[n][t]);return e},r.Matrix.prototype.ensure4x4=function(){if(4==this.elements.length&&4==this.elements[0].length)return this;if(this.elements.length>4||this.elements[0].length>4)return null;for(var e=0;e<this.elements.length;e++)for(var t=this.elements[e].length;t<4;t++)e==t?this.elements[e].push(1):this.elements[e].push(0);for(e=this.elements.length;e<4;e++)0==e?this.elements.push([1,0,0,0]):1==e?this.elements.push([0,1,0,0]):2==e?this.elements.push([0,0,1,0]):3==e&&this.elements.push([0,0,0,1]);return this},r.Matrix.prototype.make3x3=function(){return 4!=this.elements.length||4!=this.elements[0].length?null:r.Matrix.create([[this.elements[0][0],this.elements[0][1],this.elements[0][2]],[this.elements[1][0],this.elements[1][1],this.elements[1][2]],[this.elements[2][0],this.elements[2][1],this.elements[2][2]]])},r.Vector.prototype.ensure3=function(){return r.Vector.create([this.elements[0],this.elements[1],this.elements[2]])},r.Vector.prototype.ensure4=function(e){return r.Vector.create([this.elements[0],this.elements[1],this.elements[2],e])},r.Vector.prototype.divideByW=function(){for(var e=this.elements[this.elements.length-1],t=[],n=0;n<this.elements.length;n++)t.push(this.elements[n]/e);return r.Vector.create(t)},r.Vector.prototype.componentDivide=function(e){if(this.elements.length!=e.elements.length)return null;for(var t=[],n=0;n<this.elements.length;n++)t.push(this.elements[n]/e.elements[n]);return r.Vector.create(t)},r.Vector.min=function(e,t){if(e.elements.length!=t.elements.length)return null;for(var n=[],i=0;i<e.elements.length;i++)n.push(Math.min(e.elements[i],t.elements[i]));return r.Vector.create(n)},r.Vector.max=function(e,t){if(e.elements.length!=t.elements.length)return null;for(var n=[],i=0;i<e.elements.length;i++)n.push(Math.max(e.elements[i],t.elements[i]));return r.Vector.create(n)},r.Vector.prototype.minComponent=function(){for(var e=Number.MAX_VALUE,t=0;t<this.elements.length;t++)e=Math.min(e,this.elements[t]);return e},r.Vector.prototype.maxComponent=function(){for(var e=-Number.MAX_VALUE,t=0;t<this.elements.length;t++)e=Math.max(e,this.elements[t]);return e}},function(e,t,n){"use strict";var r=n(17),i=function(){function e(e){this.material=new r.a({}),this.mvpMatrixFromLight={},Object.assign(this,e)}return e.prototype.init=function(){var e=this;this.geometry.init(),this.colorAttributeArray=this.geometry.vertices.map(function(t,n){return e.material.color.e(n%3+1)})},e}();t.a=i},function(e,t,n){var r=n(13),i=n(18),o=n(24),a=n(14);function s(){}s.prototype={eql:function(e){return this.contains(e.anchor)&&this.isParallelTo(e)},dup:function(){return s.create(this.anchor,this.normal)},translate:function(e){var t=e.elements||e;return s.create([this.anchor.elements[0]+t[0],this.anchor.elements[1]+t[1],this.anchor.elements[2]+(t[2]||0)],this.normal)},isParallelTo:function(e){var t;return e.normal?(t=this.normal.angleFrom(e.normal),Math.abs(t)<=a.precision||Math.abs(Math.PI-t)<=a.precision):e.direction?this.normal.isPerpendicularTo(e.direction):null},isPerpendicularTo:function(e){var t=this.normal.angleFrom(e.normal);return Math.abs(Math.PI/2-t)<=a.precision},distanceFrom:function(e){if(this.intersects(e)||this.contains(e))return 0;if(e.anchor){var t=this.anchor.elements,n=e.anchor.elements,r=this.normal.elements;return Math.abs((t[0]-n[0])*r[0]+(t[1]-n[1])*r[1]+(t[2]-n[2])*r[2])}var i=e.elements||e;t=this.anchor.elements,r=this.normal.elements;return Math.abs((t[0]-i[0])*r[0]+(t[1]-i[1])*r[1]+(t[2]-(i[2]||0))*r[2])},contains:function(e){if(e.normal)return null;if(e.direction)return this.contains(e.anchor)&&this.contains(e.anchor.add(e.direction));var t=e.elements||e,n=this.anchor.elements,r=this.normal.elements;return Math.abs(r[0]*(n[0]-t[0])+r[1]*(n[1]-t[1])+r[2]*(n[2]-(t[2]||0)))<=a.precision},intersects:function(e){return void 0===e.direction&&void 0===e.normal?null:!this.isParallelTo(e)},intersectionWith:function(e){if(!this.intersects(e))return null;if(e.direction){var t=e.anchor.elements,n=e.direction.elements,a=this.anchor.elements,s=((c=this.normal.elements)[0]*(a[0]-t[0])+c[1]*(a[1]-t[1])+c[2]*(a[2]-t[2]))/(c[0]*n[0]+c[1]*n[1]+c[2]*n[2]);return r.create([t[0]+n[0]*s,t[1]+n[1]*s,t[2]+n[2]*s])}if(e.normal){for(var u=this.normal.cross(e.normal).toUnitVector(),c=this.normal.elements,l=(t=this.anchor.elements,e.normal.elements),f=e.anchor.elements,h=i.Zero(2,2),d=0;h.isSingular();)d++,h=i.create([[c[d%3],c[(d+1)%3]],[l[d%3],l[(d+1)%3]]]);for(var p=h.inverse().elements,_=c[0]*t[0]+c[1]*t[1]+c[2]*t[2],m=l[0]*f[0]+l[1]*f[1]+l[2]*f[2],v=[p[0][0]*_+p[0][1]*m,p[1][0]*_+p[1][1]*m],g=[],y=1;y<=3;y++)g.push(d==y?0:v[(y+(5-d)%3)%3]);return o.create(g,u)}},pointClosestTo:function(e){var t=e.elements||e,n=this.anchor.elements,i=this.normal.elements,o=(n[0]-t[0])*i[0]+(n[1]-t[1])*i[1]+(n[2]-(t[2]||0))*i[2];return r.create([t[0]+i[0]*o,t[1]+i[1]*o,(t[2]||0)+i[2]*o])},rotate:function(e,t){var n=e.determinant?e.elements:i.Rotation(e,t.direction).elements,r=t.pointClosestTo(this.anchor).elements,o=this.anchor.elements,a=this.normal.elements,u=r[0],c=r[1],l=r[2],f=o[0]-u,h=o[1]-c,d=o[2]-l;return s.create([u+n[0][0]*f+n[0][1]*h+n[0][2]*d,c+n[1][0]*f+n[1][1]*h+n[1][2]*d,l+n[2][0]*f+n[2][1]*h+n[2][2]*d],[n[0][0]*a[0]+n[0][1]*a[1]+n[0][2]*a[2],n[1][0]*a[0]+n[1][1]*a[1]+n[1][2]*a[2],n[2][0]*a[0]+n[2][1]*a[1]+n[2][2]*a[2]])},reflectionIn:function(e){if(e.normal){var t=this.anchor.elements,n=this.normal.elements,r=t[0],i=t[1],o=t[2],a=n[0],u=n[1],c=n[2],l=this.anchor.reflectionIn(e).elements,f=r+a,h=i+u,d=o+c,p=e.pointClosestTo([f,h,d]).elements,_=[p[0]+(p[0]-f)-l[0],p[1]+(p[1]-h)-l[1],p[2]+(p[2]-d)-l[2]];return s.create(l,_)}if(e.direction)return this.rotate(Math.PI,e);var m=e.elements||e;return s.create(this.anchor.reflectionIn([m[0],m[1],m[2]||0]),this.normal)},setVectors:function(e,t,n){if(null===(e=(e=r.create(e)).to3D()))return null;if(null===(t=(t=r.create(t)).to3D()))return null;if(void 0===n)n=null;else if(null===(n=(n=r.create(n)).to3D()))return null;var i,o,a=e.elements[0],s=e.elements[1],u=e.elements[2],c=t.elements[0],l=t.elements[1],f=t.elements[2];if(null!==n){var h=n.elements[0],d=n.elements[1],p=n.elements[2];if(0===(o=(i=r.create([(l-s)*(p-u)-(f-u)*(d-s),(f-u)*(h-a)-(c-a)*(p-u),(c-a)*(d-s)-(l-s)*(h-a)])).modulus()))return null;i=r.create([i.elements[0]/o,i.elements[1]/o,i.elements[2]/o])}else{if(0===(o=Math.sqrt(c*c+l*l+f*f)))return null;i=r.create([t.elements[0]/o,t.elements[1]/o,t.elements[2]/o])}return this.anchor=e,this.normal=i,this}},s.create=function(e,t,n){return(new s).setVectors(e,t,n)},s.XY=s.create(r.Zero(3),r.k),s.YZ=s.create(r.Zero(3),r.i),s.ZX=s.create(r.Zero(3),r.j),s.YX=s.XY,s.ZY=s.YZ,s.XZ=s.ZX,s.fromPoints=function(e){var t,n,i,o,u,c,l,f,h,d,p=e.length,_=[],m=r.Zero(3);for(t=0;t<p;t++){if(null===(n=r.create(e[t]).to3D()))return null;if(_.push(n),(i=_.length)>2){if(u=_[i-1].elements,c=_[i-2].elements,l=_[i-3].elements,o=r.create([(u[1]-c[1])*(l[2]-c[2])-(u[2]-c[2])*(l[1]-c[1]),(u[2]-c[2])*(l[0]-c[0])-(u[0]-c[0])*(l[2]-c[2]),(u[0]-c[0])*(l[1]-c[1])-(u[1]-c[1])*(l[0]-c[0])]).toUnitVector(),i>3&&null!==(h=o.angleFrom(d))&&!(Math.abs(h)<=a.precision||Math.abs(h-Math.PI)<=a.precision))return null;m=m.add(o),d=o}}return u=_[1].elements,c=_[0].elements,l=_[i-1].elements,f=_[i-2].elements,m=m.add(r.create([(u[1]-c[1])*(l[2]-c[2])-(u[2]-c[2])*(l[1]-c[1]),(u[2]-c[2])*(l[0]-c[0])-(u[0]-c[0])*(l[2]-c[2]),(u[0]-c[0])*(l[1]-c[1])-(u[1]-c[1])*(l[0]-c[0])]).toUnitVector()).add(r.create([(c[1]-l[1])*(f[2]-l[2])-(c[2]-l[2])*(f[1]-l[1]),(c[2]-l[2])*(f[0]-l[0])-(c[0]-l[0])*(f[2]-l[2]),(c[0]-l[0])*(f[1]-l[1])-(c[1]-l[1])*(f[0]-l[0])]).toUnitVector()),s.create(_[0],m)},e.exports=s},function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var u,c=[],l=!1,f=-1;function h(){l&&u&&(l=!1,u.length?c=u.concat(c):f=-1,c.length&&d())}function d(){if(!l){var e=s(h);l=!0;for(var t=c.length;t;){for(u=c,c=[];++f<t;)u&&u[f].run();f=-1,t=c.length}u=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function _(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new p(e,t)),1!==c.length||l||s(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=_,i.addListener=_,i.once=_,i.off=_,i.removeListener=_,i.removeAllListeners=_,i.emit=_,i.prependListener=_,i.prependOnceListener=_,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),i=function(){function e(){}return e.prototype.getConstructorMetadata=function(e){return{compilerGeneratedMetadata:Reflect.getMetadata(r.PARAM_TYPES,e),userGeneratedMetadata:Reflect.getMetadata(r.TAGGED,e)||{}}},e.prototype.getPropertiesMetadata=function(e){return Reflect.getMetadata(r.TAGGED_PROP,e)||[]},e}();t.MetadataReader=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5);t.isStackOverflowExeption=function(e){return e instanceof RangeError||e.message===r.STACK_OVERFLOW}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=n(3),o=n(6),a=n(8),s=function(){function e(e){this._cb=e}return e.prototype.unwrap=function(){return this._cb()},e}();t.LazyServiceIdentifer=s,t.inject=function(e){return function(t,n,s){if(void 0===e)throw new Error(r.UNDEFINED_INJECT_ANNOTATION(t.name));var u=new o.Metadata(i.INJECT_TAG,e);"number"==typeof s?a.tagParameter(t,n,s,u):a.tagProperty(t,n,u)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),i=n(11),o=n(6),a=n(59),s=function(){function e(e,t,n,s){this.id=i.id(),this.type=e,this.serviceIdentifier=n,this.name=new a.QueryableString(t||""),this.metadata=new Array;var u=null;"string"==typeof s?u=new o.Metadata(r.NAMED_TAG,s):s instanceof o.Metadata&&(u=s),null!==u&&this.metadata.push(u)}return e.prototype.hasTag=function(e){for(var t=0,n=this.metadata;t<n.length;t++){if(n[t].key===e)return!0}return!1},e.prototype.isArray=function(){return this.hasTag(r.MULTI_INJECT_TAG)},e.prototype.matchesArray=function(e){return this.matchesTag(r.MULTI_INJECT_TAG)(e)},e.prototype.isNamed=function(){return this.hasTag(r.NAMED_TAG)},e.prototype.isTagged=function(){return this.metadata.some(function(e){return e.key!==r.INJECT_TAG&&e.key!==r.MULTI_INJECT_TAG&&e.key!==r.NAME_TAG&&e.key!==r.UNMANAGED_TAG&&e.key!==r.NAMED_TAG})},e.prototype.isOptional=function(){return this.matchesTag(r.OPTIONAL_TAG)(!0)},e.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(e){return e.key===r.NAMED_TAG})[0]:null},e.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(e){return e.key!==r.INJECT_TAG&&e.key!==r.MULTI_INJECT_TAG&&e.key!==r.NAME_TAG&&e.key!==r.UNMANAGED_TAG&&e.key!==r.NAMED_TAG}):null},e.prototype.matchesNamedTag=function(e){return this.matchesTag(r.NAMED_TAG)(e)},e.prototype.matchesTag=function(e){var t=this;return function(n){for(var r=0,i=t.metadata;r<i.length;r++){var o=i[r];if(o.key===e&&o.value===n)return!0}return!1}},e}();t.Target=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(25),i=n(26),o=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new i.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new r.BindingOnSyntax(this._binding)}return e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e}();t.BindingWhenOnSyntax=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),i=n(6),o=function(e,t){var n=e.parentRequest;return null!==n&&(!!t(n)||o(n,t))};t.traverseAncerstors=o;var a=function(e){return function(t){var n=function(n){return null!==n&&null!==n.target&&n.target.matchesTag(e)(t)};return n.metaData=new i.Metadata(e,t),n}};t.taggedConstraint=a;var s=a(r.NAMED_TAG);t.namedConstraint=s;t.typeConstraint=function(e){return function(t){var n=null;if(null!==t){if(n=t.bindings[0],"string"==typeof e)return n.serviceIdentifier===e;var r=t.bindings[0].implementationType;return e===r}return!1}}},function(e,t,n){"use strict";e.exports=function(e,t){for(var n={},r=0;r<e.length;++r)for(var i=e[r].name,o=i.split("."),a=n,s=0;s<o.length;++s){var u=o[s].split("[");if(u.length>1){u[0]in a||(a[u[0]]=[]),a=a[u[0]];for(var c=1;c<u.length;++c){var l=parseInt(u[c]);c<u.length-1||s<o.length-1?(l in a||(c<u.length-1?a[l]=[]:a[l]={}),a=a[l]):a[l]=t?r:e[r].type}}else s<o.length-1?(u[0]in a||(a[u[0]]={}),a=a[u[0]]):a[u[0]]=t?r:e[r].type}return n}},function(e,t){e.exports=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","uint","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"]},function(e,t){e.exports=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"]},function(e,t,n){"use strict";var r=n(0),i=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},o=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=0,s=function(){function e(){this.meshes=[],this.lights=[],this.lightsInfo={},this.inited=!1,this.idx=a++}return e.prototype.addMesh=function(e){this.meshes.push(e)},e.prototype.addLight=function(e){this.lightsInfo[e.type]||(this.lightsInfo[e.type]={varName:e.type.charAt(0).toLowerCase()+e.type.substring(1),declaration:e.declaration,lights:[]}),this.lightsInfo[e.type].lights.push(e)},e.prototype.getLightsInfo=function(){return this.lightsInfo},e.prototype.init=function(){this.meshes.forEach(function(e){return e.init()}),this.inited=!0},e=i([Object(r.injectable)(),o("design:paramtypes",[])],e)}();t.a=s},function(e,t,n){"use strict";var r=n(0),i=n(1),o=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},a=function(){function e(){this.transform=i.Matrix.I(4)}return e.prototype.init=function(e,t,n,r,i,o,a){this.eye=e,this.center=t,this.up=a||$V([0,1,0]),this.fovy=n,this.aspect=r,this.znear=i,this.zfar=o,this.updateProjection(),this.updateTransform()},e.prototype.perspective=function(e,t,n,r){var i=n*Math.tan(e*Math.PI/360),o=-i,a=o*t,s=i*t;return $M([[2*n/(s-a),0,(s+a)/(s-a),0],[0,2*n/(i-o),(i+o)/(i-o),0],[0,0,-(r+n)/(r-n),-2*r*n/(r-n)],[0,0,-1,0]])},e.prototype.lookAt=function(e,t,n){var r=e.subtract(t).toUnitVector(),o=n.cross(r).toUnitVector(),a=r.cross(o).toUnitVector(),s=$M([[o.e(1),o.e(2),o.e(3),0],[a.e(1),a.e(2),a.e(3),0],[r.e(1),r.e(2),r.e(3),0],[0,0,0,1]]),u=i.Matrix.Translation($V([-e.e(1),-e.e(2),-e.e(3)]));return s.x(u)},e.prototype.ortho=function(e,t,n,r,i,o){return $M([[2/(t-e),0,0,-(t+e)/(t-e)],[0,2/(r-n),0,-(r+n)/(r-n)],[0,0,-2/(o-i),-(o+i)/(o-i)],[0,0,0,1]])},e.prototype.truck=function(e){var t=this.eye.subtract(this.center).toUnitVector(),n=this.up.cross(t).toUnitVector();n=n.x(e),this.eye=this.eye.add(n),this.center=this.center.add(n),this.updateTransform()},e.prototype.pedestal=function(e){var t=this.eye.subtract(this.center).toUnitVector(),n=this.up.cross(t).toUnitVector(),r=t.cross(n).toUnitVector();r=r.x(e),this.eye=this.eye.add(r),this.center=this.center.add(r),this.updateTransform()},e.prototype.dolly=function(e){var t=this.eye.subtract(this.center).toUnitVector();t=t.x(e),this.eye=this.eye.add(t),this.center=this.center.add(t),this.updateTransform()},e.prototype.tilt=function(e){var t=this.eye.subtract(this.center).toUnitVector(),n=this.up.cross(t).toUnitVector(),r=this.center.subtract(this.eye),o=i.Matrix.Rotation(e,n);r=o.x(r),this.center=r.add(this.eye),Math.abs(t.dot(this.up))>=.985&&(this.up=o.x(this.up)),this.updateTransform()},e.prototype.pan=function(e){var t=this.eye.subtract(this.center).toUnitVector(),n=this.up.cross(t).toUnitVector(),r=t.cross(n).toUnitVector(),o=i.Matrix.Rotation(e,r),a=this.center.subtract(this.eye);a=o.x(a),this.center=a.add(this.eye),Math.abs(t.dot(this.up))>=.985&&(this.up=o.x(this.up)),this.updateTransform()},e.prototype.cant=function(e){var t=this.eye.subtract(this.center).toUnitVector(),n=this.center.subtract(this.eye),r=i.Matrix.Rotation(e,t);n=r.x(n),this.center=n.add(this.eye),this.up=r.x(this.up),this.updateTransform()},e.prototype.updateTransform=function(){this.view=this.lookAt(this.eye,this.center,this.up),this.transform=this.projection.x(this.view)},e.prototype.updateProjection=function(){this.projection=this.perspective(this.fovy,this.aspect,this.znear,this.zfar)},e=o([Object(r.injectable)()],e)}();t.a=a},function(e,t,n){var r;e.exports=((r=function(){function e(e){return i.appendChild(e.dom),e}function t(e){for(var t=0;t<i.children.length;t++)i.children[t].style.display=t===e?"block":"none";n=e}var n=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",function(e){e.preventDefault(),t(++n%i.children.length)},!1);var o=(performance||Date).now(),a=o,s=0,u=e(new r.Panel("FPS","#0ff","#002")),c=e(new r.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=e(new r.Panel("MB","#f08","#201"));return t(0),{REVISION:16,dom:i,addPanel:e,showPanel:t,begin:function(){o=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(c.update(e-o,200),e>a+1e3&&(u.update(1e3*s/(e-a),100),a=e,s=0,l)){var t=performance.memory;l.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){o=this.end()},domElement:i,setMode:t}}).Panel=function(e,t,n){var r=1/0,i=0,o=Math.round,a=o(window.devicePixelRatio||1),s=80*a,u=48*a,c=3*a,l=2*a,f=3*a,h=15*a,d=74*a,p=30*a,_=document.createElement("canvas");_.width=s,_.height=u,_.style.cssText="width:80px;height:48px";var m=_.getContext("2d");return m.font="bold "+9*a+"px Helvetica,Arial,sans-serif",m.textBaseline="top",m.fillStyle=n,m.fillRect(0,0,s,u),m.fillStyle=t,m.fillText(e,c,l),m.fillRect(f,h,d,p),m.fillStyle=n,m.globalAlpha=.9,m.fillRect(f,h,d,p),{dom:_,update:function(u,v){r=Math.min(r,u),i=Math.max(i,u),m.fillStyle=n,m.globalAlpha=1,m.fillRect(0,0,s,h),m.fillStyle=t,m.fillText(o(u)+" "+e+" ("+o(r)+"-"+o(i)+")",c,l),m.drawImage(_,f+a,h,d-a,p,f,h,d-a,p),m.fillRect(f+d-a,h,a,p),m.fillStyle=n,m.globalAlpha=.9,m.fillRect(f+d-a,h,a,o((1-u/v)*p))}}},r)},function(e,t,n){"use strict";var r=n(78),i=n(92);e.exports=function(e){var t=(e=e||{}).extensions||[],n=r(e),o=n.scale||1,a=e.glOptions;function s(){var e=n._width/o|0,t=n._height/o|0;n.canvas.width=e,n.canvas.height=t,n.canvas.style.width=n._width+"px",n.canvas.style.height=n._height+"px",n.emit("gl-resize",e,t)}return n.on("init",function(){var r=document.createElement("canvas"),u=r.getContext("webgl",a)||r.getContext("experimental-webgl",a);if(u){for(var c=i(u),l=0;l<t.length;++l)if(!(t[l]in c))return void n.emit("gl-error",new Error("Missing extension: "+t[l]));r.style.position="absolute",r.style.left="0px",r.style.top="0px",n.element.appendChild(r),n.canvas=r,n.gl=u,s(),n.clearFlags=void 0===e.clearFlags?u.COLOR_BUFFER_BIT|u.DEPTH_BUFFER_BIT:e.clearFlags,n.clearColor=e.clearColor||[0,0,0,0],n.clearDepth=e.clearDepth||1,n.clearStencil=e.clearStencil||0,n.on("resize",s),n.on("render",function(e){u.bindFramebuffer(u.FRAMEBUFFER,null),u.viewport(0,0,n._width/o|0,n._height/o|0),n.clearFlags&u.STENCIL_BUFFER_BIT&&u.clearStencil(n.clearStencil),n.clearFlags&u.COLOR_BUFFER_BIT&&u.clearColor(n.clearColor[0],n.clearColor[1],n.clearColor[2],n.clearColor[3]),n.clearFlags&u.DEPTH_BUFFER_BIT&&u.clearDepth(n.clearDepth),n.clearFlags&&u.clear(u.COLOR_BUFFER_BIT|u.DEPTH_BUFFER_BIT|u.STENCIL_BUFFER_BIT),n.emit("gl-render",e)}),n.emit("gl-init")}else n.emit("gl-error",new Error("Unable to initialize WebGL"))}),Object.defineProperty(n,"scale",{get:function(){return o},set:function(e){return(e=+e)<=0||isNaN(e)||o===e?o:(o=e,s(),o)}}),Object.defineProperty(n,"width",{get:function(){return n._width/o|0}}),Object.defineProperty(n,"height",{get:function(){return n._height/o|0}}),Object.defineProperty(n,"mouse",{get:function(){return[n.mouseX/o,n.mouseY/o]}}),Object.defineProperty(n,"prevMouse",{get:function(){return[n.prevMouseX/o,n.prevMouseY/o]}}),n}},function(e,t,n){"use strict";function r(e,t){var n=e.__state.conversionName.toString(),r=Math.round(e.r),i=Math.round(e.g),o=Math.round(e.b),a=e.a,s=Math.round(e.h),u=e.s.toFixed(1),c=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var l=e.hex.toString(16);l.length<6;)l="0"+l;return"#"+l}return"CSS_RGB"===n?"rgb("+r+","+i+","+o+")":"CSS_RGBA"===n?"rgba("+r+","+i+","+o+","+a+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+r+","+i+","+o+"]":"RGBA_ARRAY"===n?"["+r+","+i+","+o+","+a+"]":"RGB_OBJ"===n?"{r:"+r+",g:"+i+",b:"+o+"}":"RGBA_OBJ"===n?"{r:"+r+",g:"+i+",b:"+o+",a:"+a+"}":"HSV_OBJ"===n?"{h:"+s+",s:"+u+",v:"+c+"}":"HSVA_OBJ"===n?"{h:"+s+",s:"+u+",v:"+c+",a:"+a+"}":"unknown format"}n.d(t,"a",function(){return ue});var i=Array.prototype.forEach,o=Array.prototype.slice,a={BREAK:{},extend:function(e){return this.each(o.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(n){this.isUndefined(t[n])||(e[n]=t[n])}.bind(this))},this),e},defaults:function(e){return this.each(o.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(n){this.isUndefined(e[n])&&(e[n]=t[n])}.bind(this))},this),e},compose:function(){var e=o.call(arguments);return function(){for(var t=o.call(arguments),n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},each:function(e,t,n){if(e)if(i&&e.forEach&&e.forEach===i)e.forEach(t,n);else if(e.length===e.length+0){var r,o=void 0;for(o=0,r=e.length;o<r;o++)if(o in e&&t.call(n,e[o],o)===this.BREAK)return}else for(var a in e)if(t.call(n,e[a],a)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,n){var r=void 0;return function(){var i=this,o=arguments;var a=n||!r;clearTimeout(r),r=setTimeout(function(){r=null,n||e.apply(i,o)},t),a&&e.apply(i,o)}},toArray:function(e){return e.toArray?e.toArray():o.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return isNaN(e)}),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}},s=[{litmus:a.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:r},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:r},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:r},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:r}}},{litmus:a.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:a.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:a.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(a.isNumber(e.r)&&a.isNumber(e.g)&&a.isNumber(e.b)&&a.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(a.isNumber(e.r)&&a.isNumber(e.g)&&a.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(a.isNumber(e.h)&&a.isNumber(e.s)&&a.isNumber(e.v)&&a.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(a.isNumber(e.h)&&a.isNumber(e.s)&&a.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],u=void 0,c=void 0,l=function(){c=!1;var e=arguments.length>1?a.toArray(arguments):arguments[0];return a.each(s,function(t){if(t.litmus(e))return a.each(t.conversions,function(t,n){if(u=t.read(e),!1===c&&!1!==u)return c=u,u.conversionName=n,u.conversion=t,a.BREAK}),a.BREAK}),c},f=void 0,h={hsv_to_rgb:function(e,t,n){var r=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),o=n*(1-t),a=n*(1-i*t),s=n*(1-(1-i)*t),u=[[n,s,o],[a,n,o],[o,n,s],[o,a,n],[s,o,n],[n,o,a]][r];return{r:255*u[0],g:255*u[1],b:255*u[2]}},rgb_to_hsv:function(e,t,n){var r=Math.min(e,t,n),i=Math.max(e,t,n),o=i-r,a=void 0;return 0===i?{h:NaN,s:0,v:0}:(a=e===i?(t-n)/o:t===i?2+(n-e)/o:4+(e-t)/o,(a/=6)<0&&(a+=1),{h:360*a,s:o/i,v:i/255})},rgb_to_hex:function(e,t,n){var r=this.hex_with_component(0,2,e);return r=this.hex_with_component(r,1,t),r=this.hex_with_component(r,0,n)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,n){return n<<(f=8*t)|e&~(255<<f)}},d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},_=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),m=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},v=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},g=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},y=function(){function e(){if(p(this,e),this.__state=l.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return _(e,[{key:"toString",value:function(){return r(this)}},{key:"toHexString",value:function(){return r(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),e}();function b(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space?this.__state[t]:(y.recalculateRGB(this,t,n),this.__state[t])},set:function(e){"RGB"!==this.__state.space&&(y.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function E(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space?this.__state[t]:(y.recalculateHSV(this),this.__state[t])},set:function(e){"HSV"!==this.__state.space&&(y.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}y.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=h.component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");a.extend(e.__state,h.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},y.recalculateHSV=function(e){var t=h.rgb_to_hsv(e.r,e.g,e.b);a.extend(e.__state,{s:t.s,v:t.v}),a.isNaN(t.h)?a.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},y.COMPONENTS=["r","g","b","h","s","v","hex","a"],b(y.prototype,"r",2),b(y.prototype,"g",1),b(y.prototype,"b",0),E(y.prototype,"h"),E(y.prototype,"s"),E(y.prototype,"v"),Object.defineProperty(y.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(y.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=h.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var T=function(){function e(t,n){p(this,e),this.initialValue=t[n],this.domElement=document.createElement("div"),this.object=t,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return _(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),w={};a.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(e,t){a.each(e,function(e){w[e]=t})});var A=/(\d+(\.\d+)?)px/;function x(e){if("0"===e||a.isUndefined(e))return 0;var t=e.match(A);return a.isNull(t)?0:parseFloat(t[1])}var S={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){var r=n,i=t;a.isUndefined(i)&&(i=!0),a.isUndefined(r)&&(r=!0),e.style.position="absolute",i&&(e.style.left=0,e.style.right=0),r&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,r){var i=n||{},o=w[t];if(!o)throw new Error("Event type "+t+" not supported.");var s=document.createEvent(o);switch(o){case"MouseEvents":var u=i.x||i.clientX||0,c=i.y||i.clientY||0;s.initMouseEvent(t,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,u,c,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var l=s.initKeyboardEvent||s.initKeyEvent;a.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),l(t,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:s.initEvent(t,i.bubbles||!1,i.cancelable||!0)}a.defaults(s,r),e.dispatchEvent(s)},bind:function(e,t,n,r){var i=r||!1;return e.addEventListener?e.addEventListener(t,n,i):e.attachEvent&&e.attachEvent("on"+t,n),S},unbind:function(e,t,n,r){var i=r||!1;return e.removeEventListener?e.removeEventListener(t,n,i):e.detachEvent&&e.detachEvent("on"+t,n),S},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);-1===n.indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return S},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),r=n.indexOf(t);-1!==r&&(n.splice(r,1),e.className=n.join(" "))}else e.className=void 0;return S},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return x(t["border-left-width"])+x(t["border-right-width"])+x(t["padding-left"])+x(t["padding-right"])+x(t.width)},getHeight:function(e){var t=getComputedStyle(e);return x(t["border-top-width"])+x(t["border-bottom-width"])+x(t["padding-top"])+x(t["padding-bottom"])+x(t.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)do{n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent}while(t);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},O=function(e){function t(e,n){p(this,t);var r=g(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=r;return r.__prev=r.getValue(),r.__checkbox=document.createElement("input"),r.__checkbox.setAttribute("type","checkbox"),S.bind(r.__checkbox,"change",function(){i.setValue(!i.__prev)},!1),r.domElement.appendChild(r.__checkbox),r.updateDisplay(),r}return v(t,T),_(t,[{key:"setValue",value:function(e){var n=m(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),m(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),C=function(e){function t(e,n,r){p(this,t);var i=g(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=r,s=i;if(i.__select=document.createElement("select"),a.isArray(o)){var u={};a.each(o,function(e){u[e]=e}),o=u}return a.each(o,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),s.__select.appendChild(n)}),i.updateDisplay(),S.bind(i.__select,"change",function(){var e=this.options[this.selectedIndex].value;s.setValue(e)}),i.domElement.appendChild(i.__select),i}return v(t,T),_(t,[{key:"setValue",value:function(e){var n=m(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return S.isActive(this.__select)?this:(this.__select.value=this.getValue(),m(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(),R=function(e){function t(e,n){p(this,t);var r=g(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=r;function o(){i.setValue(i.__input.value)}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),S.bind(r.__input,"keyup",o),S.bind(r.__input,"change",o),S.bind(r.__input,"blur",function(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())}),S.bind(r.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return v(t,T),_(t,[{key:"updateDisplay",value:function(){return S.isActive(this.__input)||(this.__input.value=this.getValue()),m(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}();function M(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}var P=function(e){function t(e,n,r){p(this,t);var i=g(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=r||{};return i.__min=o.min,i.__max=o.max,i.__step=o.step,a.isUndefined(i.__step)?0===i.initialValue?i.__impliedStep=1:i.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(i.initialValue))/Math.LN10))/10:i.__impliedStep=i.__step,i.__precision=M(i.__impliedStep),i}return v(t,T),_(t,[{key:"setValue",value:function(e){var n=e;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!=0&&(n=Math.round(n/this.__step)*this.__step),m(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=M(e),this}}]),t}();var I=function(e){function t(e,n,r){p(this,t);var i=g(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));i.__truncationSuspended=!1;var o=i,s=void 0;function u(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function c(e){var t=s-e.clientY;o.setValue(o.getValue()+t*o.__impliedStep),s=e.clientY}function l(){S.unbind(window,"mousemove",c),S.unbind(window,"mouseup",l),u()}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),S.bind(i.__input,"change",function(){var e=parseFloat(o.__input.value);a.isNaN(e)||o.setValue(e)}),S.bind(i.__input,"blur",function(){u()}),S.bind(i.__input,"mousedown",function(e){S.bind(window,"mousemove",c),S.bind(window,"mouseup",l),s=e.clientY}),S.bind(i.__input,"keydown",function(e){13===e.keyCode&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,u())}),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return v(t,P),_(t,[{key:"updateDisplay",value:function(){var e,n,r;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),n=this.__precision,r=Math.pow(10,n),Math.round(e*r)/r),m(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}();function N(e,t,n,r,i){return r+(e-t)/(n-t)*(i-r)}var D=function(e){function t(e,n,r,i,o){p(this,t);var a=g(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,{min:r,max:i,step:o})),s=a;function u(e){e.preventDefault();var t=s.__background.getBoundingClientRect();return s.setValue(N(e.clientX,t.left,t.right,s.__min,s.__max)),!1}function c(){S.unbind(window,"mousemove",u),S.unbind(window,"mouseup",c),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function l(e){var t=e.touches[0].clientX,n=s.__background.getBoundingClientRect();s.setValue(N(t,n.left,n.right,s.__min,s.__max))}function f(){S.unbind(window,"touchmove",l),S.unbind(window,"touchend",f),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}return a.__background=document.createElement("div"),a.__foreground=document.createElement("div"),S.bind(a.__background,"mousedown",function(e){document.activeElement.blur(),S.bind(window,"mousemove",u),S.bind(window,"mouseup",c),u(e)}),S.bind(a.__background,"touchstart",function(e){if(1!==e.touches.length)return;S.bind(window,"touchmove",l),S.bind(window,"touchend",f),l(e)}),S.addClass(a.__background,"slider"),S.addClass(a.__foreground,"slider-fg"),a.updateDisplay(),a.__background.appendChild(a.__foreground),a.domElement.appendChild(a.__background),a}return v(t,P),_(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",m(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),L=function(e){function t(e,n,r){p(this,t);var i=g(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=i;return i.__button=document.createElement("div"),i.__button.innerHTML=void 0===r?"Fire":r,S.bind(i.__button,"click",function(e){return e.preventDefault(),o.fire(),!1}),S.addClass(i.__button,"button"),i.domElement.appendChild(i.__button),i}return v(t,T),_(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(),F=function(e){function t(e,n){p(this,t);var r=g(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));r.__color=new y(r.getValue()),r.__temp=new y(0);var i=r;r.domElement=document.createElement("div"),S.makeSelectable(r.domElement,!1),r.__selector=document.createElement("div"),r.__selector.className="selector",r.__saturation_field=document.createElement("div"),r.__saturation_field.className="saturation-field",r.__field_knob=document.createElement("div"),r.__field_knob.className="field-knob",r.__field_knob_border="2px solid ",r.__hue_knob=document.createElement("div"),r.__hue_knob.className="hue-knob",r.__hue_field=document.createElement("div"),r.__hue_field.className="hue-field",r.__input=document.createElement("input"),r.__input.type="text",r.__input_textShadow="0 1px 1px ",S.bind(r.__input,"keydown",function(e){13===e.keyCode&&d.call(this)}),S.bind(r.__input,"blur",d),S.bind(r.__selector,"mousedown",function(){S.addClass(this,"drag").bind(window,"mouseup",function(){S.removeClass(i.__selector,"drag")})}),S.bind(r.__selector,"touchstart",function(){S.addClass(this,"drag").bind(window,"touchend",function(){S.removeClass(i.__selector,"drag")})});var o,s=document.createElement("div");function u(e){m(e),S.bind(window,"mousemove",m),S.bind(window,"touchmove",m),S.bind(window,"mouseup",f),S.bind(window,"touchend",f)}function c(e){v(e),S.bind(window,"mousemove",v),S.bind(window,"touchmove",v),S.bind(window,"mouseup",h),S.bind(window,"touchend",h)}function f(){S.unbind(window,"mousemove",m),S.unbind(window,"touchmove",m),S.unbind(window,"mouseup",f),S.unbind(window,"touchend",f),_()}function h(){S.unbind(window,"mousemove",v),S.unbind(window,"touchmove",v),S.unbind(window,"mouseup",h),S.unbind(window,"touchend",h),_()}function d(){var e=l(this.value);!1!==e?(i.__color.__state=e,i.setValue(i.__color.toOriginal())):this.value=i.__color.toString()}function _(){i.__onFinishChange&&i.__onFinishChange.call(i,i.__color.toOriginal())}function m(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=i.__saturation_field.getBoundingClientRect(),n=e.touches&&e.touches[0]||e,r=n.clientX,o=n.clientY,a=(r-t.left)/(t.right-t.left),s=1-(o-t.top)/(t.bottom-t.top);return s>1?s=1:s<0&&(s=0),a>1?a=1:a<0&&(a=0),i.__color.v=s,i.__color.s=a,i.setValue(i.__color.toOriginal()),!1}function v(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=i.__hue_field.getBoundingClientRect(),n=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return n>1?n=1:n<0&&(n=0),i.__color.h=360*n,i.setValue(i.__color.toOriginal()),!1}return a.extend(r.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),a.extend(r.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:r.__field_knob_border+(r.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),a.extend(r.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),a.extend(r.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),a.extend(s.style,{width:"100%",height:"100%",background:"none"}),k(s,"top","rgba(0,0,0,0)","#000"),a.extend(r.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(o=r.__hue_field).style.background="",o.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",o.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.extend(r.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:r.__input_textShadow+"rgba(0,0,0,0.7)"}),S.bind(r.__saturation_field,"mousedown",u),S.bind(r.__saturation_field,"touchstart",u),S.bind(r.__field_knob,"mousedown",u),S.bind(r.__field_knob,"touchstart",u),S.bind(r.__hue_field,"mousedown",c),S.bind(r.__hue_field,"touchstart",c),r.__saturation_field.appendChild(s),r.__selector.appendChild(r.__field_knob),r.__selector.appendChild(r.__saturation_field),r.__selector.appendChild(r.__hue_field),r.__hue_field.appendChild(r.__hue_knob),r.domElement.appendChild(r.__input),r.domElement.appendChild(r.__selector),r.updateDisplay(),r}return v(t,T),_(t,[{key:"updateDisplay",value:function(){var e=l(this.getValue());if(!1!==e){var t=!1;a.each(y.COMPONENTS,function(n){if(!a.isUndefined(e[n])&&!a.isUndefined(this.__color.__state[n])&&e[n]!==this.__color.__state[n])return t=!0,{}},this),t&&a.extend(this.__color.__state,e)}a.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,r=255-n;a.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,k(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),a.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+r+","+r+","+r+",.7)"})}}]),t}(),U=["-moz-","-o-","-webkit-","-ms-",""];function k(e,t,n,r){e.style.background="",a.each(U,function(i){e.style.cssText+="background: "+i+"linear-gradient("+t+", "+n+" 0%, "+r+" 100%); "})}var j=function(e,t){var n=t||document,r=document.createElement("style");r.type="text/css",r.innerHTML=e;var i=n.getElementsByTagName("head")[0];try{i.appendChild(r)}catch(e){}},B=function(e,t){var n=e[t];return a.isArray(arguments[2])||a.isObject(arguments[2])?new C(e,t,arguments[2]):a.isNumber(n)?a.isNumber(arguments[2])&&a.isNumber(arguments[3])?a.isNumber(arguments[4])?new D(e,t,arguments[2],arguments[3],arguments[4]):new D(e,t,arguments[2],arguments[3]):a.isNumber(arguments[4])?new I(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new I(e,t,{min:arguments[2],max:arguments[3]}):a.isString(n)?new R(e,t):a.isFunction(n)?new L(e,t,""):a.isBoolean(n)?new O(e,t):null};var V=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},X=function(){function e(){p(this,e),this.backgroundElement=document.createElement("div"),a.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),S.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),a.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;S.bind(this.backgroundElement,"click",function(){t.hide()})}return _(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),a.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",S.unbind(e.domElement,"webkitTransitionEnd",t),S.unbind(e.domElement,"transitionend",t),S.unbind(e.domElement,"oTransitionEnd",t)};S.bind(this.domElement,"webkitTransitionEnd",t),S.bind(this.domElement,"transitionend",t),S.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-S.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-S.getHeight(this.domElement)/2+"px"}}]),e}();j(function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var G="Default",H=function(){try{return!!window.localStorage}catch(e){return!1}}(),z=void 0,W=!0,Y=void 0,q=!1,K=[],$=function e(t){var n=this,r=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),S.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=a.defaults(r,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),r=a.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),a.isUndefined(r.load)?r.load={preset:G}:r.preset&&(r.load.preset=r.preset),a.isUndefined(r.parent)&&r.hideable&&K.push(this),r.resizable=a.isUndefined(r.parent)&&r.resizable,r.autoPlace&&a.isUndefined(r.scrollable)&&(r.scrollable=!0);var i,o=H&&"true"===localStorage.getItem(ne(this,"isLocal")),s=void 0,u=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:r.load.preset},set:function(e){n.parent?n.getRoot().preset=e:r.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),n.revert()}},width:{get:function(){return r.width},set:function(e){r.width=e,ae(n,e)}},name:{get:function(){return r.name},set:function(e){r.name=e,u&&(u.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(t){r.closed=t,r.closed?S.addClass(n.__ul,e.CLASS_CLOSED):S.removeClass(n.__ul,e.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return o},set:function(e){H&&(o=e,e?S.bind(window,"unload",s):S.unbind(window,"unload",s),localStorage.setItem(ne(n,"isLocal"),e))}}}),a.isUndefined(r.parent)){if(r.closed=!1,S.addClass(this.domElement,e.CLASS_MAIN),S.makeSelectable(this.domElement,!1),H&&o){n.useLocalStorage=!0;var c=localStorage.getItem(ne(this,"gui"));c&&(r.load=JSON.parse(c))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,S.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),r.closeOnTop?(S.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(S.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),S.bind(this.__closeButton,"click",function(){n.closed=!n.closed})}else{void 0===r.closed&&(r.closed=!0);var l=document.createTextNode(r.name);S.addClass(l,"controller-name"),u=Z(n,l);S.addClass(this.__ul,e.CLASS_CLOSED),S.addClass(u,"title"),S.bind(u,"click",function(e){return e.preventDefault(),n.closed=!n.closed,!1}),r.closed||(this.closed=!1)}r.autoPlace&&(a.isUndefined(r.parent)&&(W&&(Y=document.createElement("div"),S.addClass(Y,"dg"),S.addClass(Y,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Y),W=!1),Y.appendChild(this.domElement),S.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||ae(n,r.width)),this.__resizeHandler=function(){n.onResizeDebounced()},S.bind(window,"resize",this.__resizeHandler),S.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),S.bind(this.__ul,"transitionend",this.__resizeHandler),S.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&oe(this),s=function(){H&&"true"===localStorage.getItem(ne(n,"isLocal"))&&localStorage.setItem(ne(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=s,r.parent||((i=n.getRoot()).width+=1,a.defer(function(){i.width-=1}))};function Z(e,t,n){var r=document.createElement("li");return t&&r.appendChild(t),n?e.__ul.insertBefore(r,n):e.__ul.appendChild(r),e.onResize(),r}function J(e){S.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&S.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function Q(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];n.innerHTML=t?n.value+"*":n.value}function ee(e,t){var n=e.getRoot(),r=n.__rememberedObjects.indexOf(t.object);if(-1!==r){var i=n.__rememberedObjectIndecesToControllers[r];if(void 0===i&&(i={},n.__rememberedObjectIndecesToControllers[r]=i),i[t.property]=t,n.load&&n.load.remembered){var o=n.load.remembered,a=void 0;if(o[e.preset])a=o[e.preset];else{if(!o[G])return;a=o[G]}if(a[r]&&void 0!==a[r][t.property]){var s=a[r][t.property];t.initialValue=s,t.setValue(s)}}}}function te(e,t,n,r){if(void 0===t[n])throw new Error('Object "'+t+'" has no property "'+n+'"');var i=void 0;if(r.color)i=new F(t,n);else{var o=[t,n].concat(r.factoryArgs);i=B.apply(e,o)}r.before instanceof T&&(r.before=r.before.__li),ee(e,i),S.addClass(i.domElement,"c");var s=document.createElement("span");S.addClass(s,"property-name"),s.innerHTML=i.property;var u=document.createElement("div");u.appendChild(s),u.appendChild(i.domElement);var c=Z(e,u,r.before);return S.addClass(c,$.CLASS_CONTROLLER_ROW),i instanceof F?S.addClass(c,"color"):S.addClass(c,d(i.getValue())),function(e,t,n){if(n.__li=t,n.__gui=e,a.extend(n,{options:function(t){if(arguments.length>1){var r=n.__li.nextElementSibling;return n.remove(),te(e,n.object,n.property,{before:r,factoryArgs:[a.toArray(arguments)]})}if(a.isArray(t)||a.isObject(t)){var i=n.__li.nextElementSibling;return n.remove(),te(e,n.object,n.property,{before:i,factoryArgs:[t]})}},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof D){var r=new I(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});a.each(["updateDisplay","onChange","onFinishChange","step"],function(e){var t=n[e],i=r[e];n[e]=r[e]=function(){var e=Array.prototype.slice.call(arguments);return i.apply(r,e),t.apply(n,e)}}),S.addClass(t,"has-slider"),n.domElement.insertBefore(r.domElement,n.domElement.firstElementChild)}else if(n instanceof I){var i=function(t){if(a.isNumber(n.__min)&&a.isNumber(n.__max)){var r=n.__li.firstElementChild.firstElementChild.innerHTML,i=n.__gui.__listening.indexOf(n)>-1;n.remove();var o=te(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return o.name(r),i&&o.listen(),o}return t};n.min=a.compose(i,n.min),n.max=a.compose(i,n.max)}else n instanceof O?(S.bind(t,"click",function(){S.fakeEvent(n.__checkbox,"click")}),S.bind(n.__checkbox,"click",function(e){e.stopPropagation()})):n instanceof L?(S.bind(t,"click",function(){S.fakeEvent(n.__button,"click")}),S.bind(t,"mouseover",function(){S.addClass(n.__button,"hover")}),S.bind(t,"mouseout",function(){S.removeClass(n.__button,"hover")})):n instanceof F&&(S.addClass(t,"color"),n.updateDisplay=a.compose(function(e){return t.style.borderLeftColor=n.__color.toString(),e},n.updateDisplay),n.updateDisplay());n.setValue=a.compose(function(t){return e.getRoot().__preset_select&&n.isModified()&&Q(e.getRoot(),!0),t},n.setValue)}(e,c,i),e.__controllers.push(i),i}function ne(e,t){return document.location.href+"."+t}function re(e,t,n){var r=document.createElement("option");r.innerHTML=t,r.value=t,e.__preset_select.appendChild(r),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function ie(e,t){t.style.display=e.useLocalStorage?"block":"none"}function oe(e){var t=void 0;function n(n){return n.preventDefault(),e.width+=t-n.clientX,e.onResize(),t=n.clientX,!1}function r(){S.removeClass(e.__closeButton,$.CLASS_DRAG),S.unbind(window,"mousemove",n),S.unbind(window,"mouseup",r)}function i(i){return i.preventDefault(),t=i.clientX,S.addClass(e.__closeButton,$.CLASS_DRAG),S.bind(window,"mousemove",n),S.bind(window,"mouseup",r),!1}e.__resize_handle=document.createElement("div"),a.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),S.bind(e.__resize_handle,"mousedown",i),S.bind(e.__closeButton,"mousedown",i),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function ae(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function se(e,t){var n={};return a.each(e.__rememberedObjects,function(r,i){var o={},s=e.__rememberedObjectIndecesToControllers[i];a.each(s,function(e,n){o[n]=t?e.initialValue:e.getValue()}),n[i]=o}),n}$.toggleHide=function(){q=!q,a.each(K,function(e){e.domElement.style.display=q?"none":""})},$.CLASS_AUTO_PLACE="a",$.CLASS_AUTO_PLACE_CONTAINER="ac",$.CLASS_MAIN="main",$.CLASS_CONTROLLER_ROW="cr",$.CLASS_TOO_TALL="taller-than-window",$.CLASS_CLOSED="closed",$.CLASS_CLOSE_BUTTON="close-button",$.CLASS_CLOSE_TOP="close-top",$.CLASS_CLOSE_BOTTOM="close-bottom",$.CLASS_DRAG="drag",$.DEFAULT_WIDTH=245,$.TEXT_CLOSED="Close Controls",$.TEXT_OPEN="Open Controls",$._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||$.toggleHide()},S.bind(window,"keydown",$._keydownHandler,!1),a.extend($.prototype,{add:function(e,t){return te(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return te(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;a.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&Y.removeChild(this.domElement);var e=this;a.each(this.__folders,function(t){e.removeFolder(t)}),S.unbind(window,"keydown",$._keydownHandler,!1),J(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var n=new $(t);this.__folders[e]=n;var r=Z(this,n.domElement);return S.addClass(r,"folder"),n},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],J(e);var t=this;a.each(e.__folders,function(t){e.removeFolder(t)}),a.defer(function(){t.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=S.getOffset(e.__ul).top,n=0;a.each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(n+=S.getHeight(t))}),window.innerHeight-t-20<n?(S.addClass(e.domElement,$.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(S.removeClass(e.domElement,$.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&a.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:a.debounce(function(){this.onResize()},50),remember:function(){if(a.isUndefined(z)&&((z=new X).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;a.each(Array.prototype.slice.call(arguments),function(t){0===e.__rememberedObjects.length&&function(e){var t=e.__save_row=document.createElement("li");S.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),S.addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",S.addClass(n,"button gears");var r=document.createElement("span");r.innerHTML="Save",S.addClass(r,"button"),S.addClass(r,"save");var i=document.createElement("span");i.innerHTML="New",S.addClass(i,"button"),S.addClass(i,"save-as");var o=document.createElement("span");o.innerHTML="Revert",S.addClass(o,"button"),S.addClass(o,"revert");var s=e.__preset_select=document.createElement("select");e.load&&e.load.remembered?a.each(e.load.remembered,function(t,n){re(e,n,n===e.preset)}):re(e,G,!1);if(S.bind(s,"change",function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value}),t.appendChild(s),t.appendChild(n),t.appendChild(r),t.appendChild(i),t.appendChild(o),H){var u=document.getElementById("dg-local-explain"),c=document.getElementById("dg-local-storage"),l=document.getElementById("dg-save-locally");l.style.display="block","true"===localStorage.getItem(ne(e,"isLocal"))&&c.setAttribute("checked","checked"),ie(e,u),S.bind(c,"change",function(){e.useLocalStorage=!e.useLocalStorage,ie(e,u)})}var f=document.getElementById("dg-new-constructor");S.bind(f,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||z.hide()}),S.bind(n,"click",function(){f.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),z.show(),f.focus(),f.select()}),S.bind(r,"click",function(){e.save()}),S.bind(i,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)}),S.bind(o,"click",function(){e.revert()})}(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)}),this.autoPlace&&ae(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=se(this)),e.folders={},a.each(this.__folders,function(t,n){e.folders[n]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=se(this),Q(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[G]=se(this,!0)),this.load.remembered[e]=se(this),this.preset=e,re(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){a.each(this.__controllers,function(t){this.getRoot().load.remembered?ee(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),a.each(this.__folders,function(e){e.revert(e)}),e||Q(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&function e(t){0!==t.length&&V.call(window,function(){e(t)});a.each(t,function(e){e.updateDisplay()})}(this.__listening)},updateDisplay:function(){a.each(this.__controllers,function(e){e.updateDisplay()}),a.each(this.__folders,function(e){e.updateDisplay()})}});var ue=$},function(e,t,n){"use strict";var r=n(94),i=n(95),o=n(39),a=n(96),s=n(114),u=n(19);function c(e){this.gl=e,this.gl.lastAttribCount=0,this._vref=this._fref=this._relink=this.vertShader=this.fragShader=this.program=this.attributes=this.uniforms=this.types=null}var l=c.prototype;function f(e,t){return e.name<t.name?-1:1}l.bind=function(){var e;this.program||this._relink();var t=this.gl.getProgramParameter(this.program,this.gl.ACTIVE_ATTRIBUTES),n=this.gl.lastAttribCount;if(t>n)for(e=n;e<t;e++)this.gl.enableVertexAttribArray(e);else if(n>t)for(e=t;e<n;e++)this.gl.disableVertexAttribArray(e);this.gl.lastAttribCount=t,this.gl.useProgram(this.program)},l.dispose=function(){for(var e=this.gl.lastAttribCount,t=0;t<e;t++)this.gl.disableVertexAttribArray(t);this.gl.lastAttribCount=0,this._fref&&this._fref.dispose(),this._vref&&this._vref.dispose(),this.attributes=this.types=this.vertShader=this.fragShader=this.program=this._relink=this._fref=this._vref=null},l.update=function(e,t,n,c){if(!t||1===arguments.length){var l=e;e=l.vertex,t=l.fragment,n=l.uniforms,c=l.attributes}var h=this,d=h.gl,p=h._vref;h._vref=a.shader(d,d.VERTEX_SHADER,e),p&&p.dispose(),h.vertShader=h._vref.shader;var _=this._fref;if(h._fref=a.shader(d,d.FRAGMENT_SHADER,t),_&&_.dispose(),h.fragShader=h._fref.shader,!n||!c){var m=d.createProgram();if(d.attachShader(m,h.fragShader),d.attachShader(m,h.vertShader),d.linkProgram(m),!d.getProgramParameter(m,d.LINK_STATUS)){var v=d.getProgramInfoLog(m);throw new u(v,"Error linking program:"+v)}n=n||s.uniforms(d,m),c=c||s.attributes(d,m),d.deleteProgram(m)}(c=c.slice()).sort(f);var g,y=[],b=[],E=[];for(g=0;g<c.length;++g){var T=c[g];if(T.type.indexOf("mat")>=0){for(var w=0|T.type.charAt(T.type.length-1),A=new Array(w),x=0;x<w;++x)A[x]=E.length,b.push(T.name+"["+x+"]"),"number"==typeof T.location?E.push(T.location+x):Array.isArray(T.location)&&T.location.length===w&&"number"==typeof T.location[x]?E.push(0|T.location[x]):E.push(-1);y.push({name:T.name,type:T.type,locations:A})}else y.push({name:T.name,type:T.type,locations:[E.length]}),b.push(T.name),"number"==typeof T.location?E.push(0|T.location):E.push(-1)}var S=0;for(g=0;g<E.length;++g)if(E[g]<0){for(;E.indexOf(S)>=0;)S+=1;E[g]=S}var O=new Array(n.length);function C(){h.program=a.program(d,h._vref,h._fref,b,E);for(var e=0;e<n.length;++e)O[e]=d.getUniformLocation(h.program,n[e].name)}C(),h._relink=C,h.types={uniforms:o(n),attributes:o(c)},h.attributes=i(d,h,y,E),Object.defineProperty(h,"uniforms",r(d,h,n,O))},e.exports=function(e,t,n,r,i){var o=new c(e);return o.update(t,n,r,i),o}},function(e,t){var n=9007199254740991,r="[object Arguments]",i="[object Function]",o="[object GeneratorFunction]",a=/^(?:0|[1-9]\d*)$/;var s,u,c=Object.prototype,l=c.hasOwnProperty,f=c.toString,h=c.propertyIsEnumerable,d=(s=Object.keys,u=Object,function(e){return s(u(e))}),p=Math.max,_=!h.call({valueOf:1},"valueOf");function m(e,t){var n=E(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&T(e)}(e)&&l.call(e,"callee")&&(!h.call(e,"callee")||f.call(e)==r)}(e)?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],i=n.length,o=!!i;for(var a in e)!t&&!l.call(e,a)||o&&("length"==a||g(a,i))||n.push(a);return n}function v(e,t,n){var r=e[t];l.call(e,t)&&b(r,n)&&(void 0!==n||t in e)||(e[t]=n)}function g(e,t){return!!(t=null==t?n:t)&&("number"==typeof e||a.test(e))&&e>-1&&e%1==0&&e<t}function y(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||c)}function b(e,t){return e===t||e!=e&&t!=t}var E=Array.isArray;function T(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=n}(e.length)&&!function(e){var t=w(e)?f.call(e):"";return t==i||t==o}(e)}function w(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}var A=function(e){return t=function(t,n){var r=-1,i=n.length,o=i>1?n[i-1]:void 0,a=i>2?n[2]:void 0;for(o=e.length>3&&"function"==typeof o?(i--,o):void 0,a&&function(e,t,n){if(!w(n))return!1;var r=typeof t;return!!("number"==r?T(n)&&g(t,n.length):"string"==r&&t in n)&&b(n[t],e)}(n[0],n[1],a)&&(o=i<3?void 0:o,i=1),t=Object(t);++r<i;){var s=n[r];s&&e(t,s,r,o)}return t},n=p(void 0===n?t.length-1:n,0),function(){for(var e=arguments,r=-1,i=p(e.length-n,0),o=Array(i);++r<i;)o[r]=e[n+r];r=-1;for(var a=Array(n+1);++r<n;)a[r]=e[r];return a[n]=o,function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}(t,this,a)};var t,n}(function(e,t){if(_||y(t)||T(t))!function(e,t,n,r){n||(n={});for(var i=-1,o=t.length;++i<o;){var a=t[i],s=r?r(n[a],e[a],a,n,e):void 0;v(n,a,void 0===s?e[a]:s)}}(t,function(e){return T(e)?m(e):function(e){if(!y(e))return d(e);var t=[];for(var n in Object(e))l.call(e,n)&&"constructor"!=n&&t.push(n);return t}(e)}(t),e);else for(var n in t)l.call(t,n)&&v(e,n,t[n])});e.exports=A},function(e,t){},function(e,t,n){var r=n(24),i=n(13);r.Segment=function(){},r.Segment.prototype={eql:function(e){return this.start.eql(e.start)&&this.end.eql(e.end)||this.start.eql(e.end)&&this.end.eql(e.start)},dup:function(){return r.Segment.create(this.start,this.end)},length:function(){var e=this.start.elements,t=this.end.elements,n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)},toVector:function(){var e=this.start.elements,t=this.end.elements;return i.create([t[0]-e[0],t[1]-e[1],t[2]-e[2]])},midpoint:function(){var e=this.start.elements,t=this.end.elements;return i.create([(t[0]+e[0])/2,(t[1]+e[1])/2,(t[2]+e[2])/2])},bisectingPlane:function(){return Plane.create(this.midpoint(),this.toVector())},translate:function(e){var t=e.elements||e,n=this.start.elements,i=this.end.elements;return r.Segment.create([n[0]+t[0],n[1]+t[1],n[2]+(t[2]||0)],[i[0]+t[0],i[1]+t[1],i[2]+(t[2]||0)])},isParallelTo:function(e){return this.line.isParallelTo(e)},distanceFrom:function(e){var t=this.pointClosestTo(e);return null===t?null:t.distanceFrom(e)},contains:function(e){if(e.start&&e.end)return this.contains(e.start)&&this.contains(e.end);var t=(e.elements||e).slice();if(2==t.length&&t.push(0),this.start.eql(t))return!0;var n=this.start.elements,r=i.create([n[0]-t[0],n[1]-t[1],n[2]-(t[2]||0)]),o=this.toVector();return r.isAntiparallelTo(o)&&r.modulus()<=o.modulus()},intersects:function(e){return null!==this.intersectionWith(e)},intersectionWith:function(e){if(!this.line.intersects(e))return null;var t=this.line.intersectionWith(e);return this.contains(t)?t:null},pointClosestTo:function(e){if(e.normal){var t=this.line.intersectionWith(e);return null===t?null:this.pointClosestTo(t)}var n=this.line.pointClosestTo(e);return null===n?null:this.contains(n)?n:(this.line.positionOf(n)<0?this.start:this.end).dup()},setPoints:function(e,t){return e=i.create(e).to3D(),t=i.create(t).to3D(),null===e||null===t?null:(this.line=r.create(e,t.subtract(e)),this.start=e,this.end=t,this)}},r.Segment.create=function(e,t){return(new r.Segment).setPoints(e,t)},e.exports=r.Segment},function(e,t,n){(function(e,t){
/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var n;!function(n){!function(r){var i="object"==typeof t?t:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),o=a(n);function a(e,t){return function(n,r){"function"!=typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:r}),t&&t(n,r)}}void 0===i.Reflect?i.Reflect=n:o=a(i.Reflect,o),function(t){var n=Object.prototype.hasOwnProperty,r="function"==typeof Symbol,i=r&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",o=r&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",a="function"==typeof Object.create,s={__proto__:[]}instanceof Array,u=!a&&!s,c={create:a?function(){return N(Object.create(null))}:s?function(){return N({__proto__:null})}:function(){return N({})},has:u?function(e,t){return n.call(e,t)}:function(e,t){return t in e},get:u?function(e,t){return n.call(e,t)?e[t]:void 0}:function(e,t){return e[t]}},l=Object.getPrototypeOf(Function),f="object"==typeof e&&e.env&&"true"===e.env.REFLECT_METADATA_USE_MAP_POLYFILL,h=f||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[o]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,r)},t.prototype.values=function(){return new n(this._keys,this._values,i)},t.prototype.entries=function(){return new n(this._keys,this._values,a)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[o]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function r(e,t){return e}function i(e,t){return t}function a(e,t){return[e,t]}}():Map,d=f||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function e(){this._map=new h}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[o]=function(){return this.keys()},e}():Set,p=new(f||"function"!=typeof WeakMap?function(){var e=16,t=c.create(),r=i();return function(){function e(){this._key=i()}return e.prototype.has=function(e){var t=o(e,!1);return void 0!==t&&c.has(t,this._key)},e.prototype.get=function(e){var t=o(e,!1);return void 0!==t?c.get(t,this._key):void 0},e.prototype.set=function(e,t){var n=o(e,!0);return n[this._key]=t,this},e.prototype.delete=function(e){var t=o(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=i()},e}();function i(){var e;do{e="@@WeakMap@@"+s()}while(c.has(t,e));return t[e]=!0,e}function o(e,t){if(!n.call(e,r)){if(!t)return;Object.defineProperty(e,r,{value:c.create()})}return e[r]}function a(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function s(){var t=function(e){if("function"==typeof Uint8Array)return"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):a(new Uint8Array(e),e);return a(new Array(e),e)}(e);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",r=0;r<e;++r){var i=t[r];4!==r&&6!==r&&8!==r||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}():WeakMap);function _(e,t,n){var r=p.get(e);if(E(r)){if(!n)return;r=new h,p.set(e,r)}var i=r.get(t);if(E(i)){if(!n)return;i=new h,r.set(t,i)}return i}function m(e,t,n){var r=_(t,n,!1);return!E(r)&&!!r.has(e)}function v(e,t,n){var r=_(t,n,!1);if(!E(r))return r.get(e)}function g(e,t,n,r){var i=_(n,r,!0);i.set(e,t)}function y(e,t){var n=[],r=_(e,t,!1);if(E(r))return n;for(var i=r.keys(),a=function(e){var t=R(e,o);if(!O(t))throw new TypeError;var n=t.call(e);if(!w(n))throw new TypeError;return n}(i),s=0;;){var u=M(a);if(!u)return n.length=s,n;var c=u.value;try{n[s]=c}catch(e){try{P(a)}finally{throw e}}s++}}function b(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function E(e){return void 0===e}function T(e){return null===e}function w(e){return"object"==typeof e?null!==e:"function"==typeof e}function A(e,t){switch(b(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",r=R(e,i);if(void 0!==r){var o=r.call(e,n);if(w(o))throw new TypeError;return o}return function(e,t){if("string"===t){var n=e.toString;if(O(n)){var r=n.call(e);if(!w(r))return r}var i=e.valueOf;if(O(i)){var r=i.call(e);if(!w(r))return r}}else{var i=e.valueOf;if(O(i)){var r=i.call(e);if(!w(r))return r}var o=e.toString;if(O(o)){var r=o.call(e);if(!w(r))return r}}throw new TypeError}(e,"default"===n?"number":n)}function x(e){var t=A(e,3);return"symbol"==typeof t?t:function(e){return""+e}(t)}function S(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function O(e){return"function"==typeof e}function C(e){return"function"==typeof e}function R(e,t){var n=e[t];if(null!=n){if(!O(n))throw new TypeError;return n}}function M(e){var t=e.next();return!t.done&&t}function P(e){var t=e.return;t&&t.call(e)}function I(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===l)return t;if(t!==l)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return t;var i=r.constructor;return"function"!=typeof i?t:i===e?t:i}function N(e){return e.__=void 0,delete e.__,e}t("decorate",function(e,t,n,r){if(E(n)){if(!S(e))throw new TypeError;if(!C(t))throw new TypeError;return function(e,t){for(var n=e.length-1;n>=0;--n){var r=e[n],i=r(t);if(!E(i)&&!T(i)){if(!C(i))throw new TypeError;t=i}}return t}(e,t)}if(!S(e))throw new TypeError;if(!w(t))throw new TypeError;if(!w(r)&&!E(r)&&!T(r))throw new TypeError;return T(r)&&(r=void 0),n=x(n),function(e,t,n,r){for(var i=e.length-1;i>=0;--i){var o=e[i],a=o(t,n,r);if(!E(a)&&!T(a)){if(!w(a))throw new TypeError;r=a}}return r}(e,t,n,r)}),t("metadata",function(e,t){return function(n,r){if(!w(n))throw new TypeError;if(!E(r)&&!function(e){switch(b(e)){case 3:case 4:return!0;default:return!1}}(r))throw new TypeError;g(e,t,n,r)}}),t("defineMetadata",function(e,t,n,r){if(!w(n))throw new TypeError;E(r)||(r=x(r));return g(e,t,n,r)}),t("hasMetadata",function(e,t,n){if(!w(t))throw new TypeError;E(n)||(n=x(n));return function e(t,n,r){var i=m(t,n,r);if(i)return!0;var o=I(n);if(!T(o))return e(t,o,r);return!1}(e,t,n)}),t("hasOwnMetadata",function(e,t,n){if(!w(t))throw new TypeError;E(n)||(n=x(n));return m(e,t,n)}),t("getMetadata",function(e,t,n){if(!w(t))throw new TypeError;E(n)||(n=x(n));return function e(t,n,r){var i=m(t,n,r);if(i)return v(t,n,r);var o=I(n);if(!T(o))return e(t,o,r);return}(e,t,n)}),t("getOwnMetadata",function(e,t,n){if(!w(t))throw new TypeError;E(n)||(n=x(n));return v(e,t,n)}),t("getMetadataKeys",function(e,t){if(!w(e))throw new TypeError;E(t)||(t=x(t));return function e(t,n){var r=y(t,n);var i=I(t);if(null===i)return r;var o=e(i,n);if(o.length<=0)return r;if(r.length<=0)return o;var a=new d;var s=[];for(var u=0,c=r;u<c.length;u++){var l=c[u],f=a.has(l);f||(a.add(l),s.push(l))}for(var h=0,p=o;h<p.length;h++){var l=p[h],f=a.has(l);f||(a.add(l),s.push(l))}return s}(e,t)}),t("getOwnMetadataKeys",function(e,t){if(!w(e))throw new TypeError;E(t)||(t=x(t));return y(e,t)}),t("deleteMetadata",function(e,t,n){if(!w(t))throw new TypeError;E(n)||(n=x(n));var r=_(t,n,!1);if(E(r))return!1;if(!r.delete(e))return!1;if(r.size>0)return!0;var i=p.get(t);return i.delete(n),i.size>0||(p.delete(t),!0)})}(o)}()}(n||(n={}))}).call(this,n(32),n(23))},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}u((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(53),a=n(5),s=n(7),u=n(3),c=n(33),l=n(54),f=n(61),h=n(63),d=n(11),p=n(15),_=n(66),m=n(67),v=function(){function e(e){var t=e||{};if("object"!=typeof t)throw new Error(""+a.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(void 0===t.defaultScope)t.defaultScope=s.BindingScopeEnum.Transient;else if(t.defaultScope!==s.BindingScopeEnum.Singleton&&t.defaultScope!==s.BindingScopeEnum.Transient&&t.defaultScope!==s.BindingScopeEnum.Request)throw new Error(""+a.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(void 0===t.autoBindInjectable)t.autoBindInjectable=!1;else if("boolean"!=typeof t.autoBindInjectable)throw new Error(""+a.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(void 0===t.skipBaseClassChecks)t.skipBaseClassChecks=!1;else if("boolean"!=typeof t.skipBaseClassChecks)throw new Error(""+a.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=d.id(),this._bindingDictionary=new m.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new c.MetadataReader}return e.merge=function(t,n){var r=new e,i=l.getBindingDictionary(r),o=l.getBindingDictionary(t),a=l.getBindingDictionary(n);function s(e,t){e.traverse(function(e,n){n.forEach(function(e){t.add(e.serviceIdentifier,e.clone())})})}return s(o,i),s(a,i),r},e.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=this._getContainerModuleHelpersFactory(),r=0,i=e;r<i.length;r++){var o=i[r],a=n(o.id);o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)}},e.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(this,void 0,void 0,function(){var t,n,r,o,a;return i(this,function(i){switch(i.label){case 0:t=this._getContainerModuleHelpersFactory(),n=0,r=e,i.label=1;case 1:return n<r.length?(o=r[n],a=t(o.id),[4,o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)]):[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},e.prototype.unload=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.forEach(function(t){var n,r=(n=t.id,function(e){return e.moduleId===n});e._bindingDictionary.removeByCondition(r)})},e.prototype.bind=function(e){var t=this.options.defaultScope||s.BindingScopeEnum.Transient,n=new o.Binding(e,t);return this._bindingDictionary.add(e,n),new h.BindingToSyntax(n)},e.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},e.prototype.unbind=function(e){try{this._bindingDictionary.remove(e)}catch(t){throw new Error(a.CANNOT_UNBIND+" "+p.getServiceIdentifierAsString(e))}},e.prototype.unbindAll=function(){this._bindingDictionary=new m.Lookup},e.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},e.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,u.NAMED_TAG,t)},e.prototype.isBoundTagged=function(e,t,n){var r=!1;if(this._bindingDictionary.hasKey(e)){var i=this._bindingDictionary.get(e),o=l.createMockRequest(this,e,t,n);r=i.some(function(e){return e.constraint(o)})}return!r&&this.parent&&(r=this.parent.isBoundTagged(e,t,n)),r},e.prototype.snapshot=function(){this._snapshots.push(_.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},e.prototype.restore=function(){var e=this._snapshots.pop();if(void 0===e)throw new Error(a.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=e.bindings,this._middleware=e.middleware},e.prototype.createChild=function(t){var n=new e(t||this.options);return n.parent=this,n},e.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce(function(e,t){return t(e)},n)},e.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},e.prototype.get=function(e){return this._get(!1,!1,s.TargetTypeEnum.Variable,e)},e.prototype.getTagged=function(e,t,n){return this._get(!1,!1,s.TargetTypeEnum.Variable,e,t,n)},e.prototype.getNamed=function(e,t){return this.getTagged(e,u.NAMED_TAG,t)},e.prototype.getAll=function(e){return this._get(!0,!0,s.TargetTypeEnum.Variable,e)},e.prototype.getAllTagged=function(e,t,n){return this._get(!1,!0,s.TargetTypeEnum.Variable,e,t,n)},e.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,u.NAMED_TAG,t)},e.prototype.resolve=function(e){var t=this.createChild();return t.bind(e).toSelf(),t.get(e)},e.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(e,t){e._binding.moduleId=t},n=function(n){return function(r){var i=e.rebind.bind(e)(r);return t(i,n),i}};return function(r){return{bindFunction:(i=r,function(n){var r=e.bind.bind(e)(n);return t(r,i),r}),isboundFunction:function(t){return e.isBound.bind(e)(t)},rebindFunction:n(r),unbindFunction:function(t){e.unbind.bind(e)(t)}};var i}},e.prototype._get=function(e,t,n,r,i,o){var s=null,u={avoidConstraints:e,contextInterceptor:function(e){return e},isMultiInject:t,key:i,serviceIdentifier:r,targetType:n,value:o};if(this._middleware){if(null==(s=this._middleware(u)))throw new Error(a.INVALID_MIDDLEWARE_RETURN)}else s=this._planAndResolve()(u);return s},e.prototype._planAndResolve=function(){var e=this;return function(t){var n=l.plan(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);return n=t.contextInterceptor(n),f.resolve(n)}},e}();t.Container=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),i=n(11),o=function(){function e(e,t){this.id=i.id(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=r.BindingTypeEnum.Invalid,this.constraint=function(e){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return e.prototype.clone=function(){var t=new e(this.serviceIdentifier,this.scope);return t.activated=!1,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.factory=this.factory,t.provider=this.provider,t.constraint=this.constraint,t.onActivation=this.onActivation,t.cache=this.cache,t},e}();t.Binding=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(55),i=n(5),o=n(7),a=n(3),s=n(34),u=n(15),c=n(56),l=n(6),f=n(57),h=n(58),d=n(60),p=n(36);function _(e){return e._bindingDictionary}function m(e,t,n,o,a){var s=v(n.container,a.serviceIdentifier),c=[];return s.length===r.BindingCount.NoBindingsAvailable&&n.container.options.autoBindInjectable&&"function"==typeof a.serviceIdentifier&&e.getConstructorMetadata(a.serviceIdentifier).compilerGeneratedMetadata&&(n.container.bind(a.serviceIdentifier).toSelf(),s=v(n.container,a.serviceIdentifier)),c=t?s:s.filter(function(e){var t=new d.Request(e.serviceIdentifier,n,o,e,a);return e.constraint(t)}),function(e,t,n,o){switch(t.length){case r.BindingCount.NoBindingsAvailable:if(n.isOptional())return t;var a=u.getServiceIdentifierAsString(e),s=i.NOT_REGISTERED;throw s+=u.listMetadataForTarget(a,n),s+=u.listRegisteredBindingsForServiceIdentifier(o,a,v),new Error(s);case r.BindingCount.OnlyOneBindingAvailable:if(!n.isArray())return t;case r.BindingCount.MultipleBindingsAvailable:default:if(n.isArray())return t;var a=u.getServiceIdentifierAsString(e),s=i.AMBIGUOUS_MATCH+" "+a;throw s+=u.listRegisteredBindingsForServiceIdentifier(o,a,v),new Error(s)}}(a.serviceIdentifier,c,a,n.container),c}function v(e,t){var n=[],r=_(e);return r.hasKey(t)?n=r.get(t):null!==e.parent&&(n=v(e.parent,t)),n}t.getBindingDictionary=_,t.plan=function(e,t,n,r,_,v,g,y){void 0===y&&(y=!1);var b=new c.Context(t),E=function(e,t,n,r,i,o){var s=e?a.MULTI_INJECT_TAG:a.INJECT_TAG,u=new l.Metadata(s,n),c=new p.Target(t,r,n,u);if(void 0!==i){var f=new l.Metadata(i,o);c.metadata.push(f)}return c}(n,r,_,"",v,g);try{return function e(t,n,r,a,s,u){var c,l;if(null===s){c=m(t,n,a,null,u),l=new d.Request(r,a,null,c,u);var p=new f.Plan(a,l);a.addPlan(p)}else c=m(t,n,a,s,u),l=s.addChildRequest(u.serviceIdentifier,c,u);c.forEach(function(n){var r=null;if(u.isArray())r=l.addChildRequest(n.serviceIdentifier,n,u);else{if(n.cache)return;r=l}if(n.type===o.BindingTypeEnum.Instance&&null!==n.implementationType){var s=h.getDependencies(t,n.implementationType);if(!a.container.options.skipBaseClassChecks){var c=h.getBaseClassDependencyCount(t,n.implementationType);if(s.length<c){var f=i.ARGUMENTS_LENGTH_MISMATCH(h.getFunctionName(n.implementationType));throw new Error(f)}}s.forEach(function(n){e(t,!1,n.serviceIdentifier,a,r,n)})}})}(e,y,_,b,null,E),b}catch(e){throw s.isStackOverflowExeption(e)&&b.plan&&u.circularDependencyToException(b.plan.rootRequest),e}},t.createMockRequest=function(e,t,n,r){var i=new p.Target(o.TargetTypeEnum.Variable,"",t,new l.Metadata(n,r)),a=new c.Context(e);return new d.Request(t,a,null,[],i)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BindingCount={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=function(){function e(e){this.id=r.id(),this.container=e}return e.prototype.addPlan=function(e){this.plan=e},e.prototype.setCurrentRequest=function(e){this.currentRequest=e},e}();t.Context=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t){this.parentContext=e,this.rootRequest=t}}();t.Plan=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(35),i=n(5),o=n(7),a=n(3),s=n(15);t.getFunctionName=s.getFunctionName;var u=n(36);function c(e,t,n,r){var a=e.getConstructorMetadata(n),s=a.compilerGeneratedMetadata;if(void 0===s){var c=i.MISSING_INJECTABLE_ANNOTATION+" "+t+".";throw new Error(c)}var h=a.userGeneratedMetadata,d=Object.keys(h),p=function(e,t,n,r,i){for(var o=[],a=0;a<i;a++){var s=a,u=l(s,e,t,n,r);null!==u&&o.push(u)}return o}(r,t,s,h,0===n.length&&d.length>0?d.length:n.length),_=function e(t,n){var r=t.getPropertiesMetadata(n);var i=[];var a=Object.keys(r);for(var s=0,c=a;s<c.length;s++){var l=c[s],h=r[l],d=f(r[l]),p=d.targetName||l,_=d.inject||d.multiInject,m=new u.Target(o.TargetTypeEnum.ClassProperty,p,_);m.metadata=h,i.push(m)}var v=Object.getPrototypeOf(n.prototype).constructor;if(v!==Object){var g=e(t,v);i=i.concat(g)}return i}(e,n);return p.concat(_)}function l(e,t,n,a,s){var c=s[e.toString()]||[],l=f(c),h=!0!==l.unmanaged,d=a[e],p=l.inject||l.multiInject;if((d=p||d)instanceof r.LazyServiceIdentifer&&(d=d.unwrap()),h){var _=d===Object,m=d===Function;if(!t&&(_||m||void 0===d)){var v=i.MISSING_INJECT_ANNOTATION+" argument "+e+" in class "+n+".";throw new Error(v)}var g=new u.Target(o.TargetTypeEnum.ConstructorArgument,l.targetName,d);return g.metadata=c,g}return null}function f(e){var t={};return e.forEach(function(e){t[e.key.toString()]=e.value}),{inject:t[a.INJECT_TAG],multiInject:t[a.MULTI_INJECT_TAG],targetName:t[a.NAME_TAG],unmanaged:t[a.UNMANAGED_TAG]}}t.getDependencies=function(e,t){return c(e,s.getFunctionName(t),t,!1)},t.getBaseClassDependencyCount=function e(t,n){var r=Object.getPrototypeOf(n.prototype).constructor;if(r!==Object){var i=c(t,s.getFunctionName(r),r,!0),o=i.map(function(e){return e.metadata.filter(function(e){return e.key===a.UNMANAGED_TAG})}),u=[].concat.apply([],o).length,l=i.length-u;return l>0?l:e(t,r)}return 0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.str=e}return e.prototype.startsWith=function(e){return 0===this.str.indexOf(e)},e.prototype.endsWith=function(e){var t,n=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},n)},e.prototype.contains=function(e){return-1!==this.str.indexOf(e)},e.prototype.equals=function(e){return this.str===e},e.prototype.value=function(){return this.str},e}();t.QueryableString=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=function(){function e(e,t,n,i,o){this.id=r.id(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=n,this.target=o,this.childRequests=[],this.bindings=Array.isArray(i)?i:[i],this.requestScope=null===n?new Map:null}return e.prototype.addChildRequest=function(t,n,r){var i=new e(t,this.parentContext,this,n,r);return this.childRequests.push(i),i},e}();t.Request=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=n(7),o=n(34),a=n(15),s=n(62),u=function(e,t,n){try{return n()}catch(n){throw o.isStackOverflowExeption(n)?new Error(r.CIRCULAR_DEPENDENCY_IN_FACTORY(e,t.toString())):n}},c=function(e){return function(t){t.parentContext.setCurrentRequest(t);var n=t.bindings,o=t.childRequests,l=t.target&&t.target.isArray(),f=!(t.parentRequest&&t.parentRequest.target&&t.target&&t.parentRequest.target.matchesArray(t.target.serviceIdentifier));if(l&&f)return o.map(function(t){return c(e)(t)});var h=null;if(!t.target.isOptional()||0!==n.length){var d=n[0],p=d.scope===i.BindingScopeEnum.Singleton,_=d.scope===i.BindingScopeEnum.Request;if(p&&d.activated)return d.cache;if(_&&null!==e&&e.has(d.id))return e.get(d.id);if(d.type===i.BindingTypeEnum.ConstantValue)h=d.cache;else if(d.type===i.BindingTypeEnum.Function)h=d.cache;else if(d.type===i.BindingTypeEnum.Constructor)h=d.implementationType;else if(d.type===i.BindingTypeEnum.DynamicValue&&null!==d.dynamicValue)h=u("toDynamicValue",d.serviceIdentifier,function(){return d.dynamicValue(t.parentContext)});else if(d.type===i.BindingTypeEnum.Factory&&null!==d.factory)h=u("toFactory",d.serviceIdentifier,function(){return d.factory(t.parentContext)});else if(d.type===i.BindingTypeEnum.Provider&&null!==d.provider)h=u("toProvider",d.serviceIdentifier,function(){return d.provider(t.parentContext)});else{if(d.type!==i.BindingTypeEnum.Instance||null===d.implementationType){var m=a.getServiceIdentifierAsString(t.serviceIdentifier);throw new Error(r.INVALID_BINDING_TYPE+" "+m)}h=s.resolveInstance(d.implementationType,o,c(e))}return"function"==typeof d.onActivation&&(h=d.onActivation(t.parentContext,h)),p&&(d.cache=h,d.activated=!0),_&&null!==e&&!e.has(d.id)&&e.set(d.id,h),h}}};t.resolve=function(e){return c(e.plan.rootRequest.requestScope)(e.plan.rootRequest)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=n(7),o=n(3);t.resolveInstance=function(e,t,n){var a,s,u=null;if(t.length>0){var c=t.filter(function(e){return null!==e.target&&e.target.type===i.TargetTypeEnum.ConstructorArgument}).map(n);s=c,u=function(e,t,n){var r=t.filter(function(e){return null!==e.target&&e.target.type===i.TargetTypeEnum.ClassProperty}),o=r.map(n);return r.forEach(function(t,n){var r;r=t.target.name.value();var i=o[n];e[r]=i}),e}(u=new((a=e).bind.apply(a,[void 0].concat(s))),t,n)}else u=new e;return function(e,t){if(Reflect.hasMetadata(o.POST_CONSTRUCT,e)){var n=Reflect.getMetadata(o.POST_CONSTRUCT,e);try{t[n.value]()}catch(t){throw new Error(r.POST_CONSTRUCT_ERROR(e.name,t.message))}}}(e,u),u}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=n(7),o=n(64),a=n(37),s=function(){function e(e){this._binding=e}return e.prototype.to=function(e){return this._binding.type=i.BindingTypeEnum.Instance,this._binding.implementationType=e,new o.BindingInWhenOnSyntax(this._binding)},e.prototype.toSelf=function(){if("function"!=typeof this._binding.serviceIdentifier)throw new Error(""+r.INVALID_TO_SELF_VALUE);var e=this._binding.serviceIdentifier;return this.to(e)},e.prototype.toConstantValue=function(e){return this._binding.type=i.BindingTypeEnum.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,new a.BindingWhenOnSyntax(this._binding)},e.prototype.toDynamicValue=function(e){return this._binding.type=i.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new o.BindingInWhenOnSyntax(this._binding)},e.prototype.toConstructor=function(e){return this._binding.type=i.BindingTypeEnum.Constructor,this._binding.implementationType=e,new a.BindingWhenOnSyntax(this._binding)},e.prototype.toFactory=function(e){return this._binding.type=i.BindingTypeEnum.Factory,this._binding.factory=e,new a.BindingWhenOnSyntax(this._binding)},e.prototype.toFunction=function(e){if("function"!=typeof e)throw new Error(r.INVALID_FUNCTION_BINDING);var t=this.toConstantValue(e);return this._binding.type=i.BindingTypeEnum.Function,t},e.prototype.toAutoFactory=function(e){return this._binding.type=i.BindingTypeEnum.Factory,this._binding.factory=function(t){return function(){return t.container.get(e)}},new a.BindingWhenOnSyntax(this._binding)},e.prototype.toProvider=function(e){return this._binding.type=i.BindingTypeEnum.Provider,this._binding.provider=e,new a.BindingWhenOnSyntax(this._binding)},e.prototype.toService=function(e){this.toDynamicValue(function(t){return t.container.get(e)})},e}();t.BindingToSyntax=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(65),i=n(25),o=n(26),a=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new o.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new i.BindingOnSyntax(this._binding),this._bindingInSyntax=new r.BindingInSyntax(e)}return e.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},e.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},e.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e}();t.BindingInWhenOnSyntax=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),i=n(37),o=function(){function e(e){this._binding=e}return e.prototype.inRequestScope=function(){return this._binding.scope=r.BindingScopeEnum.Request,new i.BindingWhenOnSyntax(this._binding)},e.prototype.inSingletonScope=function(){return this._binding.scope=r.BindingScopeEnum.Singleton,new i.BindingWhenOnSyntax(this._binding)},e.prototype.inTransientScope=function(){return this._binding.scope=r.BindingScopeEnum.Transient,new i.BindingWhenOnSyntax(this._binding)},e}();t.BindingInSyntax=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.of=function(t,n){var r=new e;return r.bindings=t,r.middleware=n,r},e}();t.ContainerSnapshot=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=function(){function e(){this._map=new Map}return e.prototype.getMap=function(){return this._map},e.prototype.add=function(e,t){if(null==e)throw new Error(r.NULL_ARGUMENT);if(null==t)throw new Error(r.NULL_ARGUMENT);var n=this._map.get(e);void 0!==n?(n.push(t),this._map.set(e,n)):this._map.set(e,[t])},e.prototype.get=function(e){if(null==e)throw new Error(r.NULL_ARGUMENT);var t=this._map.get(e);if(void 0!==t)return t;throw new Error(r.KEY_NOT_FOUND)},e.prototype.remove=function(e){if(null==e)throw new Error(r.NULL_ARGUMENT);if(!this._map.delete(e))throw new Error(r.KEY_NOT_FOUND)},e.prototype.removeByCondition=function(e){var t=this;this._map.forEach(function(n,r){var i=n.filter(function(t){return!e(t)});i.length>0?t._map.set(r,i):t._map.delete(r)})},e.prototype.hasKey=function(e){if(null==e)throw new Error(r.NULL_ARGUMENT);return this._map.has(e)},e.prototype.clone=function(){var t=new e;return this._map.forEach(function(e,n){e.forEach(function(e){return t.add(n,e.clone())})}),t},e.prototype.traverse=function(e){this._map.forEach(function(t,n){e(n,t)})},e}();t.Lookup=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=function(){return function(e){this.id=r.id(),this.registry=e}}();t.ContainerModule=i;var o=function(){return function(e){this.id=r.id(),this.registry=e}}();t.AsyncContainerModule=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=n(3);t.injectable=function(){return function(e){if(Reflect.hasOwnMetadata(i.PARAM_TYPES,e))throw new Error(r.DUPLICATED_INJECTABLE_DECORATOR);var t=Reflect.getMetadata(i.DESIGN_PARAM_TYPES,e)||[];return Reflect.defineMetadata(i.PARAM_TYPES,t,e),e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),i=n(8);t.tagged=function(e,t){return function(n,o,a){var s=new r.Metadata(e,t);"number"==typeof a?i.tagParameter(n,o,a,s):i.tagProperty(n,o,s)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),i=n(6),o=n(8);t.named=function(e){return function(t,n,a){var s=new i.Metadata(r.NAMED_TAG,e);"number"==typeof a?o.tagParameter(t,n,a,s):o.tagProperty(t,n,s)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),i=n(6),o=n(8);t.optional=function(){return function(e,t,n){var a=new i.Metadata(r.OPTIONAL_TAG,!0);"number"==typeof n?o.tagParameter(e,t,n,a):o.tagProperty(e,t,a)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),i=n(6),o=n(8);t.unmanaged=function(){return function(e,t,n){var a=new i.Metadata(r.UNMANAGED_TAG,!0);o.tagParameter(e,t,n,a)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),i=n(6),o=n(8);t.multiInject=function(e){return function(t,n,a){var s=new i.Metadata(r.MULTI_INJECT_TAG,e);"number"==typeof a?o.tagParameter(t,n,a,s):o.tagProperty(t,n,s)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),i=n(6),o=n(8);t.targetName=function(e){return function(t,n,a){var s=new i.Metadata(r.NAME_TAG,e);o.tagParameter(t,n,a,s)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=n(3),o=n(6);t.postConstruct=function(){return function(e,t,n){var a=new o.Metadata(i.POST_CONSTRUCT,t);if(Reflect.hasOwnMetadata(i.POST_CONSTRUCT,e.constructor))throw new Error(r.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(i.POST_CONSTRUCT,a,e.constructor)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.multiBindToService=function(e){return function(t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return n.forEach(function(n){return e.bind(n).toService(t)})}}}},function(e,t,n){"use strict";var r=n(79).EventEmitter,i=n(80),o=n(83),a=n(84),s=n(85),u=n(86),c=n(87),l=n(88),f=Math.min;n(89);var h=n(90),d=n(91),p=function(){var e,t,n=new Array(256);for(e=0;e<256;++e)n[e]="UNK";for(e in a)"<"===(t=a[e]).charAt(0)&&">"===t.charAt(t.length-1)&&(t=t.substring(1,t.length-1)),t=t.replace(/\s/g,"-"),n[parseInt(e)]=t;return n}(),_=u(Object.keys(s(p)));function m(e){return c.eq(_,e)}function v(e){return m(p[e])}function g(){r.call(this),this._curKeyState=new Array(_.length),this._pressCount=new Array(_.length),this._releaseCount=new Array(_.length),this._tickInterval=null,this._rafHandle=null,this._tickRate=0,this._lastTick=d(),this._frameTime=0,this._paused=!0,this._width=0,this._height=0,this._wantFullscreen=!1,this._wantPointerLock=!1,this._fullscreenActive=!1,this._pointerLockActive=!1,this._render=function(e){var t;e._rafHandle=requestAnimationFrame(e._render),x(e),t=e._paused?e._frameTime:f(1,(d()-e._lastTick)/e._tickRate);++e.frameCount;var n=d();e.emit("render",t);var r=d();e.frameTime=r-n}.bind(void 0,this),this.preventDefaults=!0,this.stopPropagation=!1;for(var e=0;e<_.length;++e)this._curKeyState[e]=!1,this._pressCount[e]=this._releaseCount[e]=0;this.element=null,this.bindings={},this.frameSkip=100,this.tickCount=0,this.frameCount=0,this.startTime=d(),this.tickTime=this._tickRate,this.frameTime=10,this.stickyFullscreen=!1,this.stickyPointerLock=!1,this.scroll=[0,0,0],this.mouseX=0,this.mouseY=0,this.prevMouseX=0,this.prevMouseY=0}i.inherits(g,r);var y=g.prototype;function b(e,t,n){if(n in t){for(var r=t[n],i=0,o=0,a=r.length;o<a;++o)i+=e[m(r[o])];return i}var s=m(n);return s>=0?e[s]:0}function E(e){var t=e.element;e._wantFullscreen&&!e._fullscreenActive&&(t.requestFullscreen||t.requestFullScreen||t.webkitRequestFullscreen||t.webkitRequestFullScreen||t.mozRequestFullscreen||t.mozRequestFullScreen||function(){}).call(t);e._wantPointerLock&&!e._pointerLockActive&&(t.requestPointerLock||t.webkitRequestPointerLock||t.mozRequestPointerLock||t.msRequestPointerLock||t.oRequestPointerLock||function(){}).call(t)}y.keyNames=_,y.bind=function(e){var t,n;t=e in this.bindings?this.bindings[e]:[];for(var r=1,i=arguments.length;r<i;++r)if(m(n=arguments[r])>=0)t.push(n);else if(n in this.bindings)for(var o=this.bindings[n],a=0;a<o.length;++a)t.push(o[a]);(t=u(t)).length>0&&(this.bindings[e]=t),this.emit("bind",e,t)},y.unbind=function(e){e in this.bindings&&delete this.bindings[e],this.emit("unbind",e)},y.down=function(e){return function(e,t,n){if(n in t){for(var r=t[n],i=0,o=r.length;i<o;++i)if(e[m(r[i])])return!0;return!1}var a=m(n);return a>=0&&e[a]}(this._curKeyState,this.bindings,e)},y.wasDown=function(e){return this.down(e)||!!this.press(e)},y.up=function(e){return!this.down(e)},y.wasUp=function(e){return this.up(e)||!!this.release(e)},y.press=function(e){return b(this._pressCount,this.bindings,e)},y.release=function(e){return b(this._releaseCount,this.bindings,e)},Object.defineProperty(y,"paused",{get:function(){return this._paused},set:function(e){!!e!==this._paused&&(this._paused?(this._paused=!1,this._lastTick=d()-Math.floor(this._frameTime*this._tickRate),this._tickInterval=setInterval(x,this._tickRate,this),this._rafHandle=requestAnimationFrame(this._render)):(this._paused=!0,this._frameTime=f(1,(d()-this._lastTick)/this._tickRate),clearInterval(this._tickInterval)))}});var T=document.exitFullscreen||document.cancelFullscreen||document.cancelFullScreen||document.webkitCancelFullscreen||document.webkitCancelFullScreen||document.mozCancelFullscreen||document.mozCancelFullScreen||function(){};Object.defineProperty(y,"fullscreen",{get:function(){return this._fullscreenActive},set:function(e){return!!e?(this._wantFullscreen=!0,E(this)):(this._wantFullscreen=!1,T.call(document)),this._fullscreenActive}});var w=document.exitPointerLock||document.webkitExitPointerLock||document.mozExitPointerLock||function(){};function A(e,t,n){e._curKeyState[t]!==n&&(n?e._pressCount[t]++:e._releaseCount[t]++,e._curKeyState[t]=n)}function x(e){for(var t,n,r,i=d()+e.frameSkip,o=e._pressCount,a=e._releaseCount,s=e._tickRate,u=_.length;!e._paused&&d()>=e._lastTick+s;){if(d()>i)return void(e._lastTick=d()+s);for(n=d(),e.emit("tick"),r=d(),e.tickTime=r-n,++e.tickCount,e._lastTick+=s,t=0;t<u;++t)o[t]=a[t]=0;e._pointerLockActive?(e.prevMouseX=e.mouseX=e.width>>1,e.prevMouseY=e.mouseY=e.height>>1):(e.prevMouseX=e.mouseX,e.prevMouseY=e.mouseY),e.scroll[0]=e.scroll[1]=e.scroll[2]=0}}function S(e,t){e.preventDefaults&&t.preventDefault(),e.stopPropagation&&t.stopPropagation()}function O(e,t){if(function(e){return document.activeElement===document.body||document.activeElement===e.element}(e))if(S(e,t),t.metaKey)M(e,t);else{var n=v(t.keyCode||t.char||t.which||t.charCode);n>=0&&A(e,n,!0)}}Object.defineProperty(y,"pointerLock",{get:function(){return this._pointerLockActive},set:function(e){return!!e?(this._wantPointerLock=!0,E(this)):(this._wantPointerLock=!1,w.call(document)),this._pointerLockActive}}),Object.defineProperty(y,"width",{get:function(){return this.element.clientWidth}}),Object.defineProperty(y,"height",{get:function(){return this.element.clientHeight}});var C=l(32).map(function(e){return m("mouse-"+(e+1))});function R(e,t){return S(e,t),function(e,t){for(var n=0;n<32;++n)A(e,C[n],!!(t&1<<n))}(e,0),!1}function M(e,t){var n,r=_.length,i=e._curKeyState,o=e._releaseCount;for(n=0;n<r;++n)i[n]&&++o[n],i[n]=!1;return!1}function P(){var e=document.createElement("div");return e.tabindex=1,e.style.position="absolute",e.style.left="0px",e.style.right="0px",e.style.top="0px",e.style.bottom="0px",e.style.height="100%",e.style.overflow="hidden",document.body.appendChild(e),document.body.style.overflow="hidden",document.body.style.height="100%",e}e.exports=function(e){var t=!!(e=e||{}).fullscreen,n=t;void 0!==typeof e.pointerLock&&(n=!!e.pointerLock);var r=new g;return r._tickRate=e.tickRate||30,r.frameSkip=e.frameSkip||5*(r._tickRate+5),r.stickyFullscreen=!!e.stickyFullscreen||!!e.sticky,r.stickyPointerLock=!!e.stickyPointerLock||!!e.sticky,e.bindings&&(r.bindings=e.bindings),setTimeout(function(){o(function(){var i=e.element;if("string"==typeof i){var o=document.querySelector(i);o||(o=document.getElementById(i)),o||(o=document.getElementByClass(i)[0]),o||(o=P()),r.element=o}else r.element="object"==typeof i&&i?i:"function"==typeof i?i():P();r.element.style&&(r.element.style["-webkit-touch-callout"]="none",r.element.style["-webkit-user-select"]="none",r.element.style["-khtml-user-select"]="none",r.element.style["-moz-user-select"]="none",r.element.style["-ms-user-select"]="none",r.element.style["user-select"]="none"),r._width=r.element.clientWidth,r._height=r.element.clientHeight;var a=function(e,t){var n=0|e.element.clientWidth,r=0|e.element.clientHeight;n===e._width&&r===e._height||(e._width=n,e._height=r,e.emit("resize",n,r))}.bind(void 0,r);"undefined"!=typeof MutationObserver?new MutationObserver(a).observe(r.element,{attributes:!0,subtree:!0}):r.element.addEventListener("DOMSubtreeModified",a,!1),window.addEventListener("resize",a,!1),window.addEventListener("keydown",O.bind(void 0,r),!1),window.addEventListener("keyup",function(e,t){S(e,t);var n=v(t.keyCode||t.char||t.which||t.charCode);n>=0&&A(e,n,!1)}.bind(void 0,r),!1),r.element.oncontextmenu=function(e,t){return S(e,t),!1}.bind(void 0,r),r.element.addEventListener("mousedown",function(e,t){return S(e,t),A(e,C[t.button],!0),!1}.bind(void 0,r),!1),r.element.addEventListener("mouseup",function(e,t){return S(e,t),A(e,C[t.button],!1),!1}.bind(void 0,r),!1),r.element.addEventListener("mousemove",function(e,t){if(S(e,t),e._pointerLockActive){var n=t.movementX||t.mozMovementX||t.webkitMovementX||0,r=t.movementY||t.mozMovementY||t.webkitMovementY||0;e.mouseX+=n,e.mouseY+=r}else e.mouseX=t.clientX-e.element.offsetLeft,e.mouseY=t.clientY-e.element.offsetTop;return!1}.bind(void 0,r),!1),r.element.addEventListener("mouseenter",function(e,t){return S(e,t),e._pointerLockActive?(e.prevMouseX=e.mouseX=e.width>>1,e.prevMouseY=e.mouseY=e.height>>1):(e.prevMouseX=e.mouseX=t.clientX-e.element.offsetLeft,e.prevMouseY=e.mouseY=t.clientY-e.element.offsetTop),!1}.bind(void 0,r),!1);var s=R.bind(void 0,r);r.element.addEventListener("mouseleave",s,!1),r.element.addEventListener("mouseout",s,!1),window.addEventListener("mouseleave",s,!1),window.addEventListener("mouseout",s,!1);var u=M.bind(void 0,r);r.element.addEventListener("blur",u,!1),r.element.addEventListener("focusout",u,!1),r.element.addEventListener("focus",u,!1),window.addEventListener("blur",u,!1),window.addEventListener("focusout",u,!1),window.addEventListener("focus",u,!1),h(r.element,function(e,t){S(e,t);var n=1;switch(t.deltaMode){case 0:n=1;break;case 1:n=12;break;case 2:n=e.height}return e.scroll[0]+=t.deltaX*n,e.scroll[1]+=t.deltaY*n,e.scroll[2]+=t.deltaZ*n||0,!1}.bind(void 0,r),!1);var c=function(e){e._fullscreenActive=document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||!1,!e.stickyFullscreen&&e._fullscreenActive&&(e._wantFullscreen=!1)}.bind(void 0,r);document.addEventListener("fullscreenchange",c,!1),document.addEventListener("mozfullscreenchange",c,!1),document.addEventListener("webkitfullscreenchange",c,!1),r.element.addEventListener("click",E.bind(void 0,r),!1);var l=function(e,t){e._pointerLockActive=e.element===(document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement||null),!e.stickyPointerLock&&e._pointerLockActive&&(e._wantPointerLock=!1)}.bind(void 0,r);document.addEventListener("pointerlockchange",l,!1),document.addEventListener("mozpointerlockchange",l,!1),document.addEventListener("webkitpointerlockchange",l,!1),document.addEventListener("pointerlocklost",l,!1),document.addEventListener("webkitpointerlocklost",l,!1),document.addEventListener("mozpointerlocklost",l,!1),r.fullscreen=t,r.pointerLock=n,r.bind("mouse-left","mouse-1"),r.bind("mouse-right","mouse-3"),r.bind("mouse-middle","mouse-2"),r._lastTick=d(),r.startTime=d(),r.paused=!1,r.emit("init")})},0),r}},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,a,s,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(o(n=this._events[e]))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(i(n))for(s=Array.prototype.slice.call(arguments,1),a=(c=n.slice()).length,u=0;u<a;u++)c[u].apply(this,s);return!0},n.prototype.addListener=function(e,t){var a;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned&&(a=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&a>0&&this._events[e].length>a&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){if(!r(t))throw TypeError("listener must be a function");var n=!1;function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}return i.listener=t,this.on(e,i),this},n.prototype.removeListener=function(e,t){var n,o,a,s;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(a=(n=this._events[e]).length,o=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(n)){for(s=a;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){o=s;break}if(o<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,n){(function(e,r){var i=/%[sdj%]/g;t.format=function(e){if(!v(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(s(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,o=r.length,a=String(e).replace(i,function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}}),u=r[n];n<o;u=r[++n])_(u)||!b(u)?a+=" "+u:a+=" "+s(u);return a},t.deprecate=function(n,i){if(g(e.process))return function(){return t.deprecate(n,i).apply(this,arguments)};if(!0===r.noDeprecation)return n;var o=!1;return function(){if(!o){if(r.throwDeprecation)throw new Error(i);r.traceDeprecation?console.trace(i):console.error(i),o=!0}return n.apply(this,arguments)}};var o,a={};function s(e,n){var r={seen:[],stylize:c};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),p(n)?r.showHidden=n:n&&t._extend(r,n),g(r.showHidden)&&(r.showHidden=!1),g(r.depth)&&(r.depth=2),g(r.colors)&&(r.colors=!1),g(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=u),l(r,e,r.depth)}function u(e,t){var n=s.styles[t];return n?"["+s.colors[n][0]+"m"+e+"["+s.colors[n][1]+"m":e}function c(e,t){return e}function l(e,n,r){if(e.customInspect&&n&&w(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,e);return v(i)||(i=l(e,i,r)),i}var o=function(e,t){if(g(t))return e.stylize("undefined","undefined");if(v(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(m(t))return e.stylize(""+t,"number");if(p(t))return e.stylize(""+t,"boolean");if(_(t))return e.stylize("null","null")}(e,n);if(o)return o;var a=Object.keys(n),s=function(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(n)),T(n)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return f(n);if(0===a.length){if(w(n)){var u=n.name?": "+n.name:"";return e.stylize("[Function"+u+"]","special")}if(y(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(E(n))return e.stylize(Date.prototype.toString.call(n),"date");if(T(n))return f(n)}var c,b="",A=!1,x=["{","}"];(d(n)&&(A=!0,x=["[","]"]),w(n))&&(b=" [Function"+(n.name?": "+n.name:"")+"]");return y(n)&&(b=" "+RegExp.prototype.toString.call(n)),E(n)&&(b=" "+Date.prototype.toUTCString.call(n)),T(n)&&(b=" "+f(n)),0!==a.length||A&&0!=n.length?r<0?y(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),c=A?function(e,t,n,r,i){for(var o=[],a=0,s=t.length;a<s;++a)O(t,String(a))?o.push(h(e,t,n,r,String(a),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(h(e,t,n,r,i,!0))}),o}(e,n,r,s,a):a.map(function(t){return h(e,n,r,s,t,A)}),e.seen.pop(),function(e,t,n){if(e.reduce(function(e,t){return 0,t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(c,b,x)):x[0]+b+x[1]}function f(e){return"["+Error.prototype.toString.call(e)+"]"}function h(e,t,n,r,i,o){var a,s,u;if((u=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(s=e.stylize("[Setter]","special")),O(r,i)||(a="["+i+"]"),s||(e.seen.indexOf(u.value)<0?(s=_(n)?l(e,u.value,null):l(e,u.value,n-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")):s=e.stylize("[Circular]","special")),g(a)){if(o&&i.match(/^\d+$/))return s;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function d(e){return Array.isArray(e)}function p(e){return"boolean"==typeof e}function _(e){return null===e}function m(e){return"number"==typeof e}function v(e){return"string"==typeof e}function g(e){return void 0===e}function y(e){return b(e)&&"[object RegExp]"===A(e)}function b(e){return"object"==typeof e&&null!==e}function E(e){return b(e)&&"[object Date]"===A(e)}function T(e){return b(e)&&("[object Error]"===A(e)||e instanceof Error)}function w(e){return"function"==typeof e}function A(e){return Object.prototype.toString.call(e)}function x(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(g(o)&&(o=r.env.NODE_DEBUG||""),e=e.toUpperCase(),!a[e])if(new RegExp("\\b"+e+"\\b","i").test(o)){var n=r.pid;a[e]=function(){var r=t.format.apply(t,arguments);console.error("%s %d: %s",e,n,r)}}else a[e]=function(){};return a[e]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=d,t.isBoolean=p,t.isNull=_,t.isNullOrUndefined=function(e){return null==e},t.isNumber=m,t.isString=v,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=g,t.isRegExp=y,t.isObject=b,t.isDate=E,t.isError=T,t.isFunction=w,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(81);var S=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function O(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){var e,n;console.log("%s - %s",(e=new Date,n=[x(e.getHours()),x(e.getMinutes()),x(e.getSeconds())].join(":"),[e.getDate(),S[e.getMonth()],n].join(" ")),t.format.apply(t,arguments))},t.inherits=n(82),t._extend=function(e,t){if(!t||!b(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(this,n(23),n(32))},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){var r,i,o,a,s;e.exports=(i=[],o=document,a=o.documentElement.doScroll,(s=(a?/^loaded|^c/:/^loaded|^i|^c/).test(o.readyState))||o.addEventListener("DOMContentLoaded",r=function(){for(o.removeEventListener("DOMContentLoaded",r),s=1;r=i.shift();)r()}),function(e){s?setTimeout(e,0):i.push(e)})},function(e,t){var n,r="undefined"!=typeof window?window.navigator.userAgent:"",i=/OS X/.test(r),o=/Opera/.test(r),a=!/like Gecko/.test(r)&&!o,s=e.exports={0:i?"<menu>":"<UNK>",1:"<mouse 1>",2:"<mouse 2>",3:"<break>",4:"<mouse 3>",5:"<mouse 4>",6:"<mouse 5>",8:"<backspace>",9:"<tab>",12:"<clear>",13:"<enter>",16:"<shift>",17:"<control>",18:"<alt>",19:"<pause>",20:"<caps-lock>",21:"<ime-hangul>",23:"<ime-junja>",24:"<ime-final>",25:"<ime-kanji>",27:"<escape>",28:"<ime-convert>",29:"<ime-nonconvert>",30:"<ime-accept>",31:"<ime-mode-change>",27:"<escape>",32:"<space>",33:"<page-up>",34:"<page-down>",35:"<end>",36:"<home>",37:"<left>",38:"<up>",39:"<right>",40:"<down>",41:"<select>",42:"<print>",43:"<execute>",44:"<snapshot>",45:"<insert>",46:"<delete>",47:"<help>",91:"<meta>",92:"<meta>",93:i?"<meta>":"<menu>",95:"<sleep>",106:"<num-*>",107:"<num-+>",108:"<num-enter>",109:"<num--\x3e",110:"<num-.>",111:"<num-/>",144:"<num-lock>",145:"<scroll-lock>",160:"<shift-left>",161:"<shift-right>",162:"<control-left>",163:"<control-right>",164:"<alt-left>",165:"<alt-right>",166:"<browser-back>",167:"<browser-forward>",168:"<browser-refresh>",169:"<browser-stop>",170:"<browser-search>",171:"<browser-favorites>",172:"<browser-home>",173:i&&a?"-":"<volume-mute>",174:"<volume-down>",175:"<volume-up>",176:"<next-track>",177:"<prev-track>",178:"<stop>",179:"<play-pause>",180:"<launch-mail>",181:"<launch-media-select>",182:"<launch-app 1>",183:"<launch-app 2>",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",223:"<meta>",224:"<meta>",226:"<alt-gr>",229:"<ime-process>",231:o?"`":"<unicode>",246:"<attention>",247:"<crsel>",248:"<exsel>",249:"<erase-eof>",250:"<play>",251:"<zoom>",252:"<no-name>",253:"<pa-1>",254:"<clear>"};for(n=58;n<65;++n)s[n]=String.fromCharCode(n);for(n=48;n<58;++n)s[n]=n-48+"";for(n=65;n<91;++n)s[n]=String.fromCharCode(n);for(n=96;n<106;++n)s[n]="<num-"+(n-96)+">";for(n=112;n<136;++n)s[n]="F"+(n-111)},function(e,t,n){"use strict";e.exports=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t}},function(e,t,n){"use strict";e.exports=function(e,t,n){return 0===e.length?e:t?(n||e.sort(t),function(e,t){for(var n=1,r=e.length,i=e[0],o=e[0],a=1;a<r;++a)if(o=i,t(i=e[a],o)){if(a===n){n++;continue}e[n++]=i}return e.length=n,e}(e,t)):(n||e.sort(),function(e){for(var t=1,n=e.length,r=e[0],i=e[0],o=1;o<n;++o,i=r)if(i=r,(r=e[o])!==i){if(o===t){t++;continue}e[t++]=r}return e.length=t,e}(e))}},function(e,t,n){"use strict";function r(e,t,n,r,i,o){var a=["function ",e,"(a,l,h,",r.join(","),"){",o?"":"var i=",n?"l-1":"h+1",";while(l<=h){var m=(l+h)>>>1,x=a",i?".get(m)":"[m]"];return o?t.indexOf("c")<0?a.push(";if(x===y){return m}else if(x<=y){"):a.push(";var p=c(x,y);if(p===0){return m}else if(p<=0){"):a.push(";if(",t,"){i=m;"),n?a.push("l=m+1}else{h=m-1}"):a.push("h=m-1}else{l=m+1}"),a.push("}"),o?a.push("return -1};"):a.push("return i};"),a.join("")}function i(e,t,n,i){return new Function([r("A","x"+e+"y",t,["y"],!1,i),r("B","x"+e+"y",t,["y"],!0,i),r("P","c(x,y)"+e+"0",t,["y","c"],!1,i),r("Q","c(x,y)"+e+"0",t,["y","c"],!0,i),"function dispatchBsearch",n,"(a,y,c,l,h){if(a.shape){if(typeof(c)==='function'){return Q(a,(l===undefined)?0:l|0,(h===undefined)?a.shape[0]-1:h|0,y,c)}else{return B(a,(c===undefined)?0:c|0,(l===undefined)?a.shape[0]-1:l|0,y)}}else{if(typeof(c)==='function'){return P(a,(l===undefined)?0:l|0,(h===undefined)?a.length-1:h|0,y,c)}else{return A(a,(c===undefined)?0:c|0,(l===undefined)?a.length-1:l|0,y)}}}return dispatchBsearch",n].join(""))()}e.exports={ge:i(">=",!1,"GE"),gt:i(">",!1,"GT"),lt:i("<",!0,"LT"),le:i("<=",!0,"LE"),eq:i("-",!0,"EQ",!0)}},function(e,t,n){"use strict";e.exports=function(e){for(var t=new Array(e),n=0;n<e;++n)t[n]=n;return t}},function(e,t){for(var n=0,r=["ms","moz","webkit","o"],i=0;i<r.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[r[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[r[i]+"CancelAnimationFrame"]||window[r[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,t){var r=(new Date).getTime(),i=Math.max(0,16-(r-n)),o=window.setTimeout(function(){e(r+i)},i);return n=r+i,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})},function(e,t){var n,r,i="";function o(e,t,o,a){e[n](i+t,"wheel"==r?o:function(e){!e&&(e=window.event);var t={originalEvent:e,target:e.target||e.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==e.type?0:1,deltaX:0,delatZ:0,preventDefault:function(){e.preventDefault?e.preventDefault():e.returnValue=!1}};return"mousewheel"==r?(t.deltaY=-.025*e.wheelDelta,e.wheelDeltaX&&(t.deltaX=-.025*e.wheelDeltaX)):t.deltaY=e.detail,o(t)},a||!1)}window.addEventListener?n="addEventListener":(n="attachEvent",i="on"),r="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",e.exports=function(e,t,n){o(e,r,t,n),"DOMMouseScroll"==r&&o(e,"MozMousePixelScroll",t,n)}},function(e,t){"object"==typeof window.performance?window.performance.now?e.exports=function(){return window.performance.now()}:window.performance.webkitNow&&(e.exports=function(){return window.performance.webkitNow()}):Date.now?e.exports=Date.now:e.exports=function(){return(new Date).getTime()}},function(e,t,n){"use strict";var r=new("undefined"==typeof WeakMap?n(93):WeakMap);e.exports=function(e){var t=r.get(e);if(t)return t;for(var n={},i=e.getSupportedExtensions(),o=0;o<i.length;++o){var a=i[o];if(0!==a.indexOf("MOZ_")){var s=e.getExtension(i[o]);if(s)for(;;){n[a]=s;var u=a.replace(/^[A-Z]+_/,"");if(u===a)break;a=u}}}return r.set(e,n),n}},function(e,t){!function(){"use strict";if("undefined"==typeof ses||!ses.ok||ses.ok()){"undefined"!=typeof ses&&(ses.weakMapPermitHostObjects=m);var t=!1;if("function"==typeof WeakMap){var n=WeakMap;if("undefined"!=typeof navigator&&/Firefox/.test(navigator.userAgent))   ;else{var r=new n,i=Object.freeze({});if(r.set(i,1),1===r.get(i))return void(e.exports=WeakMap);t=!0}}Object.prototype.hasOwnProperty;var o=Object.getOwnPropertyNames,a=Object.defineProperty,s=Object.isExtensible,u="weakmap:",c=u+"ident:"+Math.random()+"___";if("undefined"!=typeof crypto&&"function"==typeof crypto.getRandomValues&&"function"==typeof ArrayBuffer&&"function"==typeof Uint8Array){var l=new ArrayBuffer(25),f=new Uint8Array(l);crypto.getRandomValues(f),c=u+"rand:"+Array.prototype.map.call(f,function(e){return(e%36).toString(36)}).join("")+"___"}if(a(Object,"getOwnPropertyNames",{value:function(e){return o(e).filter(v)}}),"getPropertyNames"in Object){var h=Object.getPropertyNames;a(Object,"getPropertyNames",{value:function(e){return h(e).filter(v)}})}!function(){var e=Object.freeze;a(Object,"freeze",{value:function(t){return g(t),e(t)}});var t=Object.seal;a(Object,"seal",{value:function(e){return g(e),t(e)}});var n=Object.preventExtensions;a(Object,"preventExtensions",{value:function(e){return g(e),n(e)}})}();var d=!1,p=0,_=function(){this instanceof _||b();var e=[],t=[],n=p++;return Object.create(_.prototype,{get___:{value:y(function(r,i){var o,a=g(r);return a?n in a?a[n]:i:(o=e.indexOf(r))>=0?t[o]:i})},has___:{value:y(function(t){var r=g(t);return r?n in r:e.indexOf(t)>=0})},set___:{value:y(function(r,i){var o,a=g(r);return a?a[n]=i:(o=e.indexOf(r))>=0?t[o]=i:(o=e.length,t[o]=i,e[o]=r),this})},delete___:{value:y(function(r){var i,o,a=g(r);return a?n in a&&delete a[n]:!((i=e.indexOf(r))<0||(o=e.length-1,e[i]=void 0,t[i]=t[o],e[i]=e[o],e.length=o,t.length=o,0))})}})};_.prototype=Object.create(Object.prototype,{get:{value:function(e,t){return this.get___(e,t)},writable:!0,configurable:!0},has:{value:function(e){return this.has___(e)},writable:!0,configurable:!0},set:{value:function(e,t){return this.set___(e,t)},writable:!0,configurable:!0},delete:{value:function(e){return this.delete___(e)},writable:!0,configurable:!0}}),"function"==typeof n?function(){function r(){this instanceof _||b();var e,r=new n,i=void 0,o=!1;return e=t?function(e,t){return r.set(e,t),r.has(e)||(i||(i=new _),i.set(e,t)),this}:function(e,t){if(o)try{r.set(e,t)}catch(n){i||(i=new _),i.set___(e,t)}else r.set(e,t);return this},Object.create(_.prototype,{get___:{value:y(function(e,t){return i?r.has(e)?r.get(e):i.get___(e,t):r.get(e,t)})},has___:{value:y(function(e){return r.has(e)||!!i&&i.has___(e)})},set___:{value:y(e)},delete___:{value:y(function(e){var t=!!r.delete(e);return i&&i.delete___(e)||t})},permitHostObjects___:{value:y(function(e){if(e!==m)throw new Error("bogus call to permitHostObjects___");o=!0})}})}t&&"undefined"!=typeof Proxy&&(Proxy=void 0),r.prototype=_.prototype,e.exports=r,Object.defineProperty(WeakMap.prototype,"constructor",{value:WeakMap,enumerable:!1,configurable:!0,writable:!0})}():("undefined"!=typeof Proxy&&(Proxy=void 0),e.exports=_)}function m(e){e.permitHostObjects___&&e.permitHostObjects___(m)}function v(e){return!(e.substr(0,u.length)==u&&"___"===e.substr(e.length-3))}function g(e){if(e!==Object(e))throw new TypeError("Not an object: "+e);var t=e[c];if(t&&t.key===e)return t;if(s(e)){t={key:e};try{return a(e,c,{value:t,writable:!1,enumerable:!1,configurable:!1}),t}catch(e){return}}}function y(e){return e.prototype=null,Object.freeze(e)}function b(){d||"undefined"==typeof console||(d=!0,console.warn("WeakMap should be invoked as new WeakMap(), not WeakMap(). This will be an error in the future."))}}()},function(e,t,n){"use strict";var r=n(39),i=n(19);function o(e){return new Function("y","return function(){return y}")(e)}function a(e,t){for(var n=new Array(e),r=0;r<e;++r)n[r]=t;return n}e.exports=function(e,t,n,s){function u(e,t,n){switch(n){case"bool":case"int":case"sampler2D":case"samplerCube":return"gl.uniform1i(locations["+t+"],obj"+e+")";case"float":return"gl.uniform1f(locations["+t+"],obj"+e+")";default:var r=n.indexOf("vec");if(!(0<=r&&r<=1&&n.length===4+r)){if(0===n.indexOf("mat")&&4===n.length){var o=n.charCodeAt(n.length-1)-48;if(o<2||o>4)throw new i("","Invalid uniform dimension type for matrix "+name+": "+n);return"gl.uniformMatrix"+o+"fv(locations["+t+"],false,obj"+e+")"}throw new i("","Unknown uniform data type for "+name+": "+n)}var o=n.charCodeAt(n.length-1)-48;if(o<2||o>4)throw new i("","Invalid data type");switch(n.charAt(0)){case"b":case"i":return"gl.uniform"+o+"iv(locations["+t+"],obj"+e+")";case"v":return"gl.uniform"+o+"fv(locations["+t+"],obj"+e+")";default:throw new i("","Unrecognized data type for vector "+name+": "+n)}}}function c(t){for(var r=["return function updateProperty(obj){"],i=function e(t,n){if("object"!=typeof n)return[[t,n]];var r=[];for(var i in n){var o=n[i],a=t;parseInt(i)+""===i?a+="["+i+"]":a+="."+i,"object"==typeof o?r.push.apply(r,e(a,o)):r.push([a,o])}return r}("",t),o=0;o<i.length;++o){var a=i[o],c=a[0],l=a[1];s[l]&&r.push(u(c,l,n[l].type))}r.push("return obj}");var f=new Function("gl","locations",r.join("\n"));return f(e,s)}function l(r,u,l){if("object"==typeof l){var h=f(l);Object.defineProperty(r,u,{get:o(h),set:c(l),enumerable:!0,configurable:!1})}else s[l]?Object.defineProperty(r,u,{get:(d=l,p=new Function("gl","wrapper","locations","return function(){return gl.getUniform(wrapper.program,locations["+d+"])}"),p(e,t,s)),set:c(l),enumerable:!0,configurable:!1}):r[u]=function(e){switch(e){case"bool":return!1;case"int":case"sampler2D":case"samplerCube":case"float":return 0;default:var t=e.indexOf("vec");if(0<=t&&t<=1&&e.length===4+t){var n=e.charCodeAt(e.length-1)-48;if(n<2||n>4)throw new i("","Invalid data type");return"b"===e.charAt(0)?a(n,!1):a(n,0)}if(0===e.indexOf("mat")&&4===e.length){var n=e.charCodeAt(e.length-1)-48;if(n<2||n>4)throw new i("","Invalid uniform dimension type for matrix "+name+": "+e);return a(n*n,0)}throw new i("","Unknown uniform data type for "+name+": "+e)}}(n[l].type);var d,p}function f(e){var t;if(Array.isArray(e)){t=new Array(e.length);for(var n=0;n<e.length;++n)l(t,n,e[n])}else for(var r in t={},e)l(t,r,e[r]);return t}var h=r(n,!0);return{get:o(f(h)),set:c(h),enumerable:!0,configurable:!0}}},function(e,t,n){"use strict";e.exports=function(e,t,n,i){for(var o={},u=0,c=n.length;u<c;++u){var l=n[u],f=l.name,h=l.type,d=l.locations;switch(h){case"bool":case"int":case"float":a(e,t,d[0],i,1,o,f);break;default:if(h.indexOf("vec")>=0){var p=h.charCodeAt(h.length-1)-48;if(p<2||p>4)throw new r("","Invalid data type for attribute "+f+": "+h);a(e,t,d[0],i,p,o,f)}else{if(!(h.indexOf("mat")>=0))throw new r("","Unknown data type for attribute "+f+": "+h);var p=h.charCodeAt(h.length-1)-48;if(p<2||p>4)throw new r("","Invalid data type for attribute "+f+": "+h);s(e,t,d,i,p,o,f)}}}return o};var r=n(19);function i(e,t,n,r,i,o){this._gl=e,this._wrapper=t,this._index=n,this._locations=r,this._dimension=i,this._constFunc=o}var o=i.prototype;function a(e,t,n,r,o,a,s){for(var u=["gl","v"],c=[],l=0;l<o;++l)u.push("x"+l),c.push("x"+l);u.push("if(x0.length===void 0){return gl.vertexAttrib"+o+"f(v,"+c.join()+")}else{return gl.vertexAttrib"+o+"fv(v,x0)}");var f=Function.apply(null,u),h=new i(e,t,n,r,o,f);Object.defineProperty(a,s,{set:function(t){return e.disableVertexAttribArray(r[n]),f(e,r[n],t),t},get:function(){return h},enumerable:!0})}function s(e,t,n,r,i,o,s){for(var u=new Array(i),c=new Array(i),l=0;l<i;++l)a(e,t,n[l],r,i,u,l),c[l]=u[l];Object.defineProperty(u,"location",{set:function(e){if(Array.isArray(e))for(var t=0;t<i;++t)c[t].location=e[t];else for(t=0;t<i;++t)c[t].location=e+t;return e},get:function(){for(var e=new Array(i),t=0;t<i;++t)e[t]=r[n[t]];return e},enumerable:!0}),u.pointer=function(t,o,a,s){t=t||e.FLOAT,o=!!o,a=a||i*i,s=s||0;for(var u=0;u<i;++u){var c=r[n[u]];e.vertexAttribPointer(c,i,t,o,a,s+u*i),e.enableVertexAttribArray(c)}};var f=new Array(i),h=e["vertexAttrib"+i+"fv"];Object.defineProperty(o,s,{set:function(t){for(var o=0;o<i;++o){var a=r[n[o]];if(e.disableVertexAttribArray(a),Array.isArray(t[0]))h.call(e,a,t[o]);else{for(var s=0;s<i;++s)f[s]=t[i*o+s];h.call(e,a,f)}}return t},get:function(){return u},enumerable:!0})}o.pointer=function(e,t,n,r){var i=this._gl,o=this._locations[this._index];i.vertexAttribPointer(o,this._dimension,e||i.FLOAT,!!t,n||0,r||0),i.enableVertexAttribArray(o)},o.set=function(e,t,n,r){return this._constFunc(this._locations[this._index],e,t,n,r)},Object.defineProperty(o,"location",{get:function(){return this._locations[this._index]},set:function(e){return e!==this._locations[this._index]&&(this._locations[this._index]=0|e,this._wrapper.program=null),0|e}})},function(e,t,n){"use strict";t.shader=function(e,t,n){return l(e).getShaderReference(t,n)},t.program=function(e,t,n,r,i){return l(e).getProgram(t,n,r,i)};var r=n(19),i=n(97),o=new("undefined"==typeof WeakMap?n(111):WeakMap),a=0;function s(e,t,n,r,i,o,a){this.id=e,this.src=t,this.type=n,this.shader=r,this.count=o,this.programs=[],this.cache=a}function u(e){this.gl=e,this.shaders=[{},{}],this.programs={}}s.prototype.dispose=function(){if(0==--this.count){for(var e=this.cache,t=e.gl,n=this.programs,r=0,i=n.length;r<i;++r){var o=e.programs[n[r]];o&&(delete e.programs[r],t.deleteProgram(o))}t.deleteShader(this.shader),delete e.shaders[this.type===t.FRAGMENT_SHADER|0][this.src]}};var c=u.prototype;function l(e){var t=o.get(e);return t||(t=new u(e),o.set(e,t)),t}c.getShaderReference=function(e,t){var n=this.gl,o=this.shaders[e===n.FRAGMENT_SHADER|0],u=o[t];if(u&&n.isShader(u.shader))u.count+=1;else{var c=function(e,t,n){var o=e.createShader(t);if(e.shaderSource(o,n),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS)){var a=e.getShaderInfoLog(o);try{var s=i(a,n,t)}catch(e){throw console.warn("Failed to format compiler error: "+e),new r(a,"Error compiling shader:\n"+a)}throw new r(a,s.short,s.long)}return o}(n,e,t);u=o[t]=new s(a++,t,e,c,[],1,this)}return u},c.getProgram=function(e,t,n,i){var o=[e.id,t.id,n.join(":"),i.join(":")].join("@"),a=this.programs[o];return a&&this.gl.isProgram(a)||(this.programs[o]=a=function(e,t,n,i,o){var a=e.createProgram();e.attachShader(a,t),e.attachShader(a,n);for(var s=0;s<i.length;++s)e.bindAttribLocation(a,o[s],i[s]);if(e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS)){var u=e.getProgramInfoLog(a);throw new r(u,"Error linking program: "+u)}return a}(this.gl,e.shader,t.shader,n,i),e.programs.push(o),t.programs.push(o)),a}},function(e,t,n){var r=n(98).sprintf,i=n(99),o=n(101),a=n(108);e.exports=function(e,t,n){"use strict";var s=o(t)||"of unknown name (see npm glsl-shader-name)",u="unknown type";void 0!==n&&(u=n===i.FRAGMENT_SHADER?"fragment":"vertex");for(var c=r("Error compiling %s shader %s:\n",u,s),l=r("%s%s",c,e),f=e.split("\n"),h={},d=0;d<f.length;d++){var p=f[d];if(""!==p&&"\0"!==p){var _=parseInt(p.split(":")[2]);if(isNaN(_))throw new Error(r("Could not parse error: %s",p));h[_]=p}}for(var m=a(t).split("\n"),d=0;d<m.length;d++)if(h[d+3]||h[d+2]||h[d+1]){var v=m[d];if(c+=v+"\n",h[d+1]){var g=h[d+1];g=g.substr(g.split(":",3).join(":").length+1).trim(),c+=r("^^^ %s\n\n",g)}}return{long:c.trim(),short:l.trim()}}},function(e,t,n){var r;!function(){"use strict";var i={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function o(e){return function(e,t){var n,r,a,s,u,c,l,f,h,d=1,p=e.length,_="";for(r=0;r<p;r++)if("string"==typeof e[r])_+=e[r];else if("object"==typeof e[r]){if((s=e[r]).keys)for(n=t[d],a=0;a<s.keys.length;a++){if(null==n)throw new Error(o('[sprintf] Cannot access property "%s" of undefined value "%s"',s.keys[a],s.keys[a-1]));n=n[s.keys[a]]}else n=s.param_no?t[s.param_no]:t[d++];if(i.not_type.test(s.type)&&i.not_primitive.test(s.type)&&n instanceof Function&&(n=n()),i.numeric_arg.test(s.type)&&"number"!=typeof n&&isNaN(n))throw new TypeError(o("[sprintf] expecting number but found %T",n));switch(i.number.test(s.type)&&(f=n>=0),s.type){case"b":n=parseInt(n,10).toString(2);break;case"c":n=String.fromCharCode(parseInt(n,10));break;case"d":case"i":n=parseInt(n,10);break;case"j":n=JSON.stringify(n,null,s.width?parseInt(s.width):0);break;case"e":n=s.precision?parseFloat(n).toExponential(s.precision):parseFloat(n).toExponential();break;case"f":n=s.precision?parseFloat(n).toFixed(s.precision):parseFloat(n);break;case"g":n=s.precision?String(Number(n.toPrecision(s.precision))):parseFloat(n);break;case"o":n=(parseInt(n,10)>>>0).toString(8);break;case"s":n=String(n),n=s.precision?n.substring(0,s.precision):n;break;case"t":n=String(!!n),n=s.precision?n.substring(0,s.precision):n;break;case"T":n=Object.prototype.toString.call(n).slice(8,-1).toLowerCase(),n=s.precision?n.substring(0,s.precision):n;break;case"u":n=parseInt(n,10)>>>0;break;case"v":n=n.valueOf(),n=s.precision?n.substring(0,s.precision):n;break;case"x":n=(parseInt(n,10)>>>0).toString(16);break;case"X":n=(parseInt(n,10)>>>0).toString(16).toUpperCase()}i.json.test(s.type)?_+=n:(!i.number.test(s.type)||f&&!s.sign?h="":(h=f?"+":"-",n=n.toString().replace(i.sign,"")),c=s.pad_char?"0"===s.pad_char?"0":s.pad_char.charAt(1):" ",l=s.width-(h+n).length,u=s.width&&l>0?c.repeat(l):"",_+=s.align?h+n+u:"0"===c?h+u+n:u+h+n)}return _}(function(e){if(s[e])return s[e];var t,n=e,r=[],o=0;for(;n;){if(null!==(t=i.text.exec(n)))r.push(t[0]);else if(null!==(t=i.modulo.exec(n)))r.push("%");else{if(null===(t=i.placeholder.exec(n)))throw new SyntaxError("[sprintf] unexpected placeholder");if(t[2]){o|=1;var a=[],u=t[2],c=[];if(null===(c=i.key.exec(u)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(a.push(c[1]);""!==(u=u.substring(c[0].length));)if(null!==(c=i.key_access.exec(u)))a.push(c[1]);else{if(null===(c=i.index_access.exec(u)))throw new SyntaxError("[sprintf] failed to parse named argument key");a.push(c[1])}t[2]=a}else o|=2;if(3===o)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");r.push({placeholder:t[0],param_no:t[1],keys:t[2],sign:t[3],pad_char:t[4],align:t[5],width:t[6],precision:t[7],type:t[8]})}n=n.substring(t[0].length)}return s[e]=r}(e),arguments)}function a(e,t){return o.apply(null,[e].concat(t||[]))}var s=Object.create(null);t.sprintf=o,t.vsprintf=a,"undefined"!=typeof window&&(window.sprintf=o,window.vsprintf=a,void 0===(r=function(){return{sprintf:o,vsprintf:a}}.call(t,n,t,e))||(e.exports=r))}()},function(e,t,n){var r=n(100);e.exports=function(e){return r[e]}},function(e,t){e.exports={0:"NONE",1:"ONE",2:"LINE_LOOP",3:"LINE_STRIP",4:"TRIANGLES",5:"TRIANGLE_STRIP",6:"TRIANGLE_FAN",256:"DEPTH_BUFFER_BIT",512:"NEVER",513:"LESS",514:"EQUAL",515:"LEQUAL",516:"GREATER",517:"NOTEQUAL",518:"GEQUAL",519:"ALWAYS",768:"SRC_COLOR",769:"ONE_MINUS_SRC_COLOR",770:"SRC_ALPHA",771:"ONE_MINUS_SRC_ALPHA",772:"DST_ALPHA",773:"ONE_MINUS_DST_ALPHA",774:"DST_COLOR",775:"ONE_MINUS_DST_COLOR",776:"SRC_ALPHA_SATURATE",1024:"STENCIL_BUFFER_BIT",1028:"FRONT",1029:"BACK",1032:"FRONT_AND_BACK",1280:"INVALID_ENUM",1281:"INVALID_VALUE",1282:"INVALID_OPERATION",1285:"OUT_OF_MEMORY",1286:"INVALID_FRAMEBUFFER_OPERATION",2304:"CW",2305:"CCW",2849:"LINE_WIDTH",2884:"CULL_FACE",2885:"CULL_FACE_MODE",2886:"FRONT_FACE",2928:"DEPTH_RANGE",2929:"DEPTH_TEST",2930:"DEPTH_WRITEMASK",2931:"DEPTH_CLEAR_VALUE",2932:"DEPTH_FUNC",2960:"STENCIL_TEST",2961:"STENCIL_CLEAR_VALUE",2962:"STENCIL_FUNC",2963:"STENCIL_VALUE_MASK",2964:"STENCIL_FAIL",2965:"STENCIL_PASS_DEPTH_FAIL",2966:"STENCIL_PASS_DEPTH_PASS",2967:"STENCIL_REF",2968:"STENCIL_WRITEMASK",2978:"VIEWPORT",3024:"DITHER",3042:"BLEND",3088:"SCISSOR_BOX",3089:"SCISSOR_TEST",3106:"COLOR_CLEAR_VALUE",3107:"COLOR_WRITEMASK",3317:"UNPACK_ALIGNMENT",3333:"PACK_ALIGNMENT",3379:"MAX_TEXTURE_SIZE",3386:"MAX_VIEWPORT_DIMS",3408:"SUBPIXEL_BITS",3410:"RED_BITS",3411:"GREEN_BITS",3412:"BLUE_BITS",3413:"ALPHA_BITS",3414:"DEPTH_BITS",3415:"STENCIL_BITS",3553:"TEXTURE_2D",4352:"DONT_CARE",4353:"FASTEST",4354:"NICEST",5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5124:"INT",5125:"UNSIGNED_INT",5126:"FLOAT",5386:"INVERT",5890:"TEXTURE",6401:"STENCIL_INDEX",6402:"DEPTH_COMPONENT",6406:"ALPHA",6407:"RGB",6408:"RGBA",6409:"LUMINANCE",6410:"LUMINANCE_ALPHA",7680:"KEEP",7681:"REPLACE",7682:"INCR",7683:"DECR",7936:"VENDOR",7937:"RENDERER",7938:"VERSION",9728:"NEAREST",9729:"LINEAR",9984:"NEAREST_MIPMAP_NEAREST",9985:"LINEAR_MIPMAP_NEAREST",9986:"NEAREST_MIPMAP_LINEAR",9987:"LINEAR_MIPMAP_LINEAR",10240:"TEXTURE_MAG_FILTER",10241:"TEXTURE_MIN_FILTER",10242:"TEXTURE_WRAP_S",10243:"TEXTURE_WRAP_T",10497:"REPEAT",10752:"POLYGON_OFFSET_UNITS",16384:"COLOR_BUFFER_BIT",32769:"CONSTANT_COLOR",32770:"ONE_MINUS_CONSTANT_COLOR",32771:"CONSTANT_ALPHA",32772:"ONE_MINUS_CONSTANT_ALPHA",32773:"BLEND_COLOR",32774:"FUNC_ADD",32777:"BLEND_EQUATION_RGB",32778:"FUNC_SUBTRACT",32779:"FUNC_REVERSE_SUBTRACT",32819:"UNSIGNED_SHORT_4_4_4_4",32820:"UNSIGNED_SHORT_5_5_5_1",32823:"POLYGON_OFFSET_FILL",32824:"POLYGON_OFFSET_FACTOR",32854:"RGBA4",32855:"RGB5_A1",32873:"TEXTURE_BINDING_2D",32926:"SAMPLE_ALPHA_TO_COVERAGE",32928:"SAMPLE_COVERAGE",32936:"SAMPLE_BUFFERS",32937:"SAMPLES",32938:"SAMPLE_COVERAGE_VALUE",32939:"SAMPLE_COVERAGE_INVERT",32968:"BLEND_DST_RGB",32969:"BLEND_SRC_RGB",32970:"BLEND_DST_ALPHA",32971:"BLEND_SRC_ALPHA",33071:"CLAMP_TO_EDGE",33170:"GENERATE_MIPMAP_HINT",33189:"DEPTH_COMPONENT16",33306:"DEPTH_STENCIL_ATTACHMENT",33635:"UNSIGNED_SHORT_5_6_5",33648:"MIRRORED_REPEAT",33901:"ALIASED_POINT_SIZE_RANGE",33902:"ALIASED_LINE_WIDTH_RANGE",33984:"TEXTURE0",33985:"TEXTURE1",33986:"TEXTURE2",33987:"TEXTURE3",33988:"TEXTURE4",33989:"TEXTURE5",33990:"TEXTURE6",33991:"TEXTURE7",33992:"TEXTURE8",33993:"TEXTURE9",33994:"TEXTURE10",33995:"TEXTURE11",33996:"TEXTURE12",33997:"TEXTURE13",33998:"TEXTURE14",33999:"TEXTURE15",34000:"TEXTURE16",34001:"TEXTURE17",34002:"TEXTURE18",34003:"TEXTURE19",34004:"TEXTURE20",34005:"TEXTURE21",34006:"TEXTURE22",34007:"TEXTURE23",34008:"TEXTURE24",34009:"TEXTURE25",34010:"TEXTURE26",34011:"TEXTURE27",34012:"TEXTURE28",34013:"TEXTURE29",34014:"TEXTURE30",34015:"TEXTURE31",34016:"ACTIVE_TEXTURE",34024:"MAX_RENDERBUFFER_SIZE",34041:"DEPTH_STENCIL",34055:"INCR_WRAP",34056:"DECR_WRAP",34067:"TEXTURE_CUBE_MAP",34068:"TEXTURE_BINDING_CUBE_MAP",34069:"TEXTURE_CUBE_MAP_POSITIVE_X",34070:"TEXTURE_CUBE_MAP_NEGATIVE_X",34071:"TEXTURE_CUBE_MAP_POSITIVE_Y",34072:"TEXTURE_CUBE_MAP_NEGATIVE_Y",34073:"TEXTURE_CUBE_MAP_POSITIVE_Z",34074:"TEXTURE_CUBE_MAP_NEGATIVE_Z",34076:"MAX_CUBE_MAP_TEXTURE_SIZE",34338:"VERTEX_ATTRIB_ARRAY_ENABLED",34339:"VERTEX_ATTRIB_ARRAY_SIZE",34340:"VERTEX_ATTRIB_ARRAY_STRIDE",34341:"VERTEX_ATTRIB_ARRAY_TYPE",34342:"CURRENT_VERTEX_ATTRIB",34373:"VERTEX_ATTRIB_ARRAY_POINTER",34466:"NUM_COMPRESSED_TEXTURE_FORMATS",34467:"COMPRESSED_TEXTURE_FORMATS",34660:"BUFFER_SIZE",34661:"BUFFER_USAGE",34816:"STENCIL_BACK_FUNC",34817:"STENCIL_BACK_FAIL",34818:"STENCIL_BACK_PASS_DEPTH_FAIL",34819:"STENCIL_BACK_PASS_DEPTH_PASS",34877:"BLEND_EQUATION_ALPHA",34921:"MAX_VERTEX_ATTRIBS",34922:"VERTEX_ATTRIB_ARRAY_NORMALIZED",34930:"MAX_TEXTURE_IMAGE_UNITS",34962:"ARRAY_BUFFER",34963:"ELEMENT_ARRAY_BUFFER",34964:"ARRAY_BUFFER_BINDING",34965:"ELEMENT_ARRAY_BUFFER_BINDING",34975:"VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",35040:"STREAM_DRAW",35044:"STATIC_DRAW",35048:"DYNAMIC_DRAW",35632:"FRAGMENT_SHADER",35633:"VERTEX_SHADER",35660:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",35661:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",35663:"SHADER_TYPE",35664:"FLOAT_VEC2",35665:"FLOAT_VEC3",35666:"FLOAT_VEC4",35667:"INT_VEC2",35668:"INT_VEC3",35669:"INT_VEC4",35670:"BOOL",35671:"BOOL_VEC2",35672:"BOOL_VEC3",35673:"BOOL_VEC4",35674:"FLOAT_MAT2",35675:"FLOAT_MAT3",35676:"FLOAT_MAT4",35678:"SAMPLER_2D",35680:"SAMPLER_CUBE",35712:"DELETE_STATUS",35713:"COMPILE_STATUS",35714:"LINK_STATUS",35715:"VALIDATE_STATUS",35716:"INFO_LOG_LENGTH",35717:"ATTACHED_SHADERS",35718:"ACTIVE_UNIFORMS",35719:"ACTIVE_UNIFORM_MAX_LENGTH",35720:"SHADER_SOURCE_LENGTH",35721:"ACTIVE_ATTRIBUTES",35722:"ACTIVE_ATTRIBUTE_MAX_LENGTH",35724:"SHADING_LANGUAGE_VERSION",35725:"CURRENT_PROGRAM",36003:"STENCIL_BACK_REF",36004:"STENCIL_BACK_VALUE_MASK",36005:"STENCIL_BACK_WRITEMASK",36006:"FRAMEBUFFER_BINDING",36007:"RENDERBUFFER_BINDING",36048:"FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",36049:"FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",36050:"FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",36051:"FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",36053:"FRAMEBUFFER_COMPLETE",36054:"FRAMEBUFFER_INCOMPLETE_ATTACHMENT",36055:"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",36057:"FRAMEBUFFER_INCOMPLETE_DIMENSIONS",36061:"FRAMEBUFFER_UNSUPPORTED",36064:"COLOR_ATTACHMENT0",36096:"DEPTH_ATTACHMENT",36128:"STENCIL_ATTACHMENT",36160:"FRAMEBUFFER",36161:"RENDERBUFFER",36162:"RENDERBUFFER_WIDTH",36163:"RENDERBUFFER_HEIGHT",36164:"RENDERBUFFER_INTERNAL_FORMAT",36168:"STENCIL_INDEX8",36176:"RENDERBUFFER_RED_SIZE",36177:"RENDERBUFFER_GREEN_SIZE",36178:"RENDERBUFFER_BLUE_SIZE",36179:"RENDERBUFFER_ALPHA_SIZE",36180:"RENDERBUFFER_DEPTH_SIZE",36181:"RENDERBUFFER_STENCIL_SIZE",36194:"RGB565",36336:"LOW_FLOAT",36337:"MEDIUM_FLOAT",36338:"HIGH_FLOAT",36339:"LOW_INT",36340:"MEDIUM_INT",36341:"HIGH_INT",36346:"SHADER_COMPILER",36347:"MAX_VERTEX_UNIFORM_VECTORS",36348:"MAX_VARYING_VECTORS",36349:"MAX_FRAGMENT_UNIFORM_VECTORS",37440:"UNPACK_FLIP_Y_WEBGL",37441:"UNPACK_PREMULTIPLY_ALPHA_WEBGL",37442:"CONTEXT_LOST_WEBGL",37443:"UNPACK_COLORSPACE_CONVERSION_WEBGL",37444:"BROWSER_DEFAULT_WEBGL"}},function(e,t,n){var r=n(102),i=n(107);e.exports=function(e){for(var t=Array.isArray(e)?e:r(e),n=0;n<t.length;n++){var o=t[n];if("preprocessor"===o.type){var a=o.data.match(/\#define\s+SHADER_NAME(_B64)?\s+(.+)$/);if(a&&a[2]){var s=a[1],u=a[2];return(s?i(u):u).trim()}}}}},function(e,t,n){var r=n(103);e.exports=function(e,t){var n=r(t),i=[];return i=(i=i.concat(n(e))).concat(n(null))}},function(e,t,n){e.exports=function(e){var t,n,w,A=0,x=0,S=u,O=[],C=[],R=1,M=0,P=0,I=!1,N=!1,D="",L=o,F=r;"300 es"===(e=e||{}).version&&(L=s,F=a);for(var U={},k={},A=0;A<L.length;A++)U[L[A]]=!0;for(var A=0;A<F.length;A++)k[F[A]]=!0;return function(e){return C=[],null!==e?function(e){A=0,e.toString&&(e=e.toString());var n;D+=e.replace(/\r\n/g,"\n"),w=D.length;for(;t=D[A],A<w;){switch(n=A,S){case l:A=G();break;case f:case h:A=X();break;case d:A=H();break;case p:A=Y();break;case E:A=W();break;case _:A=q();break;case c:A=K();break;case y:A=V();break;case u:A=B()}if(n!==A)switch(D[n]){case"\n":M=0,++R;break;default:++M}}return x+=A,D=D.slice(A),C}(e):function(e){O.length&&j(O.join(""));return S=b,j("(eof)"),C}()};function j(e){e.length&&C.push({type:T[S],data:e,position:P,line:R,column:M})}function B(){return O=O.length?[]:O,"/"===n&&"*"===t?(P=x+A-1,S=l,n=t,A+1):"/"===n&&"/"===t?(P=x+A-1,S=f,n=t,A+1):"#"===t?(S=h,P=x+A,A):/\s/.test(t)?(S=y,P=x+A,A):(I=/\d/.test(t),N=/[^\w_]/.test(t),P=x+A,S=I?p:N?d:c,A)}function V(){return/[^\s]/g.test(t)?(j(O.join("")),S=u,A):(O.push(t),n=t,A+1)}function X(){return"\r"!==t&&"\n"!==t||"\\"===n?(O.push(t),n=t,A+1):(j(O.join("")),S=u,A)}function G(){return"/"===t&&"*"===n?(O.push(t),j(O.join("")),S=u,A+1):(O.push(t),n=t,A+1)}function H(){if("."===n&&/\d/.test(t))return S=_,A;if("/"===n&&"*"===t)return S=l,A;if("/"===n&&"/"===t)return S=f,A;if("."===t&&O.length){for(;z(O););return S=_,A}if(";"===t||")"===t||"("===t){if(O.length)for(;z(O););return j(t),S=u,A+1}var e=2===O.length&&"="!==t;if(/[\w_\d\s]/.test(t)||e){for(;z(O););return S=u,A}return O.push(t),n=t,A+1}function z(e){for(var t,n,r=0;;){if(t=i.indexOf(e.slice(0,e.length+r).join("")),n=i[t],-1===t){if(r--+e.length>0)continue;n=e.slice(0,1).join("")}return j(n),P+=n.length,(O=O.slice(n.length)).length}}function W(){return/[^a-fA-F0-9]/.test(t)?(j(O.join("")),S=u,A):(O.push(t),n=t,A+1)}function Y(){return"."===t?(O.push(t),S=_,n=t,A+1):/[eE]/.test(t)?(O.push(t),S=_,n=t,A+1):"x"===t&&1===O.length&&"0"===O[0]?(S=E,O.push(t),n=t,A+1):/[^\d]/.test(t)?(j(O.join("")),S=u,A):(O.push(t),n=t,A+1)}function q(){return"f"===t&&(O.push(t),n=t,A+=1),/[eE]/.test(t)?(O.push(t),n=t,A+1):("-"!==t&&"+"!==t||!/[eE]/.test(n))&&/[^\d]/.test(t)?(j(O.join("")),S=u,A):(O.push(t),n=t,A+1)}function K(){if(/[^\d\w_]/.test(t)){var e=O.join("");return S=k[e]?g:U[e]?v:m,j(O.join("")),S=u,A}return O.push(t),n=t,A+1}};var r=n(40),i=n(104),o=n(41),a=n(105),s=n(106),u=999,c=9999,l=0,f=1,h=2,d=3,p=4,_=5,m=6,v=7,g=8,y=9,b=10,E=11,T=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"]},function(e,t){e.exports=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"]},function(e,t,n){var r=n(40);e.exports=r.slice().concat(["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray"])},function(e,t,n){var r=n(41);r=r.slice().filter(function(e){return!/^(gl\_|texture)/.test(e)}),e.exports=r.concat(["gl_VertexID","gl_InstanceID","gl_Position","gl_PointSize","gl_FragCoord","gl_FrontFacing","gl_FragDepth","gl_PointCoord","gl_MaxVertexAttribs","gl_MaxVertexUniformVectors","gl_MaxVertexOutputVectors","gl_MaxFragmentInputVectors","gl_MaxVertexTextureImageUnits","gl_MaxCombinedTextureImageUnits","gl_MaxTextureImageUnits","gl_MaxFragmentUniformVectors","gl_MaxDrawBuffers","gl_MinProgramTexelOffset","gl_MaxProgramTexelOffset","gl_DepthRangeParameters","gl_DepthRange","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"])},function(e,t){e.exports=function(e){return atob(e)}},function(e,t,n){var r=n(109);e.exports=function(e,t,n){t="number"==typeof t?t:1,n=n||": ";var i=e.split(/\r?\n/),o=String(i.length+t-1).length;return i.map(function(e,i){var a=i+t,s=String(a).length,u=r(a,o-s);return u+n+e}).join("\n")}},function(e,t,n){"use strict";
/*!
 * pad-left <https://github.com/jonschlinkert/pad-left>
 *
 * Copyright (c) 2014-2015, Jon Schlinkert.
 * Licensed under the MIT license.
 */var r=n(110);e.exports=function(e,t,n){return r(n=void 0!==n?n+"":" ",t)+e}},function(e,t,n){"use strict";
/*!
 * repeat-string <https://github.com/jonschlinkert/repeat-string>
 *
 * Copyright (c) 2014-2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var r,i="";e.exports=function(e,t){if("string"!=typeof e)throw new TypeError("expected a string");if(1===t)return e;if(2===t)return e+e;var n=e.length*t;if(r!==e||void 0===r)r=e,i="";else if(i.length>=n)return i.substr(0,n);for(;n>i.length&&t>1;)1&t&&(i+=e),t>>=1,e+=e;return i=(i+=e).substr(0,n)}},function(e,t,n){var r=n(112);e.exports=function(){var e=r();return{get:function(t,n){var r=e(t);return r.hasOwnProperty("value")?r.value:n},set:function(t,n){return e(t).value=n,this},has:function(t){return"value"in e(t)},delete:function(t){return delete e(t).value}}}},function(e,t,n){var r=n(113);e.exports=function(){var e={};return function(t){if(("object"!=typeof t||null===t)&&"function"!=typeof t)throw new Error("Weakmap-shim: Key must be object");var n=t.valueOf(e);return n&&n.identity===e?n:r(t,e)}}},function(e,t){e.exports=function(e,t){var n={identity:t},r=e.valueOf;return Object.defineProperty(e,"valueOf",{value:function(e){return e!==t?r.apply(this,arguments):n},writable:!0}),n}},function(e,t,n){"use strict";t.uniforms=function(e,t){for(var n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),r=[],i=0;i<n;++i){var a=e.getActiveUniform(t,i);if(a){var s=o(e,a.type);if(a.size>1)for(var u=0;u<a.size;++u)r.push({name:a.name.replace("[0]","["+u+"]"),type:s});else r.push({name:a.name,type:s})}}return r},t.attributes=function(e,t){for(var n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),r=[],i=0;i<n;++i){var a=e.getActiveAttrib(t,i);a&&r.push({name:a.name,type:o(e,a.type)})}return r};var r={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube"},i=null;function o(e,t){if(!i){var n=Object.keys(r);i={};for(var o=0;o<n.length;++o){var a=n[o];i[e[a]]=r[a]}}return i[t]}},,,function(e,t,n){"use strict";n.r(t);n(48);var r,i,o=n(29),a=(n(51),n(0)),s=n(2),u=n(9),c=n(42),l=n(43),f=n(16),h=n(10),d=n(46),p=n(20),_=n(22),m=n(12),v=n(4),g=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),y=function(e){function t(t){var n=e.call(this,t)||this;return n.type="DirectionalLight",n.declaration="\n    struct DirectionalLight {\n      vec3 direction;\n      vec3 ambient;\n      vec3 diffuse;\n      vec3 specular;\n    };\n\n    vec3 calcDirectionalLight(DirectionalLight light, vec3 normal, vec3 fragPos, vec3 viewDir)\n    {\n      vec3 lightDir = normalize(-light.direction);\n\n      // diffuse shading\n      float diff = max(dot(normal, lightDir), 0.0);\n\n      // specular shading\n      // vec3 reflectDir = reflect(-lightDir, normal);\n      // float spec = pow(max(dot(viewDir, reflectDir), 0.0), u_Shininess);\n\n      // Blinn-Phong specular shading\n      vec3 halfwayDir = normalize(lightDir + viewDir);\n      float spec = pow(max(dot(normal, halfwayDir), 0.0), u_Shininess);\n\n      vec3 ambient = light.ambient * u_Diffuse;\n      vec3 diffuse = light.diffuse * diff * u_Diffuse;\n      vec3 specular = light.specular * spec * u_Specular;\n\n      float shadow = calcShadow(u_ShadowMap"+n.index+", v_PositionFromLight"+n.index+", lightDir, normal);\n      return ambient + shadow * (diffuse + specular);\n    }\n  ",Object.assign(n,t),n}return g(t,e),t.prototype.setUniforms=function(t,n,r){var i;e.prototype.setUniforms.call(this,t,n,r),Object(v.a)(t,n,((i={})[r+".direction"]=this.direction,i[r+".ambient"]=this.model.ambient,i[r+".diffuse"]=this.model.diffuse,i[r+".specular"]=this.model.specular,i))},t}(m.a),b=n(27),E=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),T={width:2,height:2,center:$V([0,0,0])},w=function(e){function t(t){var n=e.call(this,t)||this;return Object.assign(n,T,t),n}return E(t,e),t.prototype.setVertices=function(){if(this.p1){this.vertices=new Float32Array([this.p1.e(1),this.p1.e(2),this.p1.e(3),this.p2.e(1),this.p2.e(2),this.p2.e(3),this.p3.e(1),this.p3.e(2),this.p3.e(3),this.p4.e(1),this.p4.e(2),this.p4.e(3)]);var e=this.p2.subtract(this.p1),t=this.p3.subtract(this.p1),n=e.cross(t).toUnitVector();this.normals=new Float32Array([n.e(1),n.e(2),n.e(3),n.e(1),n.e(2),n.e(3),n.e(1),n.e(2),n.e(3),n.e(1),n.e(2),n.e(3)])}else this.vertices=new Float32Array([1,0,1,1,0,-1,-1,0,-1,-1,0,1]),this.normals=new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0]);this.indices=new Uint8Array([0,1,2,0,2,3]),this.textureCoords=this.vertices.filter(function(e,t){return t%3!=1}).map(function(e){return e/2+.5})},t.prototype.setModelMatrix=function(){this.p1||(this.scale($V([this.width/2,1,this.height/2])),this.translate(this.center))},t}(b.a),A=1,x=2,S=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),O=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},C=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},R=function(e,t){return function(n,r){t(n,r,e)}},M=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;return i.prevTexture=A,i.nextTexture=A,i.renderer=t,i.scene=n,i.camera=r,i}return S(t,e),t=O([Object(a.injectable)(),R(0,Object(a.inject)(s.a.IRendererService)),R(1,Object(a.inject)(s.a.ISceneService)),R(2,Object(a.inject)(s.a.ICameraService)),C("design:paramtypes",[Object,Object,Object])],t)}(_.a),P=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),I=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},N=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},D=function(e,t){return function(n,r){t(n,r,e)}},L=!1,F=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;return i.plane=new w({p1:$V([1,1,0]),p2:$V([1,-1,0]),p3:$V([-1,-1,0]),p4:$V([-1,1,0])}),i.plane.init(),i.plane.textureCoords=i.plane.vertices.filter(function(e,t){return t%3!=2}).map(function(e){return e/2+.5}),i}return P(t,e),t.prototype.generateShaders=function(){this.fbo=this.initFramebufferObject(V,X);return{vertexShader:"\n      attribute vec4 a_Position;\n      attribute vec2 a_TextureCoord;\n\n      varying vec2 v_TextureCoord;\n    \n      void main() {\n        v_TextureCoord = a_TextureCoord;\n        gl_Position = a_Position;\n      }\n    ",fragmentShader:"\n      precision mediump float;\n      uniform sampler2D u_Texture;\n      varying vec2 v_TextureCoord;\n\n      vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n        vec4 color = vec4(0.0);\n        vec2 off1 = vec2(1.3846153846) * direction;\n        vec2 off2 = vec2(3.2307692308) * direction;\n        color += texture2D(image, uv) * 0.2270270270;\n        color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n        color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n        color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n        color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n        return color;\n      }\n\n      vec4 blur5(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n        vec4 color = vec4(0.0);\n        vec2 off1 = vec2(1.3333333333333333) * direction;\n        color += texture2D(image, uv) * 0.29411764705882354;\n        color += texture2D(image, uv + (off1 / resolution)) * 0.35294117647058826;\n        color += texture2D(image, uv - (off1 / resolution)) * 0.35294117647058826;\n        return color;\n      }\n      \n      void main() {\n        vec2 uv = vec2(gl_FragCoord.xy / vec2(32.0, 32.0));\n        // gl_FragColor = blur9(u_Texture, uv, vec2(32.0, 32.0), vec2(1.0, 0.0));\n        // gl_FragColor = texture2D(u_Texture, gl_FragCoord.xy);\n        gl_FragColor = texture2D(u_Texture, v_TextureCoord);\n        // gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n      }\n    "}},t.prototype.setupTexture=function(){var e=this.gl,t=this.shader.program;if(!L){var n=e.createTexture();e.activeTexture(e["TEXTURE"+A]),e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array([0,0,0,255])),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),L=!0}var r=this.gl.getUniformLocation(t,"u_Texture");if(this.gl.uniform1i(r,this.prevTexture),!Object(v.b)(e,t,"a_TextureCoord",this.plane.textureCoords,2,e.FLOAT))return-1},t.prototype.draw=function(){var e=this.gl,t=this.shader.program,n=this.renderer.getSize(),r=n.width,i=n.height;if(e.viewport(0,0,r,i),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this.activate(),e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE),this.setupTexture(),!Object(v.b)(e,t,"a_Position",this.plane.vertices,3,e.FLOAT))return-1;e.bindFramebuffer(e.FRAMEBUFFER,this.fbo.framebuffer),e.activeTexture(e["TEXTURE"+this.nextTexture]),e.bindTexture(e.TEXTURE_2D,this.fbo.texture),this.plane.draw(e),e.enable(e.DEPTH_TEST),e.enable(e.CULL_FACE)},t=I([Object(a.injectable)(),D(0,Object(a.inject)(s.a.IRendererService)),D(1,Object(a.inject)(s.a.ISceneService)),D(2,Object(a.inject)(s.a.ICameraService)),N("design:paramtypes",[Object,Object,Object])],t)}(M),U=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),k=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},j=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},B=function(e,t){return function(n,r){t(n,r,e)}},V=2048,X=2048;!function(e){e.LowPrecision="low-precision",e.HighPrecision="high-precision",e.Lerp="lerp",e.PCF="pcf",e.PCFLerp="pcf-lerp",e.PoissonDisk="poisson-disk",e.StratifiedPoissonDisk="stratified-poisson-disk",e.RotatedPoissonDisk="rotated-poisson-disk",e.VSM="variance-shadow-mapping"}(i||(i={}));var G=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this,o=new F(t,n,r),a=new F(t,n,r);return o.prevTexture=0,o.nextTexture=1,a.prevTexture=1,a.nextTexture=0,i.addPostProcess(o),i.addPostProcess(a),i}var n;return U(t,e),n=t,t.prototype.generateShaders=function(){var e,t,r=this,o=this.gl,a=0,s=this.scene.getLightsInfo();Object.keys(s).forEach(function(t){var n=s[t],i=n.lights;n.varName;i.forEach(function(t,n){if(t instanceof m.a){if(!(e=r.initFramebufferObject(V,X)).framebuffer)return void console.log("Failed to initialize frame buffer object");if(t.fbo=e,t.fboTextureIdx=a++,a>32)return void console.log("Exceed the maximum number of textures")}})});var u="\n      attribute vec4 a_Position;\n      uniform mat4 u_MvpMatrix;\n      void main() {\n        gl_Position = u_MvpMatrix * a_Position;\n      }\n    ";return n.mode===i.LowPrecision?t="\n        precision mediump float;\n        void main() {\n          gl_FragColor = vec4(gl_FragCoord.z, 0.0, 0.0, 0.0);\n        }\n      ":n.mode===i.HighPrecision||n.mode===i.Lerp||n.mode===i.PCF||n.mode===i.PCFLerp||n.mode===i.PoissonDisk||n.mode===i.StratifiedPoissonDisk||n.mode===i.RotatedPoissonDisk?t="\n        precision mediump float;\n        void main() {\n          vec4 bitShift = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n          const vec4 bitMask = vec4(1.0/256.0, 1.0/256.0, 1.0/256.0, 0.0);\n          vec4 rgbaDepth = fract(gl_FragCoord.z * bitShift);\n          rgbaDepth -= rgbaDepth.gbaa * bitMask;\n          gl_FragColor = rgbaDepth;\n        }\n      ":n.mode===i.VSM&&(o.getExtension("OES_standard_derivatives"),u="\n        attribute vec4 a_Position;\n        uniform mat4 u_MvpMatrix;\n        // uniform mat4 u_ModelMatrix;\n        varying vec4 v_Position;\n        void main() {\n          gl_Position = u_MvpMatrix * a_Position;\n          v_Position = gl_Position;\n        }\n      ",t="\n        #extension GL_OES_standard_derivatives : enable\n        precision mediump float;\n        varying vec4 v_Position;\n\n        vec2 packHalf(float depth) { \n          vec2 bitOffset = vec2(1.0 / 255., 0.);\n          vec2 color = vec2(depth, fract(depth * 255.));\n        \n          return color - (color.yy * bitOffset);\n        }\n\n        void main(){\n          float depth = gl_FragCoord.z;\n          // float depth = v_Position.z / v_Position.w;\n          // depth = depth * 0.5 + 0.5;\n          float moment1 = depth;\n          float moment2 = moment1 * moment1;\n          float dx = dFdx(depth);\n          float dy = dFdy(depth);\n          moment2 += 0.25 * (dx * dx + dy * dy);\n          gl_FragColor = vec4(packHalf(moment1), packHalf(moment2));\n        }\n      "),{vertexShader:u,fragmentShader:t}},t.prototype.draw=function(){var e,t,r,o,a=this,s=this.gl,u=this.shader.program;this.activate();var c=this.scene.getLightsInfo();Object.keys(c).forEach(function(n){var i=c[n],l=i.lights;i.varName;l.forEach(function(n,i){n instanceof m.a&&(r="TEXTURE"+n.fboTextureIdx,s.bindFramebuffer(s.FRAMEBUFFER,n.fbo.framebuffer),s.viewport(0,0,V,X),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.activeTexture(s[r]),s.bindTexture(s.TEXTURE_2D,n.fbo.texture),n instanceof y?(o=n.direction.x(-10),e=a.camera.ortho(-10,10,-10,10,1,100),t=a.camera.lookAt(o,n.direction,a.camera.up)):n instanceof p.a&&(e=a.camera.perspective(a.camera.fovy,V/X,1,100),t=a.camera.lookAt(n.position,$V([.01,0,0]),$V([0,1,0]))),a.scene.meshes.forEach(function(r){var i=r.geometry,o=i.vertices,a=i.modelMatrix,c=e.x(t.x(a));if(r.mvpMatrixFromLight[""+n.index]=c,Object(v.a)(s,u,{u_MvpMatrix:c}),!Object(v.b)(s,u,"a_Position",o,3,s.FLOAT))return-1;r.geometry.draw(s)}))})}),s.bindFramebuffer(s.FRAMEBUFFER,null),n.mode===i.VSM&&this.postProcesses.forEach(function(e){e.draw()}),s.bindFramebuffer(s.FRAMEBUFFER,null)},t.mode=i.HighPrecision,t=n=k([Object(a.injectable)(),B(0,Object(a.inject)(s.a.IRendererService)),B(1,Object(a.inject)(s.a.ISceneService)),B(2,Object(a.inject)(s.a.ICameraService)),j("design:paramtypes",[Object,Object,Object])],t)}(_.a),H=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),z=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},W=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Y=function(e,t){return function(n,r){t(n,r,e)}},q=function(e){function t(t,n,r,o){var a,s=e.call(this)||this;s.scene=r,s.camera=t,s.mouse=n,s.renderer=o,s.cameraController={isTruck:!0,moveSpeed:.6},s.lightController={spotLight:{angle:14,blur:2}},s.shadowController={mode:(a={},a[i.LowPrecision]=!1,a[i.HighPrecision]=!0,a[i.Lerp]=!1,a[i.PCF]=!1,a[i.PCFLerp]=!1,a[i.PoissonDisk]=!1,a[i.StratifiedPoissonDisk]=!1,a[i.RotatedPoissonDisk]=!1,a[i.VSM]=!1,a)};var u=new d.a,c=u.addFolder("camera");c.add(s.cameraController,"isTruck"),c.add(s.cameraController,"moveSpeed",.1,2);var l=u.addFolder("light");l.add(s.lightController.spotLight,"angle",10,30).onChange(s.changeLight.bind(s)),l.add(s.lightController.spotLight,"blur",2,10).onChange(s.changeLight.bind(s));var p=u.addFolder("shadow");return Object.keys(s.shadowController.mode).forEach(function(e){p.add(s.shadowController.mode,e).listen().onChange(s.changeShadowMode.bind(s,e))}),s.onResize=s.onResize.bind(s),s.onMousemove=s.onMousemove.bind(s),s.onMousewheel=s.onMousewheel.bind(s),s.renderer.on(h.a.RESIZE_EVENT,s.onResize),s.mouse.on(f.a.MOVE_EVENT,s.onMousemove),s.mouse.on(f.a.WHEEL_EVENT,s.onMousewheel),s}return H(t,e),t.prototype.onMousemove=function(e){this.moveCamera(e)},t.prototype.onMousewheel=function(e){this.moveCamera(e)},t.prototype.onResize=function(){var e=this.renderer.getSize(),t=e.width,n=e.height;this.camera.eye&&(this.camera.aspect=t/n,this.camera.updateProjection(),this.camera.updateTransform())},t.prototype.moveCamera=function(e){var t=e.deltaX,n=e.deltaY,r=e.deltaZ,i=this.cameraController,o=i.isTruck,a=i.moveSpeed;o?(this.camera.pan(.001*t*a),this.camera.tilt(.001*n*a),this.camera.dolly(.05*r*a)):(this.camera.truck(.01*-t*a),this.camera.pedestal(.01*n*a),this.camera.cant(.05*r*a))},t.prototype.changeLight=function(){var e=this,t=this.scene.getLightsInfo();Object.keys(t).forEach(function(n){var r=t[n],i=r.lights;r.varName;i.forEach(function(t,n){t instanceof p.a&&(t.angle=e.lightController.spotLight.angle,t.blur=e.lightController.spotLight.blur)})}),this.renderer.updateShaders()},t.prototype.changeShadowMode=function(e,t){var n=this;t&&(Object.keys(this.shadowController.mode).forEach(function(e){n.shadowController.mode[e]=!1}),this.shadowController.mode[e]=!0,G.mode=e,this.renderer.updateShaders())},t=z([Object(a.injectable)(),Y(0,Object(a.inject)(s.a.ICameraService)),Y(1,Object(a.inject)(s.a.IMouseService)),Y(2,Object(a.inject)(s.a.ISceneService)),Y(3,Object(a.inject)(s.a.IRendererService)),W("design:paramtypes",[Object,Object,Object,Object])],t)}(u.EventEmitter),K=function(){return function(){}}(),$=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Z=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},J=function(e,t){return function(n,r){t(n,r,e)}},Q=function(){function e(e){this.renderer=e,this.currentId=x}return e.prototype.getId=function(){var e=this.renderer.gl;if(this.maxTextures=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.currentId<this.maxTextures)return this.currentId++;console.error("exceeds maxnum of textures.")},e.prototype.load=function(e){var t=this,n=new Image,r=this.renderer.gl,i=new K;return i.id=A,i.texture=r.createTexture(),n.onload=function(){i.id=t.getId(),i.img=n,r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,1),r.activeTexture(r["TEXTURE"+i.id]),r.bindTexture(r.TEXTURE_2D,i.texture),r.texImage2D(r.TEXTURE_2D,0,r.RGB,r.RGB,r.UNSIGNED_BYTE,i.img),Object(o.a)(i.img.width)&&Object(o.a)(i.img.height)?(r.generateMipmap(r.TEXTURE_2D),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_NEAREST)):r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)},n.onerror=function(){console.log("Failed to load img: "+e)},n.crossOrigin="anonymous",n.src=e,i},e.prototype.loadCubeMap=function(e){var t=this,n=this.renderer.gl;if(6!=e.length)return null;var r=new K;return r.id=x,r.texture=n.createTexture(),Promise.all(e.map(function(e){return new Promise(function(t,n){var r=new Image;r.onload=function(){t(r)},r.onerror=function(){console.log("Failed to load img: "+e),n()},r.crossOrigin="anonymous",r.src=e})})).then(function(e){r.id=t.getId(),n.activeTexture(n["TEXTURE"+r.id]),n.bindTexture(n.TEXTURE_CUBE_MAP,r.texture);for(var i=0;i<6;i++)n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e[i]);n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)}),r},e=$([Object(a.injectable)(),J(0,Object(a.inject)(s.a.IRendererService)),Z("design:paramtypes",[Object])],e)}(),ee=new a.Container;ee.bind(s.a.ISceneService).to(c.a).inSingletonScope(),ee.bind(s.a.ICameraService).to(l.a).inSingletonScope(),ee.bind(s.a.IMouseService).to(f.a).inSingletonScope(),ee.bind(s.a.IRendererService).to(h.a).inSingletonScope(),ee.bind(s.a.IControlsService).to(q).inSingletonScope(),ee.bind(s.a.ITextureLoaderService).to(Q).inSingletonScope(),Object(a.decorate)(Object(a.injectable)(),u.EventEmitter);var te=n(30),ne=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),re={center:$V([0,0,0]),radius:1},ie=function(e){function t(t){void 0===t&&(t=re);var n=e.call(this,t)||this;return Object.assign(n,t),n}return ne(t,e),t.prototype.setVertices=function(){var e,t,n,r,i,o,a,s,u,c,l=[],f=[];for(i=0;i<=23;i++)for(o=i*Math.PI/23,a=Math.sin(o),s=Math.cos(o),e=0;e<=23;e++)t=2*e*Math.PI/23,n=Math.sin(t),r=Math.cos(t),l.push(n*a),l.push(s),l.push(r*a);for(i=0;i<23;i++)for(e=0;e<23;e++)c=(u=24*i+e)+24,f.push(u),f.push(c),f.push(u+1),f.push(u+1),f.push(c),f.push(c+1);this.vertices=new Float32Array(l),this.normals=new Float32Array(l),this.indices=new Uint16Array(f),this.textureCoords=this.vertices.filter(function(e,t){return t%3!=1}).map(function(e){return e/2+.5})},t.prototype.setModelMatrix=function(){this.scale($V(new Array(3).fill(this.radius))),this.translate(this.center)},t}(b.a),oe={declaration:"",calculation:"",result:""},ae={vertex:oe,fragment:oe},se=(function(){}(),function(){function e(){this.snippet=ae}return e.prototype.getDeclarationInFragment=function(){return"\n      vec2 texelSize = vec2(1.0) / vec2("+(V.toFixed(5),X.toFixed(5))+");\n\n      float unpackDepth(const in vec4 rgbaDepth) {\n        const vec4 bitShift = vec4(1.0, 1.0/256.0, 1.0/(256.0*256.0), 1.0/(256.0*256.0*256.0));\n        float depth = dot(rgbaDepth, bitShift);\n        return depth;\n      }\n\n      float texture2DCompare(sampler2D depths, vec2 uv, float compare, float bias){\n        float depth = unpackDepth(texture2D(depths, uv));\n        return step(compare - bias, depth);\n      }\n\n      float texture2DShadowLerp(sampler2D depths, vec2 uv, float compare, float bias){\n        vec2 centroidUV = floor(uv * "+V.toFixed(5)+" + 0.5) / "+V.toFixed(5)+";\n        vec2 f = fract(uv * "+V.toFixed(5)+" + 0.5);\n        float lb = texture2DCompare(depths, centroidUV + texelSize * vec2(0.0, 0.0), compare, bias);\n        float lt = texture2DCompare(depths, centroidUV + texelSize * vec2(0.0, 1.0), compare, bias);\n        float rb = texture2DCompare(depths, centroidUV + texelSize * vec2(1.0, 0.0), compare, bias);\n        float rt = texture2DCompare(depths, centroidUV + texelSize * vec2(1.0, 1.0), compare, bias);\n        float a = mix(lb, lt, f.y);\n        float b = mix(rb, rt, f.y);\n        float c = mix(a, b, f.x);\n        return c;\n      }\n\n      "+this.snippet.fragment.declaration+"\n\n      float calcShadow(sampler2D depths, vec4 positionFromLight, vec3 lightDir, vec3 normal) {\n        vec3 shadowCoord = (positionFromLight.xyz / positionFromLight.w) * 0.5 + 0.5;\n        float bias = max(0.05 * (1.0 - dot(normal, lightDir)), 0.005);\n        "+this.snippet.fragment.calculation+"\n      }\n    "},e.prototype.setUniforms=function(e,t){},e}()),ue=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ce=function(e){function t(){var t=e.call(this)||this;return t.snippet.fragment.calculation="\n      return texture2DCompare(depths, shadowCoord.xy, shadowCoord.z, bias);\n    ",t}return ue(t,e),t.prototype.setUniforms=function(t,n){e.prototype.setUniforms.call(this,t,n)},t}(se),le=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),fe=function(e){function t(){var t=e.call(this)||this;return t.snippet.fragment.calculation="\n      vec4 rgbaDepth = texture2D(depths, shadowCoord.xy);\n      return step(shadowCoord.z - bias, rgbaDepth.r);\n    ",t}return le(t,e),t.prototype.setUniforms=function(t,n){e.prototype.setUniforms.call(this,t,n)},t}(se),he=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),de=function(e){function t(){var t=e.call(this)||this;return t.snippet.fragment.calculation="\n      return texture2DShadowLerp(depths, shadowCoord.xy, shadowCoord.z, bias);\n    ",t}return he(t,e),t.prototype.setUniforms=function(t,n){e.prototype.setUniforms.call(this,t,n)},t}(se),pe=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),_e=function(e){function t(){var t=e.call(this)||this;return t.snippet.fragment.declaration="\n      float PCF(sampler2D depths, vec2 uv, float compare, float bias){\n        float result = 0.0;\n        for (int x = -2; x <= 2; x++) {\n          for (int y = -2; y <= 2; y++) {\n            vec2 off = texelSize * vec2(x,y);\n            result += texture2DCompare(depths, uv + off, compare, bias);\n          }\n        }\n        return result / 25.0;\n      }\n    ",t.snippet.fragment.calculation="\n      return PCF(depths, shadowCoord.xy, shadowCoord.z, bias);\n    ",t}return pe(t,e),t.prototype.setUniforms=function(t,n){e.prototype.setUniforms.call(this,t,n)},t}(se),me=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ve=function(e){function t(){var t=e.call(this)||this;return t.snippet.fragment.calculation="\n      return PCFLerp(depths, shadowCoord.xy, shadowCoord.z, bias);\n    ",t.snippet.fragment.declaration="\n      float PCFLerp(sampler2D depths, vec2 uv, float compare, float bias){\n        float result = 0.0;\n        for(int x = -1; x <= 1; x++){\n          for(int y = -1; y <= 1; y++){\n            vec2 off = texelSize * vec2(x,y);\n            result += texture2DShadowLerp(depths, uv + off, compare, bias);\n          }\n        }\n        return result / 9.0;\n      }\n    ",t}return me(t,e),t.prototype.setUniforms=function(t,n){e.prototype.setUniforms.call(this,t,n)},t}(se),ge=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ye=function(e){function t(){var t=e.call(this)||this;return t.snippet.fragment.declaration="\n      uniform float uPoissonDisk[8];\n      float PoissonDisk(sampler2D depths, vec2 uv, float compare, float bias){\n        float result = 0.0;\n        for (int i = 0; i < 4; i++) {\n          result += texture2DCompare(depths, uv + vec2(uPoissonDisk[i * 2], uPoissonDisk[i * 2 + 1])/2048.0, compare, bias);\n        }\n        return result / 4.0;\n      }\n    ",t.snippet.fragment.calculation="\n      return PoissonDisk(depths, shadowCoord.xy, shadowCoord.z, bias);\n    ",t}return ge(t,e),t.prototype.setUniforms=function(e,t){for(var n,r=[-.94201624,-.39906216,.94558609,-.76890725,-.094184101,-.9293887,.34495938,.2938776],i=0;i<8;i++)Object(v.a)(e,t,((n={})["uPoissonDisk["+i+"]"]=r[i],n))},t}(se),be=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ee=function(e){function t(){var t=e.call(this)||this;return t.snippet.fragment.declaration="\n      uniform float uPoissonDisk[32];\n      float random(vec3 seed, int i) {\n        vec4 seed4 = vec4(seed,i);\n        float dot_product = dot(seed4, vec4(12.9898,78.233,45.164,94.673));\n        return fract(sin(dot_product) * 43758.5453);\n      }\n      float StratifiedPoissonDisk(sampler2D depths, vec2 uv, float compare, float bias){\n        float result = 0.0;\n        for (int i = 0; i < 4; i++) {\n          // int index = int(mod((16.0 * random(gl_FragCoord.xyy, i)), 16.0));\n          int index = int(mod((16.0 * random(floor(v_Position.xyz * 1000.0), i)), 16.0));\n          for (int j = 0; j < 16; j++) {\n            if (j == index) {\n              result += texture2DCompare(depths, uv + vec2(uPoissonDisk[j * 2], uPoissonDisk[j * 2 + 1])/2048.0, compare, bias);\n              break;\n            }\n          }\n        }\n        return result / 4.0;\n      }\n    ",t.snippet.fragment.calculation="\n      return StratifiedPoissonDisk(depths, shadowCoord.xy, shadowCoord.z, bias);\n    ",t}return be(t,e),t.prototype.setUniforms=function(e,t){for(var n,r=[-.94201624,-.39906216,.94558609,-.76890725,-.094184101,-.9293887,.34495938,.2938776,-.91588581,.45771432,-.81544232,-.87912464,-.38277543,.27676845,.97484398,.75648379,.44323325,-.97511554,.53742981,-.4737342,-.26496911,-.41893023,.79197514,.19090188,-.2418884,.99706507,-.81409955,.9143759,.19984126,.78641367,.14383161,-.1410079],i=0;i<32;i++)Object(v.a)(e,t,((n={})["uPoissonDisk["+i+"]"]=r[i],n))},t}(se),Te=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),we=function(e){function t(){var t=e.call(this)||this;return t.snippet.fragment.declaration="\n      uniform float uPoissonDisk[8];\n      float random(vec3 seed, int i) {\n        vec4 seed4 = vec4(seed,i);\n        float dot_product = dot(seed4, vec4(12.9898,78.233,45.164,94.673));\n        return fract(sin(dot_product) * 43758.5453);\n      }\n      float RotatedPoissonDisk(sampler2D depths, vec2 uv, float compare, float bias){\n        float result = 0.0;\n        for (int i = 0; i < 4; i++) {\n          float angle = 2.0 * PI * random(floor(v_Position.xyz * 1000.0), i);\n          float s = sin(angle);\n          float c = cos(angle);\n\n          vec2 rotatedOffset = vec2(uPoissonDisk[i * 2] * c + uPoissonDisk[i * 2 + 1] * s, \n            uPoissonDisk[i * 2] * -s + uPoissonDisk[i * 2 + 1] * c);\n\n          result += texture2DCompare(depths, uv + rotatedOffset/2048.0, compare, bias);\n        }\n        return result / 4.0;\n      }\n    ",t.snippet.fragment.calculation="\n      return RotatedPoissonDisk(depths, shadowCoord.xy, shadowCoord.z, bias);\n    ",t}return Te(t,e),t.prototype.setUniforms=function(e,t){for(var n,r=[-.94201624,-.39906216,.94558609,-.76890725,-.094184101,-.9293887,.34495938,.2938776],i=0;i<32;i++)Object(v.a)(e,t,((n={})["uPoissonDisk["+i+"]"]=r[i],n))},t}(se),Ae=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),xe=function(e){function t(){var t=e.call(this)||this;return t.snippet.fragment.declaration="\n      float unpackHalf(vec2 color) {\n        return color.x + (color.y / 255.0);\n      }\n      float linstep(float low, float high, float v) {\n        return clamp((v - low) / (high - low), 0.0, 1.0);\n      }\n      float chebyshevUpperBound(vec2 moments, float compare, float bias) {\n        // float p = smoothstep(compare - bias, compare, moments.x);\n        \n        float depthScale = 0.01 * 0.25 * compare;\n        float minVariance = depthScale * depthScale;\n\n        float variance = max(moments.y - moments.x * moments.x, minVariance);\n        float d = compare - moments.x;\n        float p_max = linstep(0.2, 1.0, variance / (variance + d * d));\n\n        return (compare <= moments.x ? 1.0 : p_max);\n        // return clamp(max(p, p_max), 0.0, 1.0);\n      }\n      float VSM(sampler2D depths, vec2 uv, float compare, float bias) {\n        // vec4 result = vec4(0.0);\n        // for (int x = -1; x <= 1; x++) {\n        //   for (int y = -1; y <= 1; y++) {\n        //     vec2 off = texelSize * vec2(x,y);\n        //     result += texture2D(depths, uv + off);\n        //   }\n        // }\n\n        // if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0 || compare >= 1.0) {\n        //   return 1.0;\n        // }\n        vec4 texel = texture2D(depths, uv);\n        vec2 moments = vec2(unpackHalf(texel.xy), unpackHalf(texel.zw));\n        return chebyshevUpperBound(moments, compare, bias);\n      }\n    ",t.snippet.fragment.calculation="\n      return VSM(depths, shadowCoord.xy, shadowCoord.z, bias);\n    ",t}return Ae(t,e),t.prototype.setUniforms=function(t,n){e.prototype.setUniforms.call(this,t,n)},t}(se),Se=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Oe=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Ce=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Re=function(e,t){return function(n,r){t(n,r,e)}},Me=!1,Pe=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;return i.shadow=new ce,i}return Se(t,e),t.prototype.initShadow=function(){G.mode===i.LowPrecision?this.shadow=new fe:G.mode===i.HighPrecision?this.shadow=new ce:G.mode===i.Lerp?this.shadow=new de:G.mode===i.PCF?this.shadow=new _e:G.mode===i.PCFLerp?this.shadow=new ve:G.mode===i.PoissonDisk?this.shadow=new ye:G.mode===i.StratifiedPoissonDisk?this.shadow=new Ee:G.mode===i.RotatedPoissonDisk?this.shadow=new we:G.mode===i.VSM&&(this.shadow=new xe)},t.prototype.generateShaders=function(){this.initShadow();var e="",t="",n="",r="",i="";n+=this.shadow.getDeclarationInFragment();var o=this.scene.getLightsInfo();return Object.keys(o).forEach(function(a){var s=o[a],u=s.lights,c=s.varName,l=s.declaration;u.forEach(function(r,o){r instanceof m.a?(r.calculateShadow(),e+=r.shadowSnippet.vertex.declaration,t+=r.shadowSnippet.vertex.calculation,n+=r.shadowSnippet.fragment.declaration,r.shadowSnippet.fragment.calculation,i+="result += calc"+a+"("+c+"s["+o+"], normal, v_Position, viewDir, u_ShadowMap"+r.index+", v_PositionFromLight"+r.index+");"):i+="\n          for(int i = 0; i < "+u.length+"; i++) {\n            result += calc"+a+"("+c+"s[i], normal, v_Position, viewDir);\n          }\n        "}),r+="\n        "+l+"\n        uniform "+a+" "+c+"s["+u.length+"];\n      "}),{vertexShader:"\n      attribute vec4 a_Position;\n      attribute vec4 a_Color;\n      attribute vec4 a_Normal;\n      attribute vec2 a_TextureCoord;\n\n      uniform mat4 u_MvpMatrix;\n      uniform mat4 u_ModelMatrix;\n      uniform mat4 u_NormalMatrix;\n      \n      varying vec4 v_Color;\n      varying vec3 v_Normal;\n      varying vec3 v_Position;\n      varying vec2 v_TextureCoord;\n      \n      "+e+"\n      void main() {\n        "+t+"\n        v_Position = vec3(u_ModelMatrix * a_Position);\n        v_Normal = vec3(u_NormalMatrix * a_Normal);\n        v_Color = a_Color;\n        v_TextureCoord = a_TextureCoord;\n        gl_Position = u_MvpMatrix * a_Position;\n      }\n    ",fragmentShader:"\n      precision mediump float;\n      #define PI 3.141592653589793\n      uniform vec3 u_CameraPosition;\n      uniform float u_Diffuse;\n      uniform float u_Specular;\n      uniform float u_Shininess;\n      uniform sampler2D u_MaterialTexture;\n\n      varying vec3 v_Normal;\n      varying vec3 v_Position;\n      varying vec4 v_Color;\n      varying vec2 v_TextureCoord;\n\n      float attenuation(vec3 dir, float constant, float linear, float quadratic){\n        float distance = length(dir);\n        float radiance = 1.0 / (constant + distance * linear + pow(distance, 2.0) * quadratic);\n        return clamp(radiance, 0.0, 1.0);\n      }\n\n      "+n+"\n      "+r+"\n\n      void main() {\n        vec3 normal = normalize(v_Normal);\n        vec3 viewDir = normalize(u_CameraPosition - v_Position);\n        vec3 result = vec3(0.0);\n\n        // calculate lights\n        "+i+"\n\n        vec4 color = texture2D(u_MaterialTexture, v_TextureCoord) + v_Color;\n        gl_FragColor = vec4(result * color.rgb, color.a);\n      }\n    "}},t.prototype.setupTexture=function(e,t){var n=this.gl,r=this.shader.program;if(!Me){var i=n.createTexture();n.activeTexture(n["TEXTURE"+A]),n.bindTexture(n.TEXTURE_2D,i),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,new Uint8Array([0,0,0,255])),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),Me=!0}var o=this.gl.getUniformLocation(r,"u_MaterialTexture");if(this.gl.uniform1i(o,e&&e.id||A),!Object(v.b)(n,r,"a_TextureCoord",t,2,n.FLOAT))return-1},t.prototype.setupLights=function(e){var t=this.gl,n=this.shader.program,r=this.scene.getLightsInfo();Object.keys(r).forEach(function(i){var o=r[i],a=o.lights,s=o.varName;a.forEach(function(r,i){var o;r.setUniforms(t,n,s+"s["+i+"]"),Object(v.a)(t,n,((o={})["u_MvpMatrixFromLight"+r.index]=e[r.index],o))})}),this.shadow.setUniforms(t,n)},t.prototype.draw=function(){var e=this,t=this.gl,n=this.shader.program,r=this.renderer.getSize(),i=r.width,o=r.height;t.viewport(0,0,i,o),this.activate(),Object(v.a)(t,n,{u_CameraPosition:this.camera.eye}),this.scene.meshes.forEach(function(r){var i=r.geometry,o=r.material,a=r.colorAttributeArray,s=r.mvpMatrixFromLight,u=i.vertices,c=i.normals,l=i.modelMatrix,f=i.textureCoords,h=o.diffuse,d=o.specular,p=o.shininess,_=o.texture,m=(o.color,e.camera.transform.x(l)),g=l.inverse().transpose();return Object(v.a)(t,n,{u_MvpMatrix:m,u_ModelMatrix:l,u_NormalMatrix:g,u_Diffuse:h,u_Specular:d,u_Shininess:p}),e.setupTexture(_,f),e.setupLights(s),Object(v.b)(t,n,"a_Position",u,3,t.FLOAT)&&Object(v.b)(t,n,"a_Color",a,3,t.FLOAT)&&Object(v.b)(t,n,"a_Normal",c,3,t.FLOAT)?void r.geometry.draw(t):-1})},t=Oe([Object(a.injectable)(),Re(0,Object(a.inject)(s.a.IRendererService)),Re(1,Object(a.inject)(s.a.ISceneService)),Re(2,Object(a.inject)(s.a.ICameraService)),Ce("design:paramtypes",[Object,Object,Object])],t)}(_.a),Ie=n(21),Ne=n(17),De=ee.get(s.a.ISceneService),Le=ee.get(s.a.IRendererService),Fe=ee.get(s.a.ICameraService),Ue=(ee.get(s.a.IControlsService),ee.get(s.a.ITextureLoaderService));Le.on(h.a.READY_EVENT,function(){var e=Le.getSize(),t=e.width,n=e.height;Fe.init($V([0,5,10]),$V([0,0,0]),60,t/n,.1,100),Fe.dolly(-10);var r=Ue.load("/ray-tracer/static/images/floor-wood.jpg");De.addMesh(new te.a({geometry:new w({center:$V([0,0,0]),width:10,height:10}),material:new Ne.a({texture:r})})),De.addMesh(new te.a({geometry:new ie({center:$V([0,1,0]),radius:.5}),material:new Ne.a({color:$V([1,.5,0])})})),De.addLight(new p.a({position:$V([0,10,0]),direction:$V([0,-1,0]),angle:24,exponent:40,model:new Ie.a({ambient:$V([.2,.2,.2]),diffuse:$V([1,1,1]),specular:$V([1,1,1]),attenuation:{linear:.1,quadratic:.01}})})),Le.addShader(new G(Le,De,Fe)),Le.addShader(new Pe(Le,De,Fe))})}]);